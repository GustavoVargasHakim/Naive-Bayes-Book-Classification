Introduction to
Financial Mathematics
Concepts and Computational Methods
Arash Fahim

Introduction to Financial
Mathematics
Concepts and Computational Methods
Arash Fahim
Florida State University
July 8, 2019

Copyright © 2019, Arash Fahim

This work is licensed under a Creative Commons Attribution-NonCommercialShareAlike 4.0 International License.
You are free to:
Share—copy and redistribute the material in any medium or format
Adapt—remix, transform, and build upon the material
Under the following terms:
Attribution—You must give appropriate credit, provide a link to the license, and
indicate if changes were made. You may do so in any reasonable manner, but not
in any way that suggests the licensor endorses you or your use.
NonCommercial—You may not use the material for commercial purposes.
ShareAlike—If you remix, transform, or build upon the material, you must
distribute your contributions under the same license as the original.
This publication was made possible by an Alternative Textbook Grant issued by Florida
State University Libraries. This work is published by Florida State University
Libraries, 116 Honors Way, Tallahassee, FL 32306.
DOI: 10.33009/financialmath1

ii

Dedicated to Nasrin, Sevda and Idin.

iv

Notations

v

Table 1: Table of Notation

A Ÿ B

fi

union of two disjoint set A and B

Rd

fi

d-dimensional Euclidean space

Rd`

fi

All points in Rd with nonnegative coordinates

x P Rd

fi

d-dimensional column vector

minpx, yq
“
pminpx1 , y1 q, ..., minpxn , yn qq
x` “ minpx, 0q

fi

component-wise minimum of two vectors

fi

component-wise minimum of a vector with zero
vector

AT

fi

transpose of matrix A

fi

inner (dot) product in Euclidean space

A“0

fi

all the entities of the matrix (vector) A are zero

A‰0

fi

at least of the entities of the matrix (vector) A
is nonzero

A ě 0 (A ą 0)

fi

all the entities of the matrix (vector) A are nonnegative (positive)

∇f

fi

column vector of gradient for a diﬀerentiable
function f : Rd Ñ R

∇2 f

fi

Hessian matrix for a twice diﬀerentiable function
f : Rd Ñ R

P or P̂

fi

Probability

PpAq (resp. P̂pAq)

fi

Probability of an event A under probability P
(resp. P̂)

ErXs (resp. ÊrXs)

fi

Expected value of a random variable X under
probability P (resp. P̂)

x¨y “

xT y

vi

Preface
The story of this book started when I was assigned to teach an introductory financial mathematics course at Florida State University. Originally, this course was all measure theory,
integration and stochastic analysis. Then, it evolved to cover theory of measures, some
probability theory, and option pricing in the binomial model. When I took over this course,
I was not sure what I was going to do. However, I had a vision to educate students about
some new topics in financial mathematics, while keeping the classical risk management
material. My vision was to include some fundamental ideas that are shared between all
models in financial mathematics, such as martingale property, Makrovian property, timehomogeneity, and the like, rather than studying a comprehensive list of models. To start,
I decided to seek advise from a colleague to use a textbook by two authors, a quantitative
financial analysts and a mathematician. The textbook was a little diﬀerent and covered
various models that quants utilize in practice. The semester started, and as I was going
through the first couple of sections from the textbook, I realized that the book was unusable; many grave mistakes and wrong theorems, sloppy format, and coherency issues made
it impossible to learn from this textbook. It was my fault that I only skimmed the book
before the start of semester. A few months later, I learned that another school had had
the same experience with the book as they invited one of the authors to teach a similar
course. Therefore, I urgently needed a plan to save my course. So, I decided to write my
own lecture notes based on my vision, and, over the past three years, these lecture notes
grew and grew to include topics that I consider useful for students to learn. In 2018, the
Florida State University libraries awarded me the “Alternative Textbook Grant” to help
me make my lecture notes into an open access free textbook. This current first edition is
the result of many hours of eﬀort by my library colleagues and myself.
Many successful textbooks on financial mathematics have been developed in the recent
decades. My favorite ones are the two volumes by Steven Shreve, Stochastic Calculus for
Finance I and II ; [27, 28]. They cover a large variety of topics in financial mathematics
with emphasis on the option pricing, the classical practice of quantitative financial analysts
(quants). It also covers a great deal of stochastic calculus which is a basis for modeling
almost all financial assets. Option pricing remains a must-know for every quant and stochastic calculus is the language of the quantitative finance. However over time, a variety of
other subjects have been added to the list of what quants need to learn, including eﬃcient
vii

computer programming, machine learning, data mining, big data, and so on. Many of
these topics were irrelevant in 70s, when the quantitative finance was initially introduced.
Since then, financial markets has changed in the tools that the traders use, and the speed
of transactions. This is a common feature of many disciplines that the amount of data that
can be used to make business decisions is too large to be handled by classical statistical
techniques. Also, financial regulations has been adjusted to the new market environment.
They now require financial institutions to provide structured measurements of some of their
risks that is not included in the classical risk management theory. For instance, after the
financial meltdown in 2007, systemic risk and central clearing became important research
areas for the regulator. In addition, a demand for more robust evaluation of risks led to
researches in the robust risk management and model risk evaluations.
As the financial mathematics career grows to cover the above-mentioned topics, the
prospect of the financial mathematics master’s programs must also become broader in
topics. In the current book, I tried to include some new topics in an introductory level.
Since this is an open access book, it has the ability to include more of the new topics in
financial mathematics.
One of the major challenges in teaching financial mathematics is the diverse background of
students, at least in some institutions such as Florida State University. For example, some
students whom I observed during the last five years, have broad finance background but
lack the necessary mathematical background. They very much want to learn the mathematical aspects, but with fewer details and stepping more quickly into the implementational
aspects. Other students have majors in mathematics, engineering or computer science who
need more basic knowledge in finance. One thing that both groups need is to develop
their problem-solving abilities. Current job market favors employees who can work independently and solve hard problems, rather than those who simply take instructions and
implement them. Therefore, I designed this book to serve as an introductory course in
financial mathematics with focus on conceptual understanding of the models and problem
solving, in contrast to textbooks that include more details of the specific models. It includes
the mathematical background needed for risk management, such as probability theory, optimization, and the like. The goal of the book is to expose the reader to a wide range
of basic problems, some of which emphasize analytic ability, some requiring programming
techniques and others focusing on statistical data analysis. In addition, it covers some
areas which are outside the scope of mainstream financial mathematics textbooks. For
example, it presents marginal account setting by the CCP and systemic risk, and a brief
overview of the model risk.
One of the main drawbacks of commercial textbooks in financial mathematics is the lack
of flexibility to keep up with changes of the discipline. New editions often come far apart
and with few changes. Also, it is not possible to modify them into the course needed for
a specific program. The current book is a free, open textbook under a creative common
license with attribution. This allows instructors to use parts of this book to design their
own course in their own program, while adding new parts to keep up with the changes and
viii

the institutional goals of their program.
The first two chapters of this book only require calculus and introductory probability
and can be taught to senior undergraduate students. There is also a brief review of these
topics in Sections A.1 and B of the appendix. I tried to be as brief as possible in the
appendix; many books, including Stochastic Calculus for Finance I ([27, 28]) and Convex
Optimization ([8]), cover these topics extensively. My goal to include these topics is only
to make the current book self-suﬃcient. The main goal of Chapter 1 is to familiarize
the reader with the basic concepts of risk management in financial mathematics. All
these concepts are first introduced in a relatively nontechnical framework of one-period
such as Markowitz portfolio diversification or the Arrow-Debreu market model. Chapter
2 generalizes the crucial results of the Arrow-Debreu market model to the multiperiod
case and introduces the multiperiod binomial model and the numerical methods based on
it. Chapter 3 discusses more advanced subjects in probability, which are presented in the
remainder of Section B and Section C of the appendix. This chapter is more appropriate
for graduate students. In Section 3.2, we first build important concepts and computational
methods in continuous-time through the Bachelier model. Then, we provide the outline
for the more realistic Black-Scholes model in Section 3.3. Chapter 4 deals with pricing a
specific type of financial derivative: American options. Sections 4.0.1 and 4.1 can be studied
directly after finishing Chapter 2. The rest of this section requires an understanding of
Section 3.3 as a prerequisite. The inline exercises and various examples can help students
to prepare for the exams on this book. Many of the exercises and the examples are brand
new and are specifically created for the assignments and exams during the three last years
of teaching the course.

Acknowledgements
I am grateful to the staﬀ of Florida State University libraries who awarded me the Alternative Textbook Grant and guided me through the process of creating this book from my
lecture notes; especially my thanks goes to Devin Soper who introduced me to the grant and
walked me through the process. I learned all I know about diﬀerent licenses of intellectual
material from him. The copyedit was also managed by Devin. Laura Miller, a library intern, has been very helpful with Pandoc, a software that converts LATEXinto MS Word. She
also created some designs of the verso page for me to chose. Matthew Hunter helped me to
find the right option when I needed to do indexing and other thing that I never did before.

ix

x

TABLE OF CONTENTS

TABLE OF CONTENTS

Table of Contents
1 Preliminaries of finance and risk management
1.1 Basic financial derivatives . . . . . . . . . . . .
1.1.1 Futures and forward contracts . . . . .
1.1.2 Eisenberg-Noe model CCP . . . . . . .
1.1.3 Vanilla call and put options . . . . . . .
1.1.4 American options . . . . . . . . . . . . .
1.1.5 Bond and forward rate agreements . . .
1.1.6 Credit derivatives . . . . . . . . . . . . .
1.2 Optimization in finance . . . . . . . . . . . . .
1.3 No-dominance principle and model-independent

. . . . . .
. . . . . .
. . . . . .
. . . . . .
. . . . . .
. . . . . .
. . . . . .
. . . . . .
arbitrage

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

.
.
.
.
.
.
.
.
.

2 Modeling financial assets in discrete-time markets
2.1 Arrow-Debreu market model . . . . . . . . . . . . . . . . . . . . . . . . . .
2.1.1 Arbitrage portfolio and the fundamental theorem of asset pricing . .
2.1.2 Arrow-Debreu market model with a risk-free bond . . . . . . . . . .
2.1.3 One-period binomial model . . . . . . . . . . . . . . . . . . . . . . .
2.1.4 One-period trinomial model . . . . . . . . . . . . . . . . . . . . . . .
2.1.5 Replication and complete market . . . . . . . . . . . . . . . . . . . .
2.1.6 Superreplication and model risk . . . . . . . . . . . . . . . . . . . . .
2.2 Multiperiod discrete-time markets . . . . . . . . . . . . . . . . . . . . . . .
2.2.1 A discussion on the sample space for multiperiod asset price process
2.2.2 Arbitrage and trading in multiperiod discrete-time markets . . . . .
2.3 Binomial model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.3.1 No-arbitrage condition . . . . . . . . . . . . . . . . . . . . . . . . . .
2.3.2 Basic properties of the binomial model . . . . . . . . . . . . . . . . .
2.3.3 Arbitrage pricing and replicating European contingent claims in the
binomial model . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.3.4 Dividend-paying stock . . . . . . . . . . . . . . . . . . . . . . . . . .
2.4 Calibrating the parameters of the model to market data: the binomial model
xi

1
2
2
7
10
14
14
20
28
33
39
39
41
44
51
55
56
58
64
64
66
75
76
77
80
90
93

TABLE OF CONTENTS

TABLE OF CONTENTS

3 Modeling financial assets in continuous-time
3.1 Trading and arbitrage in continuous-time markets . . . . . . . . . . . . . .
3.2 Bachelier’s continuous-time market . . . . . . . . . . . . . . . . . . . . . . .
3.2.1 Pricing and replicating contingent claims in the Bachelier model . .
3.2.2 Numerical methods for option pricing in the Bachelier model . . . .
3.2.3 Discussion: drawbacks of the Bachelier model . . . . . . . . . . . . .
3.3 Continuous-time market of Black-Scholes . . . . . . . . . . . . . . . . . . .
3.3.1 The Black-Scholes model: limit of binomial under risk-neutral probability . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.3.2 Pricing contingent claims in the Black-Scholes model . . . . . . . . .
3.3.3 Delta hedging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.3.4 Completeness of the Black-Scholes model . . . . . . . . . . . . . . .
3.3.5 Error of discrete hedging in the Black-Scholes model and Greeks . .
3.3.6 Time-varying B-S . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
3.3.7 Black-Scholes with yield curve and forward interest rate . . . . . . .
3.3.8 Black-Scholes model and Brownian motion . . . . . . . . . . . . . .
3.3.9 Physical versus risk-neutral in the Black-Scholes model . . . . . . .
3.3.10 Black-Scholes partial diﬀerential equation . . . . . . . . . . . . . . .
3.3.11 Numerical methods for the Black-Scholes price of a European option
3.3.12 Stock price with dividend in the Black-Scholes model . . . . . . . . .

101
102
104
105
117
129
129
129
135
137
140
140
147
150
151
154
156
158
162

4 American options
167
4.0.1 Pricing American option in the binomial model via examples . . . . 168
4.1 Pricing American option in the binomial model; problem formulation . . . . 172
4.2 Pricing American option in the Black-Scholes model . . . . . . . . . . . . . 179
Appendices
A
Convex optimization . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
A.1
Convex functions . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
A.2
Convex constrained optimization . . . . . . . . . . . . . . . . . . . .
B
A review of probability theory . . . . . . . . . . . . . . . . . . . . . . . . . .
B.1
Basic concepts and definitions of discrete probability . . . . . . . . .
B.2
General probability spaces . . . . . . . . . . . . . . . . . . . . . . . .
B.3
Martingales . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
B.4
Characteristic functions and weak convergence . . . . . . . . . . . .
B.5
Donsker Invariance Principle and Brownian motion . . . . . . . . . .
C
Stochastic analysis . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
C.1
Stochastic integral with respect to Brownian motion and Itô formula
C.2
Itô formula . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
C.3
Martingale property of stochastic integral and partial diﬀerential
equations . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
xii

191
191
193
199
204
213
240
247
252
256
257
261
262

TABLE OF CONTENTS
C.4
C.5

TABLE OF CONTENTS

Stochastic integral and Stochastic diﬀerential equation . . . . . . . . 263
Itô calculus . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 266

xiii

TABLE OF CONTENTS

TABLE OF CONTENTS

xiv

1. PRELIMINARIES

1

Preliminaries of finance and risk
management
A risky asset is an asset with an uncertain future price, e.g. the stock of a company in an
exchange market. Unlike a risky asset, a bank account with a fixed interest rate has an absolutely predictable value, and is called a risk-free asset. Risky assets are classified in many
diﬀerent categories. Among them, financial securities, which constitute the largest body of
risky assets, are traded in the exchange markets and are divided into three subcategories:
equity, debt, and derivatives.
An equity is a claim of ownership of a company. If it is issued by a corporation, it is called
common stock, stock, or share. Debt, sometimes referred to as a fixed-income instrument,
promises a fixed cash flow until a time called maturity and is issued by an entity as a means
of borrowing through its sale. The cash flow from a fixed-income security is the return of
the borrowed cash plus interest and is subject to default of the issuer, i.e., if the issuer is
not able to pay the cash flow at any of the promised dates. A derivative is an asset whose
price depends on a certain event. For example, a derivative can promise a payment (payoﬀ)
dependent on the price of a stock, the price of a fixed-income instrument, the default of a
company, or a climate event.
An important class of assets that are not financial securities are described as commodities.
Broadly speaking, a commodity is an asset which is not a financial security but is still
traded in a market, for example crops, energy, metals, and the like. Commodities are in
particular important because our daily life depends on them. Some of them are storable
such as crops, which some others, such as electricity, are not. Some of them are subject
to seasonality, such as crops or oil. The other have a constant demand throughout the
year, for instance aluminum or copper. These various features of commodities introduce
challenges in modeling commodity markets. There are other assets that are not usually
included in any of the above classes, for instance real estate.
If the asset is easily traded in an exchange market, it is called liquid. Equities are the
1

1.1. BASIC FINANCIAL DERIVATIVES

1. PRELIMINARIES

most liquid of assets; fixed-income instruments and derivatives are less liquid. Commodities
have become very liquid, partly due to the introduction of emerging economies in the global
marketplace. Real estate is one of the most illiquid of assets.
Asset

Risky

Equity

Securities

Commodities

Debt

Derivatives

Risk free: Government bond

Real estate

...

Figure 1.0.1: Classification of assets

1.1

Basic financial derivatives

Financial risk is defined as the risk of loss of investment in financial markets. Two of the
main categories of financial risk are market risk, causes by the changes in the price of
market equities, and credit risk, caused by the default of a party in meeting its obligations.
Financial derivatives are designed to cover the loss caused by the market risk and the credit
risk. There are other important forms of financial risk such as operational risk and systemic
risk. However, these are irrelevant to the study of financial derivatives. Therefore, in this
section, we cover the basics of some simple financial derivatives on the market risk, bonds
and some credit derivatives. In practice, bonds are not considered as derivative. However,
theoretically, a bond is a derivative on the interest rate.

1.1.1

Futures and forward contracts

Forward and futures contracts are the same in principle, but they diﬀer in operational
aspects. In both contracts, the two parties are obliged to exchange a specific asset at a
specific date in the future at a fair price that they have agreed upon. The asset subject
to exchange is called the underlying asset; the date of exchange is called the maturity
date; and the price is called the forward/futures price. In other words, futures and forward
contracts lock the price at the moment of a deal in the future.
Forward contracts are simpler than futures. They are nontradable contracts between two
specific parties, one of whom is the buyer of the underlying asset, or the long position, and
the other is the seller of the underlying asset, or the short position. The buyer (seller) is
2

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

Risk
Nonfinancial

Financial

Market

Credit

Operational

Systemic

Insurance

Figure 1.1.1: A classification of risks

obliged to buy (sell) a determined number of units of the underlying asset from the seller
(to the buyer) at a price specified in the forward contract, called the forward price. The
forward price is usually agreed upon between two parties at the initiation of the contract.
The forward contract price is not universal and depend upon what the two parties agree
upon. Two forward contracts with the same maturity on the same underlying asset can
have two diﬀerent forward prices. Usually, one party is the issuer of the forward contract
and quotes the forward price to the other party, or the holder, who faces a decision to
agree or decline to enter the deal. Generally, the issuer is a financial firm and the holder
is a financial or industrial firm. Unlike forward contracts, futures contracts are tradable

Over-the-counter:

Long position

Central clearing:

Long position

Short position

CCP

Short position

Figure 1.1.2: Forward (top) versus futures (bottom). In futures markets, the CCP
regulates the contracts to eliminate the counterparty risk.
in specialized markets. Therefore, given a fixed underlying asset and a fixed maturity T ,
across the market there is only one futures price, a price listed in the futures market. In
other words, the futures price at time t for delivery date (maturity) T is not agreed upon
between two parties only; rather, it reflects the cumulative attitude of all investors toward
the price of the underlying asset at maturity T . The futures price is diﬀerent from the
current price of the underlying, the spot price. For a specific underlying asset, we denote
by Ft pT q the futures price at time t for delivery at T and by St the spot price at time t .
3

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

Ft pT q and St are related through
lim Ft pT q “ ST .

tÑT

To avoid counterparty risk, i.e., the risk that either of the parties might be unable to meet
their obligation on the futures, the market has a central counterparty clearinghouse (CCP).
When a trader enters the futures market, per the CCP regulation, he or she is required
to open a marginal account that is managed by the CCP. The marginal account works as
collateral; if the holder cannot meet her obligation, the CCP closes the account to cover
the failure of the party. A holder of a futures contract is supposed to keep the amount
of money in the marginal account above a level variable with changes in the futures price.
To understand the operation of a marginal account, consider a long position, the party
who is obliged to buy the underlying at time T at price F0 pT q. The financial gain/loss
from a derivative is called the payoﬀ of the derivative. Her financial payoﬀ at time T is
ST ´ F0 pT q, because she is obliged to buy the underlying at price F0 pT q while the market
price is ST . See Figure 1.1.3. While F0 pT q is fixed and remains unchanged over the term
of the contract, the underlying price ST is unknown. If at time T , F0 pT q ą ST , then she
loses the amount of F0 pT q ´ ST . The aim of the CCP is to make sure that the long position

ST − K

K − ST

K

ST

K

ST

Figure 1.1.3: The payoﬀ of forward/futures at maturity T as a function of the price of
underlying ST . K is the forward/futures price, i.e., K “ F0 pT q. Left: long position. Right:
short position.

holds at least F0 pT q ´ ST in her marginal account when is in the loosing position, i.e.,
F0 pT q ą ST . To do this, the CCP asks her to always rebalance her marginal account to
4

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

keep it above pF0 pT q ´ St q` 1 at any day t “ 0, ..., T to cover the possible future loss. An
example of marginal account rebalancing is shown in Table 1.1.
Time t
Underlying asset price St
Marginal account
Changes to the marginal account

0
87.80
.20
–

1
87.85
.15
-.05

2
88.01
0
-.15

3
88.5
0
0

4
87.90
.10
+.10

Table 1.1: Rebalancing the marginal account of a long position in futures with F0 pT q=$88
in four days.
The marginal account can be subject to several regulations, including minimum cash
holdings. In this case, the marginal account holds the amount of pF0 pT q ´ St q` plus the
minimum cash requirement. For more information of the mechanism of futures markets,
see [16, Chapter 2].
The existence of the marginal account creates an opportunity cost; the fund in the
marginal account can alternatively be invested somewhere else for profit, at least in a
risk-free account with a fixed interest rate. The following example illustrates the opportunity cost.
Example 1.1.1 (Futures opportunity cost). Consider a futures contract with maturity T
of 2 days, a futures price equal to $99.95, and a forward contract with the same maturity
but a forward price of $100. Both contracts are written on the same risky asset with spot
price S0 “ $99.94. The marginal account for the futures contract has a $10 minimum cash
requirement and should be rebalanced daily thereafter according to the closing price. We
denote the day-end price by S1 and S2 for day one and day two, respectively. Given that
the risk-free daily compound interest rate is 0.2%, we want to find out for which values
of the spot price of the underlying asset, pS1 , S2 q, the forward contract is more interesting
than the futures contract for long position.
Time t
Underlying asset price St
Marginal account

0
99.94
10.01

1
S1
10+p99.95 ´ S1 q`

2
S2
closed

The payoﬀ of the forward contract for the long position is ST ´100, while the same quantity
for the futures is ST ´ 99.95. Therefore, the payoﬀ of futures is worth .05 more than the
payoﬀ of the forward on the maturity date T “ 2.
However, there is an opportunity cost associated with futures contract. On day one, the
marginal account must have $10.01; the opportunity cost of holding $10.01 in the marginal
1

pxq` :“ maxtx, 0u

5

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

account for day one is
p10.01qp1 ` .002q ´ 10.01 “ p10.01qp.002q “ .02002,
which is equivalent to p.02002qp1.002q “ .02006004 at the end of day two. On day two, we
have to keep $10 plus p99.95 ´ S1 q` in the marginal account which creates an opportunity
cost of p.002qp10 ` p99.95 ´ S1 q` q. Therefore, the actual payoﬀ of the futures contract is
calculated at maturity as
ST ´ 99.95 ´ p1.002q

p.002qp10.01q
loooooomoooooon

´p.002q p10
` p99.95 ´ S1 q` q
loooooooooooomoooooooooooon

Opportunity cost of day 1

Opportunity cost of day 2

“ ST ´ 99.99006004 ´ p.002qp99.95 ´ S1 q` .
The total gain/loss of futures minus forward is
f pS1 q :“ST ´ 99.99006004 ´ p.002qp99.95 ´ S1 q` ´ ST ` 100
“.00993996 ´ p.002qp99.95 ´ S1 q`
shown in Figure 1.1.4,

f (S1 )
.00993996
−.18996004

94.98002

99.95

S1

Figure 1.1.4: The diﬀerence between the gain of the futures and forward in Example
1.1.1.
Exercise 1.1.1. Consider a futures contract with maturity T “ 2 days and futures price
equal to $100, and a forward contract with the same maturity and forward price of $99;
both are written on a risky asset with price S0 “ $99. The marginal account for the
futures contract needs at least $20 upon entering the contract and should be rebalanced
thereafter according to the spot price at the beginning of the day. Given that the risk-free
daily compound interest rate is 0.2%, for which values of the spot price of the underlying
asset, pS1 , S2 q, is the forward contract is more interesting than the futures contract for the
short position?
A futures market provides easy access to futures contracts for a variety of products and
for diﬀerent maturities. In addition, it makes termination of a contract possible. A long
position in a futures can even out his position by entering a short position of the same
contract.
6

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

One of the practices in the futures market is rolling over. Imagine a trader who needs
to have a contract on a product at a maturity T far in the future, such that there is no
contract in the futures market with such maturities. However, there is one with maturity
T1 ă T . The trader can enter the futures with maturity T1 and later close it when a
maturity T2 ą T1 become available. Then, he can continue thereafter until he reaches
certain maturity T .
It is well known that in an ideal situation, the spot price St of the underlying is less than or
equal to the forward/futures price Ft pT q which is referred to as contango; see Proposition
1.3.1 for a logical explanation of this phenomena. In reality, this result can no longer be true;
especially for futures and forwards on commodities which typically incur storage cost or
may not even be storable. A situation in which the futures price of a commodity is less than
the spot price is called normal backwardation or simply backwardation. Backwardation is
more common in commodities with relatively high storage cost; therefore, a low futures
price provides an incentive to go into a futures contract. In contrast, when the storage cost
is negligible, then contango occurs. We close the discussion on futures and forward with

ST

Forward price (Contango)
Spot price
Forward price (Backwardation)

0

T

Figure 1.1.5: Contango vs backwardation. Recall that limtÑT Ft pT q “ ST implies that
the forward price and spot price must converge at maturity.
a model for CCP to determine the marginal account. Notice that the material in 1.1.2 is
not restricted to futures market CCP and can be generalized to any market monitored by
the CCP.

1.1.2

Eisenberg-Noe model CCP

The CCP can be a useful tool to control and manage systemic risk by setting capital
requirements for the entities in a network of liabilities. Because if the marginal account
7

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

is not set properly, default of one entity can lead directly to a cascade of defaults. Legal
action against a defaulted entity is the last thing the CCP wants to do.
Assume that there are N entities in a market and that Lij represents the amount that
entity i owes to entity j. Entity i has an equity (cash) balance of ci ě 0 in a marginal
account with the CCP. The CCP wants to mediate by billing entity i amount pi as a
clearing payment and use it to pay the debt of entity i to other entities. We introduce the
liability matrix L consisting of all mutual liabilities Lij . It is obvious that Lii “ 0, since
there is no self-liability.
»
fi
0
L1,2 ¨ ¨ ¨ L1,N ´1
L1,N
— L2,1
0
¨¨¨
¨¨¨
L2,N ﬃ
—
ﬃ
—
ﬃ
..
..
L “ — ...
ﬃ
.
.
—
ﬃ
–LN ´1,1 ¨ ¨ ¨ ¨ ¨ ¨
0
LN ´1,N fl
LN,1 LN,2 ¨ ¨ ¨ LN,N ´1
0
ř
Lji
We define Lj :“ N
i“1 Lji to be the total liability of entity j and define the weights πji :“ Lj
as the portion of total liability of entity j that is due to entity i. If a clearing payment pj
is made by entity j to the CCP, then entity i receives πji pj from the CCP. Therefore, after
ř
all clearing payments p1 , ..., pN are made, the entity i receives total of N
j“1 πji pj . In [11],
the authors argue that a clearing payment pi must not exceed either the total liability Li
or the total amount of cash available by entity i.
First, the Eisenberg-Noe model assume that the payment vector cannot increase the liability, i.e., pi ď Li for all i. Secondly, if the equity (cash) of entity
i is given by ci , then
ř
after the clearing payment, the balance of the entity i, i.e., ci ` N
π
j“1 ji pj ´ pi must remain
nonnegative. Therefore, the model suggests that the clearing payment p satisfies
#
+
N
ÿ
pi “ min Li , ci `
πji pj
for all i.
j“1

In other word, the clearing payment vector p “ pp1 , ..., pN q is therefore a fixed point of
the map Φppq “ pΦ1 ppq, ..., ΦN ppN qq, where the function Φ : r0, L1 s ˆ ¨ ¨ ¨ ˆ r0, LN s Ñ
r0, L1 s ˆ ¨ ¨ ¨ ˆ r0, LN s is given by
#
+
N
ÿ
Φi ppq :“ min Li , ci `
πji pj
for i “ 1, .., N.
j“1

In general, the clearing payment vector p “ pp1 , ..., pN q is not unique. The following
theorem characterizes important properties of the clearing vector.
Theorem 1.1.1 ([11]). There are two clearing payment vectors pmax and pmin such that
for any clearing payment p, we have pmin
ď pi ď pmax
for all i “ 1, ..., N .
i
i
8

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

In addition, the value of the equity of each entity remains unaﬀected by the choice of clearing
vector payment; i.e., for all i “ 1, ..., N and for all clearing vector payments p,
ci `

N
ÿ
j“1

πji pj ´ pi “ ci `

N
ÿ

πji pmax
´ pmax
“ ci `
j
i

j“1

N
ÿ

πji pmin
´ pmin
j
i

j“1

Remark 1.1.1. The above theorem asserts that if by changing the clearing payment, entity
i pays more to other entities, it is going to receive more so the total balance of the equity
remains the same.
If an entity cannot clear all its liability with a payment vector, i.e., Li ą pi , then we say
that the entity has defaulted. Obviously, the equity of a defaulted
ř entity vanishes. The
vanishing of an equity can also happen without default when ci ` N
j“1 πji pj “ pi “ Li .
A condition for the uniqueness of the clearing payment vector is provided in the original
work of Eisenberg-Noe,[11]. However, the condition is restrictive and often hard to check
in a massive network of liabilities. On the other hand, the equity of each entity does not
depend on the choice of the payment vector. In a massive network, the problem of finding
at least one payment vector can also be challenging. One of the ways to find a payment
vector is through solving a linear programming problem.
Theorem 1.1.2 ([11]). Let f : RN Ñ R be a strictly increasing function. Then, the
minimizer of the following linear programming problem is a clearing payment vector.
max f ppq subject to p ě 0, p ď L and p ď c ` pΠ,

(1.1.1)

where c “ pc1 , ..., cN q is the vector of the equities of the entities, L “ pL1 , ..., LN q is the
vector of the total liability of the entities, and Π is given by
»
fi
0
π1,2 ¨ ¨ ¨ π1,N ´1
π1,N
— π2,1
0
¨¨¨
¨¨¨
π2,N ﬃ
—
ﬃ
— ..
.. ﬃ
..
Π“— .
.
. ﬃ
—
ﬃ
–πN ´1,1 ¨ ¨ ¨ ¨ ¨ ¨
0
πN ´1,N fl
πN,1 πN,2 ¨ ¨ ¨ πN,N ´1
0
Exercise 1.1.2. Consider the
řN liability matrix below by solving the linear programming
problem (1.1.1) with f ppq “ i“1 pi . Each row/column is an entity.
»

0
—0
L“—
–2
0

1
0
0
5

0
2
0
0

fi
1
0ﬃ
ﬃ
1fl
0

The initial equities are given by c1 “ 1, c2 “ 2, c3 “ 0, and c4 “ 0.
9

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

a) By using a linear programming package such as linprog in MatLab, find a clearing
payment vector.
b) Mark the entities that default after applying the clearing payment vector found in part
(a).
c) Increase the value of the equity of the defaulted entities just as much as they do not
default anymore.

1.1.3

Vanilla call and put options

A call option gives the holder the right but not the obligation to buy a certain asset at
a specified time in the future at a predetermined price. The specified time is called the
maturityoption!maturity and often is denoted by T , and the predetermined price is called
the strike price and is denoted by K. Therefore, a call option protects its owner against
any increase in the price of the underlying asset above the strike price at maturity. The
asset price at time t is denoted by St and at the maturity by ST . Call options are available
in the specialized options markets at a price that depends, among other factors, on time
t, T , K, and spot price at current time St “ S. To simplify, we denote the price of a
call option by CpT, K, S, tq2 to emphasize the main factors, i.e., t, T , K, and spot price at
current time S. Another type of vanilla option, the put option, protects its owner against
any increase in the price of the underlying asset above the strike price at the maturity; i.e.,
it promises the seller of the underlying asset at least the strike price at maturity. The price
of put option is denoted by P pT, K, S, tq, or simply P when appropriate.
The payoﬀ of an option is the owner’s gain in a dollar amount. For instance, the payoﬀ
of a call option is pST ´ Kq` . This is because, when the market price at maturity is ST
and the strike price is K, the holder of the option is buying the underlying asset at lower
price K and gains ST ´ K, provided ST ą K. Otherwise, when ST ď K, the holder does
not exercise the option and buys the asset from the market directly. Similarly, the payoﬀ
of a put option is pK ´ ST q` .
Similar to futures, options are also traded in specialized markets. You can see option
chain for Tesla in Figure 1.1.7. The columns“bid” and “ask” indicate the best buy and sell
prices in the outstanding orders, and column“Open Int” (open interest) shows the total
volume of outstanding orders.
When the spot price St of the underlying asset is greater than K, we say that the call
options are in-the-money and the puts options are outof-the-money . Otherwise, when
St ă K, the put options are in-the-money and the call options are out-of-the-money. If the
strike price K is (approximately) the same as spot price St , we call the option at-the-money
(or ATM).
Far in-the-money call or put options are behave like forward contracts but with a wrong
forward price! Similarly, far out-of-the-money call or put options have negligible worth.
2

We will see later that C only depends on T ´ t in many models.

10

1. PRELIMINARIES

K

1.1. FINANCIAL DERIVATIVES

ST

K

ST

Figure 1.1.6: Left: the payoﬀ pST ´ Kq` of a call option with strike K. Right: the payoﬀ
pK ´ ST q` of a put option with strike K.

Figure 1.1.7: Call and put option quotes on Tesla stocks on January 11, 2016. The first
column is the price of the underlying asset (NASDAQ:TSLA). The bid price is the price at
which trades are willing to buy the options and the ask price is the price at which trades
are willing to sell. The spot price at the time was $206.11. Source: Google Finance.

The holder of an option is called a long position, and the issuer of the option is called a
short position. While the holder has the privilege of exercising the option when profitable,
the issuer has the obligation to pay the holder the amount of payoﬀ upon exercise.
A European option is an option whose payoﬀ is a function gpST q of the asset price at
maturity ST . The function g : R` Ñ R is called a European payoﬀ function. Call and
put options are particularly important because any piecewise linear continuous European
payoﬀ can be written as a linear combination (possibly infinite!) of call option payoﬀs
with possibly diﬀerent strikes but the same maturity and a constant cash amount; or,
equivalently, a linear combination of call option payoﬀs and a put option payoﬀ. Therefore,
11

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

Figure 1.1.8: Call and put option quotes on IBM stocks on January 13, 2016. In-themoney options are highlighted. Source: Google Finance.
the price of payoﬀ gpST q “ a0 `

ř

i ai pST

´ Ki q` is given by
ÿ
Bt pT qa0 `
ai CpT, Ki , St , tq.
i

In the above, a0 is the constant cash amount, and for each i, pST ´ Ki q` is the payoﬀ of a
call option with the strike price Ki and the maturity T .
Remark 1.1.2. The underlying asset ST at time T is a call option with strike K “ 0.
Example 1.1.2. Put-call parity suggests that the payoﬀ pK ´ ST q` of a put option can be
written as the summation of payoﬀs of a long position in K amount of cash, a long position
in a call option with payoﬀ pST ´ Kq` , and a short position in an underlying asset. By
Remark 1.1.2, a long position in the underlying asset is a call option with strike 0. See
Figure 1.1.9.

=
K

ST

+
K

ST

+
K

ST

Figure 1.1.9: pK ´ ST q` “ K ` pST ´ Kq` ´ ST .

12

ST

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

Example 1.1.3. An option that promises the payoﬀ gpST q :“ |ST ´K|, as shown in Figure
1.1.10, is made of a long position in a call option with strike K, and long position in a
put with strike K, both with the same maturity. Equivalently, this payoﬀ can be written as
K amount of cash, a short position in underlying, and two long positions in a call option
with strike K, all with the same maturity.

K

ST

K

Figure 1.1.10: Payoﬀ gpST q “ |ST ´ K| from Example 1.1.3

Example 1.1.4. A put option with payoﬀ pK ´ ST q` can be written as K amount of cash,
a short position in a call option with strike 0, and a long position on a call option with
strike K.
Exercise 1.1.3. Consider the payoﬀ gpST q shown in Figure 1.1.6.

g(ST )
K2 −K1
2

K1

K1 +K2
2

K2

ST

Figure 1.1.11: Payoﬀ for Exercise 1.1.3

a) Write this payoﬀ as a linear combination of the payoﬀs of some call options and a
put option with diﬀerent strikes and the same maturity.
b) Repeat part (a) with call options and cash. (No put option is allowed.)
13

1.1. FINANCIAL DERIVATIVES

1.1.4

1. PRELIMINARIES

American options

European options can only be exercised at a maturity for the payoﬀ gpST q. An American
option gives its owner the right but not the obligation to exercise at any date before or
at maturity. Therefore, at the time of exercise τ P r0, T s, an American call option has an
exercise value equal to pSτ ´ Kq` . We use the notation CAm pT, K, S, tq and PAm pT, K, S, tq
to denote the price of an American call and an American put, respectively.
The exercise time τ is not necessarily deterministic. More precisely, it can be a random
time that depends upon the occurrence of certain events in the market. An optimal exercise
time can be found among those of threshold type; the option is exercised before maturity
the first time the market price of option becomes equal to the exercise value, whereas the
option usually has a higher market value than the exercise value. Notice that both of these
quantities behave randomly over time.

1.1.5

Bond and forward rate agreements

A zero-coupon bond (or simply zero bond) is a fixed-income security that promises a fixed
amount of cash in a specified currency at a certain time in the future, e.g., $100 on January
30. The promised cash is called the principle, face value or bond!face value and the time
of delivery is called the maturity. All bonds are traded in specialized markets at a price
often lower than the principle3 .
For simplicity, throughout this book, a zero bond means a zero bond with principle of $1,
unless the principle is specified; for example, a zero bond with principle of $10 is ten zero
bond s. At a time t, we denote the price of a zero bond maturing at T by Bt pT q.
We can use the price of a zero bond to calculate the present value of a future payment
or cashflow. For example, if an amount of $x at time T is worth BtxpT q at an earlier time
t. This is because, if we invest $ BtxpT q in a zero bond with maturity T , at the maturity we
receive a dollar amount of BtxpT q Bt pT q “ x.
The price of the zero bond is the main indicator of the interest rate. While the term
“interest rate” is used frequently in news and daily conversations, the precise definition
of the interest rate depends on the time horizon and the frequency of compounding. An
interest rate compounded yearly is simply related to the zero bond price by 1`R(yr) “ B01p1q ,
`
(mo) ˘12
while for an interest rate compounded monthly, we have 1 ` R 12
“ B01p1q . Therefore,
´
R(mo) ¯12
1 ` R(yr) “ 1 `
.
12
Generally, an n-times compounded interest rate during the time interval rt, T s, denoted
´
¯
pnq
R pT q n
pnq
by Rt pT q, satisfies 1 ` t n
“ Bt1pT q . When the frequency of compounding n
3

There have been instances when this has not held, e.g., the financial crisis of 2007.

14

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

approaches infinity, we obtain
p8q

Bt pT q “ e´Rt

pT q

.

This motivates the definition of the zero-bond yield. The yield (or yield curve) Rt pT q of
the zero bond Bt pT q is defined by
Bt pT q “ e´pT ´tqRt pT q or Rt pT q :“ ´

1
ln Bt pT q.
T ´t

(1.1.2)

The yield is a bivariate function R : pt, T q P D Ñ Rě0 where D is given by tpt, T q : T ą
0 and t ă T u. Yield is sometimes referred to as the term structure of the interest rate since
both variables t and T are time.
If the yield curve is a constant, i.e., Rt pT q “ r for all pt, T q P D, then, Bt pT q “ e´rpT ´tq .
In this case, r is called the continuously compounded, instantaneous, spot, or short rate.
However, the short rate does not need to be constant. A time-dependent short interest
rate is a function
r : r0, T s Ñ R` such that for any T ą 0, and t P r0, T s we have
ş
´ tT rs ds
Bt pT q “ e
; or equivalently, short rate can be defined as
rt :“ ´

B ln Bt pT q ˇˇ
B ln Bt pT q
.
“
ˇ
BT
Bt
T “t

The short rate r or rs is an abstract concept; it exists because it is easier to model the
short rate than the yield curve. In practice, the interest rate is usually given by the yield
curve.
Besides zero bonds, there are other bonds that pay coupons on a regular basis, for example
a bond that pays the principle of $100 in 12 months and $20 every quarter. A couponcarrying bond, or simply, a coupon bond, can often be described as a linear combination
of zero bonds; i.e., a bond with coupon payments of $ ci at date Ti with T1 ă ... ă Tn´1
and principle payment P at maturity Tn “ T is the same as a portfolio of zero bonds with
principle ci and maturity Ti for i “ 1, ..., n and is worth
n´1
ÿ
i“1

ci Bt pTi q ` P Bt pTn q “

n´1
ÿ

ci e´pTi ´tqRt pTi q ` P e´pTn ´tqRt pTn q .

i“1

Therefore, zero bonds are the building blocks of all bonds, and the yield curve is the main
factor in determining the price of all bonds.
Example 1.1.5. A risk-free 1-year zero bond with $20 principle is priced B0 p1q “ $19 and
a risk-free 2-year zero bond with $20 principle is priced B0 p2q “ $17. Then, the yield R1 p2q
is given by
R1 p2q “ ln B0 p1q ´ ln B0 p2q ln B0 p1q “ ln 19 ´ ln 17 « 0.1112,
and the price of a risk-free zero bond that start in one year and ends at in two years with
15

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

principle $20 is given by
B1 p2q “ 100e´R1 p2q “

1700
« 89.47.
19

The price of a bond that pays a $30 coupon at the end of the current year and $100 as the
principle in two years equals to
30

B0 p1q
B0 p2q
` 100
“ 5.9 ` 17 “ 22.9.
100
100

Exercise 1.1.4.
a) If a risk-free 1-year zero bond with $100 principle is priced B0 p1q “
$96 and a risk-free 2-year zero bond with $100 principle is priced B0 p2q “ $92, find
the price of a risk-free zero bond B1 p2q and yield curve R1 p2q.
b) What is the price of a bond that pays a $30 coupon at the end of the current year and
$100 as the principle in two years?
In the above discussion, we implicitly assumed that the issuer of the bond is not subject
to default on payment of coupons or principle. This type of bonds are called sovereign
bonds and are often issued by the Federal Reserve or central bank of a given country in
that country’s own currency. For example, sovereign bonds in the United States are T-bills,
T-notes, and T-bonds. T-bills are bonds that have a maturity of less than a year, T-notes
have a maturity of more than a year up to ten years, and T-bonds have maturity more than
ten years. Bonds issued by other entities or governments in a foreign currency are usually
called corporate bonds. The word “corporate” emphasizes the default risk of the issuer
on the payments. In addition, sovereign bonds in a foreign currency are subject to the
market risk that is caused by fluctuating exchange rates in the foreign exchange market4 .
Therefore, what is considered a risk-free bond in the United States is not risk-free in the
European Union.
The zero bond price Bt pT q can directly be used to discount a payment or a cashflow at
time T without appealing to a specific short rate model. For example, a cashflow of $10 at
time T “ 1 is worth $ 10B0 p1q now.
Similar to the yield curve, the forward rate Ft pT q5 of a zero bond is defined by
Bt pT q “ e´

şT
t

Ft puqdu

or Ft pT q :“ ´

B ln Bt pT q
.
BT

The forward rate reflects the current perception among traders about the future fluctuations
of the interest rates. More precisely, at time t, we foresee the continuously compounded
4
The foreign exchange market is a decentralized over-the-counter market where traders across the world
use to trade currencies.
5
The notation for forward rate is the same as the notation for futures price or forward price in Section
1.1.1.

16

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

interest rates for N time intervals rt0 , t1 s, rt1 , t2 s, ..., rtN ´1 , T s in the future as Ft ptq,
Ft pt1 q, ..., Ft ptN ´1 q, respectively. Here, for n “ 0, ..., N , tn “ t ` nδ and δ “ TN´t .
Then, $1 at time T is worth e´Ft ptN ´1 qδq at time tN ´1 , e´pFt ptN ´1 q`Ft ptN ´2 qqδ at time tN ´2 ,
e´pFt ptN ´1 q`...`Ft ptn qqδ at time tn , and e´pFt ptN ´1 q`...`Ft pt1 q`Ft ptqqδ at time t. As n goes to
infinity, the value Bt pT q of the zero bond converges to
lim e´

řN ´1
n“0

Ft ptn qδ

nÑ8

“ e´

şT
t

Ft puqdu

.

The forward rates are related to so-called forward rate agreements. A forward rate agreement is a contract between two parties both committed to exchanging a specific loan (a
zero bond with a specified principle and a specific maturity) in a future time (called the
delivery date) with a specific interest rate. We can denote the agreed rate by f pt0 , t, T q
where t0 is the current time, t is the delivery date, and T is the maturity of the bond. As
always, we take principle to be $1. Then, the price of the underlying bond at time t should
B pT q
equal Bt pT q “ Btt0 ptq . This is because, if we invest $ x in Bt0 ptq at time t0 , we have Btxptq at
0
0
x
time t. Then, at time t, we reinvest this amount in Bt pT q. At time T , we have Bt ptqB
.
t pT q
0
x
Alternatively, if we invest in Bt0 pT q from the beginning, we obtain Bt pT q , which must be
0

the same as the value of the two-step investment described above6 . Therefore, the fair
forward rate in a forward rate agreement must satisfy
ft0 pt, T q “ ´

ln Bt0 pT q ´ ln Bt0 ptq
.
T ´t

If we let T Ó t, we obtain limT Ót ft0 pt, T q “ Ft0 ptq. In terms of yield, we have
ft0 pt, T q “

pT ´ t0 qRt0 pT q ´ pt ´ t0 qRt0 ptq
.
T ´t

Ft0 ptq is the instantaneous forward rate. However, ft0 pt, T q is the forward rate at time t0
for time interval rt, T s and is related to the instantaneous forward rate by
żT
ft0 pt, T q “

Ft0 puqdu.
t

Unlike the forward rate and short rate rt , yield curve Rt pT q is accessible through market
data. For example, LIBOR7 is the rate at which banks worldwide agree to lend to each other
and is considered more or less a benchmark interest rate for international trade. Or, the
United States treasury yield curve is considered a risk-free rate for domestic transactions
within the United States. The quotes of yield curve Rt pT q for LIBOR and the United
6
7

A more rigorous argument is provided in Section 1.3 Example 1.3.2
London Interbank Oﬀered Rate

17

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

States treasuries at diﬀerent maturities are given in Tables 1.2 and 1.3, respectively.
Time-to-maturity T ´ t
USD
USD
USD
USD
USD
USD
USD

LIBOR
LIBOR
LIBOR
LIBOR
LIBOR
LIBOR
LIBOR

-

overnight
1 week
1 month
2 months
3 months
6 months
12 months

02-19-2016
0.37090 %
0.39305 %
0.43350 %
0.51720 %
0.61820 %
0.86790 %
1.13975 %

02-18-2016
0.37140 %
0.39200 %
0.43200 %
0.51895 %
0.61820 %
0.87040 %
1.14200 %

Current date t
02-17-2016 02-16-2016
0.37000%
0.37100 %
0.39160%
0.39050 %
0.43005 % 0.42950 %
0.51675 % 0.51605 %
0.61940 % 0.61820 %
0.86660 % 0.86585 %
1.13465 % 1.13215 %

02-15-2016
0.39340 %
0.42925 %
0.51580 %
0.61820 %
0.86360 %
1.12825 %

Table 1.2: LIBOR yield curve for US dollars. Source: www.global-rates.com. The the
date format in the table is DD-MM-YYYY, contrary to the date format MM/DD/YYYY
in the United States.

Date t
02/22/16
02/23/16
02/24/16

1 Mo
0.28%
0.28%
0.28%

3 Mo
0.33%
0.32%
0.33%

Time-to-maturity T
6 Mo
1 Yr
5 Yr
0.46% 0.55% 1.25%
0.47% 0.55% 1.23%
0.46% 0.55% 1.21%

´t
10 Yr
1.77%
1.74%
1.75%

20 Yr
2.18%
2.16%
2.16%

30 Yr
2.62%
2.60%
2.61%

Table 1.3: Treasury yield curve for US dollar. Source: https://www.treasury.gov.
The forward rates ft0 pt, T q can also be obtained from the data on forward rate agreements,
but this data is not publicly available.
We should clarify that there is a slight diﬀerence between the yield curve defined by (1.1.2)
and the yield curve data in Tables 1.2 and 1.3. The recorded data on the yield curve comes
from
ˆ
˙ 1
T ´t
1
T ´t
ˆ
Bt pT q “ p1 ` Rt pT qq , or R̂t pT q :“
´ 1,
(1.1.3)
Bt pT q
where the time-to-maturity T ´ t measured in years. Therefore,
´
¯
¯¯ 1
T ´t
R̂t pT q “ exp Rt pT qpT ´ tq
´ 1 “ exp Rt pT q ´ 1 « Rt pT q,
´

´

when Rt pT q is small. For example, in Table 1.3, the yield of a zero bond that expires in one
month is given by 0.28% “ .0028 and the price of such a bond is equal to p1.0028q´1{12 “
0.9996.
It is also important to know that an interpolation method is used to generate some of
the yield curve data in Tables 1.2 and 1.3. This is because a bond that expires exactly
18

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

in one month, three months, six months, or some other time does not necessarily always
exist. A bond that expires in a month will be a three-week maturity bond after a week.
Therefore, after calculating the yield for the available maturities, an interpolation gives
us the interpolated yields of the standard maturities in the yield charts. For example, in
Table 1.3, The Treasury Department uses the cubic Hermite spline method to generate
daily yield curve quotes.
Remark 1.1.3. While the market data on the yield of bonds with diﬀerent maturity is
provided in the discrete-time sense, i.e., (1.1.3), the task of modeling a yield curve in
financial mathematics is often performed in continuous-time. Therefore, it is important to
learn both frameworks and the relation between them.
Sensitivity analysis of the bond price
We measure the sensitivity of the zero bond price with respect to changes in the yield
t pT q
or errors in the estimation of the yields by dB
dRt pT q “ ´pT ´ tqBt pT q. As expected, the
sensitivity is negative, which means that the increase (decrease) in yield is detrimental
(beneficial) to the bond price. It is also proportional to the time-to-maturity of the bond;
t pT q
i.e., the duration of the zero bond is equal to ´ dBt pTBq{dR
. For a coupon bond, the
t pT q
sensitivity is measured after defining the yield of the bond; the yield of a coupon bond
with coupons payments of $ ci at date Ti with T1 ă ... ă Tn´1 and principle payment
P “ cn at maturity Tn “ T is a number ŷ such that ppŷq equals the price of the bond, and
ppyq is the function defined below:
ppyq :“

n
ÿ

ci e´pTi ´tqy .

i“1

Therefore, the yield of a bond is the number y that satisfies
n
ÿ

ci e´pTi ´tqŷ “

i“1

n
ÿ

ci Bt pTi q.

i“1

řn´1
The function ppyq is a strictly decreasing function with pp´8q “ 8, pp0q “ i“1
ci ` P ,
and pp8q “ 0. Therefore, for a bond with a positive price, the yield of the bond exists as
a real number. In addition, if the price of the bond is in the range p0, pp0qq, the yield of
the bond is a positive number.
Therefore, the yield ŷ depends on all parameters t, ci , Ti , and Rt pTi q, for i “ 1, ..., n.
Motivated from the zero bond, the duration the coupon bond is given by
D :“ ´

n
ÿ
ci e´pTi ´tqŷ
dp{dy
pŷq “
pTi ´ tq
,
p
ppŷq
i“1

19

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES
´pT ´tqŷ

a naturally weighted average of the duration of payments, with weights ci e ppŷqi
, for
i “ 1, ..., n.
2
2
t pT q
The convexity of a zero bond is defined by using the second derivative C :“ d Bt pTBq{dR
“
pT
q
t
2
pT ´ tq , and for a coupon bond is expressed as
C :“

n
ÿ
d2 p{dy 2
ci e´pTi ´tqŷ
pŷq “
pTi ´ tq2
.
p
ppŷq
i“1

Recall that a function f is convex if and only if f pλx ` p1 ´ λqyq ď
λf pxq ` p1 ´ λqf pyq for all λ P p0, 1q. If the function is twice differentiable, convexity is equivalent to f 2 ě 0. For more details on
convexity, see Section A.1.
While the duration indicates a negative relation between changes in yield ŷ and price of
the bond ppŷq, the convexity tells more about the magnitude of this change. For example,
considering two bonds with the same duration, the one with higher convexity is more
sensitive to changes in the yield. See Figure 1.1.12.
∆p(y)
p(y)

∆p(y)
p(y)

Bond 1
Bond 2

∆y

Bond 1
Bond 2

∆y

ppyq´ppŷq
Figure 1.1.12: The relative price change of the bond ∆ppyq
with change in the
ppŷq “
ppŷq
yield ∆y “ y ´ ŷ. Left: Bond 1 is longer in duration and therefore less sensitive than bond
2. Right: Both bonds are the same duration, but bond 1 is less convex and more sensitive.

Remark 1.1.4. While in practice bonds are not considered derivatives, they are bets on
the interest rate and therefore can mathematically be considered as derivatives. Forward
interest agreements are derivatives on bond.

1.1.6

Credit derivatives

Financial instruments are issued by financial companies such as banks. There is always a
risk that the issuer will go bankrupt or at least default on some payments and be unable to
20

1. PRELIMINARIES
Rating
Prime
Subprime
Default

1.1. FINANCIAL DERIVATIVES
Moody’s
Aaa
Ba1 and lower
C

S&P
AAA
BB+ and lower
D

Fitch
AAA
BB+ and lower
D

Table 1.4: A brief table of rating by Moody, S&P and Fitch.
meet its obligation. The same situation holds when a debt such as a mortgage is issued. In
such cases, the beneficiary of the issued security is exposed to credit risk. Therefore, it is
important to know about the creditworthiness of individual and corporate loan applicants.
There are three major credit rating companies for corporations and other institutions,
including governments: Moody’s, Standard and Poor’s (S&P), and Fitch. The rates are
usually shown by letters similar to letter grading of a university course. Regardless of
the notation used, the highest level of creditworthiness is called prime rating and the
lowest is given to a defaulted entity. Lower-half rates are usually referred to subprime
which indicates higher exposure to credit risk. See Table 1.4 for a sample of a ratings
table and its notations. To cover credit risk, financial institutes issue credit derivatives.
There are two well-known credit derivatives in the market: credit default swap (CDS) and
collateralized debt obligation (CDO). Both derivatives are written on defaultable loans
(such as bonds). For simplicity, we only consider CDOs and CDSs on defaultable zero
bonds, i.e., the simplest of all defaultable assets. First, we introduce defaultable zero
bonds and explain how the yield of a defaultable zero bond is calculated.
Defaultable zero bond
Consider a zero bond with a face value $1. If the bond is sovereign with the yield Rt pT q,
then the value of the bond is
Bt pT q “ e´Rt pT qpT ´tq .
We assume that in case of default, the value of the bond vanishes instantly. The default
of a company and the time of default are random. If we denote the (random) time of the
default by τ and assume that the default has not occurred yet, i.e., τ ą t, we define the
survival rate of the defaultable bond by λt pT q, which satisfies
Ppτ ą T | τ ą tq “ 1 ´ Ppτ ď T | τ ą tq “ 1 ´ e´λt pT qpT ´tq .
In the above Pp¨ | τ ą tq represents the probability measure (function) conditional on
τ ą t, i.e., the default has not occurred until time t. Notice that λt pT q always exists as a
nonnegative number, or `8, and is given by
λt pT q “ ´

1
ln Ppτ ď T | τ ą tq.
T ´t
21

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

If λt pT q “ 0, the bond is sovereign and never defaults. Otherwise, if λt pT q “ `8, the
probability of default is 1 and the default is a certain event. The payoﬀ of a defaultable
bond is given by the indicator random variable below:
#
1 when τ ą T,
1tτ ąT u :“
0 when τ ď T.
A common formalism in pricing financial securities with a random payoﬀ is to take expectation from the discounted payoﬀ. More precisely, the value of the defaultable bond is given
by the expected value of the discounted payoﬀ, i.e.,
´
¯
“
‰
Btλ pT q :“ E Bt pT q1tτ ąT u | τ ą t “ Bt pT qPpτ ą T | τ ą tq “ e´Rt pT qpT ´tq 1´e´λt pT qpT ´tq .
The risk-adjusted yield of a defaultable bond is defined by the value Rtλ pT q such that
´
¯
λ
e´Rt pT qpT ´tq “ Btλ pT q “ e´Rt pT qpT ´tq 1 ´ e´λt pT qpT ´tq .
Equivalently,
Rtλ pT q “ Rt pT q ´

´
¯
1
ln 1 ´ e´λt pT qpT ´tq
T ´t

For a defaultable bond, we always have Rtλ pT q ą Rt pT q. Notice that when λt pT q Ò 8,
Rtλ pT q Ó Rt pT q, and when λt pT q Ó 0, Rtλ pT q Ò 8. .
The higher the probability of default, the higher the adjusted yield of
the bond.
Exercise 1.1.5. Consider a defaultable zero bond with T “ 1, face value $1, and survival
rate 0.5. If the current risk-free yield for maturity T “ 1 is 0.2, find the adjusted yield of
this bond.
Credit default swap (CDS)
A CDS is a swap that protects the holder of a defaultable asset against default before a
certain maturity time T by recovering a percentage of the nominal value specified in the
contract in case the default happens before maturity. Usually, some percentage of the
loss can be covered by collateral or other assets of the defaulted party, i.e., a recovery
rate denoted by R. The recovery rate R is normally a percentage of the face value of the
defaultable bond and is evaluated prior to the time of issue. Therefore, the CDS covers
1 ´ R percent of the value of the asset at the time of default. In return, the holder makes
regular, constant premium payments κ until the time of default or maturity, whichever
happens first. The maturity of a CDS is often the same as the maturity of the defaultable
22

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

asset, if there is any. For example, a CDS on a bond with maturity T also expires at time
T.
To find out the fair premium payments κ for the CDS, let’s denote the time of the default
by τ and the face value of the defaultable bond by P . If the default happens at τ ď T , the
CDS pays the holder an amount of p1 ´ RqP . The present value of this amount is obtained
by discounting it with a sovereign zero bond, i.e., p1 ´ RqP B0 pT ^ τ q. If the issuer of the
bond defaults after time T , the CDS does not pay any amount. Thus, the payment of the
CDS is a random variable expressed as
p1 ´ RqP B0 pT ^ τ q1tτ ďT u .
The holder of the CDS makes regular payments of amount κ at points 0 “ T0 ă T1 ă ¨ ¨ ¨ ă
Tn in time with Tn ă T . Then, the present value of payment of amount κ, paid at time Ti
is
κ1tTi ăτ u B0 pTi q.
The total number of premium payments is N :“ maxti ` 1 : Ti ă τ ^ T u, which is also
a random variable with values 1, ..., n ` 1. Therefore, the present value of all premium
payments is given by
N
ÿ
κ
B0 pTi q.
i“1

The discounted payoﬀ of the CDS starting at time t is given by
p1 ´ RqP B0 pT ^ τ q1tτ ďT u ´ κ

N
ÿ

B0 pTi q

(1.1.4)

i“1

The only source of randomness in
ř the above payoﬀ is the default time, i.e., τ . This makes
the terms B0 pT ^ τ q1tτ ďT u and N
i“1 B0 pTi q random variables. Notice that, although each
ř
individual term in the summation N
i“1 B0 pTi q is not random, the number of terms N in
the summation is.
Because of the presence of randomness, we follow the formalism that evaluates the price
of an asset with random payoﬀ by taking the expected value of the discounted payoﬀ. In
case of a CDS, the price is known to be zero; either party in a CDS does not pay or receive
any amount by entering a CDS contract. Therefore, the premium payments κ should be
such that the expected value of the payoﬀ (1.1.4) vanishes. To do so, first we need to know
the probability distribution of the time of default. The task of finding the distribution of
default can be performed through modeling the survival rate, which is defined in Section
1.1.6. Provided that the distribution of default is known, κ can be determined by taking
23

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

the expected value as follows:
“
‰
E B0 pT ^ τ q1tτ ďT u
‰.
κ “ p1 ´ RqP “ř
E 0ďTi ăτ B0 pTi q

(1.1.5)

Exercise 1.1.6. Consider a CDS on a defaultable bond with maturity T “ 1 year and
recovery rate R at 90%. Let the default time τ be a random variable with the Poisson
distribution with mean 6 months. Assume that the yield of a risk-free zero bond is a constant
1 for all maturities within a year. Find the monthly premium payments of the CDS in terms
of the principle of the defaultable bond P “ $1.
Collateralized debt obligation (CDO)
A CDO is a complicated financial instrument. For illustrative purposes, we present a simplified structure of a CDO in this section. One leg of CDO is a special-purpose entity (SPE)
that holds a portfolio of defaultable assets such as mortgage-backed securities, commercial
real estate bonds, and corporate loans. These defaultable assets serve as collateral; therefore we call the portfolio of these assets a collateral portfolio. Then, SPE issues bonds,
which pay the cashflow of the assets to investors in these bonds. The holders of these
special bonds do not uniformly receive the cashflow. There are four types of bonds in
four trenches: senior, mezzanine, junior, and equity. The cashflow is distributed among
investors first to the holders of senior bonds, then mezzanine bond holders, then junior
bond holders, and finally equity bond holders. In case of default of some of the collateral
assets in the portfolio, equity holders are the first to lose income. Therefore, a senior trench
bond is the most expensive and an equity trench bond is the cheapest. CDOs are traded
in specialized debt markets, derivative markets, or over-the-counter (OTC).
A CDO can be structurally very complicated. For illustration purpose, in the next example
we focus on a CDO that is written only on zero bonds.
Example 1.1.6. Consider a collateral portfolio of 100 diﬀerent defaultable zero bonds
with the same maturity. Let’s trenchize the CDO in four equally sized trenches as shown
in Figure 1.1.13. If none of the bonds in the collateral portfolio default, the total $100
cashflow will be evenly distributed among CDO bond holders. However, if ten bonds default,
then total cashflow is $90; an amount of $75 to be evenly distributed among the junior,
mezzanine, and senior holders, and the remaining amount of $15 dollars will be evenly
distributed among equity holders. If 30 bonds default, then total cashflow is $70; an amount
of $50 to be evenly distributed among the mezzanine and senior holders, and the remaining
amount of $5 dollars will be evenly distributed among mezzanine holders. Equity holders
receive $0. If there are at least 50 defaults, equity and junior holders receive nothing. The
mezzanine trench loses cashflow, if and only if the number of defaults exceed 50. The senior
trench receives full payment, if and only if the number of defaults remains at 75 or below.
24

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

# of defaults

100

senior
75

mezzanine
50

junior
25

equity
0

%100

% of loss

Figure 1.1.13: Simplification of CDO structure
Above 75 defaults, equity, junior, and mezzanine trenches totally lose their cashflow, and
senior trench experiences a partial loss.
Exercise 1.1.7. Consider a credit derivative on two independently defaultable zero bonds
with the same face value at the same maturity, which pays the face value of either bond in
case of default of that bond. A credit derivative of this type is written on two independently
bonds: one of the bonds has a risk-adjusted yield of 5% and the other has a risk-adjusted
yield of 15%. Another credit derivative of this type is written on two other independently
defaulted bonds, both with a risk-adjusted yield of 10%. If both credit derivatives are oﬀered
at the same price, which one is better? Hint: The probability of default is Ppτ
´ ď T | τ ą tq “
¯
1
´λ
pT
qpT
´tq
λ
t
e
and the risk-adjusted yield satisfies Rt pT q “ Rt pT q ´ T ´t ln 1 ´ e´λt pT qpT ´tq .
λ

Therefore, the probability of default satisfies Ppτ ď T | τ ą tq “ 1 ´ e´pRt pT q´Rt pT qqpT ´tq .
Loss distribution and systemic risk
We learned from the 2007 financial crisis that even a senior trench bond of a CDO can yield
yield an unexpectedly low cashflow caused by an unexpectedly large number of defaults in
the collateral portfolio, especially when the structure of the collateral portfolio creates a
systemic risk. To explain the systemic risk, consider a collateral portfolio, which is made
up of mortgages and mortgage-based securities. These assets are linked through several
25

1.1. FINANCIAL DERIVATIVES

1. PRELIMINARIES

common risk factors, some are related to the real estate market, and the others are related
to the overall situation of the economy. These risk factors create a correlation between
defaults of these assets. Most of the risk factor that were known before the 2007 financial
crisis can only cause a relatively small group of assets within the collateral portfolio to
default. If risk factor can significantly increase the chance of default of a large group of
assets within the collateral portfolio, then it is a systemic risk factor. If we only look at the
correlation between the defaults of the assets in the collateral portfolio, we can handle the
nonsystemic risk factors. However, a systemic risk factor can only be found by studying
the structure of the collateral portfolio beyond the correlation between the defaults.
A diﬀerence between systemic and nonsystemic risk can be illustrated by the severity of
loss. In Figure 1.1.14, we show the distribution of loss in three diﬀerent cases: independent
defaultable assets, dependent defaultable assets without a systemic factor, and dependent
defaultable assets with systemic factor. The loss distribution, when a systemic risk factor
exists has at least one spike at a large loss level. It is important to emphasize that the
empirical distribution of loss does not show the above-mentioned spike and the systemic
risk factor does not leave a trace in a calm situation of a market. Relying on only a period of
market data, in which systemic losses have not occurred, leads us into a dangerous territory,
such as the financial meltdown of 2007–2008. Even having the data from a systemic event
may not help predict the next systemic event, unless we have a sound understanding of the
financial environment. Therefore, we can only find systemic risk factors through studying
the structure of a market.
Take the following example, as extreme and hypothetical as it is, as an illustration of
systemic risk. Consider a CDO made up of a thousand derivatives on a single defaultable
asset. If the asset does not default, all trenches collect even shares of the payoﬀ of the
derivatives. However, in case of default, all trenches become worthless. Even if you increase
the number of assets to, ten, it only takes a few simultaneously defaulted assets to blow up
the CDO. Even when the number of assets becomes large, their default may only depend
on few factors; i.e., when a few things go wrong, the CDO can become worthless.
Exercise 1.1.8. Consider a portfolio of 1000 defaultable asset with the same future value
$1. Let Zi represent the loss from asset i which is 1 when asset
ř i defaults and 0 otherwise.
Therefore, the total loss of the portfolio is equal to L :“ 1000
i“1 Zi . Plot the probability
density function (pdf) of L in the following three cases.
a) Z1 , ..., Z1000 are i.i.d. Bernoulli random variables with probability p “ .01.
b) Z1 , ..., Z1000 are correlated in the following way. Given the number of defaults N ě 0,
the defaulted assets can with equal likelihood be any combination of N out of 100
assets, and N is distributed as a negative binomial with parameters pr, pq “ p90, .1q.
When N ě 1000, all assets have defaulted. See Example B.14. Plot the pdf of L.
c) Now let X be a Bernoulli random variable with probability p “ .005. Given X “ 0,
the new set of random variables Z1 , ..., Z1000 are i.i.d. Bernoulli random variables
26

1. PRELIMINARIES

1.1. FINANCIAL DERIVATIVES

.15

.02

·10−2

Uncorrelated
Correlated
Correlated with systemic risk

Uncorrelated
Correlated

.1
.01
.05
Spike

y

Fat tail

y

0

20

40
60
80
Severity of total loss

100

22
24
26
28
Fat tail of correlated losses

30

Figure 1.1.14: Distribution of loss: Correlation increases the probability at the tail of the
distribution of loss. Systemic risk adds a spike to the loss distribution. All distributions
have the same mean. The fat-tailed loss distribution and the systemic risk loss distribution
have the same correlation of default.
with probability p “ .01, and given X “ 1, random variables Z1 , ..., Z1000 are i.i.d.
Bernoulli random variables with probability p “ .3. The structure is illustrated in
Figure 1.1.15.
Plot the distribution of the loss.
X

Z1

Z2

Z3

···

Z88

Z99

Z100

Figure 1.1.15: Variable X represents a systemic factor for variables Z1 , ..., Z100 . When
X “ 1, the chance of Zi “ 1 increases drastically. Since Zi “ 1 represents the loss from
asset i, when the systemic factor X is passive, i.e., X “ 0, the loss distribution is similar
to one for a portfolio of independent defaultable assets.
There are two main approaches to modeling a financial environment. Some studies, such
as (Acemoglu, Ozdaglar, and Tahbaz-Salehi 2015; Cont, Moussa, and Santos 2011; Amini,
Filipović, and Minca 2015), model a complex financial network of loans by a random
graph. Others, such as (Garnier, Papanicolaou, and Yang 2013), use the theory of mean
27

1.2. OPTIMIZATION IN FINANCE

1. PRELIMINARIES

field games to model the structure of a financial environment. While the former emphasizes
the contribution of the heterogeneity of the network in systemic risk, the latter shows that
systemic risk can also happen in a homogeneous environment. An example of such a
network method, that most central banks and central clearinghouses use to assess systemic
risk to the financial networks they oversee is the Eisenberg-Noe model, which is discussed
in Section 1.1.2.

1.2

Optimization in finance

Optimization is a regular practice in finance: a hedge fund wants to increase its profit,
a retirement fund wants to increase its long-term capital gain, a public company wants
to increase its share value, and so on. One of the early applications of optimization in
finance is the Markowitz mean-variance analysis on diversification; [20]. This leads to
quadratic programming and linear optimization with quadratic constraint. Once we define
the condition for the optimality of a portfolio in a reasonable sense, we can build an optimal
portfolio, or an eﬃcient portfolio. Then, the eﬃcient portfolio can be used to analyze
other investment strategies or price new assets. For example, in the capital asset pricing
model (CAPM), we evaluate an asset based on its correlation with the eﬃcient market. In
this section, we present a mean-variance portfolio selection problem as a classical use of
optimization methods in finance.
Consider a market with N assets. Assume that we measure the profit of the asset over a
period r0, 1s by its return:
piq
piq
S1 ´ S0
.
Ri “
piq
S0
piq

piq

Here, S0 and S1 are the current price and the future price of the asset i, respectively.
The return on an asset is the relative gain of the asset. For instance, if the price of an asset
increases by 10%, the return is 0.1. Since the future price is unknown, we take return as a
random variable and define the expected return by the expected value of the return, i.e.,
Ri :“ ErRi s.
The risk of an asset is defined as the standard deviation of the return σi , where
σi2 :“ varpRi q.
Expected return and risk are two important factors in investment decisions. An investor
with a fixed amount of money wants to distribute her wealth over diﬀerent assets to make
an investment portfolio. In other words, she wants to choose weights pθ1 , ..., θN q P RN
` such
řN
that i“1 θi “ 1 and invest θi fraction of her wealth on asset i. Then, her expected return
28

1. PRELIMINARIES

1.2. OPTIMIZATION IN FINANCE

on this portfolio choice is given by
Rθ :“

N
ÿ

θi Ri .

i“1

However, the risk of her portfolio is a little more complicated and depends on the correlation
between the assets
N
ÿ
ÿ
σθ2 :“
θi2 σi2 ` 2
θi θj ϱij σi σ2 .
i“1

1ďiăjďN

Here ϱij is the correlation between the returns of assets i and j.
Example 1.2.1 (Two assets). Assume that N “ 2 and R1 and R2 are assets with correlated
returns, and that correlation is given by ϱ12 . Thus, for θ P r0, 1s, we invest θ portion of
the wealth in asset 1 and the rest in asset 2. Then, the expected return and the risk of the
portfolio as a function of θ are given by
Rθ “ θR1 ` p1 ´ θqR2 and σθ2 “ θ2 σ12 ` p1 ´ θq2 σ22 ` 2θp1 ´ θqϱ12 σ1 σ2 .
Therefore, by eliminating θ, σθ2 becomes a quadratic function of Rθ ; see the red parabola in
Figure 1.2.1.
Exercise 1.2.1. Show that when θ “

σ22
, the portfolio with two uncorrelated assets in
σ12 `σ22
2
σθ . Find the minimum value. Repeat the result for

Example 1.2.1 takes the minimum risk
the positively and negatively correlated assets.

As seen in Figure 1.2.1 and shown in Exercise 1.2.1, there is a portfolio with minimum
risk σmin and return R˚ that is higher than the minimum return between the two assets. If
the goal is to minimize risk regardless of the return of the portfolio, there is a better option
than fully investing in the lower-risk asset. Even if the assets are correlated, negatively or
positively, the minimum risk portfolio exists. The only exception is when the two assets
are positively correlated with ϱ12 “ 1, where the least risky option is to invest fully in
the asset with lower risk. Notice that in the dotted parts of the red and green curves, all
portfolios are worse than the minimum risk portfolio. In other words, the minimum risk
portfolio has higher return than all dotted portfolios while it maintains the lowest risk. By
choosing a portfolio in the solid part of the curve, we accept to take higher risk than the
minimum risk portfolio. In return, the return of the chosen portfolio also is higher than
the return of the minimum risk portfolio. The solid part of the curve is called the eﬃcient
frontier.
The collection of all portfolios made up of more than two assets is not represented simply
by a one-dimensional curve; such a portfolio is represented by a point in a two-dimensional
region that is not always easy to find. However, Robert Merton in [21] shows that the
29

1.2. OPTIMIZATION IN FINANCE

1. PRELIMINARIES

Rθ
R2

R1

σθ2
σ12

σ22

Figure 1.2.1: The risk of a portfolio with two assets as a function of expected return.
σθ2 as a function of Rθ is a quadratic curve. The green curve indicates when the returns
of assets are negatively correlated with correlation ´1, the green curve indicates when the
returns of assets are negatively correlated with correlation less than ´1, the red curve
indicates uncorrelated assets, the gray curve indicates when they are positively correlated,
and the black curve indicates when the returns of assets are positively correlated with
correlation 1.

30

1. PRELIMINARIES

1.2. OPTIMIZATION IN FINANCE

Figure 1.2.2: Left: the risk vs return of all portfolios on three assets. The assets are
marked by blue dots. The bi-asset risk-return curves are plotted with blue, green and red
colors. Right: The eﬃcient frontier for three assets is shown in orange.
eﬃcient frontier always exists regardless of the number of assets. In Figure 1.2.2, we
sketched the risk-return region for three assets and marked the eﬃcient frontier for them.
To define the eﬃcient frontier, we impose a natural partial order among all portfolios
based on their risk and return: θ ą θ̂ if and only if Rθ ą Rθ̂ and σθ ď σθ̂ , or Rθ ě Rθ̂ and
σθ ă σθ̂ . In other words, one portfolio is better than another if it has either a lower risk
with at least the same return, or a higher return with at most the same risk. The eﬃcient
frontier is the set of all maximal portfolios under this order; i.e., there is no portfolio that
is better.
Minimum risk portfolio
The portfolio with the least risk σmin is located in the lowest end of the eﬃcient frontier.
To find the lowest-risk portfolio, we solve the following problem.
ÿ
min σθ subject to θ ě 0 and
θi “ 1.
i

Notice that the above optimization problem is equivalent to solving the quadratic programming problem.
ÿ
min σθ2 subject to θ ě 0 and
θi “ 1.
(1.2.1)
i

Recall that
σθ2 :“

N
ÿ
i“1

ÿ

θi2 σi2 ` 2

θi θj ϱij σi σ2

1ďiăjďN

which can be written in matrix form by θT Cθ. Here, the matrix C is the variance-covariance
matrix between assets given by
Cij “ ϱij σi σj .
31

1.2. OPTIMIZATION IN FINANCE

1. PRELIMINARIES

If all assets are linearly uncorrelated, then C is positive-definite. Therefore, problem (1.2.1)
is similar to those studied in Section A.2.
Minimizing risk subject to return constraint
If we want to have a return higher than the return from the portfolio, we have to take more
risk than σmin . This can be achieved by adding the constraint of a minimum return.
ÿ
min σθ subject to θ ě 0
θi “ 1 and Rθ ě R0 .
(1.2.2)
i

The constant R0 is the desired return from the portfolio.
Exercise 1.2.2. Consider a portfolio of ten assets with the expected return given by
“
‰
.1 .2 .3 .5 .2 .1 .05 .1 .2 .1
and the variance-covariance matrix by
fi
1 .2 0 0 0 0 0 0 0 0
—.2 1 .2 0 0 0 0 0 0 0 ﬃ
—
ﬃ
— 0 .2 1 .2 0 0 0 0 0 0 ﬃ
—
ﬃ
— 0 0 .2 1 .2 0 0 0 0 0 ﬃ
—
ﬃ
— 0 0 0 .2 2 .1 0 0 0 0 ﬃ
ﬃ
—
— 0 0 0 0 .1 2 .1 0 0 0 ﬃ
—
ﬃ
— 0 0 0 0 0 .1 2 .1 0 0 ﬃ
—
ﬃ
— 0 0 0 0 0 0 .1 2 .1 0 ﬃ
—
ﬃ
– 0 0 0 0 0 0 0 .1 2 .1fl
0 0 0 0 0 0 0 0 .1 2
»

Use CVX under MatLab or CVXOPT under Python, introduced in Section A.2, to numerically
solve problems (1.2.1) and (1.2.2).
Maximizing return subject to risk constraint
It is obvious that the highest return comes from the asset with the highest return. However,
it may be too risky to invest all one’s resources in one risky asset. Therefore, there is usually
a risk constraint:
ÿ
max Rθ subject to θ ě 0
θi “ 1 and σθ2 ď σ0 .
(1.2.3)
i

The constant σ0 is the maximum risk of the portfolio.

32

1.
1.3.PRELIMINARIES
NO-DOMINANCE PRINCIPLE AND MODEL-INDEPENDENT ARBITRAGE
Exercise 1.2.3. Assume that all assets are uncorrelated. Use the Cauchy-Schwartz inRi
equality to show that an optimal solution for problem (1.2.3) is obtained when θi “ aσ
2
i
ř Ri
where a “ i σ2 .
i
Now consider the general case where the assets are correlated with a positive-definite
variance-covariance matrix. Use the Cholesky decomposition for the positive-definite matrices to find an optimal solution to the problem. Is the optimal solution unique?

1.3

No-dominance principle and model-independent arbitrage

In this section, we focus on the market properties that hold true objectively regardless
of the choice of the model. Therefore, here we do not make any assumption about the
dynamics of the assets, the yield of zero bonds, and the like. Instead, we only impose two
basic assumptions and ignore any friction in the market such as transaction cost, liquidity
restriction, and nontradability of assets. Some of the contents of this section can be found
in [30, Section 1.2].
We consider a sample space Ω that includes the collection of all possible events in the
market at future time T , and let χ be given set of portfolios (a collection of assets and
strategies on how to trade them dynamically) in the market. For any portfolio in χ, the
payoﬀ of the portfolio is what it is worth at time T , and is a random variable from Ω to R.
We assume that there exists a pricing function Π : χ Ñ R; i.e., the price of portfolio P is
given by ΠpP q. We denote the payoﬀ of portfolio P at the event ω P Ω by P pωq.
The first assumption that we impose is the following:
Assumption 1.3.1 (No-dominance). If P P χ has a nonnegative payoﬀ, i.e., P pωq ě 0
for all ω P Ω, then the price ΠpP q of portfolio P is nonnegative.
Remark 1.3.1. No-dominance principle implies that two portfolios P1 and P2 with P1 pωq “
P2 pωq for all ω P Ω have the same price.
The second assumption is the linearity of the pricing function. For any two portfolios
P1 and P2 , define P1 ‘ P2 is the portfolio made by combining the two. We impose the
following natural assumption of linearity.
Assumption 1.3.2. For P1 , P2 P χ, we have
ΠpP1 ‘ P2 q “ ΠpP1 q ` ΠpP2 q.
Let’s first fix some terminology that we’ll be using. By “being in a long position” in an
asset, a bond, or the like, we mean that we hold the asset, bond, etc. Similarly, by “being
in a short position” in an asset, a bond, or the like, we mean that we owe the asset, bond,
etc. For a bond or an option, the issuer is in the short position. Having a short position
in an asset means borrowing that asset and then selling it for cash or keeping it for other
33

1.3. MODEL-INDEPENDENT EVALUATION

1. PRELIMINARIES

reasons. This is often referred to as short selling, which is a common practice in the market.
Usually, the borrower is obliged to pay the short-sold security back upon the request of the
lender or in an agreed time.
Example 1.3.1. The forward price K satisfies
Ft pT q “

St
.
Bt pT q

To see this, consider a portfolio made of a long position in the underlying asset and a
short position in a “ Ft pT q zero bonds at time t. The value of this portfolio at time T is
ST ´ Ft pT q. This value is the same as the payoﬀ of a long position in forward contract.
Therefore, by the no-dominance principle (Remark 1.3.1), we obtain that the value of the
portfolio is the same as the price of the forward contract, which is zero; St ´Bt pT qFt pT q “ 0.
On the other hand, the price of the forward is zero and therefore we have the result.
Remark 1.3.2. Proposition 1.3.1 explains a market condition called contango in the futures markets; the futures price is larger than the spot price. If holding an underlying
asset incurs storage cost, then the result of Proposition 1.3.1 may be violated and we have
Ft pT q ă St . This market condition is called backwardation. Backwardation can also occur
if the underlying of the futures contract is not even storable, for instance electricity.
Example 1.3.2. Forward rate f0 pt, T q for delivery at time t of a zero bond with maturity
T satisfies
ln B0 ptq ´ ln B0 pT q
.
f0 pt, T q “
T ´t
To see this, consider a portfolio made of a zero bond with a principle of $1 at time T . The
price of this portfolio is B0 pT q. On the other hand, consider another portfolio made of a forward rate agreement on a bond with the principle of $1 starting at time t, maturing at time
T , and with a forward rate f0 pt, T q; and a bond with a principle of $e´f0 pt,T qpT ´tq maturing
at time t. The price of such a portfolio is $B0 ptqe´f0 pt,T qpT ´tq . Since both portfolios have
the same payoﬀ of $1, they must have the same price. Thus, B0 ptqe´f0 pt,T qpT ´tq “ B0 pT q.
Exercise 1.3.1. Consider a zero bond B0d pT q in the domestic currency and another zero
bond B0f pT q in a foreign currency. At the current time t “ 0, the domestic-to-foreign
d/f
exchange rate is denoted by r0 , and the forward domestic-to-foreign exchange rate8 for
d/f
time T is denoted by f0 pT q. Show that
d/f

B0d pT qr0

d/f

“ B0f pT qf0 pT q.

Proposition 1.3.1. The price of an American option is always greater than or equal to
the price of a European option with the same payoﬀ.
8

The forward exchange rate is guaranteed at maturity.

34

1. PRELIMINARIES

1.3. MODEL-INDEPENDENT EVALUATION

Proof. An American option can always be exercised, but not necessarily optimally, at
maturity, and generates the same payoﬀ as a European option.
Proposition 1.3.2. The price of vanilla options satisfies
CpT, K1 , S, tq ď CpT, K2 , S, tq and P pT, K1 , S, tq ě P pT, K2 , S, tq,
where K1 ě K2 .
Proof. Consider a portfolio that consists of a long position in a call option with strike price
K2 and a short position in a call option with strike K1 , both maturing at T . Then, the
terminal value of the portfolio is pST ´ K2 q` ´ pST ´ K1 q` , which is nonnegative. By the
no-dominance principle, we have CpT, K2 , S, tq ´ CpT, K1 , S, tq ě 0. For a put options, a
similar argument works.
Exercise 1.3.2. Show that the price of an American call or put option is an increasing
function of maturity T .
Exercise 1.3.3. Let λ P p0, 1q. Then,
CpT, λK1 ` p1 ´ λqK2 , S, tq ď λCpT, K1 , S, tq ` p1 ´ λqCpT, K2 , S, tq.
In other words, the price of a call option is convex in K.
Show the same claim for the price of a put option, an American call option, and an American put option.
Exercise 1.3.4. It is well known that a convex function has right and left derivatives at
all points. From the above exercise it follows that the right and the left derivatives of a
call option price with respect to strike price, BK˘ CpT, K, S, tq, exists. Use no-dominance
to show that
´Bt pT q ď BK˘ CpT, K, S, tq ď 0
Hint: Consider a portfolio made of a long position in a call with strike K2 , a long position
in K2 ´ K1 bonds, and a short position in a call option with strike K1 .
Proposition 1.3.3 (Put-call parity). The price of a call option and the price of a put
option with the same strike and maturity satisfy
CpT, K, S, tq ` KBt pT q “ S ` P pT, K, S, tq.
Proof. Since pST ´ Kq` ` K “ ST ` pK ´ ST q` , according to no-dominance principle, a
portfolio consisting of a call option and K units of zero bond Bt pT q is worth as much as a
portfolio made of a put option and one unit of underlying asset.
35

1.3. MODEL-INDEPENDENT EVALUATION

1. PRELIMINARIES

Exercise 1.3.5. A portfolio of long positions in call options with the same maturity and
strikes on diﬀerent assets is worth more than a call option on a portfolio of the same assets
with the same weight; i.e.,
n
ÿ

λi CpT, Ki , S piq , tq ě CpT, K̂, Ŝ, tq,

(1.3.1)

i“1

where λi ě 0 is the number of units invested in the call option on the ith underlying asset,
Ki ě 0 is the strike of the call
asset , S piq denotes the current
řn option on the ith underlying
řn
price of the ith asset, K̂ “ i“1 λi Ki , and Ŝ “ i“1 λi S piq is the value of a portfolio that
has λi units of ith asset for i “ 1, ..., n.
Remark 1.3.3. Exercise 1.3.5 demonstrates an important implication about the risk of
a portfolio. A portfolio made of diﬀerent assets can be insured against the risk of price
increase in two ways: by purchasing a call option for each unit of each asset or by purchasing
a call option on the whole portfolio. It follows from (1.3.1) that the latter choice is cheaper
than the former. An option on a portfolio is called a basket option.
Proposition 1.3.4 (Arbitrage bounds for the price of a call option). The price of a call
option should satisfy
pS ´ Bt pT qKq` ď CpT, K, S, tq ď S.
Proof. Since pST ´ Kq` ď ST , no-dominance implies that CpT, K, S, tq ď S. To see the
right-hand side inequality, first notice that since 0 ď pST ´ Kq` , 0 ď CpT, K, S, tq. On the
other hand, a portfolio of along position in the underlying asset and a short position in K
units of zero bond has a payoﬀ ST ´ K which is less than or equal to the payoﬀ of call
option pST ´ Kq` . Therefore, S ´ KB0 pT q ď CpT, K, S, tq. As a result, pS ´ Bt pT qKq` “
maxt0, S ´ Bt pT qKu ď CpT, K, S, tq.
The notion of model-specific arbitrage will later be explored in Section 2.1. However, in
this section, we present model-independent arbitrage, which is in the same context as the
no-dominance principle.
Definition 1.3.1. A portfolio P with a positive payoﬀ and a zero price is called a modelindependent arbitrage. In other words, a portfolio P is called model-independent arbitrage
if P pωq ą 0 for all ω P Ω, and ΠpP q “ 0.
By Definition 1.3.1, a portfolio with χpω 1 q “ 0 for some ω 1 P Ω and P pωq ą 0 ω ‰ ω 1 is
not a model-independent arbitrage. This leads to a weaker notion of arbitrage.
Definition 1.3.2. A portfolio P with a nonnegative payoﬀ such that for some ω P Ω
P pωq ą 0 and zero price is called a weak arbitrage. In other words, a portfolio P is called
a weak arbitrage if P pωq ě 0 for all ω P Ω, P pω 1 q ą 0 for some ω 1 P Ω and ΠpP q “ 0.
36

1. PRELIMINARIES

1.3. MODEL-INDEPENDENT EVALUATION

Example 1.3.3. Let K1 ą K2 and CpT, K1 , S, tq ą CpT, K2 , S, tq. A portfolio that consists
of a short position in a call with strike K1 , a long position in a call with strike K2 , and the
diﬀerence ofCpT, K1 , S, tq ´ CpT, K2 , S, tq in cash is a model-independent arbitrage. This
is because, the value of such a portfolio is zero. However, the payoﬀ is pST ´ K2 q ´ pST ´
K1 q` ` CpT, K1 , S, tq ´ CpT, K2 , S, tq, which is strictly positive, and therefore we have a
model-independent arbitrage.
On the other hand, if CpT, K1 , S, tq “ CpT, K2 , S, tq, the same portfolio described in the
previous paragraph has a positive value whenever ST ą K2 , and a zero value otherwise.
Therefore, it is only a weak arbitrage.
Example 1.3.4. As a result of Exercise 1.3.4, if the price of the option is smaller that
pS´Bt pT qKq` , or larger than the asset price S, then there is a model-independent arbitrage.
For example, if CpT, K, S, tq ą S, one can have a portfolio of a short position in a call
and a long position in the underlying asset, and the diﬀerence CpT, K, S, tq ´ S in cash.
The value of this portfolio is zero. However, the payoﬀ is strictly positive, i.e., ST ´ pST ´
Kq` ` CpT, K, S, tq ´ S ą 0.
Remark 1.3.4. When CpT, K, S, tq “ S and K ą 0, Example 1.3.4 suggests that we
still have a model-independent arbitrage, unless the event ST “ 0 is legitimate. Therefore,
choice between the model-independent arbitrage or weak arbitrage depends on whether the
event ST “ 0 is included in Ω or not.
Proposition 1.3.5. If there is no model-independent arbitrage, then the no-dominance
principle holds.
Proof. Assume that no-dominance does not hold; i.e., there is a portfolio P with nonnegative payoﬀ with a negative price ΠpP q. Then, consider a new portfolio made of a long
position in the old portfolio P and holding a zero bond with face value ´ΠpP q. The new
portfolio has a positive payoﬀ of P pωq ´ ΠpP q for each ω P Ω and a zero price. Therefore,
it is a model-independent arbitrage.
Exercise 1.3.6. For 0 ă t ă T , show that if B0 ptqBt pT q ą B0 pT q (equiv. B0 ptqBt pT q ă
B0 pT q), there is a model-independent arbitrage.
Exercise 1.3.7. Consider a zero bond B0d pT q on the domestic currency and another zero
bond B0f pT q on a foreign currency. At the current time t “ 0, the domestic-to-foreign
d/f
exchange rate is denoted by r0 and the forward domestic-to-foreign exchange rate for time
d/f
T is denoted by f0 pT q. Show that if
d/f

B0d pT qr0

d/f

ą B0f pT qf0 pT q,

then there exists a model-independent arbitrage.

37

1.3. MODEL-INDEPENDENT EVALUATION

1. PRELIMINARIES

38

2. DISCRETE-TIME MARKETS

2

Modeling financial assets in
discrete-time markets
Section 2.1 deals with a single-period market in which there are only two trading dates,
one at the beginning of the period and one at maturity. In this section, an introductory
knowledge of probability theory is required; more specifically, the reader needs the theory
of probability on discrete sample spaces that is provided in Section B.1. A few times in
Section 2.2, we mention concepts form the general theory of probability. However, these
cases are not crucial for understanding of the content of this sections and can simply be
skipped. In Section 2.3, we extend the results of Section 2.1 to a multiperiod market with
a focus on the binomial model. This is also important in our later study of continuous-time
markets, which can be seen as the limit of discrete-time markets. A key concept from the
appendix is the notion of martingales that is explained in Section B.3. The last section,
Section 2.4, deals with the problem of tuning the parameters of a model to match the data
in the specific context of binomial model.

2.1

Arrow-Debreu market model

The ideas and concepts behind pricing derivatives are easier to explain in a single-period
framework with finite number of outcomes, i.e., Arrow-Debreu market model. According
to the Arrow-Debreu market model, an asset has a given price and a set of possible values.
There are N assets with prices arranged in a column vector p “ pp1 , ..., pN qT1 . For each
i “ 1, ..., N , the possible future values or payoﬀ of asset i is given by tPi,j : j “ 1, ..., M u.
Pi,j is the jth state of future value of asset i and M is a universal number for all assets.
1

AT is the transpose of matrix A.

39

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

Then, one can encode the payoﬀs of all assets into a N -by-M matrix
fi
»
P1,1 ¨ ¨ ¨ P1,M
—
.. ﬃ .
..
P :“ rPi,j si“1,...,N,j“1,...,M “ – ...
.
. fl
PN,1 ¨ ¨ ¨ PN,M
In the Arrow-Debreu market model, row Pi,¨ of the matrix P represents all future prices
of asset i for diﬀerent states of the market, and column P¨,j represents prices of all assets
in future state j of the market.

Pi,1
Pi,2
..
.

pi

Pi,M −1
Pi,M
Figure 2.1.1: Arrow-Debreu market model

Example 2.1.1 (Game of chance). Let N “ 1, M “ 2 and P1,1 “ ´P1,2 “ 1. In other
words, there is a fee p1 to enter a game of chance in which the player either gains or loses
a dollar based on the outcome of flipping a coin. Notice that for now we do not specify
the heads-tails probability for the coin. This probability determines whether the price of the
game p1 is a fair price or not.

P1,1 = 1
p1
P1,2 = −1
Figure 2.1.2: Game of chance described in the Arrow-Debreu market model

40

2. DISCRETE-TIME MARKETS

2.1.1

2.1. ARROW-DEBREU

Arbitrage portfolio and the fundamental theorem of asset pricing

A portfolio is a row vector θ “ pθ1 , ¨ ¨ ¨ , θN q where θi P R which represents the number of
units of asset i in the portfolio. The total price of the portfolio is then given by
θp “

N
ÿ

θi pi .

i“1

Here, the notation of product is simply the matrix product. Notice that if θi ą 0, the
position of the portfolio in asset i is called long, and otherwise if θi ă 0, it is called short.
Arbitrage is a portfolio that costs no money but gives a nonnegative future value and for
some states positive values. More precisely, we have the following definition.
Definition 2.1.1. θ is called a weak arbitrage portfolio or weak arbitrage opportunity if
a) θp “ 0
b) θP¨,j ě 0 for all j “ 1, ..., M
c) θP¨,j ą 0 for at least one j.
Notice that for a given θ “ pθ1 , ¨ ¨ ¨ , θN q, the portfolio represented by θ is itself an asset
with value θP¨j at the state j of the market.
We say that a market model is free of weak arbitrage or that it satisfies no weak arbitrage
condition (NWA for short), if there is no weak arbitrage opportunity in this model.
Sometimes, an arbitrage opportunity starts with a zero-valued portfolio and ends up with
positive values at all states of the market. This defined an strong arbitrage:
Definition 2.1.2. θ is called a strong arbitrage portfolio or arbitrage opportunity if
a) θp ă 0
b) θP¨,j ě 0 for all j “ 1, ..., M
Remark 2.1.1. Notice that if we remove some of the states of the market, then weak
arbitrage can disappear. However, strong arbitrage does not.
Notice that model-independent arbitrage as defined in Definition 1.3.1 is even stronger
than strong arbitrage.
The following theorem is the most important in financial mathematics that characterizes
the notion of arbitrage in a simple way. Basically, it presents a simple criterion to determine
if a market model is free of weak or strong arbitrage.
Theorem 2.1.1 (Fundamental theorem of asset pricing (FTAP)). The Arrow-Debreu market model is free of weak (respectively strong) arbitrage opportunity if and only if there exist
a column vector of positive (respectively nonnegative) numbers π “ pπ1 , ..., πM qT such that
p “ Pπ.
41

(2.1.1)

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

Notice that Theorem 2.1.1 does not claim that the vector π is unique, and therefore there
can be several solutions π such that (2.1.1) holds.
Proof. The proof for the strong arbitrage case is the result of the so-called Farkas’ lemma
which asserts that
Given an n ˆ m matrix A and a vector b P Rm . Then, exactly one of
the following two statements is true:
1) There exists a π P Rn such that Aπ “ b and π ě 0.
2) There exists a θ P Rm such that θA ě 0 and θb ă 0.
We apply Farkas’ lemma for A “ P and b “ p. Strong arbitrage is equivalent to (2) in
Farkas’ lemma. Therefore, lack of strong arbitrage is equivalent to (1).
To show the result for weak arbitrage, we consider the following extension of Farkas’s
lemma.
Given an n ˆ m matrix A and a vector b P Rm . Then, exactly one of
the following two statements is true:
1’) There exists a π P Rn such that Aπ “ b and π ą 0.
2’) There exists a θ P Rm such that θA ě 0, θA ‰ 0 and θb ď 0.
For A “ P and b “ p, weak arbitrage is equivalent to (2’). Therefore, lack of weak
arbitrage is equivalent to (1’).
Remark 2.1.2. The Farkas’ lemma and its extension that are used in the proof of Theorem
2.1.1 are corollaries of the separating hyperplane theorem. For more details about separating
hyperplane theorem and Farkas’ lemma see [8, Section 5.8.3, Section 2.5.1 and Exercise
2.20].
Lack of strong arbitrage does not imply that the vector π in Theorem 2.1.1 has some
positive entities. For instance, when p “ 0, i.e., all the assets in the market have zero
price, there is no strong arbitrage. In such a case, a trivila solution to equation (2.1.1) is
π “ 0. If p ‰ 0, then no-arbitrage condition implies that π has at least a positive entity.
Therefore, one can normalize it by
1
π̂ “ řM

j“1 πj

π.

π̂ is a probability. The probability vector π̂ “ pπ̂1 , ..., π̂M qT is referred to as a risk-neutral
or risk-adjusted probability.
42

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

Example 2.1.2. Consider a game in which you pay a fee of $.20 to enter. Then, a coin flip
determines whether you win or lose a dollar. We also include a zero bond with a face value
of $1 and a price $.80. See Figure 2.1.3. It follows from the FTAP that the no-arbitrage
condition is equivalent to the existence of a positive vector pπ1 , π2 qT satisfying
#
π1 ´ π2 “ .2,
π1 ` π2 “ .8.
In fact, such a vector (uniquely) exists and is given by p5{8, 3{8q. If we exclude the zero

P1,1 = 1
p1 = .2

P2,1 = 1
p2 = .8

P1,2 = −1

P2,2 = 1

Figure 2.1.3: An Arrow-Debreu market model with two assets and two states representing
a coin game and a zero bond
bond from the market, the FTAP criterion for no-arbitrage is reduced to the existence of a
positive solution to π1 ´ π2 “ .2. There are obviously infinitely many positive solutions.
Example 2.1.3. Consider a game of chance using two coins; to enter the game, you pay
a $1 fee. If both coins turn heads (tails), you win (lose) a dollar. Otherwise, the gain is
zero. There is also a zero bond with a face value of $1 and a price of $.80. It follows from
FTAP that there is an arbitrage opportunity. Notice that the system of equation
#
π1 ´ π4 “ 1
π1 ` π2 ` π3 ` π4 “ .8
implies π3 “ ´π2 ´.2´2π4 , which excludes the possibility of a positive solution. Therefore,
there is an arbitrage in this game.
FTAP predicts the existence of arbitrage but does not provide any. Knowing an arbitrage
opportunity exists, finding one is sometimes a challenging problem, even in the toy ArrowDebreu market model.
Exercise 2.1.1. Find an arbitrage opportunity in Example 2.1.3.
Remark 2.1.3. The weak and strong arbitrage are model specific. If we change the model,
the arbitrage opportunity can disappear. However, model-independent arbitrage remains a
strong arbitrage opportunity in any possible model.
43

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS
P1,1 = 1

P2,1 = 1

P1,2 = 0

P2,2 = 1

p1 = 1

p2 = .8
P1,3 = 0

P2,3 = 1

P1,4 = −1

P2,4 = 1

Figure 2.1.4: An Arrow-Debreu market model with two assets and four states representing a coin game and a zero bond

2.1.2

Arrow-Debreu market model with a risk-free bond

1 to the current ArrowIf we intend to add a new asset with price p1 and values P11 , ..., PM
Debreu market model, the new asset does not create an arbitrage opportunity if and only
if at least one of the existing positive solutions π of (2.1.1) satisfies

p1 “

M
ÿ

Pj1 πj .

j“1

More specifically, assume that the new asset is a zero bond with yield (interest rate) R
1
. See Figure 2.1.5. For noand face value 1. Therefore, its price is given by p0 “ 1`R

P0,1 = 1
P0,2 = 1

p0 =

1
1+R

.
.
.
P0,M −1 = 1
P0,M = 1

Figure 2.1.5: Risk-free asset in Arrow-Debreu market model
arbitrage condition to hold for the market with
ř the new bond, at least one of the positive
1
solutions of (2.1.1) implies that p0 “ 1`R
“ M
j“1 πj . Therefore, no-arbitrage condition for
an Arrow-Debreu market model with a zero bond is equivalent to existence of a positive
44

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

vector π such that (2.1.1) holds and
M
ÿ

πj “

j“1

1
,
1`R

holds for all such π. Therefore, any positive vector π can be normalized to a risk-neutral
probability through
π
“ p1 ` Rqπ.
π̂ “ řM
j“1 πj
Then, the price pi of each asset is given by
pi “

M
ÿ

Pi,j πj “

j“1

N
1 ÿ
Pi,j π̂j .
1 ` R j“1

(2.1.2)

The right-hand side above has an important interpretation: provided that the no-arbitrage
condition holds, the price of the asset is equal to the discounted expected payoﬀ with respect
to risk-neutral probability, i.e.,
1
ÊrPi¨ s.
pi “
1`R
ř
Here, ÊrPi¨ s :“ M
j“1 π̂j Pi,j is the expected payoﬀ of asset i with respect to the risk-neutral
1
probability π̂. Factor 1`R
is the discount factor.
By rearranging (2.1.2), one obtains
R“

M
ÿ
Pi,j ´ pi
π̂j .
pi
j“1

P

The term pi,j
´ 1 in RHS is the realized return of asset i if the state j of the market occurs.
i
Therefore, the interpretation of the above equality is that the expected return of each asset
under the risk-neutral probability π̂ is equal to the risk-free interest rate R.
Example 2.1.4. Consider an Arrow-Debreu market model with a risky asset shown below
and a risk-free asset with interest rate R “ .5. To see if there is no arbitrage in this model,

1
.3
.5

45

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

we should investigate the solutions to the system
#
1 “ π̂1 ` π̂2
1
.3 “ 1.5
pπ̂1 ` .5π̂2 q
The first equation accounts for that π̂ is a probability vector, and the second equation comes
from (2.1.2). However, the only solution is π̂ “ p´.1, 1.1qT , which is not a probability.
Example 2.1.5. Consider an Arrow-Debreu market model with a risky asset shown below
and a risk-free asset with interest rate R “ .5. To see if there is no arbitrage in this model,

2
1

1
.5

we should investigate the solutions to the system
1 “ π̂1 ` π̂2 ` π̂3
1
1“
p2π̂1 ` π̂2 ` .5π̂3 q
1.5
One of the infinitely many solutions to the above system is π̂ “ p.6, .2, .2qT , which implies
no-arbitrage condition.
If a second risky asset, shown below, is added to the market, we still do not have arbitrage
because vector π̂ “ p.6, .2, .2qT works for the new market.

1
.4

0
0

Exercise 2.1.2. Consider an Arrow-Debreu market model with two risky assets shown
below and a risk-free asset with interest rate R “ .5. Find all the values for p such that the
market is arbitrage free.
Remark 2.1.4. A zero bond is a risk-free asset in the currency of reference. For example,
a zero bond that pays $1 is risk-free under the dollar. However, it is not risk-free if the
currency of reference is the euro. In the latter case, a euro zero bond is subject to the risk
caused by the foreign exchange rate and is a risky asset. See Exercise (2.1.3) below.
46

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU
2

1

1
p

1
.5

0
0

Exercise 2.1.3. Consider an Arrow-Debreu market model with two assets and two states;
one is a zero bond in the domestic currency with interest rate Rd under the domestic
currency, and the other is a zero bond in a foreign currency with interest rate Rf under
foreign currency.
a) Given that the domestic-to-foreign exchange rate at time 0 is F0 2 , and at time 1 takes
nonnegative values F1 and F2 , what is the Arrow-Debreu market model description
of a foreign zero bond in the domestic currency?
b) A currency swap is a contract that guarantees a fixed domestic-to-foreign exchange
rate, or a forward exchange rate for maturity. The forward exchange rate is
agreed upon between two parties such that the value of the contract is zero. Express
the forward exchange rate of a currency swap maturing at 1 in terms of F0 , Rd , F1 ,
Rf , and F2 .
Remark 2.1.5. The risk-neutral probability π̂ has little to do with the actual probability
(or physical probability) with which each state of the market happens. The probabilities
fj :“ Pp state j occursq can be obtained through statistical analysis on historical market
data. However, the risk-neutral probability π̂ depends only on the matrix P and vector p
and not on historical market data. The one and only genuine relevance between physical
probability f “ pf1 , ..., fm qT and risk-neutral probability π̂ “ pπ̂1 , ..., π̂M qT is that they both
assign nonzero probability to each of the states of the market; i.e., fj ą 0 if and only if
π̂j ą 0 for at least one risk-neutral probabilities π̂.
One can interpret π̂ as an investor’s preference toward the diﬀerent states of the market.
To see this, let’s rewrite (2.1.2) as the following
M
”´ π̂ ¯
ı
1 ÿ ´ π̂j ¯
1
¨
pi “
fj Pi,j “
E
Pi,¨ .
1 ` R j“1 fj
1`R
f¨

(2.1.3)
π̂

Here, E is the expectation with respect to the physical probability. The quotient fjj is the
risk preference of the investor toward the state j of the market, which is also referred to
as the state-price deflator. The state-price deflator shows that, apart from the physical
probability of a certain state, an investor may be keen or averse toward the appearance of
π̂
that state. For instance, fj can be a very high probability, but state-price deflator fjj can be
2

1 unit of domestic is worth F0 units of foreign.

47

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

small, which means that the probable event of appearance of state j has little value to the
investor.
One can analyze the Arrow-Debreu market model by introducing M new elementary
securities to the market; for i “ N ` 1, ..., N ` M , asset N ` j pays $1 if market state j
happens and pays $0 otherwise. See Figure 2.1.6. Then, it is straightforward to see that π̂j
is the arbitrage free price of asset N ` j. Therefore, the cashflow from asset i is equivalent
to the cashflow of a basket of Pi,1 units of asset N ` 1, Pi,2 units of asset N ` 2, ..., and
Pi,M asset sN `M . Recall from (2.1.2) that
pi “

M
1 ÿ
Pi,j π̂j .
1 ` R j“1

PN +j,1 = 0
..
.
PN +j,j = 1
..
.
PN +j,M = 0

π̂j

Figure 2.1.6: Elementary asset sN `j

Example 2.1.6. Consider an Arrow-Debreu market model with a risky asset shown below
and a zero bond with interest rate R “ .5.
2
1
1
.5
−.5

a) A risk-neutral probability π̂ “ pπ̂1 , π̂2 , π̂3 , π̂4 qT must satisfy
#
π̂1 ` π̂2 ` π̂3 ` π̂4 “ 1
.
2π̂1 ` π̂2 ` 12 π̂3 ´ 21 π̂4 “ 32
Notice that we have two equations and four unknown; there are two more variables than equations. Therefore, we shall represent all risk-neutral probabilities as
a parametrized surface with two parameters. For example, we take π̂1 “ s and π̂2 “ t.
48

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

t
1
.8
2
3

.5

s
.1

.5

1

Figure 2.1.7: The hatched region represents the values for t and s which generate all risk-neutral probabilities in Example 2.1.6. The specific risk-neutral probability
p0.7, 0.1, 0.1, 0.1qT is shown as a black dot. Each orange line corresponds to a arbitragefree price for the new asset that is described in Part (b) of the example.

Then, we write π̂3 and π̂4 is terms of t and s as follows:
#
π̂3 ` π̂4 “ 1 ´ t ´ s
π̂3 ´ π̂4 “ 3 ´ 4t ´ 2s.
You also have to specify the suitable range for the parameters t and s such that vector
π̂ is nonnegative. More specifically, we must have the following four inequalities
$
’
0ďt
’
’
’
&0 ď s
,
’
0 ď 2 ´ 52 t ´ 32 s
’
’
’
%0 ď ´1 ` 3 t ` 1 s
2
2
which specify the region plotted in Figure 2.1.7. The region can also be specified in
the following simpler way:
#
0 ď s ď 12
.
(2.1.4)
2
1
4
3
3 ´ 3s ď t ď 5 ´ 5s
b) We introduce the new asset below.
49

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS
1
1

p

−1
−1

We shall find the range for the price p of the new asset such that the market remains
free of arbitrage; strong or weak. By FTAP, Theorem 2.1.1, p must satisfy
¯
1 ´
5
3
3
1 ¯ 2´
p“
t`s´2` t` s`1´ t´ s “
2t ` 2s ´ 1 ,
1.5
2
2
2
2
3
for at least one value of pt, sq in the interior of the region found in Part (a). Therefore,
valid range for p is pA, Bq, where
A :“ min

¯
2´
2t ` 2s ´ 1 subject to constraints (2.1.4)
3

and

¯
2´
2t ` 2s ´ 1 subject to constraints (2.1.4).
3
Both of the above values are the values of linear programming problems which can
be solved by comparing the values of p2{3qp2t ` 2s ´ 1q at the three nodes of the
hatched triangle that represents all risk-neutral probabilities, i.e., p.5, .5q, p0, .7q, and
p0, 2{3q. The smallest value is 2{9 which is attained at p0, 2{3q, and the greatest value
is 2{3 which is attained at p.5, .5q. Therefore, (weak) no-arbitrage for the new asset
is equivalent to p P p2{9, 2{3q.
B :“ max

c) Lack of strong arbitrage is when the asset price is such that all the risk-neutral probabilities have some zero component. In this case, price p should be such that the
risk-neutral probabilities are only on one of the edges of the hatched triangle
¯
´ and does
2
not include any interior point. In Figure 2.1.7, the orange lines are p “ 3 2t`2s´1
for diﬀerent values of p. The only values of p which does not have an intersection
with the interior of the triangle are p “ 2{9 and p “ 2{3. Therefore, the lack of
strong arbitrage implies that p P r2{9, 2{3s.
Exercise 2.1.4. Consider an Arrow-Debreu market model with N “ 3 and M “ 4 shown
in Figure 2.1.8 and take the bond yield R “ 0, where v1 and v2 are two (distinct) real
numbers.
a) Find all risk-neutral probabilities.
b) Recall the notion of independent random variables. Find a risk-neutral probability
that makes the random variables of the prices of two assets independent.
50

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU
P1,1 = v1

P2,1 = v1

P1,2 = v2
p1 =

v1 +v2
2

P2,2 = v1
p2 =

v1 +v2
2

P1,3 = v1

P2,3 = v2

P1,4 = v2

P2,4 = v2

Figure 2.1.8: Exercise 2.1.4

2.1.3

One-period binomial model

Let M “ 2 and N “ 2 with one risk-free zero bond and a risky asset with price S0 :“ p1 ,
and future cash flow given byP1,1 “ S0 u and P1,2 “ S0 ℓ where S0 and ℓ ă u are all positive
real numbers. By Theorem 2.1.1, in a one-period binomial model, no-arbitrage condition
S0 u

S0

S0 ℓ

Figure 2.1.9: One-period binomial model
1`R´ℓ
pu´ℓqp1`Rq and πℓ
1`R´ℓ
u´1´R
u´ℓ and π̂ℓ “ u´ℓ .

is equivalent to ℓ ă 1 ` R ă u and π “ pπℓ , πu qT with πu “
The risk-neutral probability is then given by π̂u “

“

u´1´R
pu´ℓqp1`Rq .

Exercise 2.1.5. Show the above claims.
From FTAP, we know that ℓ ă 1 ` R ă u is equivalent to the no-arbitrage condition. But,
it is often insightful to construct an arbitrage portfolio when ℓ ă 1 ` R ă u is violated.
For example, consider the case when u ď 1 ` R. Then, consider a portfolio with a short
position in one unit of the asset and a long position in S0 units of bonds. To construct
this portfolio, no cash is needed, and it is worth zero. However, the two possible future
outcomes are either S0 p1 ` Rq ´ S0 u ě 0 or S0 p1 ` Rq ´ S0 ℓ ą 0, which matches with
the definition of (weak) arbitrage in Definition 2.1.1. If we assume the strict inequality
u ă 1 ` R, then the arbitrage is strong.
51

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

Next, we consider the addition of a new asset into the market with payoﬀ P1 and P2 in
states 1 and 2, respectively. Then, no-arbitrage condition implies that the price p of this
asset is must be given by
1
pπ̂u P1 ` π̂ℓ P2 q .
p“
1`R
In particular, if the new asset is an option with payoﬀ function gpS1 q, the no arbitrage
price V pS0 q of the option is given by
V pS0 q :“

¯
1 ´
1
ÊrgpS1 qs.
π̂u gpS0 uq ` π̂ℓ gpS0 ℓq “
1`R
1`R

(2.1.5)

Here, Ê is the expectation under probability π̂, and S1 is a random variable of the price
of asset at time t “ 1 that takes the values S0 ℓ and S0 u. For instance, a call option with
payoﬀ pS ´ Kq` with ℓS0 ď K ă uS0 , shown in figure 2.1.10, has a “no-arbitrage price”:
CpKq “

1`R´ℓ
puS0 ´ Kq.
pu ´ ℓqp1 ` Rq

S0 u − K

C(K)

0
Figure 2.1.10: Cashflow of a call option in a one-period binomial model

0 ´Kq
We shall now see why any price other than puS
p1`Rq π̂u for the call option causes arbitrage
in the binomial market with a zero bond, a risky asset and a call option on the risky asset.
For this reason, we need to first introduce the notion of a replicating portfolio. Consider a
portfolio with θ0 investment in a zero bond and θ1 units of risky asset. Then, this portfolio
generates the cashflow shown in Figure 2.1.11. We want to choose pθ0 , θ1 q such that the
payoﬀ of this portfolio matches the payoﬀ of the call option, i.e.
#
θ0 ` θ1 S0 u “ S0 u ´ K
(2.1.6)
θ0 ` θ1 S0 ℓ “ 0

52

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

Therefore, we have to choose
θ0 “ ´

lpS0 u ´ Kq
u´ℓ

and

θ1 “

S0 u ´ K
.
S0 pu ´ ℓq

θ0 + θ1 S0 u = S0 u − K

θ0
1+R

+ θ1 S0

θ0 + θ1 S0 ℓ = 0

Figure 2.1.11: Replicating portfolio in a one-period binomial model
Then, one can see that the value of the replicating portfolio is equal to the price of the
call option, i.e.,
lpS0 u ´ Kq
S0 u ´ K
1
θ0
` θ1 S0 “ ´
`
“
pS0 ´ Kqπ̂u .
1`R
p1 ` Rqpu ´ ℓq
u´ℓ
1`R
Now, we return to building an arbitrage in the case where the price of call option C is
puS0 ´Kq
0 ´Kq
diﬀerent from puS
p1`Rq π̂u . We only cover the case C ă p1`Rq π̂u . Consider a portfolio that
consists of a long position in a call option and a short position in a replicating portfolio
on the same call option. Shorting a replicating portfolio is equivalent to a ´θ0 position
in cash, and a ´θ1 position in the underlying asset. Then, the value of such a portfolio
0 ´Kq
is equal to C ´ puS
p1`Rq π̂u ă 0. This means that there is some extra cash in the pocket,
while the payoﬀ of the call option can be used to clear oﬀ the shorted replicating portfolio
in full. Here, the arbitrage is in the strong sense of Definition 2.1.2.
A replicating portfolio can be built for any payoﬀ gpS1 q by solving the system of equations
#
θ0 ` θ1 S0 u “ gpS0 uq
(2.1.7)
θ0 ` θ1 S0 ℓ “ gpS0 ℓq
to obtain
θ0 “

ugpS0 ℓq ´ ℓgpS0 uq
u´ℓ

and

θ1 “

gpS0 uq ´ gpS0 ℓq
.
S0 pu ´ ℓq

The value of the replicating portfolio is given by
θ0
ugpS0 ℓq ´ ℓgpS0 uq gpS0 uq ´ gpS0 ℓq
1
` θ1 S0 “
`
“
pπ̂u gpS0 uq ` π̂ℓ gpS0 ℓqq,
1`R
p1 ` Rqpu ´ ℓq
u´ℓ
1`R
53

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

which is equal to the expected value of the discounted payoﬀ under risk-neutral probability.
Exercise 2.1.6. Consider a one-period binomial model with parameters ℓ, u and R and
let K P pS0 ℓ, S0 us. Find a replicating portfolio for a put option with strike K. Verify that
the value of the replicating portfolio is equal to the no-arbitrage price of the put option
P pKq “ πℓ pK ´ S0 ℓq. Then, find an arbitrage portfolio when the price of the put option
with strike K is less than P pKq.
Exercise 2.1.7. Consider an Arrow-Debreu market model with M “ 2 that consists of a
risk-free bond with interest rate R “ .01 and a forward contract3 on a nonstorable asset4
with forward price K and maturity of one period. Given that the payoﬀ of the forward
contract for the long position takes values P1,1 “ 4, and P1,2 “ ´2 respective to the state
of the market at maturity, is there any arbitrage?
Now assume that the underlying asset is storable and has price p “ 10. Given that there is
no arbitrage, find K, and binomial model parameters u and d for the underlying asset.
Example 2.1.7. Consider the binomial model with S0 “ 4, R “ .05, u “ 1.45, and ℓ “ .85.
We shall price and replicate the payoﬀ g in Figure 2.1.12 . To find the replicating portfolio,
we solve the system of equations (2.1.7)
#
θ0 ` 5.8θ1 “ gp5.8q “ .8
θ0 ` 3.4θ1 “ gp3.4q “ .6
to obtain θ0 “

1.9
6

and θ1 “

1
12 .

The price can be found in two ways: either by using the

g(ST )

2

2

4

5

7

ST

Figure 2.1.12: Payoﬀ of Example 2.1.7
replicating portfolio or by the risk-neutral probability. The former gives the price by the
3
4

In the context of this exercise, the forward can be replaced by a futures contract.
E.g. electricity.

54

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

value of the replicating portfolio:
1.9
1
2
θ0
` θ1 S0 “
` p4q “
.
1`R
6p1.05q
12
3.15
and π̂ℓ “ 23 to obtain
ˆ
˙
1
1
1
1
2
2
ÊrgpS1 qs “
pπ̂u gpS0 uq ` π̂ℓ gpS0 ℓqq “
p.8q ` p.6q “
.
1`R
1`R
1.05 3
3
3.15

For the latter, we use the risk-neutral probability π̂u “

2.1.4

1
3

One-period trinomial model

In a one-period trinomial model, M “ 3, N “ 2, S0 :“ p1 , u :“ P1,1 {S0 , m :“ P1,2 {S0
and ℓ :“ P1,3 {S0 , where S0 , P1,1 , P1,2 and P1,3 are all positive real numbers. By Theorem

S0 u
S0

S0 m
S0 ℓ

Figure 2.1.13: One-period trinomial model

2.1.1, no-arbitrage condition is equivalent to the existence of a positive probability vector
π̂ “ pπ̂ℓ , π̂m , π̂u q such that
"
ℓπ̂ℓ ` mπ̂m ` uπ̂u “ 1 ` R
(2.1.8)
π̂ℓ ` π̂m ` π̂u “
1.
It is not hard to see that the no-arbitrage condition has the same condition as the oneperiod binomial model, i.e., ℓ ă 1 ` R ă u. The intersection of two planes with equations
(2.1.8) in R3 is a line parametrized by
$
u´p1`Rq
m´ℓ
’
&π̂ℓ “ u´ℓ ´ u´ℓ t
π̂m “ t
’
%
u´m
π̂u “ 1`R´ℓ
u´ℓ ´ u´ℓ t
55

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

The no-arbitrage condition is equivalent to the existence of a segment of this line in the
positive octane; i.e., there exists a t such that
$
u´p1`Rq
m´ℓ
’
&π̂ℓ “ u´ℓ ´ u´ℓ t ą 0
,
π̂m “ t ą 0
’
%
1`R´ℓ
u´m
π̂u “ u´ℓ ´ u´ℓ t ą 0
)
. Or equivalently, ℓ ă 1`R ă u.
!
)
u´p1`Rq
Notice that the positive segment is given by 0 ă t ă min 1`R´ℓ
,
.
u´m
m´ℓ

which is guaranteed if and only if 0 ă min

!

1`R´ℓ u´p1`Rq
u´m , m´ℓ

π̂u
1
u
1+R

1
1

π̂ℓ

ℓ
1+R

m
1+R

π̂m

Figure 2.1.14: The positive segment of line given by (2.1.8) when ℓ ă 1 ` R ă u
Exercise 2.1.8. Derive the no-arbitrage condition for the multinomial model in Figure
2.1.15. Here, u1 ă u2 ă ¨ ¨ ¨ ă uM are positive numbers.

2.1.5

Replication and complete market

A contingent claim (or simply a claim) on an underlying asset S is a new asset with a
payoﬀ given by a function g : R` Ñ R on the price ST of the underlying asset at maturity
T ; i.e., the payoﬀ is gpST q. Call and put options are examples of contingent claims with
payoﬀ functions gpST q :“ pST ´ Kq` and gpST q :“ pK ´ ST q` , respectively. A replicating
56

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

S0 u1
S0 u2
..
.
S0 uM −1

S0

S0 uM
Figure 2.1.15: The description of the asset price in the multinomial model
(or hedging) portfolio for a contingent claim is a portfolio with the same future value as
the payoﬀ of the claim at all states of the market. For example, in the binomial model in
Section 2.1.3, any arbitrary claim can be replicated. More precisely, a payoﬀ gpS0 uq and
gpS0 ℓq for states u and ℓ, respectively, is replicated by a portfolio pθ0 , θ1 q, given by
θ0 “

ugpS0 ℓq ´ ℓgpS0 uq
u´ℓ

and

θ1 “

gpS0 uq ´ gpS0 ℓq
.
S0 pu ´ ℓq

Contrary to the binomial model, in the trinomial model, several claims may not be replicable. For instance, the replication of a call option with K P rS0 m, S0 uq leads to the following
system of three equations and two unknowns:
$
’
&θ0 p1 ` Rq ` θ1 S0 u “ S0 u ´ K
,
θ0 p1 ` Rq ` θ1 S0 m “ 0
’
%
θ0 p1 ` Rq ` θ1 S0 ℓ “ 0
which obviously does not have any solutions for pθ0 , θ1 q. A market model in which every
claim is replicable is called a complete market. A binomial model is a complete market,
whereas a trinomial model is an incomplete market.
For a general Arrow-Debreu market model, the condition of completeness is expressed in
the following theorem.
Theorem 2.1.2. Assume that there is no arbitrage, i.e., there exits a risk-neutral probability π̂. Then, the market is complete if and only if there is a unique risk-neutral probability;
i.e., if and only if the system of linear equation (2.1.1)
p “ Pπ
has a unique positive solution.
While in the binomial model there is only one risk-neutral probability and therefore the
57

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

market is complete, in the trinomial model there are infinitely many risk-neutral probabilities and therefore the market is incomplete.

2.1.6

Superreplication and model risk

Replication (or hedging) is a normal practice for the issuer of an option to manage the risk
of issuing that option. When the market is not complete, one cannot perfectly replicate all
claims and the issuer of a claim should take another approach: a nonperfect replication.
In practice, the replication starts only after pricing the claim. The issuer first picks up
˚ qT , to price the claim
a pricing model, i.e., a risk-neutral probability π̂ ˚ “ pπ̂1˚ , ..., π̂M
1
by 1`R
Ê˚ rgpST qs. Then, she tries to use the fund raised by selling the option to find a
nonperfect replication strategy. Genuinely, the higher the price of the claim, the less the
issuer is exposed to the risk. Therefore, the chosen risk-neutral probability π̂ ˚ to price
the claims represents some level of exposure to the risk. In this section, we would like to
provide a method to measure this risk, namely model risk.
The choice of a replication strategy usually depends on many variables, including the
risk preference of the issuer, which are outside the context of this section. However, for
the purpose of model risk, we introduce one specific choice of a nonperfect replication
strategy, namely superreplication. A superreplication strategy prepares the issuer for the
worst-case scenario. The superreplication price of an option is defined as the cheapest price
of a portfolio that generates a payoﬀ greater than or equal to the payoﬀ the option for all
states of the market. In the Arrow-Debreu market model for asset shown in Figure 2.1.15,
we want to make a portfolio pθ0 , θ1 q such that
θ0 ` θ1 S0 uj ě gpS0 uj q for all j “ 1, ..., M.
Then, among all such portfolios we want to choose the one that has the least cost, i.e.,
θ0
min 1`R
` θ1 S0 . For instance, in the trinomial model, the superreplication price of an
option with payoﬀ gpS1 q is defined by
min

θ0
` θ1 S0
1`R

over all θ0 and θ1 subject to the constraints
$
’
&θ0 ` θ1 S0 u ě gpS0 uq
θ0 ` θ1 S0 m ě gpS0 mq
’
%
θ0 ` θ1 S0 ℓ ě gpS0 ℓq
58

(2.1.9)

.

(2.1.10)

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

The superreplication price of a claim is the smallest value that enables the issuer to build a portfolio which dominates the payoﬀ of
the claim, in other words, to remove all risk exposure from issuing
the claim.
For simplicity, we build the rest of this section in the context of the trinomial model.
However, extension to multinomial model is straightforward. Subreplication price can be
defined similarly by
θ0
max
` θ1 S0
(2.1.11)
1`R
over all θ0 and θ1 subject to the constraints
$
’
&θ0 ` θ1 S0 u ď gpS0 uq
(2.1.12)
θ0 ` θ1 S0 m ď gpS0 mq .
’
%
θ0 ` θ1 S0 ℓ ď gpS0 ℓq
Sub or superreplication is a linear programming problem that can be solved using some
standard algorithms. However, for the trinomial model, the solution is simple: for superreplication the minimum is attained in one of the at most three points of intersection
between the lines
$
’
&θ0 ` θ1 S0 u “ gpS0 uq
θ0 ` θ1 S0 m “ gpS0 mq .
’
%
θ0 ` θ1 S0 ℓ “ gpS0 ℓq
As shown in Figure 2.1.16, we only need to
(1) find these three points,
(2) exclude those that do not satisfy the inequalities (2.1.10), and
(3) check which one of the remaining yields the smallest value for

θ0
1`R

` θ1 S0 .

Example 2.1.8. In trinomial model, let S0 “ 1, R “ .5, u “ 2, m “ 1, and ℓ “ 1{2.
Consider an option with payoﬀ g shown in Figure 2.1.17.
a) Notice that payoﬀ gp2q “ 0 and gp1q “ gp1{2q “ 1. We shall find the superreplication
price for this option.
2θ0
min
` θ1
3
over all θ0 and θ1 subject to the constraints
$
’
&θ0 ` 2θ1 ě 0
.
θ0 ` θ1 ě 1
’
%
θ1
θ0 ` 2 ě 1
59

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS
θ1

θ0

Figure 2.1.16: The linear programing problem for superhedging. The hatched region is
determined by constraints (2.1.10). The dashed lines are the contours of the linear function
θ0
1`R ` θ1 S0 in (2.1.9). The point marked by ˛ is where the minimum is attained.

g(ST )

1

1

2

ST

Figure 2.1.17: Payoﬀ of Example 2.1.8
This linear programing problem matches the one sketched in Figure 2.1.16 with the
minimizer given by p2, ´1q. Therefore, the superreplication price is given by 13 .
b) We next find all risk-neutral probabilities. Notice that any risk-neutral probability
π̂ “ pπ̂u , π̂m , π̂ℓ qT satisfies
$
π̂ℓ
’
&2π̂u ` π̂m ` 2 “ 3{2
π̂u ` π̂m ` π̂ℓ “ 1
’
%
π̂u , π̂m , π̂ℓ ą 0
60

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

By eliminating π̂m , we obtain π̂u “ 12 ` π̂2ℓ . Then, we parametrize the line of intersection of the two planes 2πu ` πm ` π2ℓ “ 3{2 and π̂u ` π̂m ` π̂ℓ “ 1.
$
1
t
’
&π̂u “ 2 ` 2
π̂m “ 21 ´ 3t
2
’
%
π̂ℓ “ t
It is easy to see that πu , πm , πℓ ą 0 if and only if t P p0, 13 q. The positive segment is
shown in Figure 2.1.18.
π̂u
1
.75

1
1

π̂ℓ

1.5

π̂m

3

Figure 2.1.18: The positive segment of the intersection of two lines given by π̂u u` π̂m m`
π̂ℓ ℓ “ 1 ` R and π̂u ` π̂m ` π̂ℓ “ 1. The mark on the segment represents a chosen pricing
model π̂ ˚ .
c) Next, we find the range of prices for the option described in Part (a) generated by
diﬀerent risk-neutral probabilities. Notice that in Part (b), all risk-neutral probabilities are generated by a single parameter t P p0, 13 q. Thus, the risk-neutral price of this
option is given by
˜
¸
´ 1 3t ¯
2 ´1
t¯
1
2t
1
t
`
gp2q `
´
gp1q ` tgp1{2q “ ´ t `
“ ´
3
2 2
2
2
3
3
3 3
As t changes in p0, 13 q, the price changes in p 29 , 13 q.
Notice that in Example 2.1.8, the superreplication price 31 is the same as the supremum
of the price range given by risk-neutral probabilities p 92 , 13 q. This is not a coincidence. One
can see the relation between the superreplication problem and risk neural pricing through
the linear programming duality in Theorem A.3.
61

2.1. ARROW-DEBREU

2. DISCRETE-TIME MARKETS

The problem of superreplication is a linear programming problem (A.3) that has a dual
problem given by (A.4). Theorem A.3 suggests that both problems have the same value.
In the context of superreplication for the trinomial model, the dual problem is given by
max πu gpS0 uq ` πm gpS0 mq ` πℓ gpS0 mq
over all πℓ , πm , and πu subject to the constraints
$
’
& π u S0 u ` π m S0 m ` π ℓ S0 m “ S0
1
πu ` πm ` πℓ “ 1`R
’
%
π u , πm , π ℓ ě 0
By change of variable π̂ “ p1 ` Rqπ, the dual problem turns into
Ppgq :“

1
max π̂u gpS0 uq ` π̂m gpS0 mq ` π̂ℓ gpS0 mq,
1`R
$
’
&π̂u u ` π̂m m ` π̂ℓ ℓ “ 1 ` R
.
π̂u ` π̂m ` π̂ℓ “ 1
’
%
π̂u , π̂m , π̂ℓ ě 0

subject to
(2.1.13)

Given no-arbitrage condition, the line of intersection of two planes π̂u u`π̂m m`π̂ℓ ℓ “ 1`R
and π̂u ` π̂m ` π̂ℓ “ 1 has a segment in the positive octane, shown in Figure 2.1.14. Then,
the value of Ppgq in (2.1.13) is attained at one of endpoints of this segment. This segment
represents the set of all risk-neutral probabilities. According to Theorem 2.1.1, the lack of
weak arbitrage implies that this segment is inside the first octane with to endpoints on two
diﬀerent coordinate planes, and the lack of strong arbitrage only implies that the endpoints
of the segment are on the coordinate planes, possibly the same coordinate plane.
Let’s recall what we presented at the beginning of this section: the issuer of the option
chooses a risk-neutral probability π̂ ˚ inside the positive segment to price the option. The
endpoints of this segment, one of which maximizes and the other minimizes the value
1
1`R max π̂u gpS0 uq ` π̂m gpS0 mq ` π̂ℓ gpS0 mq, provide the super and subreplication price of
the option with payoﬀ g, respectively. While the issuer has priced the claim by
1
Ê˚ rgpS1 qs,
1`R
to completely cover the risk, he needs P in (2.1.13). Therefore, he is short as much as
Θpπ̂ ˚ q :“ Ppgq ´

1
Ê˚ rgpS1 qs
1`R

in order to cover the risk of issuing the claim. The value Θpπ̂ ˚ q is called superreplication
62

2. DISCRETE-TIME MARKETS

2.1. ARROW-DEBREU

model risk measureindexsuperreplication model risk measure.
Example 2.1.9. In Example 2.1.8, if the pricing probability π̂ ˚ “ p7{12, 1{4, 1{6qT is
chosen, then the superreplication model risk is measured by
˜
¸
1
1
2
7
1
1
1
5
1
Ppgq ´
Ê˚ rgpS1 qs “ ´
gp2q ` gp1q ` gp1{2q “ ´
“ .
1`R
3 3 12
4
6
3 18
18
Exercise 2.1.9. In the trinomial model, let S0 “ 1, R “ 0, u “ 2, m “ 1, and ℓ “ 1{2.
a) Find all the risk-neutral probabilities and the range of prices generated by them for a
call option with strike K “ 1.
b) Find the superreplication price and sub-replication price for this call option and compare them to the lowest and highest prices in Part (a).
Example 2.1.10. In Example 2.1.8, if we modify the yield by setting R “ 1, then there
will be an arbitrage. This can be seen through the absence of risk-neutral probabilities. On
the other hand, the superreplication problem is still feasible, i.e., problem (2.1.11) with
constraint (2.1.10) still has a finite value. But this value is zero. This is because we
minimize θ20 ` θ1 subject to θ0 ` 2θ1 ě 0, θ0 ` θ1 ě 1 and θ0 ` θ21 ě 1, which obviously takes
minimum value zero.
On the other hand, if we set R ą 1, then the superreplication problem is not feasible
anymore and the minimum is ´8.
Example 2.1.11. Consider the trinomial model with S0 “ 4, R “ .05, u “ 1.45, m “
1.25 and ℓ “ .85. To price payoﬀ g in Figure 2.1.12, the risk-neutral probability π̂ “
pπ̂u , π̂m , π̂ℓ qT “ p5{18, 1{12, 23{36qT has been chosen. In order to find the model risk, we
find the superreplication price by solving the following linear programming problem.
$
’
&θ0 ` 5.8θ1 ě gp5.8q “ .8
θ0
min
` 4θ1 subject to
θ0 ` 5θ1
ě gp5q “ 0
’
1.05
%
θ0 ` 3.4θ1 ě gp3.4q “ .6
1
The minimizer is given by θ0 “ 19
6 and θ1 “ 12 , and the superreplication price is given by
2
1
3.15 . Then, the model risk is Θpgq :“ 1`R ÊrgpS1 qs ´ P.

1
2
1
2
´
pπ̂u gpS0 uq ` π̂m gpS0 mq ` π̂ℓ gpS0 ℓqq “
´
Θpgq “
3.15 1 ` R
3.15 1.05

ˆ

˙
5
1
23
p.8q ` p0q ` p.6q
18
12
36

We leave the treatment of the general multinomial model as an exercise.
Exercise 2.1.10. Write the linear programming problem associated with the superreplication of a contingent claim in the multinomial model in Exercise 2.1.8 and its dual.
63

2.2. MULTIPERIOD DISCRETE-TIME MARKETS

2. DISCRETE-TIME MARKETS

Remark 2.1.6. The superhedging price and therefore the model risk is not linear in the
payoﬀ. The superreplication price of payoﬀ g1 ` g2 is less than the sum of the superreplication price of payoﬀ g1 and the superreplication price of payoﬀ g2 . To see this, recall that,
by Theorem A.3, the superreplication price of a payoﬀ g is
"
*
1
Ppgq :“ sup
ÊrgpS1 qs : over all risk-neutral probabilities π̂ .
1`R
Because suptf pxq ` gpxqu ď sup f pxq ` sup gpxq, we have
Ppg1 ` g2 q ď Ppg1 q ` Ppg2 q.

2.2
2.2.1

Multiperiod discrete-time markets
A discussion on the sample space for multiperiod asset price process

Consider a discrete-time market with time horizon T in which trading occurs only at time
t “ 0, ..., T , and there are d ` 1 assets. We shall denote the price of asset i at time
piq
t “ 0, ..., T by St , for i “ 0, ..., d. The price of each risky asset in a multiperiod market
model is a stochastic process; this means for each t “ 1, ..., T , the price at time t, denoted
by St is a random variable. In this section, we set up a sample space to host stochastic
processes that represent the price of assets in a discrete-time market.
For a single period market with one asset whose price is a random variable with discrete
values, a finite or countably infinite sample space which matches the states to the values
of a random variable may suﬃce. For instance, if the future price S1 of an asset is given
by three values 2, 1, and 0.5, one can assume a sample space with three outcomes, namely
Ω “ tω1 , Ω2 , ω3 u with S1 pω1 q “ 2, S1 pω2 q “ 1, and S1 pω3 q “ 0.5. When we have a
multiperiod market with a single asset, the price of the asset is a stochastic process, more
than one random variable, and we need a more complicated construction for sample space.
The following examples elaborate on this situation.
Example 2.2.1. Let the price St of an asset at time t “ 1, 2 be given by the diagram in
the figure below. The random variable S1 takes values 1 and ´1 and the random variable
S1,1 = 1
S1,2 = 1

ω1
ω2

S1,3 = −1

ω3

S1,4 = −1

ω4

64

S2,1 = 2
S2,2 = 0
S2,3 = 0
S2,4 = −2

2. DISCRETE-TIME MARKETS

2.2. MULTIPERIOD DISCRETE-TIME MARKETS

S1 takes values 2, 0, and ´1. However, a suitable sample to host both random variables is
one with only four members, Ω “ tω1 , ω2 , ω3 , ω4 u with S1 pω1 q “ 1, S2 pω1 q “ 2, S1 pω2 q “ 1,
S2 pω2 q “ 0, S1 pω3 q “ ´1, S2 pω3 q “ 0, and S1 pω4 q “ ´1, S2 pω4 q “ ´2. This sample space
is made up of all possible states of the market; here there are four states that are shown
with arrows. These states are also called the paths of the price process, which represents
the evolution of the price process in time for each outcome.
The above example is a standard random walk with two periods; see Example B.13.
Example 2.2.2. We modify Example 2.2.1 as shown below. Unlike Example 2.2.1, a
ω1

S2,1 = 2

S1,2 = 1

ω2

ω

5

S1,1 = 1

S2,2 = 0

S1,3 = −1 ω
3

ω6

S1,4 = −1

S2,3 = 0
ω4

S2,4 = −2

sample space needs more than four members, exactly six. There are six diﬀerent paths that
the price of the asset can evolve in time. Ω “ tω1 , ω2 , ω3 , ω4 , ω5 , ω6 u with S1 pω1 q “ 1,
S2 pω1 q “ 2, S1 pω2 q “ 1, S2 pω2 q “ 0, S1 pω3 q “ ´1, S2 pω3 q “ 0, and S1 pω4 q “ ´1,
S2 pω4 q “ ´2, S1 pω5 q “ ´1, S2 pω5 q “ 2, and S1 pω6 q “ 1, S2 pω6 q “ ´2.
In a more general case, a sample space needs to at least have the set of all probable sample
pathssuperreplication model risk measure. of the price process. In the Arrow-Debreu model,
the set of all sample paths is the set of all states of the market, regardless of the number
of assets. In a market with T periods and one asset that takes values Vt at time t with
t “ 0, ...T , we can have the sample space
␣
(
Ω “ px1 , ..., xT q : xt P Vt , t “ 1, ..., T .
ś
This sample space have Tt“1 Vt samples paths. We can use the sample-path methodology
to write one single sample space for both Example 2.2.1 and Example 2.2.2, namely
␣
(
Ω “ pa, bq : a “ ´1 or 1, and b “ ´2, 0, or 2 .
For a market with T periods and d ` 1 assets such that at time t the vector of assets
p0q
pdq
pSt , ..., St q takes values in the set Vt Ď Rd`1
for each t “ 0, ...T , the set of all sample
`
paths is the collection of all functions of the form
ω : t1, ..., T u Ñ V1 ˆ ¨ ¨ ¨ ˆ VT
65

2.2. TRADING AND ARBITRAGE

2. DISCRETE-TIME MARKETS

Notice that some of the sample paths may have probability zero. In Example 2.2.1, the sample path p´1, 2q has probability zero, but in Example 2.2.2, no sample path has probability
zero.
A unifying approach to set a sample space for the asset price process is by extending
the
śT
set of values of the price to include all positive real numbers, Vt “ Rd`1
,
Ω
“
V
`
t“1 t “
piq
d`1 T 5
d`1 T
pR` q equipped with the Borel σ-field BppR` q q. The random variable St which
represents the price of asset i at time t is then defined by the canonical mapping
piq

piq

p0q

pdq

T
d`1
St : ω “ pω1 , ..., ωT q P pRd`1
` q ÞÑ ωt , where ωt “ pωt , ..., ωt q P R` .
piq

Here, we assume that the price of an asset only takes positive values ωt P R` . If it
takes negative values, then we can extend the sample space to Ω :“ pRd`1 qT . If asset
0 is a risk-free asset, then we can remove its contribution in the sample space and write
Ω :“ pRd` qT .
The choice of canonical space allows us to cover all types of models for asset price with
discrete or nondiscrete distribution. For the rest of this section, we do not need to emphasize on choice the sample space, we assume that the sample space is finite. Some of
the result can be generalized to countably infinite or even uncountable sample spaces. But,
the treatment of such cases needs more advance tools form martingale theory.

2.2.2

Arbitrage and trading in multiperiod discrete-time markets

Consider a market with multiple assets. There are three ways to represent a portfolio
that is made up of these assets: based on the proportion of each asset in the portfolio,
the number of units of each asset in the portfolio, and the value invested in each asset.
We start to define a portfolio based on the proportion, because it is easier to understand,
then we provide the equivalent representations on the number of units of each asset in the
portfolio and the value invested in each asset.

Portfolio
A self-financing portfolio, or simply a portfolio, is represented by the sequence of vectors
ř
piq
piq
p0q
pdq
θt “ pθt , ..., θt qT for t “ 0, ..., T ´ 1 with di“0 θt “ 1, for t “ 0, ..., T ´ 1. Here, θt
piq
piq
piq
is the ratio of the value of portfolio invested in asset i at time t; θt “ WWt , where Wt
is the proportion of the value of portfolio invested in asset i at time t and Wt is the total
piq
piq piq
piq
value of the portfolio at time t. Equivalently, Wt “ ∆t St , where ∆t is the number of
5

pd`1qT

T
We prefer to write pRd`1
` q and not R`

.

66

2. DISCRETE-TIME MARKETS

2.2. TRADING AND ARBITRAGE
piq

shares of asset i in the portfolio and St
Wt “

d
ÿ

piq

Wt

“

i“0
piq

piq

d
ÿ

is the current price of asset i. More precisely,

piq piq

∆t St

piq

and Wt

piq

piq piq

“ θt Wt “ ∆t St .

i“0

piq

θt , ∆t , and Wt can be positive, negative, or zero, representing long, short, or noinvestment positions in asset i, respectively. In addition, they do not need to be deterministic; in general, a portfolio strategy can be a sequence of random vector that depends on
piq
the information obtained from the assets’ prices before or at time t. In other words, θt is
pjq
a function of random variables Si for i “ 1, ..., t and j “ 1, ..., d. More rigorously:

Definition 2.2.1. A self-financing portfolio strategy is given by a sequence of vector funcp0q
pdq
tions θt “ pθt , ..., θt qT such that θ0 P Rd is a real vector and for any t “ 1, ..., T ´ 1,
p0q
pdq
θt “ pθt , ..., θt qT is a function that maps
» 0
fi
S1 ¨ ¨ ¨ St0
—
ﬃ
St :“ – ... . . . ... fl
(2.2.1)
S1d

¨ ¨ ¨ Std

into a vector in Rd that satisfies
d
ÿ

piq

θt “ 1,

for t “ 0, ..., T ´ 1.

i“0
piq

In other words, the function θt depends only on the prices of all assets from time t “ 0
until time t, not the future prices at points t ` 1, ..., T in time. This is in line with the
intuition that a portfolio strategy can only depend on the information gathered up to the
present time.
In diﬀerent applications, diﬀerent representation of a portfolio strategy are proved useful.
For example in the portfolio theory, it is easier to write the portfolio in terms of the ratio,
while in the replicating portfolio of an option, the number of shares in each asset happens
to provide a more convenient representation. If ∆t is known, the value of portfolio at time
t is given by
d
ÿ
piq piq
Wt “
∆t St .
i“0
piq

piq

piq

Then, the value invested in asset i changes by ∆t pSt`1 ´ St q from time t to time t ` 1.
67

2.2. TRADING AND ARBITRAGE
Time

2. DISCRETE-TIME MARKETS

# of units of asset (j)
pjq

t

∆t

“

pjq

Value of the portfolio

pjq
θt Wt
pjq
St

p0q p0q

Wt “ ∆t St

θt Wt`1

t ` 1 before rebalancing

p0q p0q

pjq

θt`1 Wt`1

pjq

∆t`1 “

pdq pdq

Wt`1 “ ∆t St`1 ` ¨ ¨ ¨ ` ∆t St`1

pjq

St`1

t ` 1 after rebalancing

pdq pdq

` ¨ ¨ ¨ ` ∆t St

p0q

p0q

pdq

pdq

Wt`1 “ ∆t`1 St`1 ` ¨ ¨ ¨ ` ∆t`1 St`1

pjq

St`1

Table 2.1: Rebalancing a portfolio strategy from time t to time t ` 1.

Therefore, the total wealth at time t ` 1 changes to
Wt`1 “

d
ÿ

piq piq

∆t St`1 ,

i“0

and the change in the value of portfolio is given by
Wt`1 ´ Wt “

d
ÿ

piq

piq

piq

∆t pSt`1 ´ St q,

(2.2.2)

i“0

However, at time t ` 1, we need to change the investment ratio θt to a diﬀerent value θt`1 ,
and as a consequence, ∆t should be changed to ∆t`1 accordingly. Since the sum of ratios
is always one,
d
ÿ
piq
θt`1 “ 1, for t “ 0, ..., T ´ 1,
i“0
piq

and θt “

piq piq
∆t St
Wt

, the vector ∆t`1 must satisfy

d
ÿ

piq
piq
∆t`1 St`1

“ Wt`1 “

i“0

d
ÿ

piq piq

∆t St`1 ,

for t “ 0, ..., T ´ 1.

i“0

Stochastic integral: discrete-time markets
For ease of calculation, we consider the case d “ 1, i.e., i “ 0 and 1. Recall from (2.2.2)
that the change in the value of the portfolio satisfies
W
t`1 ´ Wt
looooomooooon
change in the value of the portfolio

“

p0q

p0q

p0q

∆t pSt`1 ´ St q
loooooooooomoooooooooon
change due to risky asset (0)

68

`

p1q

p1q

p1q

∆
t pSt`1 ´ St q
loooooooooomoooooooooon
change due to risky asset (1)

.

2. DISCRETE-TIME MARKETS

2.2. TRADING AND ARBITRAGE

Given initial wealth W0 , we sum up the above telescopic summation to obtain
Wt “ W0 `

t´1
ÿ

p0q

p0q

p0q

∆i pSi`1 ´ Si q `

i“0

t´1
ÿ

p1q

p1q

p1q

∆i pSi`1 ´ Si q.

i“0

In the right-hand side above, either of the summations corresponds to the cumulative
changes in the value of the portfolio due to investment in one of the assets.
If asset S p0q denotes a risk-free asset with discrete yield R in the time period from i to
p0q
p0q
p1q
p0q p0q
p1q p1q
i ` 1, then Si`1 ´ Si “ RSi . On the other hand, ∆i Si “ Wi ´ ∆i Si . Therefore,
p0q

p0q

p0q

p1q p1q

∆i pSi`1 ´ Si q “ RpWi ´ ∆i Si q.
In this case, we can simply drop the superscript of the risky asset to write
W
t`1 ´ Wt
looooomooooon

RpW
t ´ ∆t St q
looooooomooooooon

“

change in the value of the portfolio

`

change due to risk-free asset

∆
t pSt`1 ´ St q
looooooomooooooon

.

change due to risky asset

Therefore, the total wealth satisfies
Wt “ W0 ` R

t´1
ÿ

t´1
ÿ

i“0

i“0

pWi ´ ∆i Si q `

∆i pSi`1 ´ Si q.

(2.2.3)

In (2.2.3), the first summation is the cumulative changes in the value of the portfolio due
to investment in the risk-free asset, and the second summation is the cumulative investment
in the portfolio due to changes in the risky asset.
An important consequence of this formula is that a self-financing portfolio is only characterized by trading strategy ∆ “ p∆0 , ..., ∆T ´1 q and the initial wealth W0 , since there is no
inflow and outflow of cash to or from the portfolio. The term
p∆ ¨ Sqt :“

t´1
ÿ

∆i pSi`1 ´ Si q

i“0

is called a discrete stochastic integral6 .
Exercise 2.2.1. Let W̃t :“ p1 ` Rq´t Wt and S̃t :“ p1 ` Rq´t St be, respectively, discounted
wealth process and discounted asset price.Then, show that
W̃t “ W0 `

t´1
ÿ

∆i pS̃i`1 ´ S̃i q,

Ŵ0 “ W0 .

i“0
6

According to Philip Protter, this notation was devised by the prominent French probabilist Paul-André
Meyer to simplify the task of typing with old-fashioned typewriters.

69

2.2. TRADING AND ARBITRAGE

2. DISCRETE-TIME MARKETS

To understand the meaning of stochastic integral p∆ ¨ Sqt , we provide the following example.
Example 2.2.3. Recall from Example B.13 that a random walk W is the wealth of a player
in a game of chance in which he wins or loses $1 in each round based on the outcome of
flipping a coin. If we denote the amount of bet of the player in round i by ∆i´1 , then the
total wealth W ∆ from the betting strategy ∆ “ p∆0 , ∆1 , ...q in t rounds is given by
Wt∆ “ W0∆ `

t´1
ÿ

∆i ξi`1

i“0

where tξi ui is a sequence of i.i.d. random variables with values 1 and ´1. Since ξi “
Wi`1 ´ Wi , we have
t´1
ÿ
Wt∆ “
∆i pWi`1 ´ Wi q “ p∆ ¨ W qt .
i“0

In particular, if ∆i ” 1, W ∆ “ W is merely a random walk.
Example 2.2.4 (Saint Petersburg paradox and doubling strategy). In the setting of Example 2.2.3, we consider the following strategy: ∆0 “ 1 and ∆i “ 2i , for i ą 0, if the
player has lost all the past rounds from 1 to i ´ 1. Otherwise, if the first winning occurs
at round i, we set ∆j “ 0 for j ě i. For example, if the player’s outcome in the first five
rounds are given by "loss, loss, loss, loss, win", then his bets are given by "1, 2, 4, 8, 16, 0
, ...", respectively. Then, the wealth of the player after five rounds is given by
W5 “ 1p´1q ` 2p´1q ` 4p´1q ` 8p´1q ` 16p1q “ 1.
However, his wealth before the fifth round is always negative.
W1 “ ´1,

W2 “ ´3,

W3 “ ´7,

W4 “ ´15.

More generally, if the player loses first i ´ 1st rounds and win the ith round, the wealth of
the player satisfies
W1 “ ´1, ..., Wi´1 “

i´1
ÿ

2j “ 2i ´ 1 and Wi´1 “ 1.

j“0

Exercise 2.2.2. In Example 2.2.4, we showed that if the player has the opportunity to
borrow with no limitation and continue the game until the first win, he will always end up
with terminal wealth equal to $1.
a) Assume that the player has a credit line, denoted by C. He stops playing if either he
reaches his credit limit or he wins for the first time. Find the possible values for the
terminal wealth of the player.
70

2. DISCRETE-TIME MARKETS

2.2. TRADING AND ARBITRAGE

b) Find the expected value of the terminal wealth of the player, given that the probability
of winning is p P p0, 1q.
Arbitrage strategy
In this section, we present the definition of an arbitrage opportunity and a version of the
FTAP7 for multistep discrete-time markets. In order to define arbitrage, we first fix the
sample space Ω of all samples paths of the price process and we define a σ-field F of all
events on the sample paths space. When Ω is a finite or countably infinite set, we can
d`1 T
T
choose F to be the σ-field of all subsets of Ω. When Ω “ pRd`1
` q , we set F “ BppR` q q.
To define arbitrage, it is crucial to to determine the set of all events on the sample paths
space that are believed to have a chance to occur. This is a part of modeling a financial
market. Relevant events are those that basically represent our beliefs about the market
behavior. Equivalently, one can determine the set of all events on the sample paths space
that are deemed impossible to occur. We define such events below.
Definition 2.2.2. We call a collection of events N Ď F a polar collection if it satisfies
a) H P N .
b) If B P N and A Ď B, then A P N .
Ť8
c) If tAn u8
n“1 Ď N , then
n“1 An P N .
The members of a polar collection are called polar sets .
As discussed in examples below, the polar collection depends on the choice of the space
sample paths.
Example 2.2.5 (polar set). In the binomial model in Section 2.1.3, if we set the sample
space to be Ω “ R` , the polar collection N is given by all subsets of Ω that do not contain
any of the points S0 u or S0 ℓ. However, if we set the sample space to Ω “ tu, ℓu, then
N “ tHu. Similarly, in the trinomial model in Section 2.1.4, Ω “ R` is the canonical
space and the polar collection N is the collection of all events A that do not contain any of
the points S0 u, S0 m, or S0 ℓ. If we set the sample space to Ω “ tu, m, ℓu, then N “ tHu.
Example 2.2.6. In Example 2.2.1, consider the sample paths space given by Ω “ tpx, yq :
x “ ´1 or ` 1 and y “ ´2, 0, or 2u. Then, the set of polar collection is
!
)
H, tp1, ´2qu, tp´1, 2qu, tp1, ´2q, p´1, 2qu .
The arbitrage relative to the polar collection N is defined below.
7

A fundamental theorem of asset pricing

71

2.2. TRADING AND ARBITRAGE

2. DISCRETE-TIME MARKETS

Definition 2.2.3. A (weak) arbitrage opportunity is a portfolio ∆ such that
a) W0 “ 0,
b) tWT ă 0u P N , and
c) tWT ą 0u R N .
A strong arbitrage opportunity is a portfolio ∆ such that
a) W0 ă 0, and
b) tWT ă 0u P N .
By tWT ă 0u P N , we mean that the event tWT ě 0u will surely happen. tWT ą 0u R N
means that tWT ą 0u is likely to happen with a possibly small chance.
In the above, we did not assign any probability to the events, except the polar collection;
the polar collection is the collection of all events that are believe to have probability zero.
Outside polar collection, all the events have nonzero probability, which may not be known.
To extend FTAP to discrete-time multiperiod market models, we need the probabilistic
notion of martingale, which is introduced in Section B.3. Risk-neutral probability in a
multiperiod market can be defined in terms of the martingale property for the discounted
asset price: Ŝt :“ p1 ` Rq´t St ; we assume implicitly that there is a zero bond with yield R
in the market.
Definition 2.2.4. We call a probability P̂ a risk-neutral probability if the discounted asset
price is a martingale with respect to the σ-field generated by the price process tSt : t ě 0u
under the probability measure P̂; i.e.,
ÊrŜt`1 | St , St´1 , ..., S1 s “ Ŝt .

(2.2.4)

Here, Ê is the expectation with respect to P̂.
We can also use the notion of σ-field FtS :“ σpSt , ..., S0 q generated by St , ..., S0 to write
ÊrŜt`1 | FtS s “ Ŝt .
For a single-period binomial model, the martingale property with respect to risk-neutral
probability is expressed and verified in Section 2.1.3; see (2.1.5).
Exercise 2.2.3. Let t∆t u8
t“0 be a bounded portfolio strategy; i.e., there exists a number
St
C such that |∆t | ă C for all t “ 0, 1, .... Show that if the discounted price Ŝt “ p1`Rq
t
is a martingale with respect to probability P̂, then the stochastic integral p∆ ¨ Ŝqt and the
discounted wealth process W̃t are martingales with respect to P̂.
72

2. DISCRETE-TIME MARKETS

2.2. TRADING AND ARBITRAGE

The following result extends Theorem 2.1.1 into multiple periods. In order to have a
fundamental theorem of asset pricing in a general form, we need to impose the following
assumption.
Assumption 2.2.1 (Dominating probability). There exists a probability P such that A P N
if and only if PpAq “ 0.
Assumption 2.2.1 holds trivially if the sample space of all paths are finite or countably
infinite. It is a nontrivial assumption when the sample path space is uncountable.
The probability P can be regarded as the physical probability in the market. Therefore,
one can equivalently define the collection of all polar sets as the set of all events that have
zero probability under P. However, as seen in Theorem 2.2.1, the only relevant information
about probability P is the no-arbitrage condition is the polar collection; the actual value
of the probability of an event does not matter as long as it has a nonzero probability. In
this case, we say that the polar sets are generated by P.
Definition 2.2.5. Two probabilities P and P̂ are called equivalent if they generate the same
polar sets. We denote the equivalency by P ” P̂.
Theorem 2.2.1 (Fundamental theorem of asset pricing (FTAP)). Let Assumption 2.2.1
hold. Then, there is no weak arbitrage opportunity in the discrete-time market model if
and only if there exists a probability measure P̂ such that
a) P̂ ” P, and
b) the discounted asset price Ŝt is a (local) martingale(local) martingale8 under P̂.
The probability measure P̂ is called a risk-neutral probability.
A market model with no arbitrage is called a complete market model if any contingent
T
claim is replicable. In other words, for a contingent claim with payoﬀ g : pRd`1
` q Ñ R
which maps the history of an underlying asset price, S0 , S1 , ..., ST into gpS0 , S1 , ..., ST q,
there exists a portfolio ∆0 , ..., ∆T ´1 such that
p∆ ¨ SqT “ gpS0 , S1 , ..., ST q.
As an extension to Theorem 2.2.1, we have the following condition for the completeness of
a market.
Corollary 2.2.1. Let Assumption 2.2.1 and no-weak-arbitrage condition hold. Then, The
market is complete if and only if there is a unique risk-neutral probability measure.
8

local martingale is roughly a martingale without condition (a) in Definition B.15.

73

2.2. TRADING AND ARBITRAGE

2. DISCRETE-TIME MARKETS

One direction of Theorem 2.2.1 is easy to prove. Here is a glimpse of the proof. Assume
that a risk-neutral probability P̂ exists, and consider an arbitrage strategy ∆ with the
corresponding discounted wealth process Wt integrable. Then,
Ŵt “ p∆ ¨ Ŝqt . pRecall that W0 “ 0.q
Since Ŝt is a P̂-martingale, then by Exercise 2.2.1, Ŵt is a martingale and we have
ÊrŴt s “ W0 “ 0.
This is in contradiction to condition (c) in the definition of arbitrage 2.2.3. For a complete
proof of this result, see [13, Pg. 7, Theorem 1.7]. A very general form of this theorem can
be found in a seminal paper by Delbaen and Schachermayer [9].
Remark 2.2.1. Assumption 2.2.1 can be relaxed by assuming that the polar sets are generate by a convex collection of probabilities P. More precisely A P N if and only if PpAq “ 0
for all P P P. Then, the fundamental theorem of asset pricing should be modified: there is
no weak arbitrage opportunity in the discrete-time model if and only if
a) Q :“ tP̂ : Ŝt is a P̂-martingaleu is nonempty, and
b) P and Q generate the same polar sets.
For more on the relaxation of Assumption 2.2.1, see [6].
By Theorem 2.2.1, the existence of risk-neutral probability eliminates the possibility of
arbitrage. However when T “ 8, the Saint Petersburg Paradox still holds even though a
risk-neutral probability exists. This is a diﬀerent issue and is related to the notion of an
admissible portfolio strategy. The following corollary suggest a practical way around this
paradox.
8
Corollary 2.2.2. Let tMt u8
t“0 be a martingale, t∆t ut“0 a portfolio strategy, and C be a
constant such that p∆ ¨ M qt ě C for all t ě 0. Then, for any stopping time τ such that
τ ă 8 a.s., we have
Erp∆ ¨ M qτ | Ft s “ p∆ ¨ M qτ ^t .

In particular, Erp∆ ¨ M qτ s ď 0.
Definition 2.2.6 (Admissible strategy). A portfolio strategy is called admissible if there
exists a C be a constant such that p∆ ¨ Sqt ě C for all t ě 0.
restriction to admissible strategies is not necessary when there are only finite number
of periods, T ă 8. For T “ 8, we need to restrict the portfolio strategy choices to
admissible strategies. In addition, this happens to be necessary when we pass to a limit
from a discrete-time market to a continuous-time market by sending the number of periods
to infinity.
74

2. DISCRETE-TIME MARKETS

2.3

2.3. BINOMIAL MODEL

Binomial model

Let H1 , H2 , ... be an i.i.d.9 sequence of random variables with values u and ℓ10 . Let T be
the maturity, and let the time variable t take values 0, 1, ..., T . At time 0, the price of the
asset is S0 . At time t “ 1, ..., T , the price of the asset satisfies St “ St´1 Ht . The binomial
model is shown in Figure 2.3.1.
S0 uT

S0 u3

S0 uT −1 ℓ

S0 u2 ℓ

S0 uT −2 ℓ2

S0 u2
S0 u
S0

..
.

S0 uℓ
S0 ℓ

S0 uℓ2

S0 u2 ℓT −2

S0 ℓ3

S0 uℓT −1

S0 ℓ2

S0 ℓT

Figure 2.3.1: Asset price in the binomial model

We label the nodes of the binomial model by the time and the state of the asset price. For
example, at time t when the asset price is equal to St,j`1 :“ S0 uj ℓt´j , the node is labeled
pt, j ` 1q. The only node at time 0 is labeled 0 for simplicity. See Figure 2.3.2.

9
10

Independent identically distributed
The probabilities of these values are irrelevant at this moment.

75

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS
(3, 4)
(2, 3)
(1, 2)

(3, 3)

(0)

(2, 2)
(1, 1)

(3, 2)
(2, 1)
(3, 1)

Figure 2.3.2: Label of the nodes in a three-period binomial model

2.3.1

No-arbitrage condition

The no-arbitrage condition for the multiperiod binomial model is the same as for the singleperiod. There is no arbitrage in the multiperiod binomial model if and only if there is no
arbitrage for the single-period model with the same parameters.
Proposition 2.3.1. There is no arbitrage in the multiperiod binomial model if and only
if ℓ ă 1 ` R ă u. In this case, the multiperiod binomial market is complete, and the
risk-neutral probability is given by assigning the following distribution to each Hi .
P̂pHi “ uq “

u´1´R
1`R´ℓ
and P̂pHi “ ℓq “
.
u´ℓ
u´ℓ

Proof. By Theorem 2.2.1 (FTAP), no-arbitrage condition is equivalent to the existence of
a risk-neutral probability. We first show that given ℓ ă 1 ` R ă u, the probability P̂
defined in the theorem is a risk-neutral probability. In other words, we shall show that
the discounted asset price is a martingale. Notice that since St`1 “ Ht`1 St , we have
t`1
Ŝt`1 “ H
1`R Ŝt . Therefore,
ÊrŜt`1 | FtS s “

1
ÊrŜt Ht`1 | FtS s,
1`R

where FtS “ σpŜt , ..., Ŝ0 q. Since Ŝt is known given FtS , if follows from Corollary B.6 that
ÊrŜt Ht`1 | FtS s “

Ŝt
ÊrĤt`1 | FtS s.
1`R

On the other hand, since H1 , H2 , ... is a sequence of independent random variables, Ht`1
76

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

is independent of FtS , and we have
ÊrĤt`1 | FtS s “ ÊrĤt`1 s “ π̂u u ` π̂ℓ ℓ “ 1 ` R.
Thus,
ÊrŜt`1 | FtS s “ Ŝt .
For the other direction, assume by contraposition that either u ď 1 ` R or ℓ ě 1 ` R.
Then, Section 2.1.3 shows that there is an arbitrage in the first period. Then, one can
liquidate the position to cash after the first period to carry over the arbitrage until time
T.
The above proof is also presented in Example B.41 in a diﬀerent way.
As shown in Figure 2.3.1, the random variable Sn only takes values S0 un´k ℓk for k “
0, ..., n. Under the risk-neutral probability,
ˆ ˙
n
n´k k
P̂pSn “ S0 u
ℓ q“
pπ̂u qn´k pπ̂ℓ qk .
k
` ˘
To see this, notice that in the binomial model in Figure 2.3.1, there are nk paths from
the node S0 to node S0 un´k ℓk , and the probability of each path is pπ̂u qn´k pπ̂ℓ qk 11 . For
simplicity, we denote S0 ut´i ℓi by St piq.
Remark 2.3.1 (Recombination in the binomialmodel). The binomial model has a feature
that allows reduce the number of values that Sn can take. For example, consider a two
period market with one asset whose price process is given below:
S0 “ 1, S1 “ H1 , and S2 “ H1 H2 ,
where Hi takes values ui and ℓi for i “ 1, 2. At time t “ 2, the S2 takes values u1 u2 ,
u1 ℓ2 , u2 ℓ1 , and ℓ1 ℓ2 . All these values are distinct unless u1 ℓ2 “ u2 ℓ1 . In the binomial
model u1 “ u2 “ u and ℓ1 “ ℓ2 “ ℓ. Therefore, u1 ℓ2 “ u2 ℓ1 “ uℓ. Therefore, the values
for S2 binomial model reduces to three, because the values u1 ℓ2 and u2 ℓ1 recombine. See
Figure 2.3.3. In general for a T period binomial market model, the recombination allows
that the price St takes only t ` 1 values, whereas in a nonrecombining market model, there
are potentially 2t distinct values for St .

2.3.2

Basic properties of the binomial model

The binomial model described above has some properties that are the common features in
many models in finance. These features allows to perform risk management evaluations in
a reasonable time. In this section, we discuss these properties.
11

This is an elementary combinatorics problem.

77

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS
u1 u2

u1 u2

u1

u1
u1 ℓ 2

S0 = 1

S0 = 1

u1 ℓ2 = ℓ1 u2

ℓ1 u2
ℓ1

ℓ1
ℓ1 ℓ2

ℓ1 ℓ2

Figure 2.3.3: Recombining binomial market model (right) versus a nonrecombining one
(left).

Time homogeneity
śt
Since tHi u8
t“1 is an i.i.d. sequence of random variables, then for t ą s,
i“s`1 Hi has the
śt´s
śt
same distribution as i“1 Hi . Therefore, given Ss “ S, St “ Ss i“s`1 Hi has the same
ś
distribution of St given
distribution as St´s “ S t´s
i“1 Hi . In other words, the conditional
ś
Ss “ S is the same as conditional distribution of St´s “ S0 t´s
H
i“1 i given S0 “ S.

Markovian property
The Markovian property for a stochastic process asserts that in order to determine the
probability of future scenarios of the value of the process, for example the value at a time
in the future, the only relevant information from the past history of the price process is the
most recent one. In other words,
Definition 2.3.1. A stochastic process tXt : t ě 0u with values in Rd is called Markovian
if for any A Ă R and s ą t, we have
PpXs P A | Xt , ..., X0 q “ PpXs P A | Xt s.
Equivalently, one can write the Markovian property of in terms of conditional expectation:
ErgpXs q | Xt , ..., X0 s “ ErgpXs q | Xt s.

(2.3.1)

The binomial model is Markovian under risk-neutral probability; given St , ..., S1 , S0
s
” ´
¯
ı
ź
ÊrgpSs q | St , ..., S0 s “ Ê g St
Hi | St , ..., S0 .
i“t`1

78

2. DISCRETE-TIME MARKETS

Since

s
ś

2.3. BINOMIAL MODEL

Hi is independent of St , ..., S0 , by Proposition B.6, we have

i“t`1
s
s
s
” ´
¯
ı
” ´ ź
¯ı
” ´
¯
ı
ź
ź
Ê g St
Hi | St “ st , ..., S0 “ s0 “ Ê g st
Hi “ Ê g St
Hi | St “ st .
i“t`1

i“t`1

i“t`1

Therefore,
ÊrgpSs q | St , ..., S0 s “ ÊrgpSs q | St s.
See Figure2.3.4 for the illustration of the Markovian property in the binomial model in one
period. Given St “ St piq, the probability that St`1 “ St`1 pi ` 1q is π̂u , and the probability
that St`1 “ St`1 piq is π̂ℓ . Given St ‰ St piq, both of the probabilities are 0.
St+1 (i + 1) := St (i)u

St (i)

St+1 (i) := St (i)ℓ

Figure 2.3.4: Conditioning of the binomial model

Why is Markovian property important? The Markovian property is often useful in reducing the computational eﬀort, and models with the Markovian property are computationally
eﬃcient. A reason for this reduction lies in the solution to the exercise below.

Exercise 2.3.1. How many paths are there in a binomial model from time t “ 0 to time
t “ n? How many nodes (values of asset price process at all points in time) are there?

If we don’t have Markovian property, we need to evaluate the conditional expectation
ÊrgpSs q | St , ..., S0 s once for each sample path; ÊrgpSs q | St , ..., S0 s is a random variable
that has as many values as the process pS0 , ..., St q does. However, Markov property allows
us to reduce the conditional expectation to ÊrgpSs q | St s, and therefore, the number of
values that ÊrgpSs q | St s can take is as many as the number of values of the ranvom
variable St .
79

2.3. BINOMIAL MODEL

2.3.3

2. DISCRETE-TIME MARKETS

Arbitrage pricing and replicating European contingent claims in
the binomial model

As in Section 2.1, the introduction of a new asset can create arbitrage if and only if the
discounted price of the new asset does not satisfy
1
ÊrP1¨j s “ p1 ,
1`R
for at least one risk-neutral probability. In the one-period binomial model, since there is
only one risk-neutral probability provided that there is no arbitrage, one can readily find
the no-arbitrage price of any new asset including all derivatives.
The same methodology applies to the multiperiod binomial model, with a slight diﬀerence:
the discounted price of the newly introduced asset must be a martingale with respect to
the risk-neutral probability.
We start by illustrating the idea in a two-period binomial model in the following example.
Example 2.3.1. Consider a two-period binomial model with S0 “ 1, u “ 2, ℓ “ 12 , and
R “ .5 (for simplicity). We consider a European call option with strike K “ .8; the payoﬀ
is gpS2 q “ pS2 ´ .8q` . Therefore, π̂u “ 32 and π̂ℓ “ 13 .
(4 − K)+ = 3.2

S2 (3) = 4

V1,2

S1 (2) = 2

S0 = 1

S2 (2) = 1

(1 − K)+ = .2

V0

S1 (1) = 1
2

V1,1

S2 (1) = 1
4

( 1 − K)+ = 0
4

Figure 2.3.5: European call option in a two-period binomial model. Left: asset price.
Right: option price
We first argue that the price of the European call option mimics the binomial model for
the asset and takes a similar form shown on the right-hand-side in Figure 2.3.5. At the
maturity, the value of the option is given by V2 “ pS2 ´ Kq` . Since S2 takes three values,
so does V2 . At time t “ 1,
We assume that there is no arbitrage. Therefore, the discounted price of the option must
be a martingale with respect to the asset price under the risk-neutral probability:
V1 “

1
1
ÊrV2 | S1 , S0 s “
ÊrpS2 ´ Kq` | S1 , S0 s.
1`R
1`R
80

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

By the Markovian property of the asset price, we have,
V1 “

1
ÊrpS2 ´ Kq` | S1 s.
1`R

Therefore, V1 is a function of S1 , and since S1 takes two values, the value V1 of the option takes two values V1,2 and V1,1 when S1 takes values S1 p2q “ S0 u and S1 p1q “ S0 ℓ,
respectively. More precisely,
ˇ
1
1
ˇ
V1,2 “
ÊrpS2 ´ Kq` | S1 “ S0 us “
pπ̂u pS1 u ´ Kq` ` π̂ℓ pS1 ℓ ´ Kq` q ˇ
1`R
1`R
S1 “S0 u
˙
ˆ
1
1
4.4
2
“
p3.2q ` p.2q “
« 1.4666.
1.5 3
3
3
Similarly at node p1, 1q, where t “ 1 and state is 1, we have
ˇ
1
1
ˇ
ÊrpS2 ´ Kq` | S1 “ S0 ℓs “
pπ̂u pS1 u ´ Kq` ` π̂ℓ pS1 l ´ Kq` q ˇ
1`R
1`R
S1 “S0 ℓ
ˆ
˙
1
2
1
.8
“
p.2q ` p0q “
« 0.8888.
1.5 3
3
9

V1,1 “

To evaluate the option price V0 at time t “ 0, we use that the no-arbitrage implies the
martingale property for the option:
ˆ
˙
1
1
2 2 4.4
1 .8
V0 “
ÊrV1 s “
pπ̂u V1,2 ` π̂ℓ V1,1 q “
p q ` p q « .6716.
1`R
1`R
3 3 3
3 9
To replicate the option, we need to solve the same system of equations as in 2.1.7 at each
node of the binomial model in a backward manner. At node p1, 2q,
#
#
θ0 p1 ` Rq ` θ1 S1 p2qu “ p4 ´ Kq`
1.5θ0 ` 4θ1 “ 3.2
or
.
θ0 p1 ` Rq ` θ1 S1 p2qℓ “ p1 ´ Kq`
1.5θ0 ` θ1
“ .2
Thus, θ1 “ 1 and θ0 “ ´ 1.6
3 . In other words, to replicate the claim at node p1, 2q we need
to keep one unit of the risky asset and borrow 1.6
3 units of the risk-free zero bond. This
4.4
leads to the price θ0 ` θ1 S1 p2q “ 2 ´ 1.6
“
,
the
same price we found with risk-neutral
3
3
probability.
The same method should be used in the other node, p1, 1q, to obtain the system of equation
#
θ0 p1 ` Rq ` θ1
“ .2
.
1
θ0 p1 ` Rq ` 4 θ1 “ 0
Thus, θ1 “

.8
3

and θ0 “ ´ .49 . The price θ0 θ1 S1 p1q “
81

1
2

` .8 ˘
3

´

.4
9

“

.8
9

is again the same as

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS

the risk-neutral price.
At node 0, the replicating portfolio needs to reach the target prices of the claim at time
t “ 1, i.e.
#
#
θ0 ` θ1 S0 u “ V1,2 “ 4.4
θ0 p1 ` Rq ` 2θ1 “ 4.4
3
3 .
or
θ0 ` θ1 S0 ℓ “ V1,1 “ .89
θ0 p1 ` Rq ` 21 θ1 “ .89
20
By solving the above system, we obtain θ1 “ 24.8
27 units of the risky asset and θ0 “ ´ 81
units of the risk-free bond in the replicating portfolio. This is the structure of the replicating
portfolio at the beginning of the replication. If the price moves up, we have to restructure
the portfolio to keep one unit of the risky asset and ´ 1.6
3 units of the risk-free bond. If it
.8
moves down, we need to readjust the position to 3 units of the risky asset and ´ .49 units
of the risk-free bond.

Next, consider a general European claim with payoﬀ gpST q, where g : R` Ñ R is a
function that assigns a value to the payoﬀ based on the price ST of the asset at terminal
time T . Such European claims are also called Markovian claims. Let V0 , ..., VT be random
variables representing the price of this European claim at time t “ 0, ..., T , respectively.
Then, in order to avoid arbitrage, the derivative price must remain martingale, i.e.
Vt “

1
ÊrVt`1 | St , ..., S0 s.
1`R

Let’s assume that at time t ` 1, Vt`1 is a function V pt ` 1, ¨q and St`1 . This assumption
is true for T , where VT “ gpST q. We use induction to show that Vt is a function of St .
It follows from the Markovian property of the binomial model that ÊrVt`1 | St , ..., S0 s “
ÊrV pt ` 1, St`1 q | St , ..., S0 s “ ÊrV pt ` 1, St`1 q | St s, and therefore
V pt, St q :“

1
ÊrV pt ` 1, St`1 q | St s.
1`R

(2.3.2)

Therefore, one needs to evaluate function V pt, Sq over the binomial model, as shown in
Figure 2.3.6.
We can also show bu induction that
V pt, St q “

1
ÊrÊrgpST q | St s.
p1 ` RqT ´t

This holds for t “ T ´ 1:
V pT ´ 1, ST ´1 q “

1
ÊrgpST q | ST ´1 s.
1`R
82

2. DISCRETE-TIME MARKETS

V0

V1

2.3. BINOMIAL MODEL

V2

V3

···

VT = g(ST )
(
)
g S0 u T

(
)
V 3, S3 (4)

(
)
g S0 uT −1 ℓ

(
)
V 3, S3 (3)

(
)
g S0 uT −2 ℓ2

(
)
V 2, S2 (3)
(
)
V 1, S1 (2)
(
)
V 2, S2 (2)

V0
(
)
V 1, S1 (1)

..
.
(
)
V 3, S3 (2)

(
)
g S0 u2 ℓT −2

(
)
V 3, S3 (1)

(
)
g S0 uℓT −1

(
)
V 2, S2 (1)

(
)
g S0 ℓ T
Figure 2.3.6: The price of a Markovian European contingent claim in the binomialmodel

Now assume that
V pt ` 1, St`1 q “

1
ÊrÊrgpST q | St`1 s.
p1 ` RqT ´pt`1q

Then, by the tower property of the conditional expectation, we can write
1
ÊrV pt ` 1, St`1 q | St s
1`R
”
ı
1
1
1
Ê
ÊrgpST q | St s.
“
ÊrgpS
q
|
S
,
...,
S
s
|
S
“
t`1
0
t
T
1 ` R p1 ` RqT ´pt`1q
p1 ` RqT ´t

V pt, St q :“

83

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS

Therefore, for any t “ 0, ..., T ´ 1, we have
V pt, St q “

1
ÊrgpST q | St s.
p1 ` RqT ´t

(2.3.3)

Remark 2.3.2. Since the binomial model is time homogeneous, ÊrgpST q | St “ Ss in
(2.3.3) is equal to ÊrgpST ´t q | S0 “ Ss. This suggests that the price function V pt, Sq is a
function of S and time-to-maturity τ :“ T ´ t, V pτ, Sq. Time-to-maturity is often used
instead of time in financial literature regarding the evaluation of contingent claims.
Example 2.3.2. Consider a four-period binomial model for a risky asset with each period
equal to a year, and take S0 “ $10, u “ 1.06, ℓ “ 0.98, and R “ .02. We shall find the
price V0 of the option with the payoﬀ shown in figure below. By 2.3.3, the value V p0, S0 q
g(ST )
1

0

10

11

S
12 T

of the option is the expected value of the discounted payoﬀ under risk-neutral probability;
V p0, S0 q “

1
ÊrgpS4 qs.
p1 ` Rq4

Since the random variable S4 takes values 9.2236816, 9.9766352, 10.7910544, 11.6719568,
and 12.6247696. Therefore, the only nonzero value of the payoﬀ is obtained when S4 “
10.7910544
` ˘ and is gp10.7910544q “ 1. The risk-neutral probability of ST “ 10.7910544 is
simply 24 pπ̂u q2 pπ̂ℓ q2 “ 38 . Thus,
V p0, S0 q “

3
« 0.34644203476.
8p1.02q4

Replication of European option in the binomial model
We show that any European contingent claim (even non-Markovian ones) are perfectly
replicable in the binomial model. The argument follows inductively: let the replicating
portfolio is built at each node of the binomial model at all points t ` 1 or later in time. As
a result of this assumption, at each node the value of the replicating portfolio is the same
as the value of the option. We continue by replicating the price of the option at time t ` 1;
84

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

i.e., we need to solve the following system of equations for each i “ 1, ..., t ` 1:
#
θ0 p1 ` Rq ` θ1 St`1 pi ` 1q “ V pt ` 1, St`1 pi ` 1qq
.
θ0 p1 ` Rq ` θ1 St`1 piq
“ V pt ` 1, St`1 pi ` 1qq
The solution is given by
θ0 “

uV pt ` 1, St piqlq ´ lV pt ` 1, St piquq
V pt ` 1, St piquq ´ V pt ` 1, St piqlq
and θ1 “
.
pu ´ ℓqp1 ` Rq
St piqpu ´ ℓq

θ1 is the number of units of the risky asset in the replicating portfolio, and θ0 is the number
of units of the risk-free bond in the replicating portfolio. In other words, the replicating
portfolio is a self-financing portfolio given by (2.2.3) with initial wealth V0 and portfolio
´1
strategy given by t∆pt, St quTt“0
.
∆pt, Sq :“

V pt ` 1, Suq ´ V pt ` 1, Sℓq
.
Spu ´ ℓq

(2.3.4)

The number of units of the risky asset in the replicating portfolio, given by (2.3.4), is called
the Delta of the contingent claim at time t. Basically, (2.3.4) suggests that the Delta of a
European Markovian contingent claim is a function of time t and the price of the underlying
asset at time t.
Remark 2.3.3. As you can see from (2.3.4), the Delta of the contingent claim at time t
measures the sensitivity of the value of the contingent claim with respect to changes in the
price of the underlying asset, i.e., changes in the price of the option due to changes in the
price of the underlying asset.
By (2.2.3), the replicating portfolio for the binomial model takes the form
V pt, St q “ V p0, S0 q ` R

t´1
ÿ

pV pi, Si q ´ ∆pi, Si qSi q `

i“0

t´1
ÿ

∆pi, Si qpSi`1 ´ Si q,

i“0

where V pi, Si q is the
ř price of the contingent claim at time i when the underlying price
is Si . The term R t´1
i“0 pV pi, Si q ´ ∆i pSi qSi q represents accumulated changes in the riskfree
řt´1zero bond in the replicating portfolio caused by compounding of the interest, and
i“0 ∆i pSi qpSi`1 ´ Si q represents the accumulated changes in the replicating portfolio
caused by changes in the risky asset price. The act of constructing a replicating portfolio
for a contingent claim is ofter referred to as Delta hedging.
The above discussion is summarized in the following algorithm.
Remark 2.3.4. Given that functions ∆ and V are calculated, one has to plug time t
and asset price St into the function to find the price and adjust the replicating portfolio
85

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS

Backward pricing and replicating European options in the binomialmodel
1:
2:
3:
4:
5:
6:
7:

At time T , the value of the option is gpST pjqq.
for each t “ T ´ 1, ..., 0 do
for each j “ 1, ..., t ` 1 do
1
ÊrV pt ` 1, St`1 q | St “ St pjqs.
The value of the option V pt, St pjqq “ 1`R
The replicating portfolio is made of ∆pt, St pjqq units of the risky asset and V pt, St pjqq´
St pjq∆pt, St pjqq is the risk-free bond.
end for
end for

of the contingent claim. However, there is no guarantee that quoted prices in the market
will match the prices in the binomial (or any other) model. In such case, interpolation
techniques can be exploited to find the price and adjust the replicating portfolio.
Exercise 2.3.2. In the binomial model, show that the Delta of a call option ∆call and the
Delta of a put option ∆put with the same maturity and strike satisfy
∆call
´ ∆put
“ 1,
t
t

for all t “ 0, ..., T ´ 1.

Is this result model-independent? Hint: consider the put-call parity.
Exercise 2.3.3. Consider a two-period binomial model for a risky asset with each period
equal to a year and take S0 “ $1, u “ 1.03 and ℓ “ 0.98.
a) If the interest rate for both periods is R “ 0.01, find the price of the option with
the payoﬀ shown in Figure 2.3.7 with K1 “ 1.00 and K2 “ 1.05 at all nodes of the
binomial model.
g(ST )
K2 − K1

K1

K2

ST

Figure 2.3.7: Payoﬀ of Exercise 2.3.3
b) Find the replicating portfolio at each node of the binomial model.
Exercise 2.3.4. Consider a two-period binomial model for a risky asset with each period
equal to a year and take S0 “ $1 u “ 1.05 and ℓ “ 1.00. Each year’s interest rate comes
from Exercise 1.1.4.
86

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

a) Is there any arbitrage? Why or why not? Give an arbitrage portfolio if you find out
there is one.

b) Now consider a two-period binomial model for a risky asset with each period equal to
a year and take S0 “ $1 u “ 1.05 and ℓ “ 0.95.
Find the price of the option with the payoﬀ shown in Figure 2.3.7 with K1 “ 1.00
and K2 “ 1.05 at all nodes of the binomial model. Find the interest rates for each
period from information in Part (a).

c) Find the replicating portfolio and specifically ∆ at all nodes of the binomial model.

Remark 2.3.5. 2.3.2 suggests that the price of a Markovian claim in a binomial model does
not depend on past movements of the price and only depends on the current price S. This
is
` not indeed true for
˘ non-Markovian claims.
` 1 For
řTexample, ˘a look-back option with payoﬀ
maxt“0,...,T St ´ K ` or an Asian option T `1 t“0 St ´ K ` are non-Markovian options
with the price depending to some extent on the past history of the price movement rather
than only the current price of the underlying. Evaluation of these type of non-Markovian
payoﬀs, namely path-dependent payoﬀs, cannot benefit fully from the Markovian property
of the model.

Example 2.3.3. Consider the setting of Exercise 2.3.3:
R “ 0.01, ˘S0 “ $1, u “ 1.03
`
and ℓ “ 0.98 To price a look-back option with payoﬀ maxt“0,1,2 St ´ 1 ` , first notice that
the payoﬀ of the option at time T “ 2 is path-dependent: the paths pS0 , S0 u, S0 uℓq and
pS0 , S0 ℓ, S0 uℓq generate the same value S0 uℓ for S2 . However, the payoﬀ for the former is
`
˘
`
˘
maxtS0 , S0 u, S0 uℓu ´ 1 ` “ maxt1, 1.03, 1.0094u ´ 1 ` “ 0.03;
while the latter has payoﬀ
`
˘
`
˘
maxtS0 , S0 ℓ, S0 uℓu ´ 1 ` “ maxt1, 0.98, 1.0094u ´ 1 ` “ 0.0094.
Therefore, the binomial model should be shown as in Figure 2.3.8 It follows from no arbi87

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS
(

)
max{S0 , S0 u, S0 u2 } − 1 + = 0.0609

u2
V (1, u)

u

(
uℓ

)
max{S0 , S0 u, S0 uℓ} − 1 + = 0.03

V0

S0 = 1

(
ℓu

max{S0 , S0 ℓ, S0 uℓ} − 1

)
+

= 0.0094

V (1, ℓ)

ℓ

(
ℓ2

)
max{S0 , S0 ℓ, S0 ℓ2 } − 1 + = 0

Figure 2.3.8: Look-back option in the binomial model in Example 2.3.3
trage that the price of the look-back option must be a martingale, and therefore,
“
‰
1
Ê gpS0 , S1 , S2 q | S1 “ u, S0 “ 1
1`R
¯
1 ´
“
π̂u p0.0609q ` π̂ℓ p0.03q « 0.0480594,
1.01
“
‰
1
Ê gpS0 , S1 , S2 q | S1 “ ℓ, S0 “ 1
V p1, ℓq “
1`R
¯
1 ´
“
π̂u p0.0094q ` π̂ℓ p0q « 0.0055841, and
1.01
“
‰
1
V0 “
Ê gpS0 , S1 , S2 q | S0 “ 1
2
p1 ` Rq
¯
1 ´ 2
2
“
π̂
p0.0609q
`
π̂
π̂
p0.03q
`
π̂
π̂
p0.0094q
`
π̂
p0q
« 0.0307617.
u
u
ℓ
ℓ
ℓ
p1.01q2 u

V p1, uq “

Replication is similar to the markovian case. For instance, to replicated the look-back option
at S1 “ u, we first need to solve the system of equations
#
θ0 p1 ` Rq ` θ1 u “ 0.0609
.
θ0 p1 ` Rq ` θ1 ℓ “ 0.03
However, since the binomial model does not recombine, the number such systems of equations to solve grows exponentially in the number of periods; whereas, in Markovian case the
number of such systems of equations grows quadratic.
Exercise 2.3.5. Consider
` 1 řT the setting
˘ of Exercise 2.3.3. Price and replicate an Asian
with K “ 10. Hint: The price is path dependent
option with payoﬀ T `1
S
´
K
t“0 t
`
and each path has a payoﬀ.

88

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

Example 2.3.4 (Call and put option). Consider a call option with strike K and maturity
T . Let the nonnegative integer k0 be such that S0 uk0 ´1 ℓT ´k0 `1 ă K ď S0 uk0 ℓT ´k0 . Then,

VT,T +1 = S0 uT − K

V1,2

Vt,t+1

..
.

Vt,t

VT,k0 +1 = S0 uk0 lT −k0 − K

..
.

V0
V1,1

Vt,2

0

Vt,1

..
.

0
Figure 2.3.9: Payoﬀ of a call option in a binomial model; k0 is such that
S0 uk0 ´1 ℓT ´k0 `1 ă K ď S0 uk0 ℓT ´k0 .
by (2.3.3), we have
V0call

T ˆ ˙
ÿ
1
n
“
pπ̂u qn´k pπ̂ℓ qk pSTk ´ Kq.
T
p1 ` Rq k“k k
0

Similarly, one can use (2.3.3) to obtain the price of a put option. However, given that we
already have the price of a call option in the above, one can find the price of a put option
89

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS

by using the put-call parity (Proposition 1.3.3):
K
´ S0
p1 ` RqT
T ˆ ˙
ÿ
1
n
K ´ ÊrST s
“
pπ̂u qn´k pπ̂ℓ qk pSTk ´ Kq `
T
p1 ` Rq k“k k
p1 ` RqT
0
ˆ ˙
kÿ
0 ´1
n
“
pπ̂u qn´k pπ̂ℓ qk pK ´ STk q.
k
k“0

V0put “ V0call `

In the above, we used the martingale property of the discounted asset price, (2.2.4), to write
S0 “ ÊrŜT s “

ÊrST s
p1`RqT

. Then, we expanded the expectation to write

T ˆ ˙
ÿ
n
K ´ ÊrST s “ ÊrK ´ ST s “
pπ̂u qn´k pπ̂ℓ qk pK ´ STk q.
k
k“0

2.3.4

Dividend-paying stock

Stocks usually pay cash dividends to the shareholders. Then, it is up to the individual
shareholders to decide whether to consume the cash dividend or invest it back into the
market. The dividend policy is determined by the management of the company, but it
is also influenced by the preference of the shareholders. Dividends are usually announced
in advanced and are paid in a regular basis, quarterly, semiannually, annually and the
like. However, when the company announces unexpected high earnings, a special dividend
can be paid. Also, a regular dividend can be stopped if the earnings are unexpectedly
low. Dividends are announced as a cash amounts; however, for the ease of calculation, we
model them as a percentage of the asset price, which is referred to as dividend yield and
is a number in r0, 1q. If the asset price at time t is St , then, after paying a dividend yield
of dt P r0, 1q, the asset price is reduced to p1 ´ dt qSt . Therefore, under the dividend policy
d1 , ..., dn , the asset price dynamics in the binomial model follows
t
ź
St “ S0 H1 ...Ht p1 ´ di q,
i“1

where Hi is a sequence of i.i.d. random variables with distribution
P̂pHi “ uq “

u´1´R
1`R´ℓ
and P̂pHi “ ℓq “
.
u´ℓ
u´ℓ
90

2. DISCRETE-TIME MARKETS

2.3. BINOMIAL MODEL

If we define H̃i “ Hi p1 ´ di q, the dividend policy makes the binomial model look like
St “ S0 H̃1 ...H̃t .
See Figure 2.3.10. Then, H̃i is distributed as
P̂pH̃i “ up1 ´ di qq “

1`R´ℓ
u´1´R
and P̂pH̃i “ ℓp1 ´ di qq “
.
u´ℓ
u´ℓ

Remark 2.3.6. It is important to notice that in this case, the no-arbitrage condition
remains the same as ℓ ă 1 ` R ă u, the case where the underlying asset does not pay
any dividend. Regarding the eﬀect of dividend on the replicating portfolio, each dividend
payment transfers the value invested in the risky asset into the risk-free zero bond. A period
before a dividend yield of d P r0, 1q, if the asset price is S, the investment in the risk-free
zero bond is θ0 , and the investment in the risky asset is θ1 , the replicating portfolio solves
a similar system of equations as for the case of no-dividend:
$
θloooooooooomoooooooooon
’
0 p1 ` Rq ` θ1 dSu ` θ
1 p1 ´ dqSu “ V pt ` 1, Sup1 ´ dqq
’
loooooomoooooon
’
&
risk-free
risky
.
’
θ
p1
`
Rq
`
θ
dSℓ
`
θ
p1
´ dqSℓ “ V pt ` 1, Sℓp1 ´ dqq
0
1
1
’
loooooooooomoooooooooon
looooomooooon
’
%
risk-free

risky

One way of pricing contingent claims on dividend-paying assets is to introduce an adjusted
asset price with no dividend and transform the payoﬀ in terms of the ś
adjusted asset price.
If we define the adjusted asset price by S̃t :“ S0 H1 ...Ht , then St “ S̃t Ti“1 p1 ´ di q. Then,
the
of a European
contingent claim given by gpST q is given in terms of S̃T by
˘
` payoﬀ
ś
g S̃T Ti“1 p1 ´ di q on the adjusted binomial asset S̃T . Then, the pricing of a contingent
claim with payoﬀ gpST q at time t given St “ S is given by
T
” `
ı
ź
˘
1
1
ÊrgpS
q
|
S
“
Ss
“
Ê
g
S̃
p1
´
d
q
|
S
“
S
t
i
t
T
T
p1 ` RqT ´t
p1 ` RqT ´t
j“t`1
˙
T ˆ
T
¯
ÿ
1
T ´ t i T ´t´i ´ i T ´t´i ź
“
π̂
π̂
g
Su
ℓ
p1
´
d
q
.
j
u ℓ
p1 ` RqT ´t i“t
i
j“t`1

V pt, Sq :“

(2.3.5)
Remark 2.3.7. Notice that the price V pt, Sq of a European contingent claim gpST q on a
dividend-paying underlying
ś asset S is no longer a function of time-to-maturity τ “ T ´ t.
This is due to the term Tj“t`1 p1 ´ di q in (2.3.5), which cannot be expressed as a function
ś
of τ , unless di “ d for all i “ 1, ..., T ; then, Tj“t`1 p1 ´ di q “ p1 ´ dqτ .
91

2.3. BINOMIAL MODEL

2. DISCRETE-TIME MARKETS
S0 un (1 − d1 )...(1 − dn )

S0 u3 (1 − d1 )(1 − d2 )(1 − d3 )

S0 un−1 ℓ(1 − d1 )...(1 − dn )

S0 u2 (1 − d1 )(1 − d2 )

S0 u(1 − d1 )

S0 u2 ℓ(1 − d1 )(1 − d2 )(1 − d3 )

.
.
.

S0 uℓ(1 − d1 )(1 − d2 )

S0

S0 ℓ(1 − d1 )

S0 un−2 ℓ2 (1 − d1 )...(1 − dn )

S0 uℓ2 (1 − d1 )(1 − d2 )(1 − d3 )

S0 u2 ℓn−2 (1 − d1 )...(1 − dn )

S0 ℓ2 (1 − d1 )(1 − d2 )

S0 ℓ3 (1 − d1 )(1 − d2 )(1 − d3 )

S0 uℓn−1 (1 − d1 )...(1 − dn )

S0 ℓn (1 − d1 )...(1 − dn )

Figure 2.3.10: Dividend-paying asset in a binomial model

Remark 2.3.8. Recall that a regular dividend policy is announced in cash and not the
dividend yield. This means for a high (low) asset price the cash dividend is equivalent to a
small (large) dividend yield. A dividend cash of $D corresponds to a dividend yield of D
S,
where S is the predividend asset price. In addition, a bigger picture of dividend payments
also suggests that the companies can change their dividend policies based on certain random
events. Therefore, it is natural to assume that the divided policy is random. If the dividend
policy is Markovian, at each node of the binomial model at time t and price St pjq, the
divided is a random variable dpt, St pjqq, for j “ 1, ..., t ` 1, the pricing methodology is
similar to the Markovian European option. In the two-period binomial model in of Exercise
2.3.6, Part (b) and Part (c) are special instances of Markovian dividends.
If the dividend policy is not Markovian, even for a Markovian asset-price model and a
Markovian contingent claim with payoﬀ gpST q, the pricing is similar to pricing methodology
92

2.4. CALIBRATING THE PARAMETERS OF THE MODEL TO MARKET DATA:
2. DISCRETE-TIME MARKETS
THE BINOMIAL MODEL
` ś
of path-dependent
options. This is because the modified payoﬀ takes the form g S̃T Tt“1 p1´
˘
dt q , where dt depends on St , ..., S0 . Therefore, pricing and hedging must be conducted
similar to Remark 2.3.5, Example 2.3.3 and Exercise 2.3.5.
Exercise 2.3.6. Consider a two-period binomial model for a risky asset with each period
equal to a year and take S0 “ $10, u “ 1.15 and ℓ “ 0.95. The interest rate for both periods
is R “ .05.
a) If the asset pays a 10% dividend yield in the first period and 20% in the second period,
find the price of a call option with strike K “ 8.
b) Consider a more complicated dividend policy that pays a10% dividend yield only if
the price moves up and no dividend if the price moves down in each period. Find the
price of a call option with strike K “ 8.
c) Finally, consider a dividend policy that pays $1 divided in the first period in each
period. Find the price of a call option with strike K “ 8.

2.4

Calibrating the parameters of the model to market data:
the binomial model

Calibration is the practice of matching the parameters of a model to data. In the binomial
model, the parameters are interest rate R, u, and ℓ. Calibrating the risk-free interest rate
R is a separate job and usually uses the price quotes of risk-free (sovereign) zero bonds. For
the purposes of this section, we assume that the yield of a zero bond is already calibrated
and satisfies Rt pt ` δq “ rδ ` opδq, where short rate r is constant and δ represents the
duration of one period in the binomial market. δ is usually small relative to the maturity
T.
Data: price quote and return
Assume that the asset price quotes are collected at δ time lapse; S´mδ , ..., S0 tabulates the
past quotes of the asset price from time ´mδ until the present time t “ 0. We denote the
quoted price by S to distinguish it from the random variable S for future price.
The arithmetic return and the logarithmic return at time t are defined by
Rarth
:“
t

St`δ ´ St
,
St

and
Rlog
t

ˆ
:“ ln
93

St`δ
St

˙
,

2.4. CALIBRATION

2. DISCRETE-TIME MARKETS

respectively. If the time step δ is small, then the price movement St`δ ´ St is also small,
arth
are very close12 . However, we will see that the small diﬀerence between
and Rlog
t and Rt
the two returns will show up in the parameter estimation. For the moment, we focus on the
arithmetic return and drop the superscript "arth" for simplicity. We discuss the logarithmic
return (or log return) at the end of this section.
From the data points S´mδ , ..., S0 , we obtain data points for the return, R´m , ..., R´1
given by
Sp´k`1qδ ´ S´kδ
R´k :“
.
S´kδ
Next, we will use this data to estimate some parameters of the market that are important
in the calibration process.

Binomial model with physical probability
The data on the quoted prices comes from the physical probability and not the risk-neutral
probability; see Remark 2.1.5. Therefore, for calibration, we need to present the binomial
model with physical probability rather than the risk-neutral probability. While the nodes
of the binomial model will not change, the probability must change; St`1 “ St Ht`1 and
tHt u8
t“1 is a sequence of i.i.d. random variables with the following distribution under
physical measure
#
u with probability p
Ht “
, for all t “ 0, 1, ....
(2.4.1)
ℓ with probability 1 ´ p
In the binomial model under physical probability measure, the sequence of returns tRt u8
t“0
also makes a sequence of i.i.d. random variables. So, to proceed with calibration, we need
to impose the same assumption on the data.
Assumption 2.4.1. The return tRt u8
t“0 is a sequence of i.i.d. random variables with the
mean and the variance given by by µδ ` opδq and σ 2 δ ` opδq, respectively.
The dimensionless quantities σ and µ are respectively called the volatility and mean return
rate of the price.
Remark 2.4.1. The assumption that volatility is a constant is not very realistic. However,
this assumption, which was widely used in practice in the 1970s and 1980s, makes the problems more tractable. We will try later to test some approaches that relax this assumption
in diﬀerent directions.
12

lnp1 ` xq « x for small x

94

2. DISCRETE-TIME MARKETS

2.4. CALIBRATION

S0 u
p

Rt = Ht − 1 =

S0



U := u − 1







L := ℓ − 1

with probability p

with probability 1 − p

1−p
S0 ℓ

Figure 2.4.1: Left: binomial model under physical probability. Right: arithmetic return
Rt .
Statistical estimation of return and volatility
We proceed by introducing some basic statistical methods to estimate µ and σ. The
simplest estimators for these parameters come from Assumption 2.4.1:
µ̂ “

m
1 ÿ
R̂´k
δm k“1

and

σ̂ 2 “

m
ÿ
1
pR̂´k ´ µ̂δq2 .
δpm ´ 1q k“1

Exercise 2.4.1 (Project). Go to Google Finance, Yahoo Finance, or any other free database
that provides free asset price quotes. Download a spreadsheet giving the daily price of a
highly liquid asset such as IBM, Apple, Alphabet, etc. Assuming Assumption 2.4.1, find the
volatility σ and the average return rate µ of the asset. Then, use these quantities to find
the daily, weekly, and yearly standard deviation and mean of the return.
A calibration of the model parameters u, ℓ, and p
We match the first and second momentum of the binomial model with the mean return
rate and volatility:
#
pU ` p1 ´ pqL “ µδ ` opδq
pU 2 ` p1 ´ pqL2 ´ ppU ` p1 ´ pqLq2 “ σ 2 δ ` opδq
Or, equivalently,
#
pU ` p1 ´ pqL “ µδ ` opδq
pp1 ´ pqpU ´ Lq2 “ σ 2 δ ` opδq

(2.4.2)

In the above system of two equations, there are three unknowns U , L, and p, which give
us one degree of freedom. We are going to use this degree of freedom by assuming that
the variance of return Rt under risk-neutral probability is also σ 2 δ ` opδq;
π̂u π̂ℓ pU ´ Lq2 “ σ 2 δ ` opδq,
95

(2.4.3)

2.4. CALIBRATION
where π̂u “

1`R´ℓ
u´ℓ

“

2. DISCRETE-TIME MARKETS

R´L
U ´L .

Remark 2.4.2. This assumption suggests that the variance of return under the risk-neutral
probability measure does not deviate significantly from the physical probability measure.
Whether we are allowed to make such a strong assumption or not is debatable. However, evidences from financial economics as well as statistical modeling of financial markets suggest
that this assumption is practical and significantly useful. In addition, in the continuous-time
modeling of financial markets, the assertion of this assumption becomes a conceptually deep
result. The reason this assumption will become clear later when we study continuous-time
models, specifically the Black-Scholes model.
To simplify further, we also drop the opδq term from the equations. Therefore, we have a
system of three equations and three unknowns.
$
’
&pU ` p1 ´ pqL “ µδ
pp1 ´ pqpU ´ Lq2 “ σ 2 δ
’
%
pU ´ RqpR ´ Lq “ σ 2 δ
For the sake of simplicity, we set new variables
U ´R
α“ ?
,
δσ

R´L
β“ ?
,
δσ

and r “

R
,
δ

(2.4.4)

where r is the annual interest rate (APR) calculated at periods δ. Thus, we have
$
?
’
´ p1 ´ pqβ “ λ δ
&pα
a
pp1 ´ pqpα ` βq “ 1
’
%
αβ “ 1
Here λ :“

(2.4.5)

µ´r
σ .

Remark 2.4.3 (Risk premium). The quantity µ´r
σ is referred to as the risk premium of the
asset and measures the excess mean return of the asset adjusted with its level of riskiness
measured by its volatility.
The solution to (2.4.5) is given by
c
c
?
?
1´p
p
α“
` λ δ,
β“
´ λ δ,
p
1´p

and

p“

1
,
1 ` x20

(2.4.6)

where x0 is the unique positive solution to the equation (see Figure 2.4.2)
x´

?
1
“ λ δ.
x
96

(2.4.7)

2. DISCRETE-TIME MARKETS

2.4. CALIBRATION

x − x−1

√
λ δ

x
x0

Figure 2.4.2: Positive solution to equation x ´

1
x

?
“ λ δ.

Then, u and ℓ are given by
u “ 1 ` δr `

?

δσα,

and ℓ “ 1 ` δr ´

?

δσβ.

(2.4.8)

Remark 2.4.4. The above calibration is well posed in the sense that, for any possible value
of parameters σ ą 0, µ, and r, one can find proper u and ℓ such that ℓ ă 1 ` R ă u in a
unique fashion. Notice that in (2.3.3), the pricing of contingent claims is not aﬀected by p,
and thus p is the least important parameter in this context.
Example 2.4.1 (Symmetric probabilities). We shall show that the following choice of
parameters for the binomial model also provides a calibration; it satisfies the Assumption
2.4.1.
?
?
? ¯
σ2
σ2
1´
u “ eδpr´ 2 q` δσ , ℓ “ eδpr´ 2 q´ δσ and p “
1`λ δ .
2
First notice that
$
´
?
2
? ¯
&eδpr´ σ2 q` δσ ´ 1 with probability 1 1 ` λ δ
2
´
Rt “
?
? ¯
σ2
δpr´
q´
δσ
1
%e
2
´ 1 with probability 2 1 ´ λ δ
Therefore,
ˆ
˙
¯´
¯´
? ¯ ´ δpr´ σ2 q´?δσ
? ¯
1 ´ δpr´ σ2 q`?δσ
2
2
ErRt s “
e
´1 1`λ δ ` e
´1 1´λ δ .
2
97

2.4. CALIBRATION
We use ex “ 1 ` x `

x2
2!

`

2. DISCRETE-TIME MARKETS
x3
3!

` ¨ ¨ ¨ , to write

ˆ
¯´
?
? ¯
1 ´
σ2
δσ 2
ErRt s “
δpr ´ q ` δσ `
` opδq 1 ` λ δ
2
2
2
˙
´
¯´
2
?
? ¯
σ
δσ 2
` δpr ´ q ´ δσ `
` opδq 1 ´ λ δ
2
2
σ2 σ2
“δpr ´
`
` λσq ` opδq “ µδ ` opδq
2
2
Recall that λσ “ µ ´ r. On the other hand,
ˆ
˙
¯2 ´
¯2 ´
? ¯ ´ δpr´ σ2 q´?δσ
? ¯
1 ´ δpr´ σ2 q`?δσ
2
2
2
ErRt s “
e
´1
1`λ δ ` e
´1
1´λ δ
2
ˆ´
˙
¯´
¯´
? ¯ ´
? ¯
1
“
δσ 2 ` opδq 1 ` λ δ ` δσ 2 ` opδq 1 ´ λ δ
“ σ 2 δ ` opδq.
2
Exercise 2.4.2 (Subjective return). Show that the following choice of parameters for the
binomial model also provides a calibration; it satisfies the Assumption 2.4.1.
?
?
`µ ´ ν
1´
σ ˘? ¯
u “ eδν` δσ , ℓ “ eδν´ δσ and p “
1`
´
δ ,
2
σ
2
where ν is a real number. Find the range of ν in terms of other parameters such that there
is no arbitrage.
Calibration the binomial model for the purpose of pricing contingent claims
Estimating rate of return is often a more diﬃcult task than estimating volatility. Methods
such as the CAPM13 have been developed to approximate the rate of return. However,
if the calibration is only used for option pricing, we often do not need the rate of return.
Recall that under risk-neutral probability, the return of a binomial asset is equal to the
yield of a zero bond, which is already estimated through the bond market data;
ÊrRt s “ ÊrHt ´ 1s “ pu ´ 1qπ̂u ` pℓ ´ 1qπ̂ℓ “

pu ´ 1qp1 ` R ´ ℓq ` pℓ ´ 1qpu ´ 1 ´ Rq
“ R.
u´ℓ

Therefore, if we only calibrate the binomial model under risk-neutral probability, the rate
of return under physical probability is irrelevant.
We impose the following assumption on the distribution of the return process under the
risk-neutral probability and use it to calibrate the binomial model under risk-neutral probability using data to estimate the volatility only.
13

the capital asset pricing model

98

2. DISCRETE-TIME MARKETS

2.4. CALIBRATION

Assumption 2.4.2. The arithmetic return tRt u8
t“0 is a sequence of independent random
variables under risk-neutral probability P̂ with mean ÊrRt s “ rδ ` opδq and varpR
ˆ
tq “
2
σ δ ` opδq.
This assumption implies the assumption that we imposed earlier in (2.4.3).
Given r and R “ rδ ` opδq, the only equation that we obtain is
pU ´ RqpR ´ Lq “ σ 2 δ.
Here, we drop the opδq term for simplicity. If we define α “
1
α,

U
?´R
δσ

and β “

R´L
? ,
δσ

we have

αβ “ 1. Any choice for α leads to β “
and therefore, is a calibration of the binomial
model. We obtain a calibration similar to (2.4.8):
?
?
u “ 1 ` δr ` δσα, and ℓ “ 1 ` δr ´ δσβ.
Here, α and β are diﬀerent than in 2.4.8.
Remark 2.4.5. In practice, Assumption 2.4.2 is too good to be true. In fact, most of
the arguments for calibration of the parameters hold without appealing to such a strong
assumption. The main use of this assumption in this section is to estimate parameters
µ and σ, the mean return and volatility. One can find estimation of these parameters by
assuming that there exists a martingale tMt u8
t“0 such that Rt ´ rδ “ Mt`1 ´ Mt .
Time-varying return and volatility
Assumption 2.4.1, which asserts that tRt ut is a sequence of i.i.d. random variables, is not
realistic in some situations and must be relaxed. Several empirical studies show that the
volatility is not constant. This removes the "identical distribution" of the return sequence.
The independence condition also does not have an empirical basis. In this section, we keep
the independence assumption but remove the part that says tRt ut is identically distributed.
We also allow for the interest rate to depend on time Rt “ rt δ. Under either of the following
assumptions, we can derive a calibration of the form
?
?
ut “ 1 ` δrt ` δσt αt , and ℓt “ 1 ` δrt ´ δσt βt .
(2.4.9)

Assumption 2.4.3. The arithmetic return tRt ut is a sequence of independent random
variables with mean ErRt s “ µt δ ` opδq and varpRt q “ σt2 δ ` opδq.
Assumption 2.4.4. The arithmetic return tRt ut is a sequence of independent random
variables under risk-neutral probability P̂ with mean ÊrRt s “ µt δ ` opδq and varpR
ˆ
tq “
2
σt δ ` opδq.
99

2.4. CALIBRATION

2. DISCRETE-TIME MARKETS

Assumption 2.4.3 allows for the parameters µ and σ to vary over time. Therefore, the
calibration in Section 2.4, should be modified such that α, β, and p vary in time and satisfy
$
?
’
p
α
´
p1
´
p
qβ
“
λ
δ
t
t
t
t
t
&a
pt p1 ´ pt qpαt ` βt q “ 1 .
’
%
αt βt “ 1
t
Here λt :“ µtσ´r
. If µ, σ, and r vary with time but λ remain does not, the calibration in
t
(2.4.9), becomes slightly simpler, because α and β does not depend on time.
?
?
ut “ 1 ` δrt ` δσt α, and ℓt “ 1 ` δrt ´ δσt β.
(2.4.10)

Assumption 2.4.4 provides a diﬀerent calibration of the same form as (2.4.10) but without
assuming that λ is time-invariant. Here, we can arbitrarily choose α and β “ α1 .
Estimating time-varying parameters falls into the time series analysis which is beyond the
scope of this book. For more details on the estimation of financial time series, see [14].

100

3. CONTINUOUS MARKETS

3

Modeling financial assets in
continuous-time
In 1900, Louis Bachelier introduced the first asset price model and pricing method for
derivatives in his Ph.D. dissertation titled “The theory of speculation” [2]. Although this
model is now considered impractical, its educational implications of this model are still important. Bachelier modeled the discounted asset price by a Brownian motion. As seen in
Section B.5, the Brownian motion is the weak limit of a normalized random walk. In Bachelier’s time, the Brownian motion had not yet been rigorously defined. However, many of its
properties were well understood. Bachelier’s contribution to the theory of probability and
stochastic processes was to use heat equation in derivative pricing. However, this contribution was neglected for about thirty years, until Andrey Nikolaevich Kolmogorov employed
partial diﬀerential equations to describe a class of stochastic processes called diﬀusion processes. Kolmogorov is the first mathematician to bring probability into rigor by establishing
its mathematical foundation. Other mathematicians who built upon Kolmogorov’s work
include Norbert Wiener, the first to discover the path properties of Brownian motion, Paul
Lévy, who provided a simple characterization of Brownian motion, and Kiyosi Itô1 , who
introduced a simple representation of diﬀusion processes in terms of Brownian motion.
The Bachelier model has a major drawback: asset price in this model can take negative
values, which will be discussed in more details in Section 3.2.3. Almost fifty years after
Bachelier, Paul Samuelson, an economist, suggested to use geometric Brownian motion
(GBM) to model the price of assets. GBM never takes nonpositive values for the asset
price, and therefore, does not suﬀer from the major drawback of Bachelier model. GBM is
also known as Black-Scholes model, named after Fischer Black and Myron Scholes. Black
and Scholes in [5] and Robert Merton in [22] independently developed a pricing method for
derivatives under the GBM. For a through review of Bachelier’s eﬀorts and contribution
1

You may find diﬀerent romanization of Kiyosi such as Kiyoshi, and diﬀerent romanization Itô such as
Itō, Itoh, or Ito. According to Wikipedia, he himself ued the spelling Kiyosi Itô.

101

3.1. TRADING AND ARBITRAGE IN CONTINUOUS-TIME
3. CONTINUOUS
MARKETS MARKETS
see [26]. For a brief history of asset price models, see [25]. For Bachelier’s biography of see
[29].

3.1

Trading and arbitrage in continuous-time markets

Recall from Section II.2.2.2 that in a discrete-time market, where trading occurs at points
t0 “ 0 ă t1 ă ... ă tN “ T in time, the value of the portfolio generated by the strategy
∆0 , ∆t1 , ..., ∆tN ´1 is given by
Wtn “ W0 `

n´1
ÿ

Ri pWti ´ ∆ti Sti q `

i“0

n´1
ÿ

∆ti pSti`1 ´ Sti q.

i“0

Here, Ri is the interest rate for the period of time rti , ti`1 s which can be taken to be
rpti`1 ´ ti q, where r is the short rate. For i “ 0, ..., N ´ 1, the strategy ∆ti is a function of
the history of the asset price, tSu : u ď ti u. Therefore,
Wtn “ W0 ` r

lim r

n´1
ÿ

i“0

i“0

pWti ´ ∆ti Sti qpti`1 ´ ti q `

T
N

If we take ti`1 ´ ti :“ δ “

δÑ0

n´1
ÿ

∆ti pSti`1 ´ Sti q.

and let δ Ñ 0, we obtain the Riemann integral

Nÿ
´1

żT

i“0

0

pWt ´ ∆t St qdt,

pWti ´ ∆ti Sti qpti`1 ´ ti q “ r

which is the accumulated net change in the portfolio due to investment in the risk-free
asset. The limit of the second term
n´1
ÿ

∆ti pSti`1 ´ Sti q

i“0

does not necessarily exist unless we enforce proper assumptions on the asset price S. For
instance if the asset price follows Brownian motion (the Bachelier model) or GBM (the
Black-Scholes model), then the limit exists and is interpreted as a stochastic Itô integral. If
the stochastic integral above is well defined, the wealth generated by the trading strategy
t∆utě0 follows
żt
żt
Wt “ W0 ` r pWs ´ ∆s Ss qds ` ∆s dSs .
(3.1.1)
0

0

şt

We choose the same notion p∆ ¨ Sqt :“ 0 ∆s dSs for the stochastic integral in continuous
time. Notice that in the discrete-time setting, the strategy ∆ at time ti is a function of the
past history of the asset price S0 , ..., Sti . When we pass to the limit, the trading strategy
102

3. CONTINUOUS MARKETS

3.1. TRADING AND ARBITRAGE

∆t at time t, depends only on the paths of the asset until time t, tSu : u ď tu. In other
words, a trading strategy does not use any information from the future.
Following the discussion in Section C.1, specifically (C.1), the stochastic integral is defined
only in the almost surely sense and can only be defined on the sample paths of the asset
price model S. Therefore, a probability space pΩ, F, Pq is needed. It is convenient to take
the sample path space with a proper σ-field and a probability measure:
Ω :“ tS : t Ñ St pωq : for each outcome ωu
Then, the notion of arbitrage is defined as follows:
Definition 3.1.1. A (weak) arbitrage opportunity is a portfolio ∆ such that
a) W0 “ 0,
b) WT ě 0 a.s., and
c) WT ą 0 on a set of sample paths with positive P probability.
A strong arbitrage opportunity is a portfolio ∆ such that
a) W0 ă 0 a.s., and
b) WT ě 0 a.s.
şt
Given that the stochastic integral p∆ ¨ Sqt “ 0 ∆s dSs is defined in a probability space
pΩ, Pq, the fundamental theorem of asset pricing (FTAP) for continuous time is as follows.
Two probabilities P̂ and P are called equivalent if any event with probability zero under
one of them has probability zero under the other, i.e., P̂pAq “ 0 if and only if PpAq “ 0.
Theorem 3.1.1 (Fundamental theorem of asset pricing (FTAP)). There is no weak arbitrage opportunity in a continuous-time model if and only if there exists a probability P̂,
namely risk-neutral probability or martingale probability, equivalent to P such that S is a
P̂-(local) martingale2 .
Recall that a market model is called complete if any contingent claim is replicable, i.e.,
for any F-measurable payoﬀ X, there exists a strategy ∆ :“ t∆t uTt“0 such that the wealth
W generated by ∆ in (3.1.1) satisfies WT “ X.
Corollary 3.1.1. Under the same setting as in Theorem 3.1.1, the market is complete if
and only if there is a unique risk-neutral probability.
2

local martingale is roughly a martingale without condition (a) in Definition B.15.

103

3.2. BACHELIER’S CONTINUOUS-TIME MARKET

3.2

3. CONTINUOUS MARKETS

Bachelier’s continuous-time market

We start by recalling the properties of a Brownian motion from Section B.5. A standard
Brownian motion is a stochastic process such that B0 “ x P Rd and characterized by the
following properties.
1) B has continuous sample paths.
2) When s ă t, the increment Bt ´ Bs is a normally distributed random variable with
mean 0 and variance t ´ s and is independent of tBu : for all u ď su.
The Bachelier model is based on an assumption made by Bachelier himself in his PhD
dissertation“Théorie de la spèculation” ([2]):
L’espèrance mathématique de l’acheteur de prime est nulle (page 33)

(3.2.1)

which translates as “The mathematical expectation of the buyer of the asset is zero”. In the
modern probabilistic language, what Bachelier meant is that the discounted asset price is
a martingale under a unique risk-neutral probability, which is equivalent to no arbitrage
condition by the FTAP in [9]. Without any discussion on the physical probability measure, the Bachelier model simply takes the discounted asset price under the risk-neutral
probability as a factor of a standard Brownian motion, i.e.
Ŝt “ e´rt St “ S0 ` σBt , σ ą 0.

(3.2.2)

Therefore under risk-neutral probability, Ŝt has a Gaussian distribution with mean S0 and
variance σ 2 t, and the pdf of Ŝt is given by
ˆ
˙
1
px ´ S0 q2
fŜt pxq “ ?
exp ´
for x P R and t ą 0.
(3.2.3)
2σ 2 t
σ 2πt
The price of the underlying asset in the Bachelier model is given by St “ ert pS0 ` σBt q.
Under risk-neutral probability, St is also a Gaussian random variable with
ÊrSt s “ S0 ert ,

and

varpSt q “ σ 2 e2rt t.

Therefore, the risk-neutral expected value of the asset price increases in a similar fashion as
a risk-free asset. The variance of St increases exponentially quickly in time, too. It follows
from applying the Itô formula (C.4) to f pt, xq “ ert pS0 ` σxq that St satisfies the SDE
dSt “ rSt dt ` σert dBt .

(3.2.4)

Inherited from the Brownian motion, the Bachelier model possesses the same properties
as the binomial model in Section 2.3.2:
104

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

1) time homogeneity and
The conditional distribution of Ŝt given Ŝs “ S equals the distribution of Ŝt´s with Ŝ0 “ S
2) Markovian.
In using the available information up to time s to make
projections about the future, the only relevant part is
the asset price at current time Ŝs (or, equivalently Ss ).
Êrf pŜt q | Ŝu , u ď ss “ Erf pŜt q | Ŝs s,

@0 ď s ă t.

The condition tŜu , u ď su (or Ŝs ) in the above conditional expectations can simply be
replaced by tSu`, u ď su (or˘ Ss ). Because both sets of random variables generate the same
σ-field Fs :“ σ Su : u ď s :
Êr¨ | Fs s “ Êr¨ | Ss s.
It is important to know that the Bachelier model is not practically interesting in modeling
financial markets. However, for educational purposes, it has all the basic components of
the more practical Black-Scholes model. Pricing a European option in the Bachelier model
is equivalent to solving a heat equation, a simple parabolic partial diﬀerential equation. On
one hand, the heat equation also appears in the simplification of the Black-Scholes model.
On the other hand, most of the knowledge and techniques used in the heat equation can
also be applied to other forms of parabolic partial diﬀerential equations that appear in
more general models.

3.2.1

Pricing and replicating contingent claims in the Bachelier model

As a result of quote (3.2.1), Bachelier concluded that the price of a European contingent
claim with payoﬀ gpST q is simply the discounted expectation of the payoﬀ under the riskneutral probability, i.e.
V0 “ e´rT ÊrgpST qs.
(3.2.5)
`
˘
In addition, given the past history of asset price Ft :“ σ Su : u ď t , the price of this
option at time t is given by
Vt “ e´rpT ´tq ÊrgpST q | Ft s.

(3.2.6)

This is inline with the fundamental theorem of asset pricing that asserts the equivalency
of no arbitrage condition with the existence of a risk-neutral probability. Precisely, the
discounted price of an option with payoﬀ gpST q must be a martingale:
e´rt Vt “ e´rT ÊrVT | Ft s “ e´rT ÊrgpST q | Ft s.
105

(3.2.7)

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

Price of a contingent claim at time zero

Since under risk-neutral probability ST “ erT ŜT is a Gaussian random variable with mean
erT S0 and variance e2rT σ 2 T , one can explicitly calculate V0 in cases where the following
integral can be given in a closed-form:
ż8
`
˘ px´S0 q2
e´rT
V0 “ ?
g erT x e´ 2σ2 T dx.
(3.2.8)
σ 2πT ´8
We start oﬀ by providing a closed-form solution for the Bachelier price of vanilla options.

Example 3.2.1 (Price of call and put in the Bachelier model). Let gpST q “ pST ´ Kq` “
erT pŜT ´ K̂q` , where K̂ “ e´rT K. Since ŜT „ N pS0 , σ 2 T q, the price V0call can be calculated
in closed form.
ż8
px´S0 q2
` rT
˘
e´rT
e x ´ K ` e´ 2σ2 T dx
V0call “ ?
σ 2πT ´8
ż8 ´
¯
px´S0 q2
1
“ ?
x ´ K̂ e´ 2σ2 T dx
`
σ 2πT ´8
ż8´
¯
px´S0 q2
1
“ ?
x ´ K̂ e´ 2σ2 T dx.
σ 2πT K̂
By the change of variable y “
V0call

x´S
? 0,
σ T

we obtain

ż8
´ ?
¯ y2
1
σ
T
y
`
S
´
K̂
“?
e´ 2 dy
0
2π pK̂´S0 q{pσ?T q
? ż
ż
2
2
σ T 8
S0 ´ K̂ 8
´ y2
´ y2
?
?
dy `
dy
“
? ye
? e
2π pK̂´S0 q{pσ T q
2π pK̂´S0 q{pσ T q

The second
above can be calculated in terms of the standard Gaussian cdf Φpxq :“
şx ´yintegral
2 {2
?1
e
dy:
2π ´8
1
?
σ 2πT

ż8
?
pK̂´S0 q{pσ T q

e´

y2
2

´ K̂ ´ S ¯
´ S ´ K̂ ¯
? 0 “ Φ 0?
dy “ 1 ´ Φ
.
σ T
σ T

Here, we used Φpxq “ 1 ´ Φp´xq.
106

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

The first integral can be evaluated by the change of variable u “
1
?
2π

ż8

2

?
pK̂´S0 q{pσ T q

ye

´ y2

1
dy “ ?
2π

ż8
?
|S0 ´K̂|{pσ T q
ˇ
2 ˇ8
´ y2 ˇ

1
“ ´? e
2π
where Φ1 pxq “

ˇ

ye´

y2
2

?
|S0 ´K̂|{pσ T q

y2
2 .

dy
´ S ´ K̂ ¯
pS0 ´K̂q2
1
0
?
“ ? e´ 2σ2 T “ Φ1
,
2π
σ T

2

x
?1 e´ 2
2π

is the standard Gaussian pdf.

To summarize, we have
? `
˘
V0call “ σ T Φ1 pdq ` dΦpdq ,
where d “

S0?
´K̂
.
σ T

(3.2.9)

By the put-call parity, we have
? `
˘
V0put “ K̂ ´ S0 ` V0call “ σ T Φ1 pdq ´ dΦp´dq .

Example 3.2.2. A digital call option is an option with payoﬀ
#
1 ST ě K
gpST q “ 1tST ěKu “
.
0 ST ă K
A digital put has payoﬀ 1tST ďKu .
The Bachelier price of a digital call option with strike K is given by
”
´
¯
ı
V0digit-c “ e´rT Ê 1tST ěKu “ e´rT P̂ ST ě K .
Notice that ST ě K is equivalent to
Ŝt?
´S0
t

Bt
?
t
Bt
?
t

“

Ŝt ´S
? 0
σ t

ě

e´rt K´S
? 0,
σ t

where Bt is the Brownian

motion at time t. Therefore,
“
is a standard Gaussian random variable. We can
write
´
`
˘¯
` ˘
V0digit-c “ e´rT 1 ´ Φ ´ d “ e´rT Φ d .
Here, d “

S0?
´K̂
σ T

is the same as in Example 3.2.1.

Exercise 3.2.1. Find a closed-form solution for the Bachelier price of a digital put option
with strike K.
Exercise 3.2.2. Find a closed-form solution for the Bachelier price of a European option
with payoﬀ in Figure (3.2.1)
107

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

g(S)

a
15
K

S

Figure 3.2.1: All slopes are -1 or 1.

The price at an arbitrary point in time: the Markovian property of the option
price
Recall from (3.2.6) that the option price Vt at time t is a random variable given by
Vt “ e´rpT ´tq ÊrgperT ŜT q | Ft s “ e´rpT ´tq ÊrgperT ŜT q | Su : u ď ts.
Since Brownian motion B is a Markovian process, the only relevant information from the
past is the most recent asset price, St . Therefore,
Vt “ e´rpT ´tq ÊrgperT ŜT q | Ŝt s “: V pt, Ŝt q,
where the function V pt, xq is given by
V pt, xq “ e´rpT ´tq ÊrgperT ŜT q | Ŝt “ xs
ż8
`
˘ px´yq2
e´rτ
“a
g erT y e´ 2σ2 τ dy.
2πpT ´ tq ´8

(3.2.10)

The second equality in the above is because given Ŝt “ x, ŜT is a Gaussian random variable
with pdf
px´yq2
1
´
fŜT py | Ŝt “ xq “ a
e 2σ2 pT ´tq .
2πpT ´ tq
The function V pt, xq is called a pricing function, which provides the price of the contingent
claim in terms of time t and the discounted price St .
Remark 3.2.1. It is simpler in the Bachelier model to write the pricing function V as a
function of the discounted asset price, which is a Brownian motion, rather than the asset
price.
108

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

Time homogeneity of the option price
By the time homogeneity of the Brownian motion, the pricing function is actually a function
of time-to-maturity τ “ T ´ t and the discounted underlying price Ŝt “ x. Because, ŜT
conditional on Ŝt “ x has the same distribution as Ŝτ conditional on Ŝ0 “ x, then
V pt, xq “ e´rτ ÊrgperT Ŝτ q | Ŝ0 “ xs “: U pτ, xq.

(3.2.11)

Example 3.2.3 (Vanilla options). Recall that in the Bachelier model, we have ŜT “
Ŝt ` σpBT ´ Bt q. The payoﬀ of the call option can be written as
pST ´ Kq` “ erT pŜT ´ K̂q` “ erT pŜt ` σpBT ´ Bt q ´ K̂q` .
Here, K̂ “ e´rT K. Given Ŝt “ x,
U call pτ, xq “ e´rτ ÊrerT pŜt ` σpBT ´ Bt q ´ K̂q` | Ŝt “ xs.
Since BT ´ Bt and Ŝt “ σBt are independent random variables, we have
U call pτ, xq “ e´rτ ÊrerT px ` σpBT ´ Bt q ´ K̂q` s.
Because BT ´ Bt is a Gaussian random variable with mean zero and variance τ “ T ´ t,
we have
ż8
´
¯
y2
e´rτ
call
U pτ, xq “ ?
erT x ` y ´ K̂ e´ 2σ2 τ dy
`
σ 2πτ ´8
ż8
´
¯
´rτ
y2
e
erT x ` y ´ K̂ e´ 2σ2 τ dy
“ ?
`
σ 2πτ K̂´x
ˆ
˙
ż8
ż8
´rτ
y2
y2
e
ye´ 2σ2 τ dy.
“ erT px ´ K̂q ?
e´ 2σ2 τ dy `
σ 2πτ K̂´x
K̂´x
Similar to the calculations in Example 3.2.1, a closed-form solution for the Bachelier price
of a call option with strike K and maturity T at time t as a function of τ “ T ´ t and
Ŝt “ x is given by
˘
`
˘˘
? ` `
U call pτ, xq “ erT e´rτ σ τ Φ1 dpτ, xq ` dpτ, xqΦ dpτ, xq ,
where
dpτ, xq :“

109

x ´ K̂
? .
σ τ

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

Exercise 3.2.3. By mimicking the method in Example 3.2.3, show that
`
˘
U digit-c pτ, xq “ erT e´rτ Φ dpτ, xq
is a closed form for the Bachelier price of a digital call option.
Exercise 3.2.4. Use the put-call parity to find a closed form for the Bachelier price
U put pτ, xq of a put option with strike K and maturity T .
Exercise 3.2.5. What is the Bachelier price of at-the-money put option (K “ S0 ) with
T “ 10, σ “ .5, R0 p10q “ .025 (yield), and S0 “ 1? What is the probability that the asset
price takes a negative value at T ?
Exercise 3.2.6. What is the Bachelier price of the payoﬀ in Figure 3.2.6 with T “ 1,
σ “ .1, R0 p1q “ .2 (yield), and S0 “ 2? What is the probability that the option ends up
out of the money?
g(ST )
1

ST
1

2

Figure 3.2.2: Payoﬀ of Exercise 3.2.6.

Martingale property of the option price and heat equation
No arbitrage condition assures that the discounted price of an option is also a martingale,
e´rt V pt, Ŝt q is a martingale. If we assume that the pricing function V pt, xq is continuously
diﬀerentiable on t and twice continuously diﬀerentiable on x, by the Itô formula we obtain
ˆ
˙
¯
σ2
´rt
d e V pt, Ŝt q “ e
Bt V ` Bxx V ´ rV pt, Ŝt qdt ` e´rt Bx V pt, Ŝt qdŜt
2
(3.2.12)
ˆ
˙
σ2
´rt
´rt
“e
Bt V ` Bxx V ´ rV pt, Ŝt qdt ` σe Bx V pt, Ŝt qdBt
2
´
¯
´
¯
Notice that in the above, we used Bt e´rt V “ e´rt Bt V ´ rV and dŜt “ σdBt .
´

´rt

Then, it follows from Section C.3 that e´rt V pt, Ŝt q is a martingale if and only if V satisfied
110

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

the following partial diﬀerential equation (PDE):
Bt V `

σ2
Bxx V ´ rV “ 0.
2

´
¯
This is because d e´rt V pt, Ŝt q reduces to the stochastic integral σe´rt Bx V pt, Ŝt qdBt .
A PDE needs appropriate boundary conditions be well-posed. The boundary conditions
here include the terminal condition given by the payoﬀ g of the contingent claim
`
˘
V pT, xq “ g erT x
and proper growth conditions as x Ñ ˘83 . The PDE above, always hold regardless of the
payoﬀ of the option. The option payoﬀ only appears as the terminal condition. Therefore,
the problem of finding the pricing function V pt, xq reduces to solving the boundary value
problem (BVP) below.
#
2
Bt V ` σ2 Bxx V ´ rV “ 0
`
˘
(3.2.13)
V pT, xq “ g erT x
and the growth condition at infinity: |V pt, xq| ď C|gpxq| for some constant C, as x Ñ ˘8.
The BVP (3.2.13) is a backward heat equation; i.e., we video record the evolution of the
heat over time and play it back in reverse. If we do the change of variable τ “ T ´ t and
U pτ, xq “ V pt, xq, then U satisfies the forward heat equation
#
2
Bτ U “ σ2 Bxx U ´ rU
`
˘
(3.2.14)
U p0, xq “ g erT x
Therefore, the price of a contingent claim at any time can be obtained by solving the BVP
(3.2.14).
Example 3.2.4. By bare-handed calculations, we can show that the function
˘
`
˘˘
? ` `
U pτ, xq “ erpT ´τ q σ τ Φ1 dpτ, xq ` dpτ, xqΦ dpτ, xq ,
where
dpτ, xq :“

x ´ K̂
? .
σ τ

satisfies
Bτ U “

σ2
Bxx U ´ rU.
2

3

In order for a PDE to have a unique solution, it is necessary to impose proper boundary conditions.
The terminal condition is not suﬃcient to make the boundary value problem well posed. We always need
boundary conditions at other boundaries; here they are growth conditions at infinity.

111

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

Exercise 3.2.7. Show that the pricing function on nondiscounted price St :“ erpT ´tq Ŝt ,
Ũ pτ, xq :“ U pτ, erτ xq, satisfies
#
2rt 2
Bτ Ũ “ rxBx Ũ ` e 2 σ Bxx Ũ ´ rŨ
Ũ p0, xq “ gpxq
Exercise 3.2.8. Show that the discounted pricing function upτ, xq “ e´rτ U pτ, xq satisfies
the standard form of the heat equation below
#
2
Bτ u “ σ2 Bxx u
`
˘ .
(3.2.15)
up0, xq “ g erT x
Remark 3.2.2 (On regularity of the pricing function). To be able to apply Itô formula in
(3.2.12), the pricing function V pt, xq needs to be continuously diﬀerentiable on t and twice
continuously diﬀerentiable on x. While the payoﬀ of the option may not be diﬀerentiable
or value function n continuous, the V pt, xq is infinitely diﬀerentiable for all t ă T and all
x.
Replication in the Bachelier model: Delta hedging
By (3.1.1), the dynamics of a portfolio in the Bachelier model are given by
żt

żt

∆s dSs .

pWs ´ ∆s Ss qds `

Wt “ W0 ` r

0

0

Similar to Exercise I.2.2.1, the discounted wealth from a portfolio strategy ∆ satisfies
żt
Ŵt “ e´rt Wt “ W0 ` ∆s dŜs ,
0

and is a martingale. On the other hand, by applying the Itô formula to the discounted
option price e´rt V pt, Ŝt q, we obtain (3.2.12)
ˆ
˙
żt
σ2
´rt
´rs
e V pt, Ŝt q “V p0, S0 q ` e
Bt V ` Bxx V ´ rV ps, Ŝs qds
2
0
żt
` e´rs Bx V ps, Ŝs qdŜs
0
żt
“V p0, S0 q ` e´rs Bx V ps, Ŝs qdŜs .
0

The last inequality above comes from the martingale property of discounted option price
and (3.2.13).
112

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

A replicating portfolio is` a portfolio
that generates the terminal wealth WT equal to
˘
the payoﬀ V pT, ŜT q “ g erT Ŝ . Since both Ŵt and e´rt V pt, Ŝt q are martingales with
`
˘
ŴT “ e´rT V pT, ŜT q “ e´rT g erT Ŝ , then we must have Ŵt “ e´rt V pt, Ŝt q “: V̂ pt, Ŝt q for
all t P r0, T s, V p0, S0 q “ W0 , and ∆t “ e´rt Bx V pt, Ŝt q “ Bx V̂ pt, Ŝt q.
∆t represents the number of units of the underlying in the replicating portfolio. It follows
from (3.2.12) that ∆t is a function of t and Ŝt and is given by
∆pt, Ŝt q “ e´rt Bx V pt, Ŝt q.
Notice that since V is a function of τ “ T ´ t, so is ∆:
∆pτ, Ŝt q “ e´rt Bx V pt, Ŝt q “ e´rpT ´τ q Bx U pτ, Ŝt q.
To summarize, the issuer of the option must trade continuously in time to keep exactly
∆t “ e´rt Bx V pt, Ŝt q number of units of the underlying asset at time t in the replicating
portfolio. ∆t also accounts for the sensitivity of the option price with respect to the change
in the price of the underlying.

Example 3.2.5. The replicating portfolio for a call option in the Bachelier model is obtained by taking the partial derivative Bx of the function
˘
`
˘˘
? ` `
V call pt, xq “ U call pτ, xq “ erpT ´τ q σ τ Φ1 dpτ, xq ` dpτ, xqΦ dpτ, xq ,
with
dpτ, xq :“

x ´ K̂
? .
σ τ

We have
∆pτ, xq “ erpT ´τ q Bx U call pτ, xq
`
˘
`
˘
`
˘¯
? ´
“ σ τ Bx dpτ, xqΦ2 dpτ, xq ` Bx dpτ, xqΦ dpτ, xq ` dpτ, xqBx dpτ, xqΦ1 dpτ, xq
`
˘
`
˘
`
˘
“ Φ2 dpτ, xq ` Φ dpτ, xq ` dpτ, xqΦ1 dpτ, xq
`
˘
“ Φ dpτ, xq .
(3.2.16)
Here, Φ1 pxq “
´xΦ1 pxq

2

x
?1 e´ 2
2π

is the pdf of the standard Gaussian, and we used Φ2 pxq “

and Bx dpτ, xq “

2

´x ´ x2
?
e
2π

“

1
?
.
σ τ

Example 3.2.6. To find the Bachelier price of an option with payoﬀ gpxq “ ex , we need
113

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

to find the the pricing function U , which solves the following BVP:
#
2
Bτ U “ σ2 Bxx U ´ rU
`
˘ .
U p0, xq “ exp erT x
¯
`
We shall verify that the solution to this problem is if the form U pτ, xq “ eλτ exp erT x ,
and find the constant λ by plugging it into the equation:
ˆ
˙
σ2
σ2
Bτ U ´ Bxx U ` rU “ λ ´ e2rT
` r U pτ, xq “ 0.
2
2
2

Thus, for λ “ e2rT σ2 ´ r, U pτ, xq satisfies the equation and the initial condition. Delta
hedging is obtained by
´
´
¯
`
˘
σ2 ¯
∆pτ, xq “ e´rT erτ Bx U pτ, xq “ epλ`rqτ exp erT x “ exp e2rT τ exp erT x .
2
Exercise 3.2.9. Find
? a closed-form solution for the Bachelier price of an option with
payoﬀ gpxq?“ 2 cosp 2xq ´ 3 sinp´xq. Hint: Search for the solution of the form U pτ, xq “
α1 eλ1 τ cosp 2xq ` α2 eλ2 τ sinp´xq.
Example 3.2.7. Let S0 “ $10, σ “ .03, and r “ 0.03. The Bachelier Delta of the following
portfolio of vanilla options given in the table below is the linear combination of the Deltas,
3∆call pτ “ .5, K “ 10q ´ 3∆put pτ “ 1, K “ 10q ´ ∆call pτ “ 2, K “ 8q.
position
long
short
short

units
3
3
1

type
call
put
call

strike
$8
$10
$8

maturity
.5
1
2

The maturities are given in years. Then, (3.2.16) for the Delta of the call option in Example
3.2.5 should be used to evaluate ∆call pτ “ .5, K “ 10q, 3∆put pτ “ 1, K “ 10q and ∆call pτ “
2, K “ 8q.
Exercise 3.2.10. Let S0 “ 10, σ “ .03, and r “ 0.03. Consider the portfolio below.
position
long
long

units
3
4

type
call
put

strike
$10
$5

maturity
.25 yrs
.5 yrs

How many units x of the underlying are required to eliminate any sensitivity in the portfolio
with respect to changes in the price of the underlying?
Example 3.2.8. Let S0 “ 10, r “ .01, σ “ .02, and T “ 1. Consider the payoﬀ in Figure
3.2.3.
114

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

g(ST )

1

9

10

11

12

ST

Figure 3.2.3: Payoﬀ in Exercise 3.2.8.
a) Find the Delta of the payoﬀ gpST q at t “ 0.
b) Find an appropriate portfolio of call options, put options and a short position in an
option with payoﬀ gpST q such that the portfolio has a constant ∆ at all points in time.
(a) The payoﬀ gpST q can be written as the following combination of call options
gpST q “ pST ´ 9q` ´ pST ´ 10q` ´ pST ´ 11q` ` pST ´ 12q` .
Therefore,
∆g pt “ 0, x “ 10q “∆call pτ “ 1, K “ 9q ´ ∆call pτ “ 1, K “ 10q ´ ∆call pτ “ 1, K “ 11q
` ∆call pτ “ 1, K “ 12q.
Then, (3.2.16) for the Delta of the call option in Example 3.2.5 should be used to evaluate
∆call pτ “ 1, Kq, for K “ 9, 10, 11, and 12.
(b) By part (a), if we add a long position in a put option with strike K “ 9, a long position
in a put option with strike K “ 12, a short positions in a put option with strike K “ 10,
and a short positions in a put option with strike K “ 11 all with maturity T “ 1, then the
total payoﬀ of the portfolio will be
p9´ST q` ´p10´ST q` ´p11´ST q` `p12´ST q` ´gpST q “ 9´ST `ST ´10`ST ´11`12´ST “ 0.
Thus, the above portfolio is equivalent to zero position in cash and zero position in the
underlying over time, which has a Delta of zero.
Exercise 3.2.11. Let S0 “ 9, r “ .01, σ “ .05 and T “ 1. Consider the payoﬀ gpST q
shown in Figure 3.2.4.
a) Find the Delta of the payoﬀ gpST q at time t “ 0.
115

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

g(ST )
1

8

9

10

ST

Figure 3.2.4: Payoﬀ in Exercise 3.2.11.

b) Find an appropriate portfolio of call options, put options, and a short position in an
option with payoﬀ gpST q such that the portfolio has ∆ of 0 at all points in time.
Example 3.2.9. Consider the payoﬀ gpST q shown in Figure 3.2.5. Take T “ 10, σ “ 0.05,

g(ST )
K2 − K1

ST
K1

K2

Figure 3.2.5: Payoﬀ in Example 3.2.9.
R0 p10q “ 0.01 (yield), and S0 “ 1. In addition, we assume that K1 “ 0.8, but K2 is
unknown. However, assume that the Bachelier Delta of the contingent claim at time 0 is
(approximately) equal to ´0.385. From this we shall find K2 . Notice that
gpST q “ pST ´ K1 q` ´ 2pST ´ K2 q` .
116

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

Therefore,
∆g pτ “ 10, x “ 1q “ ∆call pτ “ 10, K “ K1 , x “ 1q ´ 2∆call pτ “ 10, K “ K2 , x “ 1q
` 1 ´ 0.8e´0.1 ˘
` 1 ´ K2 e´0.1 ˘
` 1 ´ K2 e´0.1 ˘
?
?
?
“Φ
q ´ 2Φ
“ 0.9596 ´ 2Φ
.
0.05 10
0.05 10
0.05 10
Thus,
K2 “ 1.0963.
To find the Bachelier price of the contingent claim at time 0, we simply use
U pτ “ 10, x “ 1q “ U call pτ “ 10, K “ 0.8, x “ 1q ´ 2U call pτ “ 10, K “ 1.0963, x “ 1q.
Exercise 3.2.12. Consider the payoﬀ gpST q shown in Figure 3.2.6.

g(ST )
K −1

ST
1

K

Figure 3.2.6: Payoﬀ in Exercise 3.2.12. All the slopes are 0, 1, or ´1.
Part a) Take T “ 10, σ “ .05, R0 p10q “ .01 (yield), and S0 “ 1. Find K such that the
Bachelier Delta of the contingent claim at time 0 is (approximately) equal to ´0.385
Part b) Find the Bachelier price of the contingent claim at time 0.

3.2.2

Numerical methods for option pricing in the Bachelier model

The BVP for the heat equation in (3.2.13), or, equivalently, (3.2.14) or (3.2.15), generates
closed-form solutions in some specific cases, such as a linear combination of call or put
options, an exponential payoﬀ in Example 3.2.6, or a sin-cos payoﬀ in Exercise 3.2.9. In
general, a closed-form solution can be obtained if the integral in (3.2.8) can precisely be
evaluated, or, equivalently, if the BVP for the heat equation has a closed-form solution.
The class of payoﬀs with closed-form solutions is narrow, and therefore one needs to study
numerical methods for solving the heat equation in the Bachelier model. Even though
117

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

the Bachelier model is very far from being practically valuable, the numerical methods
presented in this section can be applied indirectly to the Black-Scholes model in the next
section. In addition, studying this numerical models for the BVP for the heat equation
establishes the methodology for evaluations of more complicated models. Therefore, the
reader is recommended to read this section to obtain a background on diﬀerent methods
of the evaluation for the BVPs in finance.

Fourier transform
In this section, we interpret that (3.2.11) as the Fourier transform of a function. The
advantage of such interpretation is that a class of methods called fast Fourier transform
(FFT) algorithms can be deployed to eﬃciently approximate the Fourier transform and its
inverse with highly accurately. The Fourier transform of a function upxq is defined by
ż8
1
u
ppθq :“ F ruspθq :“ ?
upxqe´xθi dx,
2π ´8
and the inverse Fourier transform of a function u
ppθq is given by
ż8
1
u
ppθqexθi dx,
F ´1 rp
uspxq :“ ?
2π ´8
ş8
If u is integrable, i.e., ´8 |upxq|dx ă 8, then the Fourier transform F ruspθq exists and
is bounded uniformly on θ. However, the inverse Fourier transform of a bounded function
not necessarily exists. If, in addition, we assume that u is square integrable, i.e.,
şdoes
8
2
´8 |upxq| dx ă 8, then the Fourier transform F ruspθq is also square integrable and
´1
ppθq. For a twice continuously diﬀerentiable
F rF russpxq “ upxq and F rF ´1 rp
usspθq “ u
square integrable function u, the Fourier transform of Bxx upxq equals ´θ2 u
ppθq.
In specific payoﬀs, one can apply Fourier transform and then inverse Fourier transform to
find a closed-from solution to the heat equation. However, for a wider class of payoﬀs, one
can only obtain a closed form only for the Fourier transform of the solution to the heat
equation. Then, the inverse Fourier transform can be achieved numerically through a class
of eﬃcient algorithms, namely fast Fourier transform. Since these algorithms are numerically highly eﬃcient, a closed-form for the Fourier transform of the solution is as good as
a closed-form for the solution. Assuming that U pτ, xq is twice continuously diﬀerentiable
p pτ, θq and
and square integrable on x, the Fourier transform of Bxx U pτ, xq equals ´pθq2 U
p
U pτ, θq satisfies the ordinary diﬀerential equation (ODE)
# p
dU
2 2p
p
dτ “ ´σ θ U ´ r U
ş
.
p p0, θq “ e´rT gppe´rT θq “ ?1 8 gperT xqe´xθi dx
U
2π ´8
118

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

Notice that in the above ODE, θ is a parameter and therefore, the solution is given by
p pτ, θq “ e´rT e´rτ e´σ2 θ2 τ gppe´rT θq.
U
p pτ, θq recovers the solution
If U pτ, ¨q is square integrable, the inverse Fourier transform of U
U pτ, xq, i.e.
”
ı
p pτ, ¨qspxq “ e´rT e´rτ F ´1 e´σ2 θ2 τ gppe´rT θq pxq.
U pτ, xq “ F ´1 rU
(3.2.17)
It follows from the convolution rule in Fourier transform that,
˜
¸ ˜
¸
”
ı
”
ı
”
ı
´1
´σ 2 θ2 τ ´rT
´rT
´rT
´1 ´σ 2 θ 2 τ
´1
´rT
F
e
e
gppe
θq “ e
F
e
˚ F
gppe
θq .
Here ˚ is the convolution operator defined by
ż8
f ˚ gpxq :“
f pyqgpx ´ yqdy.
´8

”
ı
2 2
Since F ´1 e´σ θ τ pxq “

x2

?1
e´ 2σ2 τ ,
σ 2πτ

we derive the formula

e´rτ
U pτ, xq “ ?
2πτ

ż8

`
˘ px´yq2
g erT y e´ 2σ2 τ dy,

´8

which is the same as (3.2.10).

Finite-diﬀerence scheme for the heat equation
In this section, we introduce the finite-diﬀerence method for the classical heat equation
(3.2.15), that is
#
2
Bτ u “ σ2 Bxx u
´
¯
up0, xq “ g̃pxq :“ g erT x

For educational purposes, despite the availability of analytical formulas, we restrict the
discussion to call and put options only. Other types of payoﬀs should be treated with a
similar but yet diﬀerent analysis. We denote the price of a call (put) option with strike
K as a function of time-to-maturity τ and the current discounted price of underlying x as
upτ, xq “ Cpτ, xq (upτ, xq “ P pτ,` xq), which˘ is the solution
` to the heat
˘ equation (3.2.14)
with initial condition up0, xq “ erT x ´ K ` (up0, xq “ K ´ erT x ` ). Finally, we set
S0 “ 0 by considering the change of variable Xt “ Ŝt ´ S0 , i.e., the shifted price equal to
the diﬀerence between the discounted price Ŝt and the initial price S0 .
119

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

As the actual domain of the heat equation is infinite, in order to apply the finite-diﬀerence
scheme, first we need to choose a finite computational domain pτ, xq P r0, T sˆr´xmax , xmax s,
for a suitable choice of xmax ą 0. Now, since the computational domain is bounded,
it induces more boundary conditions to the problem at the boundaries x “ xmax and
x “ ´xmax . Recall that to solve a BVP analytically or numerically, the boundary condition
is necessary at all the boundaries. We should find appropriate boundary conditions at both
points xmax and ´xmax , which usually rely on the terminal payoﬀ of the option. These
types of boundary conditions, which are induced by the computational domain and do not
exist in the original problem are called artificial boundary conditions, or in short ABC.
learn how to set ˘the ABC, let’s study the case of a call option with payoﬀ gpxq “
`To
rT
e x ´ pK ` erT S0 q `, i.e., up0, xq “ perT x ´ pK ` erT S0 qq` . The idea is simply as
follows. If x is a very small negative number, then up0, xq “ 0. If the current discounted
price of the underlying is a suﬃciently small negative number, the probability that the
price at maturity enters the in-the-money region rpK ` erT S0 q, 8q is significantly small.
For instance, since the discounted price St “ S0 ` σBt is a Gaussian random variable, for
A ą 0 the probability that St ě A (or equivalently St ď ´A) is given by
ż8
y2
A2
1
1
?
e´ 2τ σ2 dy „ e´ 2τ σ2 , as A Ñ 8,
2
σ 2τ π A
?
which is smaller than .006 for A ą 3σ T . In other words, far out-of-money options should
have almost zero price. On the other hand, when St “ x is suﬃciently large, the probability
that the discounted price of the underlying will drop below K `erT S0 at maturity T (out-ofmoney) is significantly small, and therefore perT ŜT ´ Kq` « erT ŜT ´ K. Far in-the-money
options should have almost the same price as the price of payoﬀ ST ´ K, that is one unit
of asset minus K units of cash.
More rigorously, we need the following estimation:
?
ż8
2
σ τ ´ A22
1
´ y 2
?
ye 2τ σ dy „ ? e 2τ σ , as A Ñ 8.
σ 2τ π A
2π
If we set A :“ e´rT K ` S0 ` e´rT xmax , for suﬃciently large xmax , we have
ż8
py`xmax q2
e´rτ
upτ, ´xmax q “ ?
perT y ´ pK ` erT S0 qq` e´ 2τ σ2 dy
σ 2τ π ´8
ż8
py`xmax q2
e´rτ
“ ?
perT y ´ pK ` erT S0 qqe´ 2τ σ2 dy
σ 2τ π e´rT K`S0
ż
y2
erpT ´τ q 8
“ ?
py ´ Aqe´ 2τ σ2 dy
σ 2τ π A
?
ż
erpT ´τ q σ τ ´ A22
erpT ´τ q 8 ´ y2 2
2τ
σ
?
dy „
ď ?
ye
e 2τ σ , as A Ñ 8.
σ 2τ π A
2π
120

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

In other words, far out-of-money options should have zero price. This suggests that
upτ, ´xmax q « 0 for suﬃciently large xmax .
On the other hand, if we set B :“ e´rT K ` S0 ´ e´rT xmax , we obtain
ż8
py´xmax q2
e´rτ
upτ, xmax q “ ?
perT y ´ pK ` erT S0 qq` e´ 2τ σ2 dy
σ 2τ π ´8
ż
y2
erpT ´τ q 8
py ´ Bqe´ 2τ σ2 dy.
“ ?
σ 2τ π B
Notice that since
1
?
σ 2τ π
and

ż8
B

y2
1
ye´ 2τ σ2 dy “ ?
σ 2τ π

1
?
σ 2τ π

ż8

?
y2
B2
σ τ
ye´ 2τ σ2 dy „ ? e´ 2τ σ2 ,
2π
´8

żB

y2

e´ 2τ σ2 dy „ 1

B

as B Ñ ´8, we have
upτ, xmax q „ ´erpT ´τ q B “ e´rτ pxmax ´ pK ` erT S0 qq.
Following this observation, we choose ABC for (3.2.18) for the call option given by
upτ, xmax q “ e´rτ perT xmax ´ pK ` erT S0 qq and upτ, ´xmax q “ 0.
For put option, put-call parity Proposition 1.3.3 implies that the ABC is given by upτ, xmax q “
0 and upτ, ´xmax q “ e´rτ ppK ` erT S0 q ´ erT xmax q.
To summarize, we must solve the following BVP to numerically price a call option.
$
2
’
Bτ upτ, xq
“ σ2 Bxx upτ, xq for x P p´xamx , xmax q, t ą 0
’
’
’
&up0, xq
“ perT x ´ pK ` erT S0 qq` for x P p´xamx , xmax q
.
(3.2.18)
’upτ, xmax q
“ e´rτ perT xmax ´ pK ` erT S0 qq for t ą 0
’
’
’
%upτ, ´x q “ 0 for τ ą 0
max
The next step is to discretize the BVP (3.2.18) in time and space. For time discretization,
T
we choose N as the number of time intervals and introduce the time step h :“ N
and
discrete points τi in time for i “ 0, ..., N ´ 1, N . Then, we choose a computational domain
r´xmax , xmax s. We discretize the computational domain by xj :“ kj with k :“ xmax
M for
j “ ´M, ..., M . The discretization leads to a grid including points pti , xj q for i “ 0, ..., N
and j “ ´M, ..., M , shown in Figure 3.2.7.
Next, we need to introduce derivative approximation. There are two ways to do this:
explicit and implicit. In both methods, the first derivative of a function upτi , xj q with
121

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

x
xmax

T

τ

k
−xmax
h
Figure 3.2.7: Finite diﬀerence grid for the heat equation. In the explicit scheme the CFL
condition should be satisfied, i.e., kh2 ď σ1 . Artificial boundary conditions are necessary on
both xmax and ´xmax .

respect to time τ atanydiscretetimepτi , xj q, is approximated by
Bt upτi , xj q «

upτi`1 , xj q ´ upτi , xj q
h

Then, the second derivative with respect to x can be approximated by
Bxx upτi , xj q «

upτi , xj`1 q ` upτi , xj´1 q ´ 2upτi , xj q
.
k2

Now, we have all the ingredients to present the explicit scheme for the heat equation.
The scheme is obtained from the heat equation (3.3.25) by simply plugging the above
approximations for derivatives, i.e.
upτi`1 , xj q ´ upτi , xj q
σ 2 upτi , xj`1 q ` upτi , xj´1 q ´ 2upτi , xj q
“
¨
.
h
2
k2
122

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

x
xj+1
xj
xj−1

τi

τi+1

t

Figure 3.2.8: Possible active points in the finite-diﬀerence scheme to evaluate upτi`1 , xj q,
marked with a square. The function u is unknown at dark nodes and known at light nodes.
All six nodes are active for implicit scheme with θ‰1. For explicit scheme, θ “ 1, only
filled-in nodes are active.
We can simplify the scheme by writing
ˆ
˙
hσ 2
hσ 2
upτi`1 , xj q “ 1 ´ 2 upτi , xj q ` 2 pupτi , xj`1 q ` upτi , xj´1 qq .
k
2k

(3.2.19)

In order to use explicit finite-diﬀerence scheme in (3.2.19), we need to have the CFL4
condition
h
1
ď 2.
k2
σ
Otherwise, the scheme does not converge. The right-hand side of the CFL condition is
always 12 times the inverse of the coeﬃcient of the second derivative in the equation. For
implicit schemes, this condition can be relaxed.
Notice that in problem (3.2.18), at τ0 “ 0, the initial condition is known. Therefore, we
set
up0, xj q :“ e´rT gperT xj q for j “ ´M, ..., M.
Then, if upτi , xj q is known for all j “ ´M, ..., M , the explicit scheme (3.2.19) suggests that
upτj`1 , xj q can be found for all j “ ´M ` 1, ..., M ´ 1. For j “ ´M and M , one can use
ABC to assign values to upτi , x´M q and upτi , xM q.
4

Courant-Friedrichs-Lewy

123

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

The implicit scheme is a little more diﬃcult than explicit scheme to implement. But it
has its own advantages; e.g., the CFL condition is not necessary. To present the implicit
method we need to modify the approximation of the second derivative as follows.
upτi , xj`1 q ` upτi , xj´1 q ´ 2upτi , xj q
k2
upτi`1 , xj`1 q ` upτi`1 , xj´1 q ´ 2upτi`1 , xj q
`θ
.
k2

Bxx upτi , xj q « p1 ´ θq

In the above, θ P r0, 1s is a parameter. If θ “ 0, then the scheme is the same as the explicit
scheme. If θ “ 1, we call it a pure implicit scheme. Then for θ ‰ 0, we can present the
implicit scheme as follows.

ˆ

hσ 2
1`θ 2
k

˙

hσ 2
upτi`1 , xj q ´ θ 2 pupτi`1 , xj`1 q ` upτi`1 , xj´1 qq “
2k
ˆ
˙
hσ 2
hσ 2
1 ´ p1 ´ θq 2 upτi , xj q ` p1 ´ θq 2 pupτi , xj`1 q ` upτi , xj´1 qq .
k
2k
(3.2.20)

If upτi , xj q is known for all j “ ´M, ..., M , then the right-hand side above is known. Lets
denote the right-hand side by
˙
ˆ
hσ 2
hσ 2
Rpτi , xj q :“ 1 ´ p1 ´ θq 2 upτi , xj q ` p1 ´ θq 2 pupτi , xj`1 q ` upτi , xj´1 qq .
k
2k
For j “ M ´ 1, upτi`1 , xj`1 q on the left-hand side is known. Thus, we move this term to
the other side
ˆ
˙
hσ 2
hσ 2
1 ` θ 2 upτi`1 , xM ´1 q ´ θ 2 upτi`1 , xM ´2 q “
k
2k
hσ 2
Rpτi , xM ´1 q ` θ 2 upτi`1 , xM q.
2k
Similarly for j “ ´M ` 1 we have
ˆ
˙
hσ 2
hσ 2
1 ` θ 2 upτi`1 , x´M `1 q ´ θ 2 upτi`1 , x´M `2 q “
k
2k
hσ 2
Rpτi , x´M `1 q ` θ 2 upτi`1 , x´M q.
2k
To find upτi`1 , xj q, one needs to solve the following tridiagonal equation for upτi`1 , xj q,
124

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL

j “ ´M ` 1, ..., M ´ 1.
AUi`1 “ Ri ´ Yi

(3.2.21)

where A is a 2M ´ 1-by-2M ´ 1 matrix given by
»
2
1 ` θ hσ
k22
— ´θ hσ
—
2k2
—
0
—
—
..
A :“ —
.
—
—
—
0
—
–
0
0

2

´θ hσ
2k2 2
1 ` θ hσ
k22
´θ hσ
2k2

0
2
´θ hσ
2k2 2
1 ` θ hσ
k2

¨¨¨
¨¨¨
¨¨¨

´θ hσ
2k2
0
0

2

0
0
2
´θ hσ
2k2
..
.

0
0
0
..
.

¨¨¨
¨¨¨
¨¨¨
2

1 ` θ hσ
k22
´θ hσ
2k2
0

2

´θ hσ
2k2 2
1 ` θ hσ
k22
´θ hσ
2k2

0
2
´θ hσ
2k2 2
1 ` θ hσ
k2

fi
ﬃ
ﬃ
ﬃ
ﬃ
ﬃ
ﬃ,
ﬃ
ﬃ
ﬃ
ﬃ
fl

Yi is the column 2M ´ 1-vector
Yi :“ θ

hσ 2
pupτi`1 , x´M q, 0, ¨ ¨ ¨ , 0, upτi`1 , xM qqT ,
2k 2

Ri is the column 2M ´ 1-vector
Ri :“ pRpτi , x´M `1 q, ¨ ¨ ¨ , Rpτi , xM ´1 qqT ,
and the unknown is the column 2M ´ 1-vector
Ui`1 :“ pupτi`1 , x´M `1 q, ¨ ¨ ¨ , upτi`1 , xM ´1 qqT .
Notice that the endpoints upτi`1 , x´M q and upτi`1 , xM q are given by the ABC:
upτi`1 , xM q “ e´rτ perT xM ´ pK ` erT S0 qq and upt, x´M q “ 0.
The CFL condition for the implicit scheme with θ P r0, 1q is given by
h
1
ď
.
k2
p1 ´ θqσ 2
For the pure implicit scheme (θ “ 1), no condition is necessary for convergence.

Monte Carlo approximation for the Bachelier model
Recall that in the Bachelier model Gaussian distribution with mean S0 and variance σ 2 T ,
Ŝτ is N px, σ 2 τ q, and the pricing formula is given by
U pτ, xq “ e´rτ ÊrgperT Ŝτ q | Ŝ0 “ xs.
125

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

In the Monte Carlo method, we generate samples based on the underlying probability
distribution to approximate the above expectation. Let the i.i.d. samples txj : j “
1, ..., N u be taken from N p0, 1q. Then, the expectation ÊrgperT Ŝτ q | Ŝ0 “ xs can be
approximated by
N
?
1 ÿ
gperT px ` σ τ xi qq.
N j“1
Hence, the price of the option U pτ, t, xq can be approximated by
U approx pτ, xq “

N
?
e´rpT ´tq ÿ
gperT px ` σ τ xi qq.
N
j“1

(3.2.22)

The larger the number of samples N is, the more accurate the approximation U approx pτ, xq
is obtained. The plain Monte Carlo method is not as eﬃcient as the finite-diﬀerence, at
least when there is only a single risky asset. However, some methods such as variance
reduction or quasi Monte Carlo can be used to increase its performance.

Quadrature approximation for the Bachelier model
Quadrature methods are based on a deterministic (nonrandom) approximation of the integral. In the Bachelier model the price of the option is given by
ż8
`
˘ py´xq2
e´rτ
g erT y e´ 2σ2 τ dy.
U pτ, xq “ ?
σ 2πτ ´8
As an example of the quadrature method, one can first approximate the improper integral
above with the proper integral
e´rτ
?
σ 2πτ

ż x`A

`
˘ py´xq2
g erT y e´ 2σ2 τ dy

x´A

and then use Riemann sums to approximate the price of option by
U

approx

˚
2
N ´1
e´rτ ÿ ` rT ˚ ˘ ´ pyj ´xq
2
2σ
τ
g e yj e
pyj`1 ´ yj q,
pτ, xq “ ?
σ 2πτ j“0

where y0 “ x ´ A ă y1 ă ¨ ¨ ¨ ă yN “ x ` A. If the discrete points yj for j “ 0, ..., N are
carefully chosen, the quadrature method outperforms the plain Monte Carlo method.
Exercise 3.2.13 (Project). Consider the initial price S0 , σ, r and payoﬀ assigned to your
group.
126

3. CONTINUOUS MARKETS

3.2. BACHELIER MODEL
Group 1
1
2
3
4
5
6

T
1
10
1
2
2
1

S0
10
100
2
2
2
.5

r
.2
.1
.2
.5
.5
.1

σ
1
5
.5
.5
.5
.001

Step 1. Choose a computational domain around the initial price, rS0 ´ xmax , S0 ` xmax s.
Step 2. Set appropriate artificial boundary conditions (ABC) at the boundary points S0 ´xmax
and S0 ` xmax .
Step 3. Write a program that implements the implicit finite-diﬀerence code. The time and
space discretization parameters ph, kq must be set to satisfy
h
1
ď
.
2
k
p1 ´ θqσ 2
Step 4. To make sure that your code is correct, run the program for a call (or a put) option
and compare it to the closed-form solution in (3.2.9).
Step 5. Run the program for θ “ 0 (explicit), θ “
record the results.

1
2

(semi-implicit) and θ “ 1 (implicit) and

Step 6. Simulate a discrete sample path of the price of the underlying asset with the same
time discretization parameter h. Use the following algorithm:
Simulating a sample paths of underlying in the Bachelier model
1: Discretize time by t0 “ 0, ti “ ih, and T “ hN .
2: for each j “ 1, ..., N do
3: Generate a random
? number wj from standard Gaussian distribution N p0, 1q to represent pBtj ´ Bj q{ h
?
4: Ŝj “ Ŝj´1 ` σ hwj
5: sj “ ertj Ŝj
6: end for
Output: vector ps0 “ S0 , st1 , ..., stN ´1 , sT q is a discretely generated sample path of the
Bachelier model.
Step 7. Recall that the hedging is given by the derivative Bx V̄ pt, Ŝt q “ ert Bx V pt, ert St q. Evaluate the hedging strategy discretely at each node of the discretely generated sample
127

3.2. BACHELIER MODEL

3. CONTINUOUS MARKETS

path ps0 “ S0 , st1 , ..., stN ´1 q in Step 7, i.e.,
pBx V p0, ert s0 q, Bx V pt1 , ert1 st1 q, ..., ertN ´1 Bx V ptN ´1 , ertN ´1 stN ´1 qq.
Note that some interpolation may be needed in this step.
Submit the following outputs:
Output 1. The program
Output 2. A comparison with the closed-form solution for a call at p0, S0 q.
Output 3. The price and hedging strategy at the points of the discrete grid.
g(ST )

g(ST )

10

Group 1
5

ST

15

80

Group 2

-5

-40

g(ST )

g(ST )

1

100

40

140

ST

1

Group 3

Group 4

ST
1

2

ST

3

1

g(ST )

2

3

g(ST )

1
.25

Group 5

ST
1

2

.75

Group 6
.25

3

.5

-.25

Figure 3.2.9: Diﬀerent payoﬀs of the group project

128

ST

3. CONTINUOUS MARKETS
3.3. CONTINUOUS-TIME MARKET OF BLACK-SCHOLES

3.2.3

Discussion: drawbacks of the Bachelier model

One of the drawbacks of the Bachelier model is the possibility of negative realization of the
asset price. However, this is not the main concern, as in many other applications; Gaussian
random variables are used to model positive quantities such as human weight. The negative
asset price can be problematic if the ratio σS?0T is not suﬃciently large. For instance, if the
ratio σS?0T “ 1, then the chance of a negative price at maturity T is significant, i.e., higher
than .3.
In addition, the return of an asset in the Bachelier model is not integrable. The return of
an asset in the Bachelier model is given by
Rarth
:“
t

erδ Bt`δ ´ Bt
erδ pBt`δ ´ Bt q
erpt`δq Ŝt`δ ´ ert Ŝt
“
“
` erδ ´ 1.
Bt
Bt
ert Ŝt

Given Bt , the return in the Bachelier model is a Gaussian random variable. Some empirical
studies support the Gaussian distribution for the return. However, the random variable B1t
is not integrable:
„
ȷ
ż
1
1
1 ´ x2
Ê
e 2t dx “ 8.
“?
|Bt |
2tπ R |x|

3.3

Continuous-time market of Black-Scholes

The Black-Scholes model can be obtained by asymptotic methods from the binomial model.
To do this, we first present some asymptotic properties of the binomial model.

3.3.1

The Black-Scholes model: limit of binomial under risk-neutral
probability

Let T ą 0 be a real number and N be a positive integer. We divide T units of time into
T5
. Then, consider a binomial model with N periods
N time intervals, each of size δ :“ N
given by the times t0 “ 0 ă t1 “ δ, ..., tk “ kδ, ...tN “ T . Recall from binomial model that
Spk`1qδ “ Skδ Hk`1 ,

for k “ 0, ..., N ´ 1

where, in accordance with Assumption 2.4.1, tHk uN
k“1 is a sequence of i.i.d. random variables with the following distribution
#
u with probability π̂
Hk “
ℓ with probability 1 ´ π̂
5

Each time unit is divided into 1{δ small time intervals.

129

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Asymptotics of parameters u, ℓ, and p
The goal of this section is to show the following approximation:
u “ 1 ` δr `
ℓ “ 1 ` δr ´

?
?

δσα “ eδpr´

?

σ2
q`
2

2
δpr´ σ2 q´

δσβ “ e

?

δσα

` opδq,

δσβ

` opδq.

(3.3.1)
?

To?obtain this approximation, one should notice that from (2.4.7), we have x0 “ 1 ` λ 2 δ `
op δq. Thus, it follows from (2.4.6) that
?
?
?
?
1´p
1 λ δ
2
“ x0 “ 1 ` λ δ ` op δq and p “ ´
` op δq.
p
2
4
Then,
?
1´p
α “
` 2λ δ
p
2

c

?
?
?
1´p
` op δq “ x20 “ 1 ` 3λ δ ` op δq.
p

(3.3.2)

On the other hand, one can easily see that6
e

?
2
δpr´ σ2 q` δσα

?
2
?
pδpr ´ σ2 q ` δσαq2
σ2
“ 1 ` δpr ´ q ` δσα `
` opδq
2
2
?
σ2
δσ 2 α2
“ 1 ` δpr ´ q ` δσα `
` opδq
2
2
?
δpσ 2 ´ 1qα2
“ 1 ` δr ` δσα `
` opδq
2
?
“ 1 ` δr ` δσα ` opδq.

?
In the above we used (3.3.2), i.e.,
σ 2 ´ 1?“ Op δq.
?
Similarly, we have β 2 “ 1 ´ 3λ δ ` op δq and
eδpr´

σ2
q´
2

?
δσβ

“ 1 ` δr ´

?

δσβ ` opδq.

Arithmetic return versus log return
This asymptotics yields to the relation between the arithmetic return and the log return
in the binomial model. While the arithmetic return is given by
#
?
δr
`
δσα
?
Rarth
“
t
δr ´ δσβ
6 x

e “1`x`

x2
2

` opx2 q

130

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

the log return is given by
Rlog
t

#
δpr ´
“
δpr ´

σ2
2 q
σ2
2 q

?
` δσα ` opδq
?
´ δσβ ` opδq

.

The probabilities of the values in both returns are given by pπ̂, 1 ´ π̂q for risk-neutral
probability and pp, 1 ´ pq for physical probability. In particular, if Ê and E are respectively
expectations with respect to risk-neutral probability and physical probability, then we have
ÊrRarth
s “ rδ,
t

and ÊrpRarth
q2 s “ σ 2 δ ` opδq
t

ErRarth
s “ µδ, and ErpRarth
q2 s “ σ 2 δ ` opδq
t
t
1 2
log 2
2
ÊrRlog
t s “ pr ´ σ qδ, and ÊrpRt q s “ σ δ ` opδq
2
1 2
log 2
2
ErRlog
t s “ pµ ´ σ qδ, and ErpRt q s “ σ δ ` opδq.
2

(3.3.3)

Weak convergence of the binomial model: the geometric Brownian motion
From the asymptotics in (3.3.3), the log return of the calibrated binomial model is given
by
#
?
2
δpr ´ σ2 q ` δσα with probability π̂
log
?
Rt “ lnpHk q “
2
δpr ´ σ2 q ´ δσβ with probability 1 ´ π̂
Indeed,
lnpSpk`1qδ q “ lnpSkδ q ` lnpHk`1 q,
or
lnpSt q “ lnpS0 q `

N
ÿ

lnpHk q.

k“1

Let tZk uN
k“1 be a sequence of i.i.d. random variables with the following distribution
#
α
with probability π̂
Zk “
´β with probability 1 ´ π̂
Then, we have
lnpST q “ lnpS0 q ` pr ´

N
?
σ2
1 ÿ
qT ` σ T ¨ ?
Zk .
2
N k“1

Next, we want to show that the normalized summation
131

?1
N

řN

k“1 Zk

(3.3.4)
converges weakly to

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

a random variable (distribution) as the number of time intervals N approaches infinity7 .
To show this, from Theorem B.9 from the appendix, we only need to find
lim χ ?1

N Ñ8

řN

k“1

N

Zk pθq.

Notice that here the characteristic function is under the risk-neutral probability, χX pθq “
ÊreiθX s.
Since tZt uN
k“1 is a sequence of i.i.d. random variables, we have
χ ?1

řN

N

k“1

Zk pθq

“

N
ź

ˆ
χ Z1

k“1

θ
?
N

˙
.

On the other hand,
χZ1 pθq “ ÊreiθZ1 s “ 1 ` iθÊrZ1 s ´

θ2 ÊrZ12 s
` opθ2 q.
2

Notice that by (2.4.4), we can write
π̂ “

R´L
β
“
.
U ´L
α`β

(3.3.5)

Therefore, straightforward calculations show that ÊrZ1 s “ 0, and ÊrZ12 s “ 1. By using the
Taylor expansion of the characteristic function, we obtain
˙
ˆ
θ2
1
θ
“1´
` op q,
χZ1 ?
2N
N
N
and
ˆ
χ ?1

řN

N

k“1

Zk pθq

“

˙N
θ2
1
1´
` op q
.
2N
N

By sending n Ñ 8, we obtain
lim χ ?1

N Ñ8

N

ˆ
˙N
2
θ2
1
´ θ2
pθq
“
lim
1
´
`
op
q
“
e
.
k“1 Zk
N Ñ8
2N
N

řN

θ2

Since e´ 2 is the
ř characteristic function of a standard Gaussian random variable, we conclude that ?1N N
k“1 Zk converges weakly to N p0, 1q.
Exercise 3.3.1. In the above calculations, explain why we cannot apply the central limit
theorem (Theorem B.7) directly.
7

Or equivalently δ Ñ 0.

132

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

(3.3.4) suggests that we define a continuous-time model for price St of the asset at time
T as the weak limit of the binomial model by
lnpST q “ lnpS0 q ` pr ´

σ2
qT ` σN p0, T q
2

or equivalently
˙
σ2
ST “ S0 exp pr ´ qT ` σN p0, T q .
2
ˆ

Calibrating binomial model: revised
In the above, we see that the choice of parameters u, ℓ, and R leads to a perfect choice
of ÊrZ1 s “ 0 and ÊrZ12 s “ 1. However, in (3.3.4), the only criteria for the convergence of
binomial model to Black-Scholes model is that the random variables Zk , k “ 1, ..., N must
satisfy ÊrZ1 s “ opδq and ÊrZ12 s “ 1 ` op1q;
If ÊrZ1 s “ opδq,

and ÊrZ12 s “ 1 ` op1q,

N
1 ÿ
then ?
Zk converges to N p0, 1q weakly.
N k“1

(3.3.6)

To avoid the calculation of α and β, one can choose diﬀerent parameters for the binomial model. Notice that the binomial model has three parameters u, ℓ and R while the
Black-Scholes parameters are only two. This degree of freedom provides us with some modifications of the binomial model which still converges to the Black-Scholes formula. This
also simplifies the calibration process in Section 2.4 significantly. Here are some choices:
1) Symmetric probabilities:
u “ eδpr´

σ2
q`
2

?
δσ

Then

, ℓ “ eδpr´

σ2
q´
2

?
δσ

,

and R “ rδ,

1
π̂u “ π̂ℓ “ .
2

Notice that (3.3.4) should be modified by setting thetZk uN
k“1 distribution of the i.i.d.
sequence
#
1
with probability 12
Z1 “
´1 with probability 12
and ÊrZ1 s “ 0 and ÊrZ12 s “ 1.
133

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

2) Subjective return:
u “ eδν`

?
δσ

?

, ℓ “ eδν´

δσ

,

and R “ rδ,

Then
1
π̂u “
2

˜

? r ´ ν ´ 1 σ2
2
1` δ
σ

¸

1
and π̂ℓ “
2

˜

? r ´ ν ´ 1 σ2
2
1´ δ
σ

¸
.

In this case, (3.3.4) should be modified by setting thetZk uN
k“1 distribution of the i.i.d.
sequence
$?
& δ ν´r` 12 σ2 ` 1 with probability π̂
u
σ
Z1 “ ? ν´r`
1 2
σ
% δ
2
´ 1 with probability π̂ℓ
σ
and ÊrZ1 s “ 0 and ÊrZ12 s “ 1 `

´

ν´r` 21 σ 2
σ

¯2

δ.

Exercise 3.3.2. Show
ÊrZ1 s “ opδq,

and ÊrZ12 s “ 1 ` op1q

in the following cases:
a) symmetric probabilities
b) subjective return
Exercise 3.3.3. Consider a risk-neutral trinomial model with N periods presented by
Spk`1qδ “ Skδ Hk`1 ,
where δ :“

T
N

for k “ 0, ..., N ´ 1

and tHk uN
k“1 is a sequence of i.i.d. random variables with distribution
$
?
2
δpr´ σ2 q` 3δσ
’
e
’
&
σ2
Hk “ eδpr´ 2 q
’
’
% δpr´ σ2 q´?3δσ
2
e

with probability π̂ “

1
6

with probability 1 ´ 2π̂ “
with probability π̂ “

2
3

1
6

and π̂ ă 12 . Show that as δ Ñ 0, this trinomial model converges to the Black-Scholes model
in the weak sense.
?
2
Hint: Find Zk such that lnpHk q “ pr ´ σ2 qδ ` σ δZk . Then, show (3.3.6)
134

3. CONTINUOUS MARKETS

3.3.2

3.3. BLACK-SCHOLES MODEL

Pricing contingent claims in the Black-Scholes model

Recall from the last section that the limit of the binomial model under risk-neutral probability yields the geometric Brownian motion (GBM)
˙
ˆ
σ2
(3.3.7)
St “ S0 exp pr ´ qt ` σBt .
2
We can use this random variable St to price an option in this continuous setting. We start
with a call option with maturity T and strike price K.
Inspired by the geometric Brownian motion market model, the price of this call option is
the discounted expected value of pST ´ Kq` under risk-neutral probability. To calculate
this price, we only need to know the distribution of St under risk-neutral probability, which
is given by (3.3.7). Since St is a function of a standard Gaussian random variable, we obtain
ˆ
˙
˙
ˆ 2˙
ż8 ˆ
?
σ2
1
x
S0 exp pr ´ qT ` σ T x ´ K
ÊrpST ´ Kq` s “ ?
exp ´
dx.
2
2
2π ´8
`
´
Notice that when x ď x˚ :“ σ?1 T lnpK{S0 q ´ pr ´
otherwise pST ´ Kq` “ St ´ K. Therefore,
ÊrpST ´ Kq` s “ S0 e
“ S0 e

ż8

2
pr´ σ2 qT

rT

“ S0 erT

Notice that

?

?

ż8

e

2π

?
px´σ T q2
´
2

?

2π
2
´ x2

ż8
?
x˚ `σ T

e
?

¯
, the integrand is zero and

2

T x´ x2

x˚

x˚

ş8

eσ

σ2
2 qT

2π

ż8
dx ´ K
x˚

ż8
dx ´ K
x˚

ż8
dx ´ K
x˚

x2

e´ 2
? dx
2π

x2

e´ 2
? dx
2π
x2

e´ 2
? dx
2π

x2

´ 2
e?
2π

dx is the probability that a standard Gaussian random variable is
2
ş
´ x2
8
e?
˚
?
greater than x and x˚ `σ T 2π dx is the probability that a standard Gaussian random
?
variable is greater than x˚ ` σ T . Simple calculation shows that
˙
ˆ
?
1
σ2
˚
?
x `σ T “
lnpK{S0 q ´ pr ` qT .
2
σ T
x˚

In other words, the price of a European call option is given by
CpT, K, S0 , 0q :“ e´rT ÊrpSt ´ Kq`s “ S0 Φ pd1 q ´ e´rT KΦ pd2 q ,
135

(3.3.8)

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

where
`
`
1 ´
σ2 ˘ ¯
σ2 ˘ ¯
1 ´
d1 “ ?
lnpS0 {Kq ` r `
T and d2 “ ?
lnpS0 {Kq ` r ´
T . (3.3.9)
2
2
σ T
σ T
Here Φpxq “

y2

´ 2
e?
´8
2π

şx

dy is the standard Gaussian distribution function.8

Exercise 3.3.4. Use put-call parity to show that the Black-Scholes formula for the price
of a put option with maturity T and strike K is given by
P pT, K, S0 , 0q :“ e´rT KΦ p´d2 q ´ S0 Φ p´d1 q .
For a general contingent claim, the price of a derivative with payoﬀ gpSt q in the BlackScholes model is given by
„ ˆ
˙ȷ
?
2
´rT
´rT
pr´ σ2 qT `σ T N p0,1q
V0 pS0 q :“ e
ÊrgpST qs “ e
Ê g e
˙
ż8 ˆ
?
x2
σ2
1
“?
g epr´ 2 qT `σ T x e´ 2 dx.
2π ´8
As a consequence of Assumption 2.4.1, if we repeat the calculations in Section 3.3.1, we
obtain
ˆ
˙
ˆ
˙
σ2
σ2
St “ S0 exp pr ´ qt ` σN p0, tq
and ST “ St exp pr ´ qpT ´ tq ` σN p0, T ´ tq .
2
2
Now we would like to explain the relation between the two normal random variables
N p0, T ´ tq and N p0, tq in the above. In the Black-Scholes model, SSTt is independent
of St . This, in particular, implies that the Black-Scholes model is Markovian9 and
given that the price of the underlying asset at time t is equal to St , the price of a call
option with strike K and maturity T is a function of St and t but not Su for u ă t. As a
result, the price of a call option at time t given St “ S is given by
CpT, K, S, tq :“ e´rpT ´tq ÊrpST ´ Kq` | St “ Ss “ SΦ pd1 q ´ e´rpT ´tq KΦ pd2 q ,
˙
ˆ
σ2
1
?
d1 “
lnpS{Kq ` pr ` qpT ´ tq and
2
σ T ´t
ˆ
˙
1
σ2
d2 “ ?
lnpS{Kq ` pr ´ qpT ´ tq .
2
σ T ´t
In general, the Markovian property implies that for a general contingent claim with payoﬀ
8
9

In the above calculations, we use 1 ´ Φpxq “ Φp´xq.
Given the current asset price, future movements of the price are independent of past movements.

136

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

gpSt q, the Black-Scholes price at time t is V pt, St q :“ e´rpT ´tq ÊrgpST q | St s. We will study
some more properties of this function V : r0, T s ˆ R` Ñ R later in the chapter. In the
Black-Scholes market, a contingent claim that has payoﬀ gpST q, a function of the price of
the underlying asset at time T , is called a Markovian claim, and the price of a Markovian
claim is given by
„ ˆ
˙ȷ
?
2
´rpT ´tq
´rpT ´tq
pr´ σ2 qpT ´tq`σ T ´tN p0,1q
V pt, Sq :“ e
ÊrgpST q | St “ Ss “ e
Ê g e
˙
ˆ
ż
` pr´ σ2 qpT ´tq`σ?T ´tx ˘ ´ x2
e´rpT ´tq 8
2
“ ?
e 2 dx.
g S e
2π
´8
(3.3.10)
Remark 3.3.1. The price of a Markovian claim in the Black-Scholes model does not depend on past movements of the price; it only depends on the current price St . This is not
true for non-Markovian
¯ example, a look-back option with payoﬀ pmax0ďtďT St ´ Kq`
´ şclaims. For
1 T
are non-Markovian options with a price that depends
or an Asian option T 0 St ´ K
`

to some extent on the history of price movements rather than only on the current price of
the underlying.
As seen in (3.3.10), the Black-Scholes price of a Markovian European option is always
a function of T ´ t rather than t and T separately. Therefore, we can introduce a new
variable τ :“ T ´ t, time-to-maturity. Then, one can write the value of the Markovian
European option as a function of τ and S by
ˆ
˙
ż
` pr´ σ2 qτ `σ?τ x ˘ ´ x2
e´rτ 8
´rτ
2
V pτ, Sq :“ e ÊrgpSτ q | S0 “ Ss “ ?
g S e
e 2 dx.
2π ´8
For call option the Black-Scholes formula in terms of τ is given by

1
d1 “ ?
σ τ

3.3.3

ˆ

Cpτ, K, Sq “ SΦ pd1 q ´ e´rτ KΦ pd2 q ,
˙
ˆ
˙
(3.3.11)
σ2
1
σ2
lnpS{Kq ` pr ` qτ
and d2 “ ?
lnpS{Kq ` pr ´ qτ .
2
σ τ
2

Delta hedging

As seen in the binomial model, to hedge the risk of issuing an option, one has to construct
a replicating portfolio. The replicating portfolio contains ∆t pSt q units of risky asset at
time t. If the price of the asset at time t is given by St “ S, the ∆t pSt q in the binomial
model is given by (2.3.4);
∆t pSq :“

V pt ` δ, Suq ´ V pt ` δ, Sℓq
.
Spu ´ ℓq
137

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Using the asymptotic formula for u and ℓ from (3.3.1), we have
?
?
V pt ` δ, S ` Spδr ` δσαqq ´ V pt ` δ, S ` Sp1 ` δr ´ δσβqq
?
∆t pSq “
S δσpα ` βq
?
?
By expanding V pt ` δ, S ` Spδr ` δσαqq and V pt ` δ, S ` Sp1 ` δr ´ δσβqq about the
point pt, Sq and sending δ Ñ 0, we obtain the Delta of the Black-Scholes model as
∆BS
t pSq “ BS V pt, Sq,

(3.3.12)

where V pt, Sq is the Black-Scholes price of a general contingent claim with any given payoﬀ.
As for a call option with maturity T and strike K, by taking derivative with respect to S
from (3.3.11), we obtain
∆BS
t pSq “ Φpd1 q.
Here we used
SBS d1 Φ1 pd1 q ´ e´rpT ´tq KBS d2 Φ1 pd2 q “ 0.
Exercise 3.3.5. Let S0 “ $10, σ “ .03, and r “ 0.03. Find the Black-Scholes Delta of the
following portfolio.
position
long
short
short

units
3
3
1

type
call
put
call

strike
$10
$10
$10

maturity
60 days
90 days
120 days

The maturities are given in business days.
Exercise 3.3.6. Let S0 “ 10, σ “ .03, and r “ 0.03. Consider the portfolio below.
position
long
long
?

units
3
4
x

type
call
put
underlying

strike
$10
$5
NA

maturity
60 days
90 days
NA

How many units x of the underlying are required to eliminate any sensitivity of the portfolio
with respect to the changes in the price of the underlying?
Another derivation of the Delta in the Black-Scholes model
Another heuristic derivation of this result is as follows. In the binomial model, we can
write
ÊrgpST q | St`δ “ Sus “ ÊrgpST ´δ uq | St “ Ss and
ÊrgpST q | St`δ “ Sℓs “ ÊrgpST ´δ lq | St “ Ss.
138

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

This is because the binomial model is time homogeneous. Therefore,
∆t pSq “

V pt ` δ, Suq ´ V pt ` δ, Sℓq
Spu ´ ℓq

“ e´rpT ´tq

ÊrgpST q | St`δ “ Sus ´ ÊrgpST q | St`δ “ Sℓs
` Opδq
Spu ´ ℓq

“ e´rpT ´tq

ÊrgpST ´δ uq | St “ Ss ´ ÊrgpST ´δ lq | St “ Ss
` Opδq
Spu ´ ℓq

“ e´rpT ´tq

ÊrST ´δ g 1 pST ´δ q | St “ Sspu ´ ℓq
` Opδq.
Spu ´ ℓq

In the above, we used (3.3.1) to obtain pu ´ ℓq2 “ Opδq, and we used
gpxq ´ gpyq “ g 1 pxqpy ´ xq ` Oppx ´ yq2 q
to obtain the last equality. Hence,
∆t pSq “

e´rpT ´tq
ÊrST ´δ g 1 pST ´δ q | St “ Ss ` Opδq
S

Now, by the weak convergence of the underlying asset price in the binomial model to the
asset price in the Black-Scholes model, as δ Ñ 0, we obtain
∆BS
t pSq “

e´rpT ´tq
ÊrST g 1 pST q | St “ Ss.
S

Notice that given St “ S, we have
ˆ
˙
σ2
ST “ S exp pr ´ qpT ´ tq ` σN p0, T ´ tq .
2
Therefore,
ˆ
˙
¯
d ´
σ2
ST 1
gpST q “ exp pr ´ qpT ´ tq ` σN p0, T ´ tq g 1 pST q “
g pST q.
dS
2
S
This implies that
”S
ı
” d ´
¯
ı
T 1
´rpT ´tq
´rpT ´tq
∆BS
pSq
“
e
Ê
g
pS
q
|
S
“
S
“
e
Ê
gpS
q
|
S
“
S
t
t
T
T
t
S
dS
´
¯
d
“
e´rpT ´tq ÊrgpST q | St “ Ss “ BS V pt, Sq.
dS

139

3.3. BLACK-SCHOLES MODEL

3.3.4

3. CONTINUOUS MARKETS

Completeness of the Black-Scholes model

Similar to the binomial model, the Black-Scholes market is complete; every contingent claim
is replicable. For the moment, it is not our concern to show this rigorously. Instead, we
accept this fact and would rather emphasize how to replicate a contingent claim. In order
to replicate a Markovian contingent claim with payoﬀ gpST q in the Black-Scholes model,
we start by recalling from Section 2.3.3 that the replicating portfolio in the binomial model
is determined by ∆bi
ti pSti q given by (2.3.4) and the replicating portfolio is written as
V bi pt, St q “ V bi p0, S0 q ` R

t´1
ÿ

t´1
ÿ

i“0

i“0

pV bi pi, Si q ´ ∆bi
i pSi qSi q `

∆bi
i pSi qpSi`1 ´ Si q. (3.3.13)

Notice that R “ rδ ` opδq. By taking the limit from (3.3.13), we obtain
żT
V pT, ST q “ V p0, S0 q ` r

żT
pV pt, St q ´ ∆t pSt qSt qdt `

0

∆t pSt qdSt .

(3.3.14)

0

In the above V pt, Sq is the Black-Scholes price of the contingent claim, and ∆t pSt q satisfies
(3.3.12). The first integral in (3.3.14) is a simple Riemann integral. The second integral
is a more complicated stochastic integral; the integrator dSt is an Itô stochastic, which is
you can interpret the It0̂ integral in (3.3.14)
presented in Section C.4. But for the moment, ř
N ´1
∆ti pSti qpSti`1 ´ Sti q.
as the limit of the discrete stochastic integral i“0
Exercise 3.3.7. Repeat the above calculation to show that the discounted value of the
option p1 ` Rq´t V bi pt, St q converges to
e

´rT

żT
V pT, ST q “ V p0, S0 q `

e´rt ∆t pSt qdSt .

0

3.3.5

Error of discrete hedging in the Black-Scholes model and Greeks

Equation (3.3.14) suggests adjusting the Delta continuously in time to replicate the contingent claim. On one hand, this is a useful formula, because in reality trading can happen
with enormous speed which makes continuous time a fine approximation. However, in practice, the time is still discrete, and hedging is only a time lapse. Therefore, it is important to
have some estimation of the error of discrete-time hedging in the Black-Scholes framework.
Let us consider that the Black-Scholes model is running continuously in time, but we
only adjust our position on the approximately replicating portfolio at times ti :“ δi where
T
δ “ N
and i “ 0, 1, ..., N . By setting aside the accumulated error until time ti , we can
assume that our hedge has been perfect until time ti , for some i, i.e.
V pti , Sti q “ ∆BS
ti pSti qSti ` Yti ,
140

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

where V pt, Sq is the Black-Scholes value of the contingent claim and Yt is the position in
cash. At time ti`1 “ ti ` δ, the value of the portfolio is
rδ
∆BS
ti pSti qSti `δ ` e Yti .

Since by (3.3.12), ∆BS
ti pSti q “ BS V pti , Sti q, the error is given by
”
ı
Errti pδq :“Ê V pti ` δ, Sti `δ q ´ BS V pti , Sti qSti `δ ´ erδ Yti | Sti
”
ı
“Ê V pti ` δ, Sti `δ q ´ BS V pti , Sti qSti `δ ´ erδ pV pti , Sti q ´ BS V pti , Sti qSti q | Sti
”
“Ê V pti ` δ, Sti `δ q ´ V pti , Sti q ´ BS V pti , Sti qpSti `δ ´ Sti q
ı
` perδ ´ 1qpV pti , Sti q ´ BS V pti , Sti qSti q | Sti
”
“Ê V pti ` δ, Sti `δ q ´ V pti , Sti q ´ BS V pti , Sti qpSti `δ ´ Sti q
ı
´ δrpV pti , Sti q ´ BS V pti , Sti qSti qq | Sti ` Opδ 2 q
By the Taylor formula, the price of the option is
V pti ` δ, Sti `δ q “ V pti , Sti q ` Bt V pti , Sti qδ ` BS V pti , Sti qpSti `δ ´ Sti q
1
1
` BSS V pti , Sti qpSti `δ ´ Sti q2 ` Btt V pti , Sti qδ 2
2
2
` BSt V pti , Sti qpSti `δ ´ Sti qδ ` opδq.
Notice that since
?
Sti `δ ´ Sti “ σSti δN p0, 1q ` Opδq, with N p0, 1q independent of Sti ,
3

(3.3.15)

the conditional expectation ÊrpSti `δ ´ Sti q2 | Sti s “ σ 2 St2i δ ` Opδ 2 q. Therefore, by the
properties of the conditional expectation, we have
ÊrBS V pti , Sti qpSti `δ ´ Sti q | Sti s “ BS V pti , Sti qÊrSti `δ ´ Sti | Sti s “ 0
ÊrBSS V pti , Sti qpSti `δ ´ Sti q2 | Sti s “ BSS V pti , Sti qÊrpSti `δ ´ Sti q2 | Sti s
3

“ σ 2 St2i BSS V pti , Sti qδ ` Opδ 2 q,

141

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

and we can write the error term10 by
Errti pδq :“ δpBt V pti , Sti q `

σ 2 St2i
3
BSS V pti , Sti q ` rBS V pti , Sti qSti q ´ rV pti , Sti qq ` Opδ 2 q.
2
(3.3.16)

3

where the term Opδ 2 q depends on the higher derivative BtS V , σ, Sti , and r.
Before finishing the error estimation, let us briefly explain some of the important terms
which show up in (3.3.16).
1) The first derivative BS V of the option price, Delta, is denoted by ∆pt, Sq and determines the sensitivity of the value of the option with respect to the price of the
underlying.
2) The second derivative BSS V of the option price, which is called Gamma and denoted
by Γpt, Sq and determines the convexity of the option value on the price of underlying.
3) The time derivative Bt V , which is called time decay factor or Theta and is denoted
by Θpt, Sq, determines how the price of option evolves over time.
As a function of time-to-maturity τ “ T ´ t, by the abuse of notation, we define V pτ, Sq :“
V pt, Sq and therefore we have
∆pτ, Sq “ BS V pτ, Sq
Γpτ, Sq “ BSS V pτ, Sq
Θpτ, Sq “ ´Bτ V pτ, Sq
For example in the case of call option with strike K and maturity T , by taking derivatives
BSS and Bτ in (3.3.11), we have
Sσ
1
? Φ1 pd1 q and Θpτ, Sq “ ´ ? Φ1 pd1 q ´ rKe´rτ Φpd2 q.
Sσ τ
2 τ
(3.3.17)
The ∆, Γ, and Θ of a call option in the Black-Scholes model is shown in Figure 3.3.1.
To continue with the error estimation, we need the following proposition.
∆pτ, Sq “ Φpd1 q, Γpτ, Sq “

Proposition 3.3.1. For a European Markovian contingent claim, the Black-Scholes price
satisfies
σ2S 2
Θpτ, Sq “ ´
Γpτ, Sq ´ rS∆pτ, Sq ` rV pτ, Sq.
2
Proof. Apple Proposition (C.1) to the martingale e´rt V pt, St q.
Here we heuristically assumed N p0, 1q „ 1. A more rigorous treatment of this error is in by calculating
1
the L2 error by calculating ÊrpErrti pδqq2 s 2 .
10

142

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

Delta
Gamma
Theta

1

0.5

0

−0.5
6

8

10
S

12

14

Figure 3.3.1: Greeks of a call option with τ “ 1, σ “ .1, r “ .05, and K “ 10. As you
see the significant sensitivity is near the ATM.

As a result of this proposition, the term of order δ in (3.3.16) vanishes, and thus one step
3
T
error is of order Opδ 2 q. Since δ “ N
, we have
«
ﬀ
Nÿ
´1
?
Errpδq :“ Ê
Errti pδq “ Op δq,
i“0

which converges to 0 as quickly as

?

δ when δ Ñ 0.

Discrete hedging without a money market account
One reason to completely disregard the money market account is because the risk-free
interest rate r is not exactly constant. The money market is also under several risks which
is a diﬀerent topic. One way to tackle the interest rate risks is to completely exclude the
risk-free money market account from the hedging portfolio, and try to measure the hedging
error in this case. To understand this better, let us first consider the issuer of an option
that is long in ∆BS pti , Sti q units of the underlying. Then the change in the portfolio from
time ti to time ti ` δ is
ÊrV pti ` δ, Sti `δ q ´ V pti , Sti q ´ ∆BS pti , Sti qpSti `δ ´ Sti qs
“ pBt V pti , Sti q `
143

σ 2 St2i
BSS V pti , Sti qqδ ` opδq,
2

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

where we use (3.3.15) on the right-hand side. This error is related to the loss/profit of not
perfectly hedging and is called a slippage error; see Figure 3.3.2.

V (t, S)

V (ti + δ,Sti +δ )

V (ti ,Sti )
S
S ti

Sti +δ

Figure 3.3.2: The red curve is the value of the option at time ti , the blue curve is the
value of the option at time ti`1 . The slippage error is shown in burgundy.
The loss/profit from slippage can be calculated by using the same technology as in the
previous section; the slippage error during the time interval rti , ti ` δs is given by
pΘpti , Sti q `

σ 2 St2i
Γpti , Sti qqδ ` opδq
2

As illustrated in Figure 3.3.4, when, for instance, the time decay factor is negative and
Gamma is positive, for small changes in the price of the asset, we lose, and for larger
changes we gain. As seen in (3.3.17), it is a typical situation to have negative Θ and
positive Γ for call options (or put options or any European Markovian option with a
convex payoﬀ function). See Figure 3.3.3.
Exercise 3.3.8. Show that if the payoﬀ function gpST q is a convex function on ST , then
the Markovian European contingent claim with payoﬀ gpST q has nonnegative Γ; V pτ, Sq is
convex on S for all τ .
Let S̃t “ e´rt St and Ṽ pt, S̃t q “ e´rt V pt, St q “ e´rt V pt, ert S̃t q be respectively the discounted underlying price and discounted option price. Then, we can show that
Bt Ṽ pt, S̃q “ ´

σ 2 S̃ 2
B Ṽ pt, S̃q.
2 S̃ S̃
144

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

2.5

V (t, S)

2
1.5
1
0.5
0

K
S

Figure 3.3.3: The time decay for the price of call option in the Black-Scholes model. As
τ Ñ 0, the color becomes darker.

Exercise 3.3.9. Use Proposition 3.3.1 to show the above equality.
This suggests that if the interest rate is nearly zero, then the lack of a money market in
the replication does not impose any error. Otherwise, when the interest rate is large, the
slippage error is significant and is equal to
pΘpti , Sti q `

σ 2 St2i
Γpti , Sti qqδ ` opδq “ rpV pti , Sti q ´ St2i ∆pti , Sti qqδ ` opδq,
2

which can accumulate to a large number.

Other Greeks
Two other Greeks are Rho, denoted by ρ, and Vega, denoted by V, which respectively
measure the sensitivity with respect to interest rate r and volatility σ, i.e.,
´
¯
´
¯
ρpτ, Sq :“ Br e´rτ ÊrgpSτ q | S0 “ ss
and Vpτ, Sq :“ Bσ e´rτ ÊrgpSτ q | S0 “ ss .
145

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Profit/Loss

∆S

Figure 3.3.4: The loss/profit of the discrete hedging in the Black-Scholes model. The
red graph shows the loss/profit without the time decay factor. The blue includes the time
decay factor, too.
For a call option, these derivatives are given by
?
ρpτ, Sq “ e´rτ Kτ Φpd2 q and Vpτ, Sq “ S τ Φ1 pd1 q.
Figures (3.3.1) and 3.3.5 show the Greeks ∆, Γ, Θ, ρ and V for a call option as a function
of S.
Exercise 3.3.10. The third derivative of the Black-Scholes price with respect to S is called
speed. Find a closed-form solution for speed.
Example 3.3.1. The payoﬀ in Figure 3.3.6 can be written as pST ´ K1 q` ´ pST ´ K2 q` ´
pST ´ K3 q` ` pST ´ K4 q` . Therefore, the closed-form solution for the Black-Scholes price
of the option is given by
V pτ, Sq “ Cpτ, K1 , Sq ´ Cpτ, K2 , Sq ´ Cpτ, K3 , Sq ` Cpτ, K4 , Sq.
All the Greeks of the option are also a linear combination of the Greeks of these call
options. For instance,
∆pt, Sq “ Φpd1 pτ, K1 , Sqq ´ Φpd1 pτ, K2 , Sqq ´ Φpd1 pτ, K3 , Sqq ` Φpd1 pτ, K4 , Sqq.
146

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

10

Rho
Vega

8
6
4
2
0
6

8

10
S

12

14

Figure 3.3.5: ρ and V of a call option with τ “ 1, σ “ .1, r “ .05, and K “ 10.
g(ST )

K1

K2

K3

K4

ST

Figure 3.3.6: Payoﬀ of Example 3.3.1 gpST q “ pST ´ K1 q` ´ pST ´ K2 q` ´ pST ´ K3 q` `
pST ´ K4 q` .
Exercise 3.3.11. Write the payoﬀs in Figure 3.3.7 as a linear combination of call options
and derive a closed-form formula for the Black-Scholes price, the Delta, the Gamma, and
the time decay of options with these payoﬀs.
Exercise 3.3.12 (Bull and bear call spreads). Write the payoﬀs in Figure 3.3.8 as linear
combination of call options with diﬀerent strikes and possibly some cash and give the closed
form formula for them.

3.3.6

Time-varying Black-Scholes model

Recall from Section 2.4 that the binomial model can be calibrated to time-dependent
T
parameters. Let δ “ N
and consider the discrete time instances ti “ iδ. The time-varying
147

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

g(ST )

g(ST )

K

K1

ST

K2

ST

Figure 3.3.7: Left: payoﬀ of straddle. Right: payoﬀ of strangle.

g(ST )

K1

K2

ST

Figure 3.3.8: Red: Bull-spread call. Blue: Bear-spread call

binomial can be given by
lnpStk`1 q “ lnpSkδ q ` lnpHk`1 q,
where tHk uN
k“1 is a sequence of independent random variables with the following distribution under the risk-neutral probability
#
?
1 ` δrtk ` δσtk αk with probability π̂k
?
Hk “
,
1 ` δrtk ´ δσtk βk with probability 1 ´ π̂k
148

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

where αk , βk are given by (2.4.6) and (2.4.7) for time-dependent λt . Therefore, equation
(3.3.4) takes the following time-dependent form:
lnpStk q “ lnpS0 q `

k´1
ÿ

prti ´

i“0
βk
αk `βk

Analogous to (3.3.5), we have πk “

N
? ÿ
σt2i
qδ ` δ
σtk Zk .
2
k“1

(3.3.18)

and

ÊrZk s “ 0 and ÊrZk2 s “ 1.
Therefore,
χ?δσt

k

iθσtk Zk
s “ 1 ` iθσtk δ ÊrZ1 s ´
Zk pθq “ Êre

θ2 σt2k δ ÊrZ12 s
` opδq.
2

This implies that
χ?δ řN σt Zk pθq
k“1
k

“

N ˆ
ź
k“1

˙ ź
N
2 řN
1 2 2
´ 1 θ2 σ2 δ
´θ
σ2 δ
2
e 2 tk `opδq “ e 2 i“1 tk `opδq.
1 ´ δθ σtk ` opδ q “
2
k“1

As δ Ñ 0,
χ?δ řN

k“1

σtk

´
Zk pθq Ñ e

which is the characteristic function of N p0,
ˆż T
ST “ S0 exp

prt ´
0

şT
0

θ2
2

şT
0

σt2 dt

,

σt2 dtq. Thus in the limit, we have

σt2
qdt `
2

żT

˙
σt2 dtN p0, 1q .

0

As a matter of fact, for any t we have
ˆż t
ˆ żt
˙˙
σu2
2
St “ S0 exp
pru ´
qdu ` N 0, σu du
2
0
0
ˆż T
ˆ żT
˙˙
2
σ
ST “ St exp
pru ´ u qdu ` N 0,
σu2 du
.
2
t
t
´ ş
¯
´ ş
¯
T
t
and the random variables N 0, t σu2 du and N 0, 0 σu2 du are independent.

Usually the interest rate rt and the volatility σt are not given and we have to estimate
them from the data. In the next section, we discuss some estimation methods for these
two parameters.
149

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Using the variable r and σ, we can rewrite the Black-Scholes formula for a call option by
şT

ÊrpST ´ Kq` | St “ Ss “ SΦ pd1 q ´ e´
ˆ
˙ ˙
żTˆ
σu2
1
lnpS{Kq `
ru `
d1 “ b ş
du and
T 2
2
t
σ
du
t u
ˆ
˙ ˙
żTˆ
1
σu2
d2 “ b ş
lnpS{Kq `
ru ´
du .
T 2
2
t
σ
du
t u

CpT, K, S, tq :“ e´

ru du

t

şT
t

ru du

KΦ pd2 q ,

For a general European payoﬀ gpST q we have the Black-Scholes price given by
şT

ÊrgpSτ q | S0 “ Ss
ˆ
˙
b
ż
` ´ şT pru ´ σu2 qdu`x şT σ2 udu ˘ ´ x2
e´ t ru du 8
u
t
2
“ ?
g S e t
e 2 dx.
2π
´8

V pt, Sq :“ e´

t

ru du

şT

3.3.7

Black-Scholes with yield curve and forward interest rate

Recall from Section 1.1.5 that the yield curve Rt pT q and forward curve Ft pT q of a zero
bond are defined by
Bt pT q “ e´pT ´tqRt pT q “ e´

şT
t

Ft puqdu

or or Rt pT q :“ ´

1
d ln Bt pT q
ln Bt pT q Ft pT q :“ ´
.
T ´t
dT

Since setting a model for the forward rate is equivalent to setting a model for the short
rate rt , in the Black-Scholes formula with a time-varying interest rate, one can equivalently
use the forward rate or the yield curve. Assume that σ is constant. Then, the Black-Scholes
pricing formula becomes
CpT, K, S, tq :“ e´
d1 “ a
d2 “ a

şT
t

şT

ÊrpST ´ Kq` | St “ Ss “ SΦ pd1 q ´ e´ t Ft puqdu KΦ pd2 q ,
ˆ
˙
żT
σ2
lnpS{Kq `
Ft puqdu ` pT ´ tq and
2
´ tq
t
˙
ˆ
żT
σ2
lnpS{Kq `
Ft puqdu ´ pT ´ tq .
2
´ tq
t

Ft puqdu

1
σ 2 pT
1
σ 2 pT

150

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

and
CpT, K, S, tq :“ e´Rt pT qpT ´tq ÊrpST ´ Kq` | St “ Ss “ SΦ pd1 q ´ e´Rt pT qpT ´tq KΦ pd2 q ,
ˆ
˙
1
σ2
d1 “ a
lnpS{Kq ` Rt pT qpT ´ tq ` pT ´ tq and
2
σ 2 pT ´ tq
ˆ
˙
σ2
1
lnpS{Kq ` Rt pT qpT ´ tq ´ pT ´ tq .
d2 “ a
2
σ 2 pT ´ tq
(3.3.19)

3.3.8

Black-Scholes model and Brownian motion

In Section B.5, we show that the symmetric random walk converges to the Brownian
řN motion
Bt . The same principle shows that the linear interpolation of the summation k“1 Zk in
the logarithm of the asset price in the binomial model in (3.3.4) also converges to the
Brownian motion. Therefore, one can write the Black-Scholes model (3.3.7) by using the
Brownian motion Bt ;
˙
ˆ
σ2
(3.3.20)
St “ S0 exp pr ´ qt ` σBt .
2
Here Bt is a Gaussian random variable with mean zero and variance t. The above process
is called a geometric Brownian motion (GBM for short)11 .
Markovian property of the Black-Scholes model
Since for Brownian motion the increment Bs`t ´ Bt is independent of Bt ,
ˆ
˙
ˆ
˙
σ2
σ2
St “ S0 exp pr ´ qt ` σBt
and St`s “ St exp pr ´ qs ` σpBt`s ´ Bt q
2
2
are independent. Verbally, this means that future price movements are independent of past
movements. In other words, given the history of the movement of an asset’s price until
time t, i.e., Su for all u P r0, ts, the distribution of St`s only depends on St and that part
of history during r0, tq is irrelevant. As a result, for any function g : R` Ñ R, we have
„ ˆ
ˆ
˙˙ȷ
σ2
ÊrgpSt`s q | Su : @u P r0, tss “ ÊrgpSt`s q | St s “ Ê g St exp pr ´ qs ` σpBt`s ´ Bt q
.
2
The pricing formula (3.3.10) is precisely derived from the Markovian property of the BlackScholes model.
11

Paul Samuelson, in the 1950’s, first came up with the idea of using GBM to model the risky asset
price. His primary motivation is that GBM never generates negative prices, which overcomes one of the
drawbacks of Bachelier model, negative prices for an asset.

151

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

As a result of the Markovian property of GBM, one can write
ˆ
ˆ
˙
˙
σ2
St`dt ´ St “ St exp pr ´ qdt ` σpBt`dt ´ Bt q ´ 1
2
´
¯
2
σ
1
“ St pr ´ qdt ` σpBt`dt ´ Bt q ` σ 2 pBt`dt ´ Bt q2 ` opdtq.
2
2
Therefore, the short-term return of an asset in the Black-Scholes model is given by
St`dt ´ St
σ2
1
“ pr ´ qdt ` σpBt`dt ´ Bt q ` σ 2 pBt`dt ´ Bt q2 ` opdtq.
St
2
2
This is, in particular, consistent with Assumption 2.4.1 and the definition of mean return
and volatility, i.e.
„
ȷ
St`dt ´ St
σ2
1
Ê
“ pr ´ qdt ` σ ÊrBt`dt ´ Bt s ` σ 2 ÊrpBt`dt ´ Bt q2 s ` opdtq “ rdt ` opdtq.
St
2
2
˙
ˆ
St`dt ´ St
“ σ 2 dt ` opdtq.
var
St
Inspired from the above formal calculation, We formally write the Black-Scholes model for
the asset price as
dSt
“ rdt ` σdBt .
(3.3.21)
St
The above equation, which describes (3.3.20) in the diﬀerential form, is called the BlackScholes stochastic diﬀerential equation.

Martingale property of the Black-Scholes model

Similar to the binomial model, in the Black-Scholes model the lack of arbitrage is equivalent
to the martingale property of the discounted asset price. The discounted asset price in the
Black-Scholes model is given by
ˆ 2
˙
σ
´rt
S̃t “ e St “ S0 exp ´ t ` σBt .
2
152

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

The conditional expectation of S̃t`s given S̃t is then given by
„
ˆ 2
˙ˇ ȷ
ˇ
σ
S0 Ê exp ´ pt ` sq ` σBt`s ˇˇS̃t
2
ˆ 2
˙ „
ˆ 2
˙ˇ ȷ
ˇ
σ
σ
“ S0 exp ´ t ` σBt Ê exp ´ s ` σpBt`s ´ Bt q ˇˇS̃t
2
2
„
ˆ 2
˙ˇ ȷ
ˇ
σ
“ S̃t Ê exp ´ s ` σpBt`s ´ Bt q ˇˇS̃t .
2
By the independence of the increments of Brownian motion, we have
„
ˆ 2
˙ˇ ȷ
˙ȷ
„
ˆ 2
ˇ
σ
σ
Ê exp ´ s ` σpBt`s ´ Bt q ˇˇS̃t “ Ê exp ´ s ` σpBt`s ´ Bt q ,
2
2
and therefore,
„
ˆ 2
˙ȷ
ˇ ‰
“
σ
Ê S̃t`s ˇS̃t “ S̃t Ê exp ´ s ` σpBt`s ´ Bt q .
2
On the other hand since Bt`s ´ Bt „ N p0, sq, we have
Ê rexp pσpBt`s ´ Bt qqs “ exp

ˆ

˙
σ2
s ,
2

ˇ ‰
“
and therefore, Ê S̃t`s ˇS̃t “ S̃t .

In addition to the asset price, the discounted price of a newly introduced contingent claim
must be a martingale to preserve the no-arbitrage condition. Recall from formula (3.3.10)
that the price of a contingent claim with payoﬀ gpST q is given by
V pt, St q “ e´rpT ´tq ÊrgpST q | St s.
If we define the discounted price by Ṽ pt, St q “ e´rt V pt, St q, then we can write the above
as
Ṽ pt, St q “ e´rT ÊrgpST q | St s.
By the tower property of conditional expectation, we have
ˇ ı
”
ˇ ‰
“
ˇ
Ê Ṽ pt ` s, St`s qˇSt “ Ê e´rT ÊrÊrgpST q | St`s sˇSt “ e´rT Ê rgpST q|St s “ Ṽ pt, St q.
Therefore, the price of the contingent claim is a martingale under risk-neutral probability.
153

3.3. BLACK-SCHOLES MODEL

3.3.9

3. CONTINUOUS MARKETS

Physical versus risk-neutral in the Black-Scholes model

Recall from (2.4.1) that the binomial model under physical probability is given by
Spk`1qδ “ Skδ Hk`1 ,

for k “ 0, ..., N ´ 1,

where the sequence of i.i.d. random variables tHk uN
k“1 is given by
#
u with probability p
Hk “
ℓ with probability 1 ´ p
Then, the dynamics of the asset price under physical probability is given by
lnpST q “ lnpS0 q `

N
ÿ

lnpHk q.

k“1

lnpHk q is the log return Rlog
kδ . Recall from (3.3.3) that the first two moments of log return
are given by
1
ErlnpHk qs “ pµ ´ σ 2 qδ ` Opδ 2 q and ErlnpHk q2 s “ σ 2 δ ` opδq.
2
If we define Zk1 :“

2 {2q
lnpHk q´pµ´σ
?
,
σ δ

one can write

˙
N
?
1 ÿ 1
1 2
Zk ,
lnpST q “ lnpS0 q ` µ ´ σ T ` σ T ¨ ?
2
N k“1
ˆ

where tZk1 u is a sequence of i.i.d. random variables satisfying
ErZk1 s “ opδq, and ErpZk1 q2 s “ 1 ` op1q.
ř
1
If follows from (3.3.6) that ?1N N
k“1 Zk converges weakly to N p0, 1q, and under physical
probability, the Black-Scholes model is described by
ˆ
˙
σ2
St “ S0 exp pµ ´ qt ` σBt .
2
In other words, by switching from risk-neutral probability to physical probability, we adjust
the mean return of the asset from r to the risk-free interest rate µ.
Remark 3.3.2. For the purpose of derivative pricing, physical probability is irrelevant.
This is because by the fundamental theorem of asset pricing, Theorem 2.1.1, the price
of any derivative is determined by the discounted expectation of payoﬀ under risk-neutral
154

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

probability. However, for portfolio management, physical probability is important, because
it carries the long-term growth rate of the asset, µ. For example, an investor with x initial
wealth wants to decide how to split his investment between a risk-free bond with interest
rate r and a risky asset given by the Black-Scholes model
ˆ
˙
σ2
St “ S0 exp pµ ´ qt ` σBt .
2
His objective is to maximize his expected wealth at time T subject to a constraint of the risk
of portfolio measured by the variance of the wealth at time T , i.e.,
maxtErXTθ s ´ λvarpXTθ qu.

(3.3.22)

θ

where XTθ is the wealth of the investor at time T if he chooses to invest x0 ´θ in the risk-free
asset and θ in the risky asset. The wealth XTθ satisfies
XTθ “ erT px0 ´ θq ` θepµ´

σ2
qT `σBT
2

.

Therefore,
ErXTθ s “ erT px0 ´ θq ` θeµ and varpXTθ q “ θ2 e2µT peσ

2T

´ 1q.

Therefore, the portfolio maximization problem (3.3.22) is given by
)
!
2
max erT px0 ´ θq ` θeµT ´ λθ2 e2µT peσ T ´ 1q
θ

and the solution is given by
θ˚ “

eµT ´ erT
.
2λe2µT peσ2 T ´ 1q

Volatility estimation
Notice that the log return of the Black-Scholes model satisfies
ln

´S

t`δ

¯

St

“ pµ ´

σ2
qδ ` σpBt`δ ´ Bt q
2

We consider the time discretization t0 “ 0, ti`1 “ ti ` δ, and tN “ t. Therefore, it follows
from (B.15) (the quadratic variation of Brownian motion) that
Nÿ
´1
i“0

ln

´S

ti`1

St i

¯2

“ σ2

Nÿ
´1

pBti`1 ´ Bti q2 ` opδq Ñ σ 2 t

i“0

155

(3.3.23)

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

One can use (3.3.23) to make an estimation of volatility. For any ti “ iδ, evaluate
Yti :“

i´1
ÿ

ln

´S

tj`1

St j

j“0

¯2

.

If δ is small enough, then Yti should approximately be equal to ti σ 2 . This suggests that
if we fit a line to the data tpti , Yti q : i “ 0, 1, ...u, the slope of line is σ 2 . The schematic
picture of this fitting is shown in figure 3.3.9.
Quadratic variation of log return

data
fitted line: Slope=σ 2

0

0.5

1

Time

Figure 3.3.9: Quadratic variation estimation of volatility

Exercise 3.3.13 (Project). With the same set of data from Exercise 2.4.1, calculate the
1
volatility by using the quadratic variation formula (3.3.23). Take δ “ 250
year. Then, plot
the estimated quadratic variation Yti versus time ti . Some examples of the generated plots
are given in Figure 3.3.10. Then fit a line to the data by assuming Yt “ σ 2 t ` noise. To fit
a line to the data points, you can use the least square method. The slope of the line gives
you the volatility σ.

3.3.10

Black-Scholes partial diﬀerential equation

Recall from Proposition 3.3.1 that the price V pτ, Sq of the Markovian European contingent
claim with payoﬀ gpST q at time t “ T ´ τ (τ is time-to-maturity) when the asset price is
S satisfies
σ2S 2
´Bτ V pτ, Sq “ ´
BSS V pτ, Sq ´ rSBS pτ, Sq ` rV pτ, Sq.
2
156

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL
·10−2

Quadratic variation of log return

0.2

3

2
0.1
1

0
0

0.5

1

0

0.5

1

Time

Time

Figure 3.3.10: Quadratic variation estimation of volatility: Left: Tesla. Right: S&P500
The above equation is a partial diﬀerential equation called the Black-Scholes equation. One
way to find the pricing formula for an option is to solve the Black-Scholes PDE. As with
all PDEs, a boundary condition and an initial condition12 are required to solve the PDE
analytically or numerically. The initial condition for the Black-Scholes equation is the
payoﬀ of the derivative, i.e.
V p0, Sq “ gpSq.
Notice that here when τ “ 0, we have t “ T .
Notice that the above PDE holds in region τ P r0, T s and S ą 0. Therefore, we need a
boundary condition at S “ 0. This boundary condition is a little tricky to devise, because
in the Black-Scholes model, the price of the asset St never hits zero; if the price of an asset
is initially positive, then the price stays positive at all times. If the price of the asset is
initially 0, then ST “ 0 and the price of the option with payoﬀ gpST q is given by
V pτ, 0q “ e´rτ ÊrgpST q | ST ´τ “ 0s “ e´rτ gp0q.
Therefore, the boundary condition for S “ 0 is given by
V pτ, 0q “ e´rτ gp0q.
To summarize, the Black-Scholes PDE for pricing a Markovian European contingent claim
with payoﬀ gpST q is given by the following boundary value problem
$
σ2 S 2
’
&Bτ V pτ, Sq “ 2 BSS V pτ, Sq ` rSBS V pτ, Sq ´ rV pτ, Sq
.
(3.3.24)
V pτ, 0q
“ e´rτ gp0q
’
%
V p0, Sq
“ gpSq
Exercise 3.3.14. Consider the option with payoﬀ gpST q “
12

For time-dependent PDEs.

157

?1
ST

. Find the Black-Scholes

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

price of this payoﬀ at time t “ 0 by solving PDE (3.3.24). Hint: Try to plug in V pτ, Sq “
e´rτ S a into the Black-Scholes equation, for some constant a. Then, find the constant a.
The boundary condition V pτ, 0q “ e´rτ gp0q is unnecessary as gp0q “ 8.
Remark 3.3.3. Somehow the boundary condition V pτ, 0q “ e´rτ gp0q is redundant in equation (3.3.24), because in the Black-Scholes model, the price of the underlying asset never hits
zero. But this condition is important for solving the Black-Scholes equation numerically.
Heat equation and Black-Scholes model
Recall from Exercise 3.3.9 that the change of variable S̃ :“ e´rpT ´τ q S and Ṽ pτ, S̃q :“
e´rpT ´τ q V pτ, Sq “ e´rpT ´τ q V pτ, erpT ´τ q S̃q modifies the Black-Scholes equation to
Bτ Ṽ pτ, S̃q “

σ 2 S̃ 2
B Ṽ pτ, S̃q.
2 S̃ S̃

If we make a change of variables x :“ lnpS̃q and U pτ, xq :“ Ṽ pτ, ex q, then we obtain the
heat equation
σ2
Bτ U pτ, xq “
Bxx U pτ, xq.
2
Unlike (3.3.24), the heat equation holds on the whole space, i.e.
#
2
Bτ U pτ, xq “ σ2 Bxx U pτ, xq
.
(3.3.25)
U p0, xq
“ e´rT V perT ex q
Notice that at time t “ 0 (or τ “ T ), the price of the Markovian European contingent
claim with payoﬀ gpST q is equal to V pT, S0 q “ Ṽ pT, S0 q “ U pT, lnpS0 qq.
Transforming the Black-Scholes equation into the heat equation helps us to apply numerical techniques for the heat equation that are developed in Section 3.2.2 to obtain the
Black-Scholes price of an option.

3.3.11

Numerical methods for the Black-Scholes price of a European
option

Although the Black-Scholes price of call options, put options, digital options, or a linear
combination of them has to a closed-form solution, there are many payoﬀs that does not.
As a result, one need to develop numerical methods to evaluate the price of such options.
This section, covers the finite-diﬀerence scheme for the Black-Scholes equation, the binomial
model approximation of the Black-Scholes model, and the Monte Carlo approximation of
the price of a European option in the Black-Scholes model. All the methods in Section
3.2.2 can also be applied after transferring the Black-Scholes into the heat equation, as
discussed in Section 3.3.10.
158

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

Solving the Black-Scholes equation via finite-diﬀerence scheme
One can directly discretize the Black-Scholes equation (3.3.24) to apply the finite-diﬀerence
method described in the previous section. See Figure 3.3.11. In this case, the computation
domain has to be r0, Smax s for some Smax ą 0. The boundary condition at 0 is already
assigned at (3.3.24) by
V pτ, 0q “ e´rτ gp0q,
and the ABC at Smax is given by the growth of the payoﬀ for large values of S. For a call
option, for instance, the ABC is
V pt, Smax q “ Smax for Smax suﬃciently large.
The rest of the approximation follows as was presented in Section 3.3.10. However, one
should be cautious about applying explicit schemes, which need the CFL condition. Recall
that the right-hand side of the CFL condition is always 12 times the inverse of the coeﬃcient
of second derivative in the equation. Therefore, the CFL condition translates to
h
1
ď 2 2.
2
k
σ S
If Smax is chosen very large, for a fixed discretization k of variable S, one needs to set the
discretization h of variable t very small. The downside of this method is that the time of
the algorithm increases significantly. In such cases, transferring the Black-Scholes equation
into the heat equation and implementing the explicit finite-diﬀerence scheme in Section
3.3.10 is more eﬃcient.

S
Smax

k
T

h

t

Figure 3.3.11: Finite-diﬀerence grid for the Black-Scholes equation. In the explicit
1
scheme the CFL condition should be satisfied, i.e., kh2 ď σS
. This requires choosing a
very small h. Artificial boundary conditions are necessary on both Smax and 0.
159

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Binomial model scheme for the Black-Scholes equation
Recall from Section 3.3.1 that the Black-Scholes model is the limit of the binomial model
under risk-neutral probability. Therefore, if necessary, one can use the binomial model
to approximate the Black-Scholes price of the contingent claim. For implementation, one
T
needs to choose a suﬃciently large number of periods N or, equivalently, a small δ “ N
.
Suggested by (3.3.1), for a given interest rate r and volatility σ, we need to choose u and
ℓ and the one-period interest rate R as follows.
u “ eδpr´

σ2
q`
2

?
δσα

, l “ eδpr´

σ2
q´
2

?

δσβ

,

and R “ rδ,

where α and β are given by (2.4.6). However, one can avoid the calculation of α and β by
making some diﬀerent choices. Notice that the binomial model has three parameters u, ℓ
and R while the Black-Scholes parameters are only two. This degree of freedom provides
us with some modifications of binomial model, which still converges to the Black-Scholes
formula. This also simplifies the calibration process in Section 2.4 significantly. Here are
some choices:
1) Symmetric probabilities:
u “ eδpr´

σ2
q`
2

?
δσ

, l “ eδpr´

Then

σ2
q´
2

?
δσ

,

and R “ rδ,

1
π̂u “ π̂ℓ “ .
2

2) Subjective return:
u “ eδν`

?
δσ

, l “ eδν´

?
δσ

,

and R “ rδ,

Then
1
π̂u “
2

˜

? r ´ ν ´ 1 σ2
2
1` δ
σ

¸

1
and π̂ℓ “
2

˜

? r ´ ν ´ 1 σ2
2
1´ δ
σ

¸
.

To see why this choices work, recall (3.3.4) from Section 3.3.1. The only criteria for the
convergence of the binomial model to the Black-Scholes model is that when we write the
log of asset price in the binomial model as in (3.3.4),
lnpST q “ lnpS0 q ` pr ´

N
?
σ2
1 ÿ
Zk ,
qT ` σ T ¨ ?
2
N k“1

160

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

the random variables Zk , k “ 1, ..., N must satisfy
ÊrZ1 s “ opδq and ÊrZ12 s “ 1 ` op1q.
In Section 3.3.1, we made a perfect choice of ÊrZ1 s “ 0 and ÊrZ12 s “ 1.
Monte Carlo scheme for Black-Scholes
Recall from Section 3.3.2 that the price of a Markovian European contingent claim can be
written as an expectation and/or a single integral.
ˆ
˙
ż
` pr´ σ2 qτ `σ?τ x ˘ ´ x2
e´rτ 8
´rτ
2
g S e
V pτ, Sq :“ e ÊrgpSτ q | S0 “ Ss “ ?
e 2 dx.
2π ´8
One way to estimate V pT, S0 q is to generate a sample xp1q , ..., xpM q of N p0, 1q and approximate the above expectation by
ˆ
˙
M
` pr´ σ2 qT `σ?T xpjq ˘
e´rT ÿ
2
g S0 e
.
M j“1

(3.3.26)

Another class of approximation methods, quadrature methods, directly targets the integral
by choosing a large number 0 ă xmax and approximate the integral
˙
ż xmax ˆ
` pr´ σ2 qτ `σ?τ x ˘ ´ x2
2
e 2 dx
g S e
´xmax

by a finite Riemann sum. For instance, if we choose ∆x :“ xmax
and xpjq “ j∆x, the
L
approximation goes as follows:
ˆ
˙
ż
? ˘
`
σ2
x2
e´rτ xmax
V pτ, Sq « ?
g S epr´ 2 qτ `σ τ x e´ 2 dx
2π ´xmax
˙
2
L´1
?
ÿ ˆ `
2
˘ ´ xpjq
´rT
pr´ σ2 qT `σ T xpjq
«e
g S0 e
e 2 ∆x.
j“´L

Quadrature methods, if implemented carefully, can be more eﬃcient than the naive Monte
Carlo scheme (3.3.26).
Exercise 3.3.15 (Project). Consider the payoﬀ of a bull-spread call in Figure 3.3.8 with
T “ 1, K1 “ 10, and K2 “ 20. Assume that the parameters of the underlying asset
are given by S0 “ 15 and σ “ .02, and that the interest rate is r “ .01. Compare the
following approximation schemes for the price of the bull-spread call. Record the time of
the algorithms for each scheme to obtain four-digit accuracy.
161

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

a) The closed-form solution for the value of this option from the Black-Scholes formula.
b) Implicit finite-diﬀerence with parameter θ “ .5.
c) Implicit finite-diﬀerence with parameter θ “ 1.
d) Explicit finite-diﬀerence (equivalently implicit with θ “ 0).
e) Symmetric binomial model.
f) Monte Carlo scheme.
g) Approximation by a Riemann sum.

3.3.12

Stock price with dividend in the Black-Scholes model

IN this section, we consider two types of dividend strategies. If the dividend is paid
continuously, then there is a constant outflow of cash from the price of the asset. If the
rate of dividend payment is Dt , the Black-Scholes model in (3.3.21) has to be modified to
dSt “ rSt dt ` σdBt ´ Dt dt.
Choosing Dt :“ qSt for q ě 0, we obtain
dSt “ pr ´ qqSt dt ` σSt dBt .

Remark 3.3.4. For a continuous dividend rate q, the dividend yield in time period rt, T s
is given by e´qpT ´tq ˆ 100 percent.
Especially, this choice guarantees that the dividend is always less than the asset price and
that paying the dividend does not diminish the value of the asset. In exponential form, we
have
ˆ
˙
σ2
´qt
St “ S0 exp ppr ´ qqt ` σBt q “ e S0 exp pr ´ qt ` σBt .
2
In this case, the Black-Scholes price of a European contingent claim with payoﬀ gpST q is
given by
” ´
¯
ı
V pt, Sq “ e´rpT ´tq ÊrgpST q | St “ Ss “ e´rpT ´tq Ê g e´qpT ´tq S̃T | S̃t “ S ,
where S̃t satisfies the Black-Scholes equation without dividend, i.e.
ˆ
˙
σ2
S̃t “ S0 exp pr ´ qt ` σBt .
2
162

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

If the dividend strategy is time-varying qt , then one can write the above pricing formula as
” ´ şT
¯
ı
V pt, Sq “ e´rpT ´tq Ê g e´ t qs ds S̃T | S̃t “ S .
For continuous-rate dividend, the relation between the Greeks of the option in Proposition
3.3.1 is modified as in the following proposition.
Proposition 3.3.2. Let St follow the Black-Scholes price with a continuous dividend rate
q. For a European Markovian contingent claim, the Black-Scholes price satisfies
Θpτ, Sq “ ´

σ2 S 2
Γpτ, Sq ´ pr ´ qqS∆pτ, Sq ` rV pτ, Sq.
2

The second type of dividend strategy is discrete. The discrete dividend is paid in times
0 ď t0 ă t1 ă ... ă tN ď T in amounts D0 , ..., DN . Then, between the times of dividend
payment, the asset price follows the Black-Scholes model, i.e.
˙
ˆ
σ2
St “ Stn´1 exp pr ´ qpt ´ tn´1 q ` σpBt ´ Btn´1 q , t P rtn´1 , tn q.
2
Just a moment before the payment of dividend at time tn ´13 the price of the asset is
ˆ
˙
σ2
Stn ´ :“ Stn´1 exp pr ´ qptn ´ tn´1 q ` σpBtn ´ Btn´1 q .
2
But, after paying a dividend of Dn , this price drops to
ˆ
˙
σ2
Stn “ Stn ´ ´ Dn “ Stn´1 exp pr ´ qptn ´ tn´1 q ` σpBtn ´ Btn´1 q ´ Dn .
2
As mentioned in Section 2.3.4, the dividend is usually given as a percentage of the current
asset price, i.e.
Dn “ dn Stn ´ , with dn P r0, 1q.
and we have
˙
σ2
“ p1 ´ dn qStn´1 exp pr ´ qptn ´ tn´1 q ` σpBtn ´ Btn´1 q .
2
ˆ

Stn “ p1 ´ dn qStn ´

Remark 3.3.5. For a discrete dividend, the dividend yield in time period rtn´1 , tn s is
dn ˆ 100 percent.
13

The moment before time t is denoted by t´.

163

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

Therefore,
N
ź

σ2
ST “
p1 ´ dn qS0 exp pr ´ qT ` σBT
2
n“1
ˆ

˙
.

Remark 3.3.6. If at time T there is a dividend payment, the payoﬀ of a contingent claim
gpST q takes into account the price ST after the payment of the dividend. In short, the price
of the asset at the maturity is always ex-dividend.
Proposition 3.3.3. Let St follow the Black-Scholes price with the discrete dividend policy
given by d0 , ..., dN P r0, 1q at times 0 ď t0 ă t1 ă ... ă tN ď T . For a European Markovian
contingent claim, the Black-Scholes price satisfies
Θpτ, Sq “ ´

σ2S 2
Γpτ, Sq ´ rS∆pτ, Sq ` rV pτ, Sq for τ P pT ´ tn , T ´ tn´1 q.
2

Then, the Black-Scholes price of a contingent claim with payoﬀ gpST q is given by
” ´ ź
¯ˇ
ı
ˇ
´rpT ´tq
´rpT ´tq
V pt, Sq “ e
ÊrgpST q | St “ Ss “ e
Ê g
p1 ´ dn qS̃T ˇS̃t “ S ,
tătn ďT

where S̃t satisfies the simple no-dividend Black-Scholes model.
Exercise 3.3.16. Consider a portfolio of one straddle option with K “ 10 and one strangle
option with K1 “ 8 and K2 “ 14, both maturing at T “ 1. See Figure 3.3.7. Assume that
the underlying asset has parameters S0 “ 2 and σ “ .2, and that it pays a 4% quarterly
dividend. The interest rate is r “ .01 (1%). Find the price of this portfolio and its ∆ and
Γ at time t “ 0.
Remark 3.3.7. Dividend strategies are sometimes not known upfront and therefore should
be modeled by random variables. If the dividend policy is a random policy that depends on
the path of the stock price, then, the pricing formula will be more complicated even in the
Black-Scholes model.
Exercise 3.3.17 (Butterfly spread). Consider the payoﬀ gpST q shown in Figure 3.3.12.
Consider the Black-Scholes model for the price of a risky asset with T “ 1, r “ .04, and
σ “ .02 with dividends paid quarterly with a dividend yield of 10%. Take S0 “ 10, K1 “ 9,
and K2 “ 11. Find the Black-Scholes price, ∆, Γ, ρ, and V of this option at time t “ 0.
Find Θ at time t “ 0 without taking derivatives with respect to S.
164

3. CONTINUOUS MARKETS

3.3. BLACK-SCHOLES MODEL

g(ST )
K2 −K1
2

K1

K1 +K2
2

K2

ST

Figure 3.3.12: Butterfly spread payoﬀ
The Black-Scholes equation with dividend
In the case of dividends, the Black-Scholes equation in (3.3.24) is given by
$
σ2 S 2
’
&Bτ V pτ, Sq “ 2 BSS V pτ, Sq ` pr ´ qqSBS pτ, SqV pτ, Sq ´ rV pτ, Sq
.
V pτ, 0q
“ e´rτ gp0q
’
%
V p0, Sq
“ gpSq
This also allows us to solve the derivative pricing problem with more complicated dividend
strategies. Let’s assume that the dividend payment rate at time t is a function qpt, St q.
Then, the Black-Scholes model with dividend is given by the SDE
dSt “ St pr ´ qpt, St qqdt ` σSt dBt .
and Black-Scholes equation in (3.3.24) is given by
$
σ2 S 2
’
&Bτ V pτ, Sq “ 2 BSS V pτ, Sq ` pr ´ qpt, SqqSBS V pτ, Sq ´ rV pτ, Sq
.
V pτ, 0q
“ e´rτ gp0q
’
%
V p0, Sq
“ gpSq
After the change of variables described in Section 3.3.10, we obtain
#
2
Bτ U pτ, xq “ σ2 Bxx U pτ, xq ´ qpT ´ τ, erpT ´τ q ex qBx U pτ, xq,
.
U p0, xq
“ e´rT V perT ex q
The above equation is a heat equation with a drift term given by qpT ´τ, erpT ´τ q ex qBx U pτ, xq.
Exercise 3.3.18 (Project). Consider a European call option with T “ 1 and K “ 2.
Assume that the parameters of the underlying asset are given by S0 “ 2 and σ “ .2, and
that the interest rate is r “ .01 (1%). In addition, assume that the underlying asset pays
165

3.3. BLACK-SCHOLES MODEL

3. CONTINUOUS MARKETS

dividends at continuous rate qpt, St q “ .05e´.01t St , i.e., 5% of the discounted asset price.
a) Write the Black-Scholes equation for this problem and convert it into a heat equation
with a drift term.
b) Solve this problem numerically by using a finite-diﬀerence scheme.
Example 3.3.2. Consider a European option with payoﬀ
gpST q “ eαST .
Assume that the interest rate is r ą 0 and that the volatility of the underlying asset is σ ą 0,
and at time 0 it has value S0 , and pays dividends at a continuous rate qpt, St q “ qSt , where
q ą 0. Then, the Black-Scholes equation is given by
#
2 2
Bτ V pτ, Sq “ σ 2S BSS V pτ, Sq ` pr ´ qSqSBS V pτ, Sq ´ rV pτ, Sq
.
V p0, Sq
“ eαS .
The boundary condition for the Black-Scholes equation at S “ 0 is given by
V pτ, 0q “ 1.
Function V pτ, Sq “ e´rτ eαS satisfies the Black-Scholes equation and the boundary conditions. Therefore, the price of the contingent claim with payoﬀ eαST at time-to-maturity τ
(at time T ´ τ ) is given by V pτ, Sq “ e´rτ eαS if the asset price takes value S at that time.
Exercise 3.3.19. Consider a European option with payoﬀ
gpST q “ ST´5 e10ST .
Assume that the interest rate is r “ .1 and the underlying asset satisfies S0 “ 2 and σ “ .2,
and that pays dividends at a continuous rate of qpt, St q “ .2St .
a) Write the Black-Scholes equation for this problem.
b) Solve this problem analytically by the method of separation of variables. Plug into the
equation a solution candidate with the form eατ S ´5 e10S and determine α.

166

4. AMERICAN OPTIONS

4

American options
Unlike European options, holder of an American options has the right but not the obligation
to exercise any date before or at the maturity. When she chooses to exercise the option
at time t P r0, T s (or in discrete-time models t P t0, ..., T u), she receives the payoﬀ of the
option gpt, St q; i.e., the payoﬀ is a function gpt, Sq of the time of exercise t and the price
of the underlying S at the time of exercise. For instance, the payoﬀ of an American call
option if exercises at time t is pSt ´ Kq` .
To price an American option, we assume that the holder chooses to exercise the American
option at the optimal time of exercise; the time that the holder receives the largest value
possible. We will discuss the details of the optimal exercise time in the future.
We use CAm pT, K, S, tq and PAm pT, K, S, tq to denote the price of American call and
American put at time t when the underlying asset price is S with maturity T and strike K,
respectively. The following remarks are very important in our future study of American
option.
Remark 4.0.1. Notice that since exercising is always an option, the value of the American
option never falls below the payoﬀ. In fact, is can sometimes be strictly larger than the
payoﬀ.
Remark 4.0.2. Consider an American option with payoﬀ gpt, Sq which can possibly take
negative values. Since the holder has no obligation to exercise the option, she will not do
so as long as gpt, St q ď 0. In particular, if the American option has not been exercised
before the maturity T , it is not optimal for her to exercise at T if SpT, ST q ď 0. Therefore,
the actual payoﬀ is g` pt, Sq “ maxt0, gpt, Squ. On the other hand, if the payoﬀ gpT, ST q is
positive at maturity, it is always optimal to exercise it. Therefore, we always assume that
the payoﬀ of an American option is nonnegative.
Remark 4.0.3. The price p of an American option with payoﬀ g1 pt, Sq ` g2 pt, Sq is not
the same as the sum of the price p1 of an American option with payoﬀ g1 pt, Sq and price p2
of an American option with payoﬀ g2 pt, Sq. In fact, the first value is always smaller than
167

4. AMERICAN OPTIONS
or equal to the sum of the other two. To see this, let t̃ be the optimal exercise time for the
American option with payoﬀ g1 pt, Sq ` g2 pt, Sq, i.e., the present value of the option is
p “ B0 pt̃qpg1 pt̃, St̃ q ` g2 pt̃, St̃ qq.
Notice that time t̃ is not necessarily optimal for the other two American options with payoﬀ
g1 pt, Sq or g2 pt, Sq. Therefore,
pi ě B0 pt̃qgi pt̃, St̃ q,

for

i “ 1, 2.

This implies that p ď p1 ` p2 .

4.0.1

Pricing American option in the binomial model via examples

The key to the pricing of American options is to compare to values at each node of the
model, i.e., continuation value and exercise value. We will properly define these values in
this section and use them to price American option. We first present the pricing method
in the naive case of one-period binomial model.
Example 4.0.1. Consider a one-period binomial model with S0 “ 1, u “ 2.1, ℓ “ .6 and
R “ .1 (for simplicity). We consider an American put option with strike K; the payoﬀ is
pK ´ Sq` . Similar to the European put, at the terminal time T “ 1, the value of the option
is known. However, at time t “ 0 we are facing a diﬀerent situation; we can choose to
exercise and get the exercise value of E :“ pK ´ 1q` , or we can continue. If we continue,
we will have a payoﬀ of pK ´ 2.1q` or pK ´ .6q` depending of the future events. The value
of continuation is obtain via taking risk-neutral expectation:
ˆ
˙
1
1
2
1
ÊrpK ´ ST q` s “
pK ´ 2.1q` ` pK ´ .6q` .
C :“
1`R
1.1 3
3
(K − 2.1)+

max{C, E}

(K − .6)+

Figure 4.0.1: American put option in one-period binomial model
Next, we should compare continuation value C and exercise value E. If C ą E, we should
not exercise at time 0 and should wait until time 1. Otherwise when C ď E, it is optimal
168

4. AMERICAN OPTIONS
to exercise. For example when K “ 3, we have C “ 1.7273 ă E “ 2 and thus we exercise.
However, when K “ 1, we have C “ .2424 ą E “ 0 and thus we do not exercise.

0.6

21
13

2.1

K

Figure
4.0.2:
One-period
binomial model:
continuation value C
“
`1
˘
2
1
(gray) and exercise value E “ pK ´ 1q` (red) of
1.1 3 pK ´ 2.1q` ` 3 pK ´ .6q`
an American put option as a function of strike price K.
As seen in Figure 4.0.2, only American put options with strike K in p.6, 21
13 q generate a
larger continuation value and therefore should not be exercises at time 0.
To illustrate more, we consider a two period binomial model in the following example.
Example 4.0.2. Consider a two-period binomial model with the same parameters as in
Exercise 4.0.1, i.e., u “ 2.1, ℓ “ .6 and R “ .1. We consider an American put option
with strike K; the payoﬀ is pK ´ Sq` . The terminal time T “ 2, the value of the option is
known. At time t “ 1, there are two nodes and at time t “ 0 there is one node, at each of
which we have to find exercise value and continuation value. The exercise values are given
by the payoﬀ as seen in Figure 4.0.3
Here C0 , C1,1 , and C1,2 are the continuation values at nodes t “ 0, t “ 1 price-down, and
t “ 1 price-up, respectively. Next, we should compare continuation value and exercise value
at each node in a backward manner. At time t “ 1, the continuation value is
ˆ
˙
1
1
2
1
C1,2 “
pK ´ 4.41q` ` pK ´ 1.26q`
ÊrpK ´ ST q` | S1 “ 2.1s “
1`R
1.1 3
3
ˆ
˙
1
1
1
2
C1,1 “
ÊrpK ´ ST q` | S1 “ .6s “
pK ´ 1.26q` ` pK ´ .36q`
1`R
1.1 3
3
169

4. AMERICAN OPTIONS
(K − 4.41)+

max{C1,2 , (K − 2.1)+ }

max{C0 , (K − 1)+ }

(K − 1.26)+

max{C1,1 , (K − .6)+ }

(K − .36)+

Figure 4.0.3: American put option in two-period binomial model
Therefore, the price of the option at these nodes are
"
ˆ
˙
*
1
1
2
V1,2 “ max
pK ´ 4.41q` ` pK ´ 1.26q` , pK ´ 2.1q`
1.1 3
3
"
ˆ
˙
*
1
1
2
V1,1 “ max
pK ´ 1.26q` ` pK ´ .36q` , pK ´ .6q`
1.1 3
3

1.26 2.1

3.3

4.41

K

Node (1, 2)

.36 .6

12.6 1.26
13

K

Node (1, 1)

Figure 4.0.4: Two-period binomial model: at each nodes at time t “ 1, continuation
value (gray) is compared to exercise value (red) as a function of strike price K.
As you see from Figure 4.0.4, if we choose the strike of the option K in p1.26, 3.3q, then
at node p1, 2q the continuation value is larger, otherwise we exercise at this node. If we
choose K in p.36, 12.6
13 q, at node p1, 1q the continuation value is larger.In this example, values
of K that imposes the continuation in node p1, 1q is disjoint from those which imposed
continuation at node p1, 2q. Therefore, we exercise the American option on at least one of
170

4. AMERICAN OPTIONS
these nodes.
Now let fix our put option by choosing K “ 2. Then, we continue at node p1, 2q and
exercise at node p1, 1q. Therefore, at time t “ 1, the option takes values
V1,2 “ C1,2 « 0.4485

and

V1,1 “ 1.4.

At time t “ 0, we need to see if it is optimal to exercise or if it is optimal to continue. The
situation at node p0, 0q is explained in Figure 4.0.5. The exercise value is E “ 1 but the
continuation value is positive, i.e., C “ .9844. Therefore, it is optimal to exercise.

0.4485
max{C, E} = E = 1
1.4000
Figure 4.0.5: American put option at time t “ 0 in two-period binomial model of Example
4.0.2.
Remark 4.0.4. As a general rule, when it is optimal to exercise, i.e., the continuation
value is less than or equal to exercise value, there is no point in continuing the option. This
is because the continuation value remains equal to exercise value since then after. This can
be observed from Example 4.0.2 by taking for example K “ 1. The schematic pattern of
exercise and continuation nodes is presented in Figure 4.0.6.
(4.41,0)

(4.41,0)

(2.1,0)
(1,.2424)

(2.1,.9)
(1.26,0)

(.6,.4)
K=1

(1,1)

(1.26,.74)
(.6,1.4)

(.36,.46)

K=2

(.36,1.64)

Figure 4.0.6: The pattern of continuation versus exercise in a two-period binomial model
in Example 4.0.2. The red nodes are the exercise nodes and blue nodes are continuation
nodes. In the pair pa, bq, a is the asset price and b is the continuation value.
Exercise 4.0.1. In Example 4.0.2, take the following values of K.
171

4.1. PRICING AMERICAN OPTION IN THE BINOMIAL MODEL; PROBLEM
FORMULATION
4. AMERICAN OPTIONS
1) K “ 1.
2) K “ 3.

4.1

Pricing American option in the binomial model; problem
formulation

In this section, we formulate the problem of pricing an American option with (nonnegative)
payoﬀ gpt, Sq in T -period binomial model. Notice that to price an American option, it is
important to know the best exercise time for the holder of the option. Since the price of the
underlying is randomly changing over time, the best execution time can also be a random
time. To formulate an exercise strategy as a random time, we need to define the notion of
stopping time. Recalling from Definition B.19, we define an exercise strategy for the multi
period binomial model.
Definition 4.1.1. An exercise strategy for an American option is a stopping time with
respect to price of underlying tSt : t “ 0, ...u, i.e., is a random variables τ : Ω Ñ t0, ..., T u
such that for any t “ 0, ..., T , the even τ ď t is known given the values of Su for u ď t.
In other words, exercise strategy is a stopping time with respect to the information generated by the price process. Given the holder of an American option chooses a specific
stopping time τ , the corresponding value of the option is obtained through
”
ı
1
Ê
gpτ,
S
q
.
τ
p1 ` Rqτ
Therefore, the (optimal) value of the option for the holder is given by the maximum value
over all exercise strategies;
ı
”
1
gpτ,
S
q
,
V0 :“ max Ê
τ
τ PT0
p1 ` Rqτ
where the maximum is taken over the set T0 all stopping times τ with values in t0, ..., T u.
Since the binomial model can be constructed on a finite sample space (the set of all price
process paths is finite), then the set T0 is finite and therefore in the above e can show the
value of the American option with a maximum. More generally, given the option has not
been exercised until time t, then the value of the option is given
Vt :“ max Êr
τ PTt

1
gpτ, Sτ q | Ft s.
p1 ` Rqτ ´t

(4.1.1)

Here the maximum is taken over the finite set Tt of all stopping times τ with values in
tt, ..., T u. Since T0 is finite, there exists an optimal exercise strategy (stopping time) ϱ˚
172

4. AMERICAN OPTIONS

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

with values in t0, ..., T u such that
”
V0 “ Ê

ı
1
˚
˚
gpϱ
,
S
q
ϱ
p1 ` Rqϱ˚

Similarly at time t, there exists an optimal a stopping time ϱ˚t with values in tt, ..., T u such
that
”
ı
1
˚
˚
Vt “ Ê
gpϱ
,
S
q
|
F
t
˚
t
ϱt
p1 ` Rqϱt ´t
We explain the methodology for pricing American option in the simple one-period case
by choosing t “ T ´ 1, i.e.
VT ´1 :“ max Êr
τ PTT ´1

1
gpτ, Sτ q | FT ´1 s,
p1 ` Rqτ ´T `1

where the maximum is taken over all stopping times τ with two values T ´ 1 and T ; the
former corresponds to decision to exercise at time T ´ 1, while the latter is to continue
untill maturity T . Given FT ´1 , for any stopping time τ with two values tT ´ 1, T u, the
events tτ “ T ´ 1u “ tτ ď T ´ 1u and tτ “ T u “ tτ ď T ´ 1uA are both known. Therefore,
either τ “ T ´ 1 a.s. or τ “ T a.s.. When τ “ T ´ 1 we obtain the exercise value
1
gpT ´ 1, ST ´1 q; otherwise τ “ T yields the continuation value 1`R
ÊrgpT, ST q | FT ´1 s.
Therefore, the choice of exercise strategy boils down to choosing the maximum of the
1
ÊrgpT, ST q | FT ´1 s, i.e.
exercise value gpT ´ 1, ST ´1 q and the continuation value 1`R
VT ´1 “ max

!

)
1
ÊrgpT, ST q | FT ´1 s, gpT ´ 1, ST ´1 q .
1`R

By using the Markov property of the binomial model, we have ÊrgpT, ST q | FT ´1 s “
ÊrgpT, ST q | ST ´1 s and thus the value of the American option is a function of time T ´ 1
and asset price ST ´1 , i.e.
V pT ´ 1, ST ´1 q “ max

!

)
1
ÊrgpT, ST q | ST ´1 s, gpT ´ 1, ST ´1 q .
1`R

In this one period situation, it is not hard to see that the optimal stopping time is obtained
by the first time t (among T ´ 1, and T ) that the exercise value gpt, St q is not smaller than
1
continuation value 1`R
ÊrgpT, ST q | ST ´1 s. Notice that from Remark 4.0.2 the value of the
American option at maturity time T is always equal gpT, ST q and
V pT ´ 1, ST ´1 q “ max

!

)
1
ÊrVT | ST ´1 s, gpT ´ 1, ST ´1 q .
1`R

In the sequel, we would like to extend the above implication to all t. More precisely, we
seek to show the following theorem.
173

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

4. AMERICAN OPTIONS

Theorem 4.1.1. The value of the American option with payoﬀ function gpt, Sq is a function V pt, Sq of time t and the asset price S which satisfies
V pt, St q “ max

!

)
1
ÊrV pt ` 1, St`1 q | St s, gpt, St q
1`R

(4.1.2)

Here the supremum is over all stopping times with values in tt, ..., T u. In addition, we show
that an optimal exercise strategy is given by the stopping time τt˚ defined by the first time
u ě t such that V pu, Su q “ gpu, Su q, i.e.,
τt˚ “ inftu : u “ t, ..., T,

such that V pu, Su q “ gpu, Su qu.

(4.1.3)

Recall that from Remark 4.0.1, we already know that Vt ě gpt, St q. Therefore (4.1.3)
representation for an optimal exercise implies that V pt, St q ą gpt, St q if and only if τt˚ ą t.
To prove Theorem 4.1.1, we define a new process Ṽ by
#
ṼT :“ gpT, ST q
␣ 1
(
.
(4.1.4)
Ṽt :“ max 1`R
ÊrṼt`1 | Ft s, gpt, St q
t “ 0, ..., T ´ 1
The following lemma presents some key properties for the study of an American option.
Lemma 4.1.1. The following properties hold for Vt and Ṽt defined by 4.1.1 and 4.1.4,
respectively.
Vt
i) Both p1`Rq
t and
the asset price.

Ṽt
p1`Rqt

are supermartingales with respect to filtration generated by

ii) Vt and Ṽt are greater than or equal to gpt, St q.
iii) Vt is the smallest process with property (i) and (ii).
! V ˚
)
u^τ
t
iv)
:
u
“
t,
...,
T
is a martingale.
˚
u^τ
p1`Rq

t

Property (i) asserts that the discounted price of an American option is a supermartingale
and property (ii) simply restates that the value of the American option is never smaller
than the payoﬀ. Property (iii), which is a crucial property of the value of American option,
indicates that the discounted values of the American option is the smallest supermartingale
which is greater than or equal to the discounted payoﬀ.
Proof of Lemma 4.1.1. Given Ft , for any stopping time τ with values in tt, ..., T u, the
occurrence of the event tτ ď tu “ tτ “ tu is known. Therefore,
• If τ “ t has happened then strategy τ suggests to exercise and
”
ı
1
Ê
gpτ,
S
q
|
F
“ gpt, St q.
τ
t
p1 ` Rqτ ´t
174

4. AMERICAN OPTIONS

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

• If τ “ t has not happened, then strategy τ suggests to continue.
Therefore,
Vt “ max Êr
τ PTt

␣
(
1
1
gpτ, Sτ q | Ft s “ max max Êr
gpτ, Sτ q | Ft s, gpt, St q
τ
´t
τ
´t
τ PTt`1
p1 ` Rq
p1 ` Rq
(4.1.5)
ě

1
1
gpτ, Sτ q | Ft s.
max Êr
1 ` R τ PTt`1 p1 ` Rqτ ´t´1

Let ϱ˚t`1 be an optimal exercise for Vt`1 , i.e.
Vt`1 “ Ê

1

”

ϱ˚
t`1 ´t´1

p1 ` Rq

ı
gpϱ˚t`1 , Sϱ˚ q .
t`1

Then, in particular we have
Vt ě Êr

1
p1 ` Rq

ϱ˚
t`1 ´t

gpϱ˚t`1 , Sϱ˚ q | Ft s “
t`1

1
ÊrVt`1 | Ft s.
1`R

Vt
Therefore, p1`Rq
t is a supermartingale. The supermartingale property for
consequence of its definition (4.1.4), i.e.

Ṽt “ max

␣

Ṽt
p1`Rqt

is a direct

(
1
1
ÊrṼt`1 | Ft s, gpt, St q ě
ÊrṼt`1 | Ft s.
1`R
1`R

Hence, (i) is proven. (ii) is a straightforward consequence of choosing τ ” t in (4.1.1) and
(4.1.4).
To show (iii), let Yt be another process which satisfies (i)-(ii). In particular, YT ě
gpT, ST q “ VT . Inductively, assume that Yu ě Vu for u ą t. If Vt “ gpt, St q, then
property (ii) for Yt implies Vt “ gpt, St q ď Yt . Otherwise, Vt ą gpt, St q and we deduce from
(4.1.5) that
1
Vt “ max Êr
gpτ, Sτ q | Ft s.
τ PTt`1
p1 ` Rqτ ´t
Since Yt satisfies (ii), we have
Vt ď max Êr
τ PTt`1

1
Yτ | Ft s.
p1 ` Rqτ ´t

By optional sampling theorem, Theorem B.6, we obtain
Êr

1
Yτ | Ft s ď Yt .
p1 ` Rqτ ´t
175

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

4. AMERICAN OPTIONS

Hence, Vt ď Yt .
Remark 4.1.1 (Snell envelope). For any given payoﬀ process g :“ tgt utě0 , for instance
gpt,Sq
gt “ p1`Rq
t , the smallest supermartingale which is greater than or equal to g is called Snell
envelope of g. Therefore, the discounted value of the American option is the Snell envelope
of the discounted payoﬀ.
First, we use the properties (i)-(iii) in Lemma 4.1.1 to show that Vt “ Ṽt for all t.
Lemma 4.1.2. For any t “ 0, ..., T , we have Vt “ Ṽt .
Proof. Obviously, VT “ gpT, ST q “ ṼT . If Vt`1 “ Ṽt`1 , then
Ṽt “ max

!

)
! 1
)
1
ÊrṼt`1 | Ft s, gpt, St q “ max
ÊrVt`1 | Ft s, gpt, St q .
1`R
1`R

By (i) (supermartingale property of discounted V ) and (ii), we have
␣
(
Ṽt ď max Vt , gpt, St q “ Vt .
On the other hand, since Vt is the smallest process with properties (i) and (ii), we must
have Vt ď Ṽt , which verifies the equality.
Next lemma is on the Markovian property of the price of American option.
Lemma 4.1.3. The value of the American option Vt is a function of time t and asset price
S, i.e., Vt “ V pt, St q.
Proof. If Vt`1 “ V pt ` 1, St`1 q, then by Markovian property of binomial model, we obtain
ÊrV pt ` 1, St`1 q | Ft s “ ÊrV pt ` 1, St`1 q | St s and
Vt “ max

!

)
1
ÊrV pt ` 1, St`1 q | St s, gpt, St q
1`R

is a function V pt, St q of time and the asset price. Hence, (4.1.2) follows.
Finally, we show that (4.1.3) provides an optimal exercise.
Lemma 4.1.4. The stopping time τt˚ given by 4.1.3 satisfies
”
Vt “ Ê

ı
1
˚
˚ q | Ft
gpτ
,
S
˚
t
τ
t
p1 ` Rqτt ´t

Proof. Notice that by definition, Vτt˚ “ gpτt˚ , Sτt˚ q. Hence, by the optional sampling theorem, Theorem (B.6), and property (iv), we obtain that
”
Vt “ Vt^τt˚ “ Ê

ı
”
ı
1
1
˚
˚
˚
˚
V
pτ
,
S
q
|
F
“
Ê
gpτ
,
S
q
|
F
t
t ,
τ
˚
˚
t
t
τt
p1 ` Rqτt ´t
p1 ` Rqτt ´t
176

4. AMERICAN OPTIONS

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

which shows that τt˚ is optimal.
The above discussion suggests the following algorithm in pricing American options.
Pricing American options in the binomial model
1:
2:
3:
4:
5:
6:
7:
8:
9:
10:

At time T , the value of the option is gpT, ST pjqq.
for each t “ T ´ 1, ..., 0 do
for each j “ 1, ..., t ` 1 do
Exercise value = gpt, St pjqq.
˘
` i`1
1
1
i π̂ .
ÊrV pt ` 1, St`1 q | St “ St piqs “ 1`R
Continuation value = 1`R
Vt`1 π̂u ` Vt`1
ℓ
)
!
1
ÊrV pt ` 1, St`1 q | St “ St piqs .
The value of the option V pt, St piqq “ max gpt, St piqq, 1`R
If V pt, St piqq “ gpt, St piqq, we exercise the option and stop.
If V pt, St piqq ą gpt, St piqq, we continue and the replicating portfolio is given by
∆t pSt pjqq units of risky assets and V pt, St piqq ´ ∆t pSt pjqqSt pjq is cash.
end for
end for

Remark 4.1.2 (Path dependent American option). If the payoﬀ of the American option
depends on the path, one can adjust the algorithm by considering the path dependent continuation value and path dependent exercise value. Exercise 4.1.1 provides an example of
such kind.
Example 4.1.1 (American call option on a nondividend asset does not exist!). In this
case the payoﬀ is given by gpt, Sq “ pS ´ Kq` . Then, the price of the American call option
is the same as the price of European call option! In fact, this is true in any model where
the pricing of European claims is carried by the risk-neutral probability. See Proposition
4.1.1.
This situation is not unique to American call option. The following proposition further
elaborate on this matter.
Proposition 4.1.1. Consider an American option with a convex payoﬀ gpSq such that
gp0q “ 0 on an asset which pays no dividend. Assume that the price of a European contingent claim is given by
V Eu pt, Sq “ Bt pT qÊrgpST q | St “ Ss,
where Ê is expectation under risk-neutral probability, and the discounted asset price S̃t “
St
p1`Rqt is a martingale under risk-neutral probability. Then, the price of American option
V Am pt, Sq with payoﬀ gpSq is the same as V Eu , i.e.
V Eu pt, Sq “ V Am pt, Sq.
177

4.1. AMERICAN OPTION IN THE BINOMIAL MODEL

4. AMERICAN OPTIONS

Remark 4.1.3. Proposition 4.1.1 is only true when the underlying asset does not pay
dividend. See Exercise 4.1.2.
Exercise 4.1.1. Consider a two-period binomial model for a risky asset with each period
equal to a year and take S0 “ $1, u “ 1.5 and ℓ “ 0.6. The interest rate for both periods is
R “ .1.
a) Price an American put option with strike K “ .8.
b) Price an American call option with strike K “ .8.
c) Price an American option with a path dependent payoﬀ which pays the running maximum1 of the path.
Remark 4.1.4. A naive example of an American option is the case where the payoﬀ is $1.
In this case, if the interest rate is positive, it is optimal to exercise the option right away.
However, if interest rate is 0, the time of exercise can be any time. This naive example has
an important implication. If interest rate is zero, one can remove condition gp0q “ 0 from
Proposition 4.1.1, simply by replacing payoﬀ g by g̃pSq “ gpSq ´ gp0q. Since cash value of
gp0q does not change value over time, the value of the American option with payoﬀ gpSq is
gp0q plus the value of American option with payoﬀ g̃pSq.
For negative interest rate, the exercise date will be postponed compared to the positive
interest rate.
For example, if the interest rate is zero, the price of American put is equal to the price of
European put.
Hedging American option in the binomial model
Hedging American option in the binomial model follows the same way as European option.
The only diﬀerence is that the hedging may not continue until maturity because of the
early exercise. Given that we know the price V pt ` 1, St`1 piqq of the American option at
time t ` 1 at all states i “ 1, ..., t ` 2, to hedge at time t and state j, we need to keep
∆t pSt pjqq units of risky asset in the replicating portfolio and V pt, St piqq ´ ∆t pSt pjqqSt pjq
in cash, where ∆t pSq is given by (2.3.4), i.e.
∆pt, Sq :“

V pt ` 1, Suq ´ V pt ` 1, Sℓq
for t ă τ ˚ .
Spu ´ ℓq

Notice that hedging an American contingent claim is only matters before the time of the
exercise. At the time of the exercise or thereafter, there is no need to hedge. However, if
the holder of the American claim decides not to exercise at time τ ˚ , the issuer can continue
hedging with no hassle. For example, in Example 4.0.2 with K “ 2, it is optimal for the
1

The running maximum at time t is the maximum of the price until or at time t.

178

4. AMERICAN
4.2. PRICING
OPTIONS AMERICAN OPTION IN THE BLACK-SCHOLES MODEL
holder to exercise the option at the beginning, where the price of asset is $ 1. Therefore,
the issuer need $ 1 to replicate. However, if the holder continues, the replication problem
in the next period leads to solving the following system of equation.
#
2.1a ` 1.1b “ .4485
.6a ` 1.1b
“ 1.4000
which yields a “ ´1.903 and b “ 2.3107. Therefore, the issuer needs $ a ` b “ .4077 to
replicate the option which is less than $ 1 if the holder exercises the option.
Exercise 4.1.2. Consider a two-period binomial model for a risky asset with each period
equal to a year and take S0 “ $1, u “ 1.2 and ℓ “ 0.8. The interest rate for both periods is
R “ .05.
a) If the asset pays 10% divided yield in the first period and 5% in the second period,
find the price of an American and European call options with strike K “ .8.
b) Construct the replicating portfolio for both American and European call option.

4.2

Pricing American option in the Black-Scholes model

In continuous time, including Black-Scholes model, the definition of exercise policy (stopping time) for American options is not easy to define. The definition needs to use filtration
and σ-algebra from measure theory2 . Here we avoid technical discussion of stopping times
and only present the solution for American option in the Black-Scholes model.
First notice that Proposition 4.1.1 implies that the American call option is Black-Scholes
model has the same price as European call if the underlying does not pay any dividend.
Therefore, our focus here is on the derivatives such as American put or American call on
a dividend-paying asset.
The key to solve the American option problem in the Black-Scholes model is to set up a
free boundary problem. This type of problems are widely studied in physics. For example,
in order to understand how an ice cube is melting over time, we need to solve a free
boundary problem. Or if we push an elastic object to a certain shape, after releasing, the
shape starts changing in a certain way which can be realized by solving a free boundary
problem. See Figure 4.2.1.
Another simple example occurs if we add obstacle underneath a hanging elastic rubber.
An elastic rubber fixed at two level points takes shape as a piece of parabola shown in left
image in Figure 4.2.2. The equation satisfied by the free rubber is u2 “ c where the constant
c depends on the physical properties of the rubber. If we position an obstacle underneath
the rubber such that the elastic rubber is touched, then it changes the shape of the red
2

For more information see for example [23, 31] or for a more advanced text see [17, Chapter 1].

179

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

4. AMERICAN OPTIONS

Figure 4.2.1: Exterior membrane of a tube (purple shape) is forcefully shaped into a
dumbbell (red shape). Upon release of the forces, the surface of the shape starts moving;
each point moves at a speed proportional to the curvature of the surface. Eventually, it
returns back to the original shape. The picture is adopted from [12].

180

4. AMERICAN OPTIONS

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

curve shown in right image in Figure 4.2.2. The position of the red curve satisfies the
same equation u2 “ c but only at the points where the rubber in not touching the obstacle.
Inside the touching region px0 , x1 q, the rubber takes the shape of the obstacle. At the two
endpoints of touching region, the shape of the rubber is once continuously diﬀerentiable;
i.e., if the upx0 q “ upx1 q “ y0 the height of the obstacle and u1 px0 q “ u1 px1 q “ 0.

y0

x0

x0

x1

Figure 4.2.2: The blue curve on the left shows the position of a free elastic hanging at
two points. The red curve shows the same elastic rubber hanging at the same points but
bounded below by an obstacle.
After this short introduction, we come back to the problem of pricing and hedging American option. For the sake of simplicity, we only consider simple case where there is only one
free boundary. This for example occurs when we have an American put or an American
call on a dividend-paying asset. Below, we list the important facts that you need to know
about the free boundary.
a) The domain for the problem tpt, Sq : t P r0, T s, and S P r0, 8qu is divided into to
parts separated by a curve C :“ tpt, S ˚ ptqq : t P r0, T su. The curve C is called free
boundary.
b) On one side of the boundary it is not optimal to exercise the option. This side is
called continuation region, e.g. if the asset price Ss ą S ˚ psq for all s ď t, it has never
been optimal to exercise the option before or at time t.
c) The other side of the boundary is called exercise region, e.g. if the asset price St ď
S ˚ ptq, then it is optimal to exercise the option at time t. Therefore, the optimal
stopping time is the first time that the pair pt, St q hits the exercise region. More
precisely, the asset price St hits the free boundary at time t at point S ˚ ptq.
τ ˚ :“ inf tt ď T : St “ S ˚ ptqu .
181

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

4. AMERICAN OPTIONS

It is important to notice that the exercise boundary is an unknown in pricing American
options in continuous time. The other unknown is the price of the American option. We
next explain that finding the price of the American option also gives us the free boundary.
The relation between these two is lied in the following representation of the stopping policy.
For an American option with payoﬀ gpt, St q, we have the optimal stopping τ ˚ given by
τ ˚ “ inf tt ď T : V pt, St q “ gpt, St qu .
See [24] for more details. Therefore, finding the price of American option is the first priority
here, which will be explained in the sequel.
Finding the edges of exercise boundary
So far, we learned that the domain of the problem is split into continuation boundary and
exercise boundary; e.g. for American put at each time t, p0, S ˚ ptqq is the interior of exercise
region and pS ˚ ptq, 8q is the interior of the continuation region. determining continuation
region is the matter of guess-and-check; we must look at the payoﬀ of the American option
to guess the topology of the continuation region. One general rule is that it is not
optimal to exercise in the out of money region or where the payoﬀ takes its
minimum value. We consider the following examples to clarify this rule:
a) American put. An American put option with strike K is out-of-money if St ą
K, and since it is not optimal to exercise in the out-of-money region, the exercise
boundary should be inside the in-the-money region, i.e., S ˚ ptq ď K. See Figure 4.2.3
on the left. At the maturity (t “ T ), S ˚ pT q “ K.
b) American call. An American call option with strike K on a dividend-paying asset
is out-of-money if St ă K, and since it is not optimal to exercise in the out-ofmoney region, the exercise boundary should be inside the in-the-money region, i.e.,
S ˚ ptq ě K. See Figure 4.2.3 on the left. At the maturity (t “ T ), S ˚ pT q “ K.
c) Straddle. Several other options including strangle, bull and bear spread, etc can also
be argued in the similar fashion. However, we only explain it for straddle. First notice
that one can shift the payoﬀ of a straddle option by cash amount of K2 so that the new
payoﬀ is positive. The key to analyze the straddle is that it is the least desirable to
exercise the option at and around the minimum point. Therefore, we can guess that
there are two free boundaries, S1˚ ptq and S2˚ ptq , located symmetrically on two sides of
the minimum point of the payoﬀ K. At the maturity (t “ T ), S1˚ pT q “ S ˚ 2pT q “ K;
the free boundaries collapse to K.
The position of the free boundary with respect time in the three examples is sketched in
Figure 4.2.5.
182

4. AMERICAN OPTIONS

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

K

K
St

St

∗

∗

S (t)

S (t)

Figure 4.2.3: Left: Free boundary of American put at time t. Right: Free boundary of
American call (on dividend-paying asset) at time t. The continuation region in marked
with |—|.
g(St )
g(St )

K
2

K
2

K
S ∗ (t)
1

St

S ∗ (t)
1

K

S ∗ (t)
2

St

S ∗ (t)
2

Figure 4.2.4: Two free boundaries of straddle.The continuation region in marked with
|—|. The free boundaries can occur both on the positive regions of the payoﬀ and on
the negative region of the payoﬀ. If the time-to-maturity is long, we guess that the free
boundaries are wides apart and as time-to-maturity decreases, they get closer.
Remark 4.2.1. The price of an American option with payoﬀ equal to g1 pSq ` g2 pSq is
not equal to, but only smaller than, the summation of prices of an American option with
payoﬀ g1 pSq and an American option with payoﬀ g2 pSq Similar phenomenon is observed
in Exercise 1.3.3.
Smooth fit
The main tool in finding the free boundary and to evaluate American options in the principle of smooth fit.
Let’s denote the price of the American option at time t when the asset price is equal to
St “ S by V pt, Sq. We provide the methodology for American put option. For other cases,
the method can be adopted after necessary modifications. Before presenting this principle,
we shall explain that in the continuation region, the price function V pt, Sq of the American
183

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

4. AMERICAN OPTIONS

2.8
2

Continuation region

Exercise region

2.5
2.6

1.8

Exercise region
2.4

1.6
1.4

2

Continuation region

2.2

Exercise region

1.5

Continuation region

Exercise region

1.2
2
1

0

0.2

0.4

0.6

0.8

1

0

0.2

0.4

0.6

0.8

1

1

0

0.2

0.4

0.6

Figure 4.2.5: Sketch of the position of American option exercise boundary in time (horizontal axis). Left: American put. Middle: American call (dividend). Right: American
Straddle.
put option satisfies Black-Scholes equation, i.e.
$
σ2 S 2
’
&Bt V pt, Sq ` 2 BSS V pt, Sq ` rSBS V pt, Sq ´ rV pt, Sq “ 0
V pt, Sq “ gpt, Sq
’
%
V pT, Sq “ gpT, Sq;

for S ą S ˚ ptq
for S ď S ˚ ptq .

(4.2.1)

Therefore, S ˚ ptq serves as a boundary for the above equation. However, S ˚ ptq itself is an
unknown. With the Black-Scholes equation, we have two unknowns but only one equation.
Principal of smooth fit provides a second equation.
Proposition 4.2.1 (Principal of smooth fit). Assume that the payoﬀ gpt, Sq of the American option is twice continuously diﬀerentiable with respect to S and continuous in t. Then,
at the free boundary S ˚ ptq, we have
V pt, S ˚ ptqq “ gpt, S ˚ ptqq,

and

BS V pt, S ˚ ptqq “ BS gpt, S ˚ ptqq,

for all t ă T .
For example for American put we have gpt, Sq “ pK ´Sq` . Therefore, principle of smooth
fit implies that V pt, S ˚ ptqq “ pK ´ S ˚ ptqq` and BS V pt, S ˚ ptqq “ ´1.
To see how smooth fit can be used in pricing American options, we provide some exactly
solvable example in the following. These examples are called perpetual American options
with maturity T “ 8. As a result, the price of the American option does not depend
on time and the term Bt V in PDE (4.2.1) vanishes. Therefore, the pricing function V pSq
satisfies the ODE
σ2S 2 2
V pSq ` rSV 1 pSq ´ rV pSq “ 0,
2
in the continuation region.
184

0.8

1

4. AMERICAN OPTIONS

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

Example 4.2.1 (Perpetual American put option). A perpetual American option is an
option with maturity T “ 8. In practice, there is no perpetual option. However, if the
maturity is long (10 years), then one can approximate the price with the price of a perpetual
option.

The key observation is that since the Black-Scholes model is time-homogeneous, the free
boundary of the perpetual American put option does not depend on time, i.e., S ˚ ptq “ S ˚
for some unknown constant S ˚ ă K. On the other hand, since the time horizon is infinite,
the price V pt, Sq of the American put does not depend on t, i.e., Bt V pt, Sq “ 0. Thus, we
have
σ2S 2 1
V pSq ` rSV 1 pSq ´ rV pSq “ 0.
2
The general solution of the above equation is given by
2r

V pSq “ c1 S ` c2 S ´ σ2 .
One can argue that c1 must be equal to 0. Since as S Ñ 8, the option goes deep out-ofmoney and becomes worthless. To find c2 , we use principle of smooth fit.
2r

c2 pS ˚ q´ σ2 “ K ´ S ˚
c2 “
Thus, S ˚ “

rK
2
r` σ2

σ 2 ˚ 2r2 `1
pS q σ
.
2r

and
$
’
&K ´ S
´
¯ 2r2 `1 2r
V pSq “
2
’
% σ2r rKσ2 σ
S ´ σ2
r`

Sě

rK
2
r` σ2

Să

rK
2
r` σ2

2

.

Example 4.2.2 (Perpetual American call option on continuous dividend-paying asset).
Consider a continuous constant dividend rate q ą 0. The free boundary in this case is
given by a constant S ˚ with S ˚ ą K and the price of American option satisfies
σ2S 2 2
V pSq ` pr ´ qqSV pSq ´ rV pSq “ 0.
2
The general solution of the above equation is given by
V pSq “ c1 S γ1 ` c2 S γ2 ,
185

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

4. AMERICAN OPTIONS

where γ1 and γ2 are roots of
σ2 ¯
σ2 2 ´
γ ` r´q´
γ ´ r “ 0.
2
2
Notice that γ1 and γ2 have opposite sign and the positive one is strictly larger than 1. With
out loss in generality, we assume that γ1 ă 0 ă 1 ă γ2 .
One can argue that c1 must be equal to 0. Since as S Ñ 0, the option goes deep out-ofmoney and becomes worthless. To find c2 , we use principle of smooth fit.
c2 pS ˚ qγ2 “ S ˚ ´ K
1
.
c2 “
˚
γ2 pS qγ2 ´1
Thus, S ˚ “

γ2 K
γ2 ´1

and
V pSq “

#
S´K

Sď

1
˚ 1´γ2 S γ2
γ2 pS q

Są

γ2 K
γ2 ´1
γ2 K
γ2 ´1

.

Exercise 4.2.1. Formulate and solve the free boundary problem for the perpetual American
options with following payoﬀs.
a) pS ´ Kq` ` a where a ą 0.
b) pK ´ Sq` ` a where a ą 0.
c) Straddle
d) Strangle
e) Bull call spread
f) Bear call spread
American option with finite maturity
Unlike perpetual American option, when T ă 8, there is no closed-form solution for the free
boundary problem (4.2.1). Therefore, numerical methods should be used to approximate
the solution.
The simplest among numerical methods is the binomial approximation. One needs to
choose large number of periods N and apply the algorithm of “Pricing American options
in the binomial model”. The parameters of the binomial model u, ℓ , and R can be
chosen according to symmetric probabilities, subjective return, or any other binomial which
converges to the specific Black-Scholes model.
186

4. AMERICAN OPTIONS

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

The finite-diﬀerence scheme can be employed to solve free boundary problem numerically.
Similar to Section (3.3.10), one can apply the change of variables U pτ, xq “ e´rτ V pT ´
τ, erτ `x q, to derive a heat equation with free boundary for U , i.e.
$
σ2
˚
’
&Bτ U pτ, xq “ 2 Bxx U pτ, xq ` rBx V pτ, xq ´ rU pτ, xq for x ą x pτ q
U pτ, xq “ gpT ´ τ, ex q
for x ď x˚ pτ q ,
’
%
U p0, xq “ gpT, ex q
where x˚ pτ q “ lnpS ˚ pτ qq.
For the simplicity, we only consider American put option, where we have U pτ, xq ě gpT ´
τ, ex q. Whether we want to apply explicit or implicit scheme to the above problem, because
of the free boundary, we need to add an intermediate step between step i and step i ` 1
of the scheme. Suppose that the approximate solution Û pτi , xj q at τi is known for all j.
Therefore, finite-diﬀerence scheme (3.2.19) or (3.2.20) provides an approximate solution,
denoted by Û pτi` 1 , xj q for the heat equation without including the free boundary3 . Then,
2

to find an approximate solution Û pτi`1 , xj q for the free boundary problem at τi`1 , one only
needs to set
Û pτi`1 , xj q :“ maxtÛ pτi` 1 , xj q, gpT ´ τ, exj qu.
2

To summarize we have the following:
#
:“ AÛ pτi , ¨q
Û pτi` 1 , ¨q
2

Û pτi`1 , xj q :“ maxtÛ pτi` 1 , xj q, gpT ´ τ, exj qu @j

.

2

Here A can be implicit, explicit or mixed scheme.
The above method is in the category of splitting method, where there is one or more
intermediate steps in the numerical schemes to go from step i to step i ` 1.
The splitting method described in this section can also be applied directly to Black-Scholes
equation with free boundary
$
σ2 S 2
˚
’
&Bτ V pτ, Sq “ 2 BSS V pτ, Sq ` rSBS V pτ, Sq ´ rV pτ, Sq for S ą S pτ q
V pτ, Sq “ gpT ´ τ, Sq
for S ď S ˚ pτ q .
’
%
V p0, Sq “ gpT, Sq;
The CFL condition is not diﬀerent in the case of free boundary problems.
The Monte Carlo methods for American options are more complicated than for the European options and in beyond the scope of this lecture notes. For more information of the
Monte Carlo methods for American options, see [19], [7], or the textbook [15].
3

The subscript in τi` 1 indicate that finite-diﬀerence evaluation in each step in an intermediate step.
2

187

4.2. AMERICAN OPTION IN THE BLACK-SCHOLES

4. AMERICAN OPTIONS

American call option on discrete dividend-paying asset
Unlike continuous dividend problem, the discrete dividend cannot be solved as a single
free boundary problem. Consider an asset which pays dividend yield of d P p0, 1q at times
t1 ă t2 ă ... ă tn “ T . Proposition 4.1.1 suggests that at any time t P rti , ti`1 q between
the times of dividend payments it is better to wait and not to exercise. However, at time ti
of the dividend payment, the price of the asset decreases by the dividend and so does the
price of the call option. Therefore, if the continuation is not optimal, the option should be
exercises at the moment just before the time of a dividend payment.

188

Appendices

189

A. CONVEX OPTIMIZATION

A

Convex optimization

In this section, we briefly review the important result that we need from linear and convex
optimization for this course. We start with reminding the notion of convex set and convex
function.

A.1

Convex functions

Definition A.1. A set A Ď Rd is called convex if for any λ P p0, 1q and x, y P A, we have
λx ` p1 ´ λqy P A.
In other words, a convex set is a set which contains all the segments with endpoints inside
the set.
Example A.1. The unit disk tx P Rd : |x| ď 1u and the unit cube r0, 1sd are convex
sets. The volume given by inequalities ai ¨ x ď bi for i “ 1, ..., n, ai P Rd and bi P R
(enclosed within n hyperplanes) is a convex set. Euclidean space Rd and the empty set are
also convex.
Definition A.2. Let A be a convex set. A real function f : A Ď Rd Ñ R is called convex
if for any λ P p0, 1q and x, y P Rd , we have
f pλx ` p1 ´ λqyq ď λf pxq ` p1 ´ λqf pyq.
A function f is called concave if ´f is convex. The convexity (concavity) is called strict if
the inequality above is strict when x‰y.
Proposition A.1. A set A Ď Rd is called convex. Then, a function f : A Ď Rd Ñ R is
convex if and only if
˜
¸
n
n
ÿ
ÿ
f
λi xi ď
λi f pxi q,
i“1

i“1

for all x1 , ..., xn P A and λ1 , ..., λn P R` with

řn

i“1 λi

“ 1.

If a convex function f is twice diﬀerentiable, then the Hessian matrix of second derivatives
of f , ∇2 f , has all eigenvalues nonnegative. In one dimensional case, this is equivalent to
f 2 ě 0.
However, not all convex function are twice diﬀerentiable or even diﬀerentiable. We actually
know that all convex functions are continuous. In addition, we can show that the one-sided
directional derivatives of a continuous function exits.
Proposition A.2. Let A be a convex set and f : A Ď Rd Ñ R be a convex function. Then,
for all x in the interior of A and all vectors v P Rd , the directional derivative of f at x is
191

A. CONVEX OPTIMIZATION
the direction of v,
∇v f pxq :“ lim

εÑ0`

f px ` εvq ´ f pxq
ε

exits and satisfies f px ` tvq ě f pxq ` t∇v f pxq for all t ě 0. In particular, f is continuous
at all points of A.
In one dimensional case, for a convex functions f the above Proposition implies that the
right and left derivatives, f 1 p¨`q and f 1 p¨´q, exist at all points, and in particular a convex
function is always continuous.
The above proposition has an important implication about the tangent hyperplane to a
convex function.
Corollary A.1. Consider a convex function f and x0 P Rd . Then, there exists some
u P Rd such that the hyperplane y “ f px0 q ` px ´ x0 q ¨ u always lies underneath the surface,
i.e.
f pxq ě f px0 q ` px ´ x0 q ¨ u for all x P Rd .
When f is diﬀerentiable, the linear approximation of f is always under-approximating the
function, i.e.
f pxq ě f px0 q ` px ´ x0 q ¨ ∇f px0 q for all v P Rd .
If a function f is twice diﬀerentiable, the
∇2 f is the matrix which contains all
” Hessian
ı
2
f
second derivatives of the function f , i.e. BxBi Bx
. For twice diﬀerentiable function one
j
dˆd

can provide a criteria for convexity based on the eigenvalues of the Hessian matrix.
Corollary A.2. If all eigenvalues of the Hessian matrix ∇2 f are nonnegative (positive)
at all points, then the function f is convex (resp. strictly convex).
One can also use the Hessian matrix to find the local minimum and maximums of a
function by checking its local convexity and concavity which is given in the following result.
Recall that a point x0 for a diﬀerentiable function is called critical if ∇f px0 q “ 0.
Proposition A.3. A critical point x0 for a diﬀerentiable function f is a local minimum
(resp. maximum) if and only if f is convex (resp. concave) in a neighborhood of x0 .
As a result of the above proposition we have the second order derivative test in multivariate
calculus.
Proposition A.4. A critical point x0 for a second order diﬀerentiable function f is
i) a local minimum if the Hessian ∇2 f px0 q is positive-definite.
ii) a local maximum if the Hessian ∇2 f px0 q is negative-definite.
iii) a saddle point if the Hessian ∇2 f px0 q has both negative and positive eigenvalues.
x2 `y 2
2

.

2
2
´ x `y
2

.

Exercise A.1. Find and categorize all the critical point of the function f px, yq “ xe´
Exercise A.2. Find and categorize all the critical point of the function f px, yq “ xye
192

A. CONVEX OPTIMIZATION

A.2

Convex constrained optimization

Consider a convex function f : D Ď Rn Ñ R where the set D is given by
K “ tx P Rn : gi pxq ď 0 for i “ 1, ..., mu.
We assume that all functions gi for i “ 1, ..., m are convex and therefore the set K is closed
and convex. The primal problem is to minimize f in D, i.e.
min f pxq subject to constraints gi pxq ď 0 for i “ 1, ..., M.
If f is strictly concave, then the optimizer is unique if it exists. Notice that the existence
of the optimizer is subject to nonemptiness of the set D.
An equality constraint can also be described in the above form if the function gi is aﬃne4
and both gi pxq ď 0 and ´gi pxq ď 0. For later analysis, we specify constraint equalities in
the problem separately and define the feasibility set by
K “ tx P Rn : gi pxq ď 0 for i “ 1, ..., m and hj pxq “ 0 for j “, ..., ku.
Notice that since gi s are convex and hj s are aﬃne, K is convex, for any number λ P p0, 1q
and any x, y P K, λx ` p1 ´ λqy P K. Given the convex functions gi for i “ 1, ..., m and
aﬃne functions hj for j “ 1, ..., k, the convex constrained optimization problem is given by
#
gi pxq ď 0
for i “ 1, ..., m
P :“ min f pxq subject to constraints
.
(A.1)
hj pxq “ 0
for j “ 1, ..., k
Function f is called the objective function and the inequalities gi ď 0 and equations hj “ 0
are called constraints. If K ‰ H, the problem is called feasible. if f pxq is strictly convex,
then the minimizer is unique; for any two
minimizers x1 and x2 with minimum
˘
` x distinguished
1
1 `x2
ă 2 pf px1 q ` f px2 qq “ P which contradicts
value P “ f px1 q “ f px2 q, we have f
2
with that x1 and x2 are minimizers.
Duality method is one of the useful approaches to solve the convex optimization problems.
To present the dual problem, we first introduce the Lagrangian
!
)
Lpµ, λq “ minn f pxq ` µ ¨ gpxq ` λ ¨ hpxq .
xPR

Here µ P Rm and gpxq “ pg1 pxq, ..., gm pxqqq, λ P Rk and hpxq “ ph1 pxq, ..., hm pxqqq and ¨ is
the dot product in the proper Euclidean space. Then, the dual problem is given by
D :“
4

max

k
µPRm
` , λPR

Lpµ, λq.

An aﬃne function is a linear function plus a constant; hpxq “ a ¨ x ` b, where a P Rm and b P R.

193

A. CONVEX OPTIMIZATION
Notice that for x P K, Lpµ, λq ď f pxq ` µ ¨ gpxq ` λ ¨ hpxq ď f pxq. Therefore, Lpµ, λq ď
minxPK f pxq and thus, D ď P which is called the weak duality. We can show that under
the following condition that the strong duality holds.
Assumption A.1 (Slater condition). There exist a point x0 such that gi px0 q ă 0 for all
i “ 1, ..., m and hj px0 q “ 0 for all j “ 1, ..., k.
Theorem A.1 (Duality). Let f , gi for i “ 1, ..., n and hj for j “ 1, ..., m are convex
and Slater condition A.1 holds. Then D “ P . In addition, the dual maximizer pµ˚ , λ˚ q P
k
Rm
` ˆ R exists whenever D ą ´8, i.e.
max

k
µPRm
` , λPR

Lpµ, λq “ Lpµ˚ , λ˚ q.

A proof of this theorem can be found in [8, Section 5.3.2]. The following example shows
if Slater condition fail, the strong duality does not necessarily hold.
Example A.2. Take d “ m “ 2, n “ 1 with f px1 , x2 q “ x21 ` x2 , g1 pxq “ x2 , h1 pxq “
x1 ` x2 and h2 pxq “ x1 ´ x2 . Since feasibility set is a singleton; K “ tp0, 0qu, the Slater
condition does not hold. Therefore, P “ f p0, 0q “ 0. On the other hand, Lpµ, λq “ ´8
unless λ “ 0. Specifically, Lpµ, 0q “ minpx1 ,x2 q f px1 , x2 q ` µx2 . Then, we also have
Lpµ, 0q “ min x21 ` min x2 p1 ` µq “ ´8,
x1

x2

since µ ě 0. Therefore, D “ ´8 ă P “ f p0, 0q “ 0.
Remark A.1. Notice that the duality can sometimes hold when the Slater condition does
not hold or when the problem is not even feasible. For instance, if K “ H, since minH “ 8,
P “ 8. On the other hand, for and arbitrary point x0 , let I and J respectively be the set
of all indices i and j such that gi px0 q ą 0 and hj px0 q ‰ 0. Since K “ H, at least one of I
or J is nonempty. Then, choose µ and λ such that µi “ 0 if and only if i R I and λj “ 0
if and only if j R J. Therefore,
Lpµ, λq ď f px0 q ` µ ¨ gpx0 q ` λ ¨ hpx0 q.
By sending µi Ñ `8 for i P I and λj Ñ ˘8 whether hj px0 q is negative/positive, we obtain
that maxµPRm
k Lpµ, λq “ `8.
` , λPR
One of the practical methods of finding the optimal points for primal and dual problem is
through the KKT5 , which provided a necessary condition of optimality. Additionally with
Slater condition, KKT is also suﬃcient.
5

Karush-Kuhn-Tucker

194

A. CONVEX OPTIMIZATION
Theorem A.2 (KKT optimality condition). Assume that f , g and h are diﬀerentiable
k
and x˚ P Rd and pµ˚ , λ˚ q P Rm
` ˆ R are respectively the optimizer of the primal and dual
problems. Then,
Bxℓ f px˚ q ` µ ¨ Bxℓ gpx˚ q ` λ ¨ Bxℓ hpx˚ q “ 0 for ℓ “ 1, ..., n
µ˚i gi px˚ q “ 0 for i “ 1, ..., m.

(A.2)

˚

hj px q “ 0 for j “ 1, ..., k
Condition µ˚i gi px˚ q “ 0 is called the complementary slackness condition. In addition, if
k
the Slater condition A.1 holds and (A.2) is satisfied, then x˚ P Rd and pµ˚ , λ˚ q P Rm
` ˆR
are respectively the optimizer of the primal and dual problems.
Example A.3. We want to find the maximum volume of an open lid box with a fixed
surface area s by solving the constrained maximization problem
max xyz subject to constraints xy ` 2xz ` 2yz “ s.
?
Notice that since the Slater condition holds for x0 “ y0 “ s and Z0 “ 0, the dual problem
and primal problem have the same value. The KKT condition suggest to solve the following
to find candidates for the primal and dual problem.
xy ` 2µpx ` yq “ 0
xz ` µpx ` 2zq “ 0
yz ` µpy ` 2zq “ 0
xy ` 2xz ` 2yz “ s
Solving the above system of equation yields
?
?
3s
3s
˚
˚
˚
˚
and µ “ ´
,
x “ y “ 2z “
3
12
and the maximum volume is

?
s 3s
16 .

Exercise A.3. Find the volume of the largest box under the constraint that the sum of the
diagonals of the three sides sharing a corner equal is to s.
The duality method, while can be used as a computational tool, it can also provide us
with some qualitative results about the optimization problem that we are studying. For
instance, in Section 2.1.6, the dual problem for evaluation of model risk is the problem of
superreplication. In the next sections, we formulate the dual problem for the linear and
quadratic programming.
195

A. CONVEX OPTIMIZATION
Linear programming

Linear optimization is when the objective function f and the constraints are all linear;
for some constants p P Rd , ai P Rd , bi P R for i “ 1, .., m, and cj P Rd and dj P R for
j “ 1, ..., k.
f pxq “ p ¨ x, gi pxq “ ai ¨ x ` bi , and hj pxq “ cj ¨ x ` dj .
Therefore,
#
ai ¨ x ` b i ď 0
P :“ min p ¨ x subject to constraints
cj ¨ x ` dj “ 0

for i “ 1, ..., m
.
for j “ 1, ..., k

(A.3)

Let matrices A and C consist of rows a1 , ..., am and c1 , ..., ck , respectively and set d :“
pd1 , ..., dk q and b :“ pb1 , ..., bm q as column vectors. Then, the linear programming can be
written in the following compact form.
#
Ax ` b ď 0
min p ¨ x subject to constraints
.
Cx ` d “ 0
Each equation cj ¨ x ` dj “ 0 is a hyperplane and each inequality ai ¨ x ` bi ď 0 is a halfspace in the d-dimensional Euclidean space. The feasibility set K can easily be empty, if the
constraints are made by parallel hyperplanes; for example ai x ` bi ď 0 and ai1 x ` bi1 ď 0
with ai “ ´ai1 and bi “ ´bi1 ´ 1. To avoid this situation, we assume that the vectors
a1 , ..., am and c1 , ..., ck are linearly independent in Rd . As a result, m ` k ď d the matrices
A and C are full rank, where A and C are matrices with rows a1 , ..., am and c1 , ..., ck ,
respectively. In addition, we need to assume that the column vector d “ pd1 , ..., dk q is in
the range of ´C and the orthant ty P Rm : y ě bi for i “ 1, ..., mu intersects with the
range of ´A, Cx ` d “ 0 and Ax ` b ď 0 together have a solution for x. and are column
vectors.
The Lagrangian for the linear programming is given by
Lpµ, λq “ min tp ¨ x ` µ ¨ pAx ` bq ` λ ¨ pCx ` dqu .
xPRd

Notice that if pµ, λq are such that pT ` pµ˚ qT A ` pλ˚ qT C ‰ 0 then,
!
)
min ppT ` µT A ` λT Cq ¨ x ` µT b ` λT d “ ´8.
xPRd

Therefore,
#
Lpµ, λq “

´8
µT b ` λT d

pT ` pµ˚ qT A ` pλ˚ qT C ‰ 0
.
pT ` pµ˚ qT A ` pλ˚ qT C “ 0
196

A. CONVEX OPTIMIZATION
Therefore, the dual problem can be written as
D :“ max µT b ` λT d subject to constraints pT ` pµ˚ qT A ` pλ˚ qT C “ 0
µě0,λ

(A.4)

Theorem A.3 (Linear programming duality). Consider the following two linear programming problems (A.3) and (A.4). If either of the problems has an optimal solution, so does
the other one and both problems have the same value, D “ P .
Exercise A.4. Write the dual problem and KKT condition for the standard linear programming equation:
#
xi ď 0
for i “ 1, ..., d
min p ¨ x subject to constraints
.
cj ¨ x ` dj “ 0
for j “ 1, ..., k
Exercise A.5 (Project). Study the following algorithms for the linear programming problem in Exercise 2.1.10. Find a package that has both methods and compare the running
time of each method on the same problem.
a) Simplex method
b) Interior points
Quadratic programming
Consider a positive-definite symmetric6 d-by-d matrix M , ai P Rd , bi P R for i “ 1, .., m,
and cj P Rd and dj P R for j “ 1, ..., k.
1
f pxq “ x ¨ M x, gi pxq “ ai ¨ x ` bi , and hj pxq “ cj ¨ x ` dj .
2
Therefore, the quadratic optimization problem is given by
#
ai ¨ x ` bi ď 0
1
min x ¨ M x subject to constraints
2
cj ¨ x ` dj “ 0

for i “ 1, ..., m
.
for j “ 1, ..., k

The Lagrangian for the linear programming is given by
*
"
1
Lpµ, λq “ min
x ¨ M x ` µ ¨ pAx ` bq ` λ ¨ pCx ` dq .
xPRd 2
6

A matrix A is symmetric if AT “ A and is positive-definite if all its eigenvalues are

197

(A.5)

A. CONVEX OPTIMIZATION
The dual problem for (A.5) is also a quadratic problem; the minimizer for x in the Lagrangian function Lpµ, λq is given by xpµ, λq “ ´M ´1 pAT µ ` C T λq and therefore Lagrangian Lpµ, λq is a quadratic function of µ and λ. Therefore,
1
1
Lpµ, λq “ ´ µ ¨ Ãµ ` µ ¨ b ´ λ ¨ C̃λ ` λ ¨ d,
2
2
where Ã “ AM ´1 AT and C̃ “ CM ´1 C T are indeed nonnegative definite symmetric matrices. The dual problem can now be decoupled into two problems;
"
*
"
*
1
1
max ´ µ ¨ Ãµ ` µ ¨ b and max ´ λ ¨ C̃λ ` λ ¨ d
µě0
λ
2
2
The maximization problem on λ is an unconstrained problem which leads to λ˚ “ C̃ ´1 d
when C̃ is invertible. The maximization problem on µ is, however, a constrained problem.
One way to find the primal and the dual optimal variables X ˚ , µ˚ and λ˚ is through KKT
condition in Theorem (A.2), which is written as
M x˚ ` AT µ˚ ` C T λ˚ “ 0
µ˚i pai x˚ ` bi q “ 0 for i “ 1, ..., m
cj x˚ ` dj “ 0 for j “ 1, ..., k
When the dual maximizer µ˚i ą 0, then by KKT condition the ith constraint must hold
with equality, ai x˚ ` bi “ 0. In this case, we call the constraint an active constraint.
Exercise A.6 (Project). Study the following algorithms for the linear programming problem in Section 1.2. Find a package that has both methods and compare the running time
of each method on the same problem.
a) Active set
b) Interior points
Computational tools for convex optimization problems
The computational methods for convex optimization problems are vast and we do not
intend to study them in this book. Instead, we briefly introduce some of the tools which
you can use to solve optimization problems in finance.
A well-developed convex optimization tool is CVX under MatLab created by Michael Grant
and Stephen Boyd. The academic (noncommercial) version of the toolbox is free and under
a GNU General Public License; it can be used or redistributed but not altered. However,
it works under commercial software MatLab. The home of CVX is http://cvxr.com.
198

B. A REVIEW OF PROBABILITY THEORY
Another convex optimization tool is CVXOPT which is a Python Program created by Martin
Andersen, Joachim Dahl, and Lieven Vandenberghe. The license is also a GNU General
Public License. The home of CVXOPT is https://cvxopt.org.
As a fun fact, Stephen Boyd from Stanford University and Lieven Vandenberghe from
UCLA are the authors of the convex optimization book [8] which has more than 40,000
citations and is widely used as textbook for optimization courses.

B

A review of probability theory

In financial modeling, most uncertainties can eﬀectively bemodeled by probability. Probability was not considered part of mathematics until approximately four hundred years
ago by a series of correspondence between Blaise Pascal (1623–1662) and Pierre de Fermat
(1607–1665). Most of the problems were motivated by observation in gambling and games
of chance.
Example B.1 (Empirical observation). One wins a game of rolling one die if he achieves
at least one six in four trials. In a diﬀerent game, one wins in rolling two dice if he
achieves at least one double six in twenty-four trials. Chevalier de Méré a.k.a. Antoine
Gombaud (1607–1684) wrote to Pascal that these two games must have the same probability
of winning; in the latter, the chance of getting a favorable outcome is a round in six times
less than the former, while the number of trials is six times more. Chevalier de Méré,
however, discovered that the two games are not empirically the same. More specifically,
he observed that the first game has a winning chance of slightly more than 50% while the
second game’s chance is slightly greater than that. Pascal and Fermat discussed the problem
until Fermat eventually solved it. The solution is as follows.
´ ¯4
The chance of losing the first game is 56 . Therefore, the change of
´ ¯4
winning is 1 ´ 56
« 0.5177.The second problem has the change of
´ ¯24
35
winning equal to 1 ´ 36
« 0.4914.
It is astonishing that Chevalier de Méré could empirically distinguish a diﬀerence of 0.0263
between the two chances of winning.
Example B.2 (Problem of points). Three players are playing over a stake. The condition
of winning is that whoever wins a certain number of rounds takes the whole stake. Player
1 needs one more round to win the stake, while players 2 and 3 need two rounds. However,
outside circumstances dictates that they have to suddenly stop playing and agree to divide
the stake according to current situation of the game. Obviously, player 1 deserves a greater
share of the stake than the other two players, who should receive the same share. What is
the fair share of the stake for each player?
199

B. PROBABILITY
The game is over after at most three rounds. Therefore, for each possible outcome of the next three rounds a winner can be decided. For
example, if the outcome of the next three rounds is p2, 3, 1q (player 2
wins, then player 3 wins, and finally player 1 wins), then player 1 is
the winner. There are twenty-seven possible outcomes in the next three
rounds in seventeen of which player 1 wins. Players 2 and 3 each win in
exactly five of the twenty-seven outcomes. Therefore, if all players have
the same chance of winning each round of the game, the stake should
be divided by 17, 5 and 5 between players 1, 2, and 3, respectively.
For about a hundred more years, probability theory continued to be used primarily to
address gambling-related problems, until Jacob Bernoulli (1655–1705), Abraham de Moivre
(1667–1754), and Thomas Bayes (1702–1761) introduced the first limit theorems. Bernoulli
proved that if the probability of heads in tossing a coin is p, then the frequency of heads
in a sequence of n trials converges to p as n Ñ 8. De Moivre showed that the empirical
distribution of the number of heads in n trials converges to a normal distribution.
Law of large numbers. If r is the number of heads in n trials of
tossing a coin with heads probability p, then the probability of that
|p ´ nr | ě ϵ converges to zero as n Ñ 8.
In
tossing a coin with heads probability p, the probability of r heads is given by
`n˘n rtrials ofn´r
p
p1
´
pq
for r “ 0, ..., n. This probability is called the binomial distribution.
r
` ˘
De Moivre-Laplace. In the binomial distribution, nr pr p1´pqn´r „
2

x
?1 e´ 2
2π

holds when as n Ñ 8 and ? r´np

npp1´pq

Ñ x.

The above theorem is an early version of the central limit theorem, which will be presented
later in Theorem B.7 in Section B.4.
Bayes also contributed the concept of conditional probability, which deals with how the
occurrence of a specific event can aﬀect the probabilities of other events. This gave birth to
the concept of conditional probability. Consider the Venn diagram in Figure B.1. Assume
that events A, B, and C have their ex ante probabilities. If we discover that event A has
happened, the ex post probability of A is now equal to 1. Another event B is now restricted
to whatever remains of it inside A, i.e., A X B, and their ex post probabilities are obtained
by rescaling the ex ante probability of A X B by the ex ante probability of A. For example,
the probability of event B given by
ex post probability of A given B “

ex ante probability of A X B
.
ex ante probability of A

In Figure B.1, the ex post probability of C is zero, since the ex ante probability of A X C
is zero.
200

B. PROBABILITY

A

B

C

A∩B

Figure B.1: Given A, the ex post probability of event B is the probability of event B
inside A (A X B) divided by the probability of A.
In the above, we explained how to find the ex post probability in terms of the ex ante
probability. The Bayes formula explains how to obtain the ex ante probability in terms of
the ex post probability. Bayes formula, one of the most influential results in probability,
constructs the foundation of Bayesian statistics. To explain the formula, first we need to
introduce some notations. By PpAq we denote the ex ante probability of event A, and by
PpA|Bq we denote the ex post probability of A given B.
Bayes formula 1.
PpAq “ PpA|BqPpBq ` PpA|B A qPpB A q
If B1 , B2 , ... are mutually exclusive and
PpB1 Y B2 Y ¨ ¨ ¨ q “ 1,
then
PpAq “ PpA|B1 qPpB1 q ` PpA|B2 qPpB2 q ` ¨ ¨ ¨ .
When ex post probabilities of an event A conditional on a certain event B and the ex ante
probability of B are known, one can use Bayes formula to find the ex post probability of
B conditional on A.
Bayes formula 2.
PpB|Aq “

PpA|BqPpBq
PpA|BqPpBq
“
PpAq
PpA|BqPpBq ` PpA|B A qPpB A q

We elaborate on the notion of conditional probability and the Bayes theorem via a famous
example in conditional probability, namely the three prisoners problem.

201

B. PROBABILITY
Example B.3 (Three prisoners problem). Three suspects (Bob, Kevin, and Stuart) are
equally likely to be convicted. However, the judge has made up his mind and is going
to pronounce one and only one of them guilty the following morning. None of the three
prisoners knows who is going to be announced; however, the warden has been told the name
of the guilty by the judge and has been given strict orders not to pass the information to
the prisoners. Stuart argues with the warden that at least one of the other two, Kevin or
Bob, is not guilty. If the warden names one of the other two, Stuart still cannot know
if he himself is guilty or not. The warden counterargues that if he reveals the name of a
nonguilty person, Stuart’s chance of conviction increases from 31 to 12 , because now there
are two prisoners one of whom is going to be guilty. Is the warden correct?
To answer the question, we formulate the problem using conditional probabilities. In
this case, if the warden names Bob as not guilty, then the ex ante probability of Stuart’s
conviction is given by
Ş
ex ante probability of conviction of Stuart Bob named not guilty by the warden
.
ex ante probability of Bob named not guilty by the warden
The ex ante probability of Bob named not guilty by the warden can be calculated using the
Bayes formula. Let’s denote this event by B̃, and let S, K, and B be the events that either
Stuart, Kevin, or Bob, respectively, is announced guilty. By conditional probability, one
needs to calculate
PpS X B̃q
.
PpS|B̃q “
PpB̃q
Since PpS Y K Y Bq “ 1, it follows from the first Bayes formula that
PpB̃q “ PpB̃|SqPpSq ` PpB̃|KqPpKq ` PpB̃|BqPpBq.
Notice that PpKq “ PpBq “ PpSq “
Therefore,

17
3 ,

PpB̃q “

PpB̃|Sq “

1
2,

PpB̃|Kq “ 1, and PpB̃|Bq “ 0.

1 1
1
` `0“ .
6 3
2

On the other hand,
1
PpS X B̃q “ PpB̃|SqPpSq “ .
6
Therefore, PpS|B̃q “

1
6
1
2

“ 31 .

In Example B.3, the revealed information does not change the ex ante probability. This
is, however, a coincidence and not necessarily true. The following exercise addresses this
issue.
7

Here we assume that they are equally likely to be pronounced guilty. One can adjust these probabilities
and solve the problem accordingly.

202

B. PROBABILITY
Exercise B.1. Repeat the solution to Example B.3 with PpKq “ PpSq “
Beware as here is some ambiguity about how to choose PpB̃|Sq!

1
6

and PpBq “ 23 .

Example B.4. In a burglary hearing, there is a probability pG that the suspect is guilty.
In actual fact, the suspect is left-handed. If it is brought before the court that the burglar
is right-handed, the ex post probability that the suspect is guilty vanishes to zero. However,
if the evidence shows that the burglar is left-handed, we need to use the Bayes formula to
find the ex post probability that the suspect is guilty. In this case, let G be the event that
the suspect is guilty and L be the event that the burglar is left-handed that, we assume, has
the same ex ante probability of any individual is left-handed8 . Then,
PpG|Lq “

PpL|GqPpGq
PpGq
“
.
PpLq
PpLq

Notice that PpL|Gq “ 1, because the suspect is left-handed. On the other hand,
PpLq “ PpL|GqPpGq ` PpL|GA qPpGA q “ PpGq ` PpL|GA qPpGA q
Notice that PpGq “ pG , PpGA q “ 1 ´ pG , and PpL|GA q is roughly equal to the percentage of
the left-handed population, denoted by pL . Therefore,
PpG|Lq “

pG
.
pG ` p1 ´ pG qpL

Notice that when PL ă 1, then PpG|Lq ą PpGq “ pG , because pG ` p1 ´ pG qpL ă 1. For
15
. If pL “ 0,
instance, when pL “ .1 and pG “ .15, then the ex post probability PpG|Lq is 23.5
then no one in the population is left-handed except for the suspect, which makes him guilty.
If pL “ 1, then everyone in the population is left-handed, PpG|Lq “ pG , and the event L
does not add to the information we already have.
Exercise B.2. Show that if the ex ante probability of event A is 1, then PpB|Aq “ PpBq.
The notion of conditional probability (the handling of new pieces of information in probability) is one of the most influential tools in applications of probability theory. Most
important applications appear in Bayesian statistics, through which they contribute to all
other areas of science.
We conclude the discussion of early advances in probability theory by mentioning that
these early developments are gathered in Essai philosophique sur les probabilités by PierreSimone Laplace (1749–1827) ([18]). However, the subject still lacked mathematical rigor
compared to other areas of mathematics until a breakthrough happened in the twentieth
century. Andrey Nikolaevich Kolmogorov (1903–1987) initiated the foundation of probability theory through measure theory, a topic in mathematical analysis. We provide a more
8

It is logical to assume that the probability that a burglar is left-handed is the same as any other
individual.

203

B. PROBABILITY
rigorous treatment of probability theory in Section B.2. In the next section, we present
the discrete theory of probability, which does not need measure theory.

B.1

Basic concepts and definitions of discrete probability

A (finite, countably infinite) sample space is a collection of all possible outcomes of a
random experiment. Any subset A of the sample space Ω is called an event.
Example B.5 (Flipping a coin). The sample space is thead, tailu.
Example B.6 (Arrow-Debreu market model in Section 2.1). The sample space can be
chosen to be t1, ..., M u, i.e., the collection of all the possible states of the system.
Example B.7 (T -period binomial model). The sample space of the T -period binomial
model in Section 2.3 can be chosen to be the collection of all T -sequences of the form
pa1 , ..., aT q where each ai is either u or ℓ. Each sample addresses the complete movements
of the asset price over time.
A probability over a finite (countably infinite) sample space Ω “ tω1 , ..., ωM u (Ω “
tω
ř 1 , ω2 , ...u) is a vector π “ pπ1 , ..., πM q π(π “ pπ1 , π2 , ...q) of nonnegative values such that
ωPΩ πi “ 1. For simplicity, we write P pωj q “ πj if no confusion occurs. The collection
of all subsets of Ω determines the set of all events. The probability of an event A Ď Ω is
then defined by
ÿ
PpAq :“
πωi .
ωPA

Evidently, P satisfies
1) PpHq “ 0,
2) PpAA q “ 1 ´ PpAq for all A Ď Ω, and,
3) If tAn uně1 is a sequence of disjoint events, then
˜
¸
ď
ÿ
P
An “
PpAn q.
ně1

ně1

Example B.8 (Flipping a coin). In flipping a fair coin, the probability of either heads or
tails is p “ 12 . In flipping a unfair coin, the probability of heads is p ‰ 12 , and therefore the
probability of tails is 1 ´ p. In two consecutive flips of a fair coin, the probability of having
pH, Hq, pH, T q, pT, Hq, or pT, T q is equally 1{4. If the coin is not fair, then the sample space
is not changed. But the probabilities of these outcomes change to πH “ p and πT “ 1 ´ p
where p P r0, 1s. In two consecutive flips, we have πH,H “ p2 , πH,T “ πT,H “ pp1 ´ pq, and
πT,T “ p1 ´ pq2 .
204

B. PROBABILITY
Example B.9 (Single asset T -period binomial model). In a binomial model with T -periods,
a risk-neutral probability assigns the probability πuk πℓT ´k to an outcome pa1 , ..., aT q in which
k of the entities are u and the T ´ k remaining are ℓ.
A random variable X is a function from sample space to Rd , X : ω P Ω ÞÑ Xpωq P Rd . The
values that X takes with positive probability are called the values of the random variable,
x P Rd such that Ppω : Xpωq “ xq ą 0. To simplify the notation, we often write PpX “ xq
for Ppω : Xpωq “ xq. When the sample space is finite or countably infinite, the random
variables can only take finitely of countably infinitely many values. Random variables with
at most countably infinitely many values are called discrete random variables.
Remark B.1. Notice that the values of a random variable are relative to the choice of
probability measure. For example, a random variable X : t0, 1, 2u Ñ R defined by Xpxq “ x
has values t0, 1, 2u relative to probability Pp0q “ Pp1q “ Pp2q “ 1{3. However, relative to a
new probability Qp0q “ Qp1q “ 1{2 and Qp2q “ 0, the set of values is given by t0, 1u.
Example B.10. Recall from Example B.6 that the sample space for the Arrow-Debreu
market model is the set of states Ω “ t1, ..., M u. Therefore, a random variable is given by
a function X : t1, ..., M u Ñ R. In particular, the payoﬀ of an asset (the price of an asset
at time 1 for each state of the market) in the Arrow-Debreu market model is a random
variable. For instance, the payoﬀ of asset i given in diagram 2.1.1 is a random variable
Pi,¨ : Ω Ñ R such that
Pi,¨ pjq “ Pi,j .
Example B.11 (Bernoulli random variable). Flipping a coin creates a Bernoulli random
variable by assigning values to the outcomes heads and tails. The Bernoulli random variable
X takes the value 1 if the coin turns heads and 0 otherwise. If the coin has a probability
of tails equal to p, then X “ 1 has probability p and X “ 0 has probability 1 ´ p.
Definition B.1. For an event A, the indicator of A is a random variable that takes value
1 if A occurs and 0 otherwise. The indicator of A is denoted by 1A 9 . The indicator random
variable 1A is a Bernoulli random variable that takes value 1 with probability PpAq and
value 0 with probability 1 ´ PpAq.
Example B.12 (Binomial random variable). In flipping a coin n times, the binomial
random variable X takes the value of the number of heads. The set of values of X is
t0, ..., nu. If the coin has a probability of heads equal to p, then for x in the set of values,
the probability X “ x is given by
ˆ ˙
n x
p p1 ´ pqn´x .
x
9

the indicator is also denoted by χA in some literature.

205

B. PROBABILITY
Example B.13 (Random walk). In a game of chance, in each round a player flips a coin.
If it turns tails, he gains $1; otherwise, he loses $1. Technically, each round has an outcome
given by 2X ´ 1 where X is a brand new Bernoulli random variable with outcomes 1 and 0.
The player’s accumulated reward after two rounds is a random variable W2 that take values
´2, 0, and 2 with probabilities 1{4, 1{2, and 1{4, respectively. If the coin has a probability
of heads equal p, then PpW2 “ 2q “ p2 , PpW2 “ ´2q “ p1 ´ pq2 , and PpW2 “ 0q “ 2p1 ´ pqp.
Here, 1 is not among the values of W2 , because PpW2 “ 1q “ 0.
If the player continues this game, the sequence of his accumulated wealth at all times,
W0 , W1 , W2 , ...., is called a random walk. At time t, Wt takes values t´t, ´t ` 2, ..., tu for
t “ 1, ..., T . The probability of Wt “ x is given by
ˆ ˙
t k
t`x
p p1 ´ pqt`1´k with k “
.
k
2
In Example B.13, a proper sample space can be given by
Ω :“ tpa1 , a2 , ...q ai “ H or T for i “ 1, 2, ...u ,

(B.1)

when the game is infinite.
Exercise B.3. In Example B.13, calculate PpW2 “ 2 | W1 “ 1q and PpW3 “ ´1 | W1 “ 1q.
Example B.14 (Negative binomial random variable). In flipping a coin, the negative
binomial random variable X counts the number of heads before r number of tails appear.
The set of values of X is tr, r ` 1, ...u. If the coin has a probability of heads equal to p, then
for x in the set of values, the probability X “ x is given by
ˆ
˙
x`r´1 x
p p1 ´ pqr .
x
Exercise B.4. In Example B.14, find an appropriate sample space and an accurate probability on this sample space.
Example B.15 (T -period binomial model). For the binomial model with T periods, consider the sample space described in Example B.7. Recall from Section 2.3 that in the
binomial model with T periods, the price St of the asset at time t is a random variable that
takes values tS0 uk ℓt´k : k “ 0,`...,
one can say that under risk-neutral
probability,
˘ tu. Thus,
`t˘
t
π
k
t´k
k
t´k
we have P̂ pSt “ S0 u ℓ q “ k pπ̂u q pπ̂ℓ q . This is because exactly k of outcomes in
the sample space lead to St “ S0 uk ℓt´k , and each outcome in the sample space has probat´k
bility pπ̂u qk pπ̂
physical probability, see 2.4.1; the probability of St “ S0 uk ℓt´k
` t ℓ˘q k . Under
changes to k p p1 ´ pqt´k .
Remark B.2 (Random walk as a corner stone of financial models). A binomial model is
related to the random walk in Example B.13 through taking logarithm. If Vt “ lnpSt q then
206

B. PROBABILITY
Vt takes values lnpS0 q ` k lnpuq ` pt ´ kq lnpℓq for k “ 0, ..., t. In other words, Vt is the
position of a generalized random walk after t rounds, starting at lnpS0 q which moves to
lnpuq or lnpℓq in each round, respective to the outcomes of a coin. If S0 “ 1, u “ e and
ℓ “ e´1 , then the random walk Vt is the standard random walk Wt described in Example
B.13. Otherwise, Vt “ lnpS0 q ` µt ` σWt where µ “ lnpuq`lnpℓq
and σ “ lnpuq´lnpℓq
. In other
2
2
words,
St “ S0 exp pµt ` σWt q .
Example B.16. Two random variables representing the payoﬀ of two risky assets in the
Arrow-Debreu market model that also includes a zero bond with yield R “ 0, is shown in
Figure B.2. From Exercise 2.1.4, we know that all risk-neutral probabilities are given by
π̂ “ pt{2, p1 ´ tq{2, p1 ´ tq{2, t{2qT with t P p0, 1q. The conditional probability of X “ y

X
P1,1 = 1

Y
P2,1 = 1

P1,2 = −1

P2,2 = 1

p1 = 0

p2 = 0
P1,3 = 1

P2,3 = −1

P1,4 = −1

P2,4 = −1

Figure B.2: Example B.16
given Y “ x, for x “ ˘1 and y “ ˘1, is found below.
PpX “ 1&Y “ 1q
π̂1
“
“t
PpY “ 1q
π̂1 ` π̂2
PpX “ ´1&Y “ 1q
π̂2
PpX “ ´1|Y “ 1q “
“
“1´t
PpY “ 1q
π̂1 ` π̂2
PpX “ 1&Y “ ´1q
π̂3
PpX “ 1|Y “ ´1q “
“
“1´t
PpY “ ´1q
π̂3 ` π̂4
PpX “ ´1&Y “ ´1q
π̂4
PpX “ ´1|Y “ ´1q “
“
“t
PpY “ ´1q
π̂3 ` π̂4
PpX “ 1|Y “ 1q “

(B.2)

Independence
Recall that the conditional probability of event B given that event A has occurred is defined
by
PpA X Bq
PpB | Aq :“
.
PpAq
207

B. PROBABILITY
The conditional probability gives birth to the important notion of independence. Two
events A and B are called independent if
PpB | Aq “ PpBq,
or equivalently
PpA | Bq “ PpAq.
It is easier to write independence as
PpB X Aq “ PpAqPpBq.
Two random variables X and Y are called independent if each event related to X is independent of each event related to Y , i.e.
For all x in values of X and all y is values of Y , we have
PpX “ x, Y “ yq “ PpX “ xqPpY “ yq.
Exercise B.5. Show that two events A and B are independent if and only if the indicator
random variables 1A and 1B are independent.
In modeling random experiments, independence is a common-sense knowledge or an assumption inside a model. For example in a random walk, the outcomes of two diﬀerent
rounds are assumed independent, because of the belief that two flips of a coin are independent trials. As a result, two random variables W5 and W8 ´ W5 are independent.
Exercise B.6. Show that in a random walk, W5 and W8 ´ W5 are independent provided
that the outcome of each round is independent of other rounds.
Defining independence for more than two events (equivalently random variables) is a little
tricky. We call X independent of the sequence of random variables X1 , X2 , ..., Xn if
PpX “ x, X1 “ x1 , X2 “ x2 , ..., Xn “ xn q “ PpX “ xqPpX1 “ x1 , X2 “ x2 , ..., Xn “ xn q.
This indicates that any event related to the values of X is independent of any event related
to the values of X1 , X2 , ..., Xn , i.e.
PpX P A, pX1 , X2 , ..., Xn q P Bq “ PpX P AqPppX1 , X2 , ..., Xn q P Bq.
A finite sequence X1 , X2 , ..., Xn is called independent sequence of random variables if for
each i, Xi and tXj : j‰iu are independent.
As observed in the following exercise, to show the independence of a sequence of random
variables, it is not enough to check that each pair of random variables Xi and Xj are
independent.
208

B. PROBABILITY
Exercise B.7. In two consecutive flips of a fair coin, let A be the event that the first flip
turns heads, B be the event that the second flip turns heads and C be the event that only
one of the flips turns heads. Show that A, B, and C are not an independent sequence of
random variables, but they are pairwise independent.
An equivalent definition of independence of a sequence of random variables is as follows.
A finite sequence X1 , X2 , ..., Xn is called independent if for all subsets A1 , ..., An of values
of X1 , ..., Xn , respectively, we have
PpX1 P A1 , ..., Xn P An q “ PpX1 P A1 q...PpXn P An q.

(B.3)

This can also be extended to an infinite sequence of random variables. An infinite sequence
X1 , X2 , ... is called independent if each finite subset tXi1 , ..., Xin u makes an independent
sequence. Having defined the notion of independence for a sequence of random variables,
we can now properly define a random walk, as the previous definition in Example B.13 is
more heuristic than rigorous.
Definition B.2. Let ξ1 , ξ2 , ... be a sequence of independent and identically distributed
(i.i.d.) random variables such that Ppξi “ 1q “ p and Ppξi “ ´1q “ 1 ´ p for some
p P p0, 1q. For x P Z, the sequence W0 “ x, W1 , W2 , ... with
Wn :“ x `

n
ÿ

ξi for n ě 1,

i“1

is called a random walk. When p “ 12 , we call it a symmetric random walk; otherwise, it
is called a biased random walk.
Let X be a random variable on a discrete sample space Ω with probability vector πpωq
for each ω P Ω. Then, the expectation or expected value of X is defined by
ÿ
Xpωqπpωq.
(B.4)
ErXs :“
ωPΩ

If a random variable X takes values x1 , x2 , ... with probabilities p1 , p2 , ..., respectively, then
the expectation of X can equivalently be given by
ErXs :“

8
ÿ

xi pi .

i“1

In particular, if values of X are finitely many x1 , x2 , ..., xn with probabilities p1 , p2 , ..., pn ,
respectively, then the expectation of X is equivalently given by
ErXs :“

n
ÿ
i“1

209

xi pi .

(B.5)

B. PROBABILITY
The advantage of (B.5) over (B.4) is that a sample space can be very large while the random
variable only takes small number of values. For example, in Example B.9, a single-asset
T -period binomial model generates a sample space of all paths of the asset price of size 2T ,
while the values of random variable St are only T ` 1.
By straightforward calculations, the expectation of a function f pxq of X is given by
Erf pXqs “

8
ÿ

f pxi qpi .

i“1

The variance of a random variable is defined by
varpXq :“ ErpX ´ ErXsq2 s “ ErX 2 s ´ ErXs2 .
One of the important result in the expectation of random variables is the Jensen inequality
for convex functions.
Corollary B.1. Consider a probability space pΩ, F, Pq that hosts a Rd -valued random
variable X and let f : Rd Ñ R be convex function f . Then, we have
f pErXsq ď Erf pXqs,
provided that both of the expectations exist.
Proof. By Corollary A.1, there exists a vector u P Rd such that f pErXsq ` pX ´ ErXsq ¨ u ď
f pXq. By taking the expected value from both sides, we obtain the desired result.
The Jensen inequality is reduced to the definition of convexity (A.2) when X is a random
variable with two values x1 and x2 . More precisely, if PpX “ x1 q “ λ and PpX “ x2 q “ 1´λ,
we have
f pErXsq “ f pλx1 ` p1 ´ λx2 qq ď λf px1 q ` p1 ´ λqf px2 q “ Erf pXqs.
Let Y be another random variable with values y1 , ..., ym . To write the expectation of a
function f px, yq of two random variables X and Y , we need to know the joint (mutual)
probabilities of the pair pX, Y q, i.e.,
pi,j :“ PpX “ xi , Y “ yj q for i “ 1, ..., n,

and j “ 1, ..., m.

Notice that although PpX “ xi q and PpY “ yj q are positive, pi,j can be zero, which means
that if a value xi is realized for the random variable X, then yj cannot be realized for Y ,
and vice versa. Then, we define the expected value of f pX, Y q by
Erf pX, Y qs :“

8 ÿ
8
ÿ
i“1 j“1

210

f pxi , yj qpi,j .

B. PROBABILITY
With the above definition, one show the Cauchy-Schwartz inequality.
Theorem B.1. For two random variables X and Y we have
a
a
ErXY s ď ErX 2 s ErY 2 s.
The equality holds if and only if X and Y are linearly dependent, i.e., if aX ` bY ` c “ 0
for some constants a, b, c P R such that at least one of them is nonzero.
The covariance between two random variables is defined by
covpX, Y q :“ ErpX ´ ErXsqpY ´ ErY sqs “ ErXY s ´ ErXsErY s.
By applying the Cauchy-Schwartz inequality, we obtain
a
a
covpX, Y q “ ErpX ´ ErXsqpY ´ ErY sqs ď ErpX ´ ErXsq2 s ErpY ´ ErY sq2 s.
In the above, the equality holds if and only if X and Y are linearly dependent. The
correlation between two random variables is defined by
covpX, Y q
corpX, Y q :“ a
.
varpxqvarpY q
The Cauchy-Schwartz inequality shows that ´1 ď corpX, Y q ď 1, and either of the equalities holds if and only if if aX ` bY ` c “ 0 for some constants a, b, c P R such that at least
one of them is nonzero. In the case of equality, when ab ă 0 (respectively ab ą 0), then
corpX, Y q “ 1 (respectively corpX, Y q “ ´1).
We can define conditional expectation similarly by replacing the probabilities pi,j with
the conditional probabilities
pi|j :“ PpX “ xi | Y “ yj q “

pi,j
,
pYj

with pYj “ PpY “ yj q. More precisely,
Erf pX, Y q | Y “ yj s :“

8
ÿ

f pxi , yj qpi|j “

i“1

8
1 ÿ
f pxi , yj qpi,j .
pYj i“1

(B.6)

Notice that if PpY “ yq “ 0, then Erf pX, Y q | Y “ ys in (B.6) is not defined. However, we
can define function h : y ÞÑ Erf pX, Y q | Y “ ys on the set of values of the random variable
Y . This in particular helps us to define the random variable
Erf pX, Y q | Y s :“ hpY q.

211

B. PROBABILITY
Remark B.3. Notice the diﬀerence between Erf pX, Y q | Y “ yj s, Erf pX, Y q | Y “ ys,
and Erf pX, Y q | Y s. Erf pX, Y q | Y “ yj s is a real number, Erf pX, Y q | Y “ ys is a real
function on variable y, and finally Erf pX, Y q | Y s is a random variable.
Example B.17. With regard to the above remark, we find PpX “ 1|Y q, PpX “ ´1|Y q,
and ErX|Y s in Example B.16. It follows from (B.2) that hpyq “ PpX “ 1|Y “ yq is given
by
#
t
when y “ 1
hpyq “
1 ´ t when y “ ´1
Thus, PpX “ 1|Y q “ tδ1 pY q ` p1 ´ tqδ´1 pY q. Here, δx pyq is 1 when y “ x and 0 otherwise.
Similarly, PpX “ ´1|Y q “ p1 ´ tqδ1 pY q ` tδ´1 pY q. Finally,
ErX|Y s “ PpX “ 1|Y q ´ PpX “ ´1|Y q “ tδ1 pY q ` p1 ´ tqδ´1 pY q ´ p1 ´ tqδ1 pY q ´ tδ´1 pY q
“ p2t ´ 1qδ1 pY q ` p1 ´ 2tqδ´1 pY q.
As a particular case, when f px, yq “ x, we have
hpyq “ ErX | Y “ ys

and

ErX | Y s “ hpY q.

Corollary B.2. If X and Y are random variables and f is a real function, then we have
Erf pY qX | Y s “ f pY qErX | Y s.
The following proposition, which is a direct result of (B.6), explains a very important
property of independent random variables.
Proposition B.1. X and Y are independent if and only if, for any real function f px, yq
of X and Y , we have
Erf pX, Y q | Y “ ys “ Erf pX, yqs for all y in the set of values of Y.
Corollary B.3. If X and Y are independent and f is a real function, then we have
Erf pXq | Y s “ Erf pXqs.
One of the important properties of conditional expectation is the tower property, which
is presented in the next proposition.
Proposition B.2 (Tower property of conditional expectation). Let X, Y and Z be random
variables. Then,
ErErX | Y, Zs | Y s “ ErX | Y s.
In particular,
ErErX | Y ss “ ErXs.
212

B. PROBABILITY
The following proposition provides an equivalent representation for independence through
the conditional expectation.

B.2

General probability spaces

Some random experiments can generate uncountable number of outcomes, e.g., choosing
a point in the unit interval r0, 1s or choosing a chord of a unit circle. In such cases, the
definitions in Section B.1 don’t make sense; e.g., the summation in (B.4) relies on the
countability of the sample space. The complexity of uncountable sample spaces is twofold.
First, the basic definitions, such as the expected value in (B.4), use summation, which
relies on countability of values. In Section B.2, we will consider the continuous random
variables in which the summations can be replaced by an integral, such as Example B.18.
Secondly, there is mathematical challenge in defining an event in an uncountable sample
space, which we will describe later in this section.
Example B.18. In choosing a random number uniformly inside r0, 1s, the probability of
the following events can be calculated by integration.
şb
i) The probability that the random number is in pa, bq Ď r0, 1s equals a f pxqdx “ b ´
a. Here f pxq “ 1r0,1s pxq is called the uniform probability density function. This
probability is the area enclosed by f pxq and x axis above interval pa, bq
ii) The probability that the random number is .5 equals 0 as the area described in (i) is
zero.
iii) The probability that the random number is a rational number is 0. Rational numbers
are countable so the probability of this event is sum of the probability of each rational
number, which is summation of countable number of zeros.
iv) The probability that the random number is an irrational number is 1. This probability
is the complement of the probability of rationals, which is 0.
The random experiment in the above example is describing a continuous random variable. In such random variables, the probability of events and expected values of random
variables can be calculated by integration. However, in general, there can be random
variables that are neither continuous nor discrete. In that case, concepts such as expectation and conditional expectation should be defined diﬀerently; they requires advanced
techniques from measure theory. Measure theory was gradually developed as a theory for
integration by several mathematicians such as Émile Borel (1871–1956), Henri Lebesgue
(1875–1941), Johann Radon (1887–1956), and Maurice Fréchet (1878–1973). However, Andrey Kolmogorov (1903–1987) was the first who noticed that this theory can be used as a
foundation for probability theory; a probability is a nonnegative finite measure (normalized
to mass one) and the expectation is an integral with respect to that measure.
213

B. PROBABILITY

≡

2πr

ω7→ei2πr ω
−−−−−−−−−→
2πr

Figure B.3: Description of the transformations in Example B.19
Another diﬃculty that arises in uncountable sample spaces is the meaning of an event. In
discrete space, any subset of the sample space is an event and any function from sample
space to Rd is a random variable. However, in uncountable sample spaces, there are some
subsets of the sample space for which no value as a probability can be assigned. Therefore,
an event and a random variable should be defined in a proper way by using the concept of
measurability; only measurable sets are events, and measurable real functions make random
variables. For more extensive study on the concept of probability measures and measurable
functions see [1] or [4]. Here, we address the issue briefly. First, we provide an example to
show how a nonmeasurable set looks like.
Example B.19 (A nonmeasurable set exists). Consider Ω “ r0, 1q, identified
? by a unit
i2πω
circle through the transformation ω ÞÑ e
shown in Figure B.3. Here, i “ ´1. Now,
for any rational number r in r0, 1q, consider the rotational transformation on the circle
given by ei2πr : x “ ei2πω ÞÑ ei2πr x. If we consider the uniform probability on Ω “ r0, 1q,
the induced probability on the circle is also uniform. The uniform probability on the circle
is invariant under rotations;
PpBq “ Ppei2πr Bq for any subset B on the circle.
For x “ ei2πω , define the orbit of x by Opxq :“ txei2πr : r P Q X r0, 1qu. Since Opxq
is countable and the unit circle is uncountable, there are uncountably many disjoint orbits
with a union equal to the unit circle. Let A be a set that has exactly one point from each
distinct orbit. Then, one can see that the countable disjoint union
ď
ei2πr pAq
rPQXr0,1q

covers the unit circle. Here, ei2πr pAq means the image of A under the rotational transfor1
mation ei2πr . This is because: (1) If x P ei2πr pAq X ei2πr pAq for 0 ď r ă r1 ă 1 rationals ,
1
we have then both ei2πp1´rq x10 and ei2πp1´r q x belonging to A and being members of Opxq,
10

If y “ ei2πr x, then x “ ye´i2πr . But, since ´r is not in r0, 1q and 1 “ ei2π , we can write x “ yei2πp1´rq .

214

B. PROBABILITY
which contradicts the choice of A; and (2) For each x, there is a member y P Opxq P A; there
exists a rational r such that y “ ei2πr x. Thus, x “ ei2πp1´rq y P ei2πp1´rq pAq. Therefore, we
have
¨
˛
ď
ÿ
`
˘
P˝
ei2πr pAq‚ “
P ei2πr pAq .
rPQXr0,1q

rPQXr0,1q

It follows from the invariance of uniform probability under rotation that the probability of
A is the same as the probability of ei2πr pAq for all r P Q X r0, 1q, if such a probability exists.
¨
˛
ď
ÿ
P˝
ei2πr pAq‚ “
P pAq .
rPQXr0,1q

rPQXr0,1q

Now
if A has probability 0 under uniform measure, then so does
union
Ť
Ť the countable
i2πr
i2πr
pAq, which is a contradiction, because the union rPQXr0,1q e
pAq makes
rPQXr0,1q e
up the whole circle, which has probability 1. Otherwise, if A has a nonzero probability, then
the sum on the left-hand side is infinite. Either way, it is impossible to assign a probability
to A; A is nonmeasurable.
Uncountable sample spaces appear in probability even when the experiment is a discrete
one. For instance, consider the following version of the law of large numbers:
Theorem B.2 (Law of Large Numbers). Let tXn u8
n“1 be a sequence of independent random
variables that take values 0 or 1 with equal likelihood. Then,
8
1
1 ÿ
Xn “
N Ñ8 N
2
n“1

lim

except on a set of outcomes with probability zero.
In this theorem, we consider a sample space Ωthat consists of all sequences ω “ pω1 , ...q
such that ωn “ H or T based on the outcome of the nth coin flip. The random variable
Xn is defined by 1 if ωn “ H and 0 if ωn “ T . This sample space is uncountable! To see
this, we construct a map which takes it into the interval r0, 1q:
ω ÞÑ

8
ÿ
Xn
.
2n
n“1

The right-hand-side above is the binary representation of a number in r0, 1q. Therefore,
the sample space Ω is uncountable and not significantly diﬀerent from r0, 1q.
Remark B.4. Notice that
numbers can have two diﬀerent binary representations.
ř some
1
For example, .5 “ 12 “ 8
.
However, the even in Ω that corresponds to all these
n“2 2n
numbers has probability zero.
215

B. PROBABILITY
σ-field of events
One of the important notions in the probability theory is dealing with the definition of an
event, a random variable, and the information related to them, which is presented in the
following definition.
Definition B.3 (σ-field). For a (possibly uncountable) sample space Ω, the set of events
should use the notion of σ-field from measure theory. A σ-field F is a collection of subsets
of Ω that satisfies
a) H and Ω P F.
b) If A P F, then AA P F.
c) For a sequence tAn u8
n“0 Ď F,

Ť8

n“0 An

P F.

A sample space Ω along with a σ-field is called a measurable space.
Usually, a σ-field can be specified by defining a set of elementary events and expanding
this set to a whole σ-field, which contains all events. For instance, in a discrete sample
space Ω “ tω1 , ω2 , ...u, one can define the elementary events to be En “ tωn u. Then, any
event is a countable union of elementary events.
In uncountable sample spaces, the methodology of working with elementary events is
inevitable. We consider a set of elementary events tEn : n ě 1u and construct the
smallest σ-field that contains all these elementary events, namely the σ-field generated by
elementary sets tEn : n ě 1u denoted by σpEn : n ě 1q.
Example B.20. Consider Ω “ R and the elementary events given by the singleton sets
En :“ txn u for n “ 1, 2, .... Then, by property (b) the complement of singleton elementary
events, EnA “ Rztxn u is in the σ-field generated by En s. Also, any finite or countable
number of xn s and the complement of it make events in this σ-field. For instance, the
σ-field generated by t1u is
!
)
H, R, t1u, Rzt1u .
The σ-field generated by t1u and t2u is
!
)
H, R, t1u, t2u, t1, 2u, Rzt1u, Rzt2u, Rzt1, 2u .
Example B.21. The σ-field generated by a single event, A has four distinct events: H,
Ω, A, and AA . For example, the σ-field generated by the set of all rational numbers in R
consist of H, R, the set of rational numbers, and the set of irrational numbers.
In the discrete example from the last paragraph, the σ-field is the same as the set of all
subsets of Ω. In Chapter 2, the sample space is Ω “ pRd`1 qT . We consider each elementary
216

B. PROBABILITY
event given by an open set in pRd`1 qT . Then, we work with the Borel σ-field BpΩq, the
σ-field generated by all open subsets of Ω. This method can be generalized to all samples
spaces that are topological spaces. The Borel σ-field in R, BpRq, is generated by the set of
all open intervals pa, bq. It is not hard to see that all intervals, closed or semi-closed, are
also included in the Borel σ-field. For instance,
č´
1¯
pa, bs “
a, b `
.
n
ně1
Ť
Also, all single points are in the Borel σ-field; tbu “ ně1 rb, b ` n1 q. Also, BpRq can be
generated by half-open intervals of the form pa, bs, because
pa, bq “

8 ´
ď
1ı
a, b ´
.
n
n“1

Exercise B.8. Show that BpRq can be generated by half-open intervals of the form ra, bq.
Exercise B.9. Check whether the following sets make a σ-field. In case they are not a
σ-field, find the missing events that makes them a σ-field.
␣
(
i) R, tau, tbu, ta, bu, Rztbu, Rztau where a and b are two distinct real numbers.
␣
(
ii) H, r0, 1s, r0, 23 q, p 13 , 1s .
␣
(
iii) H, R .
The Borel σ-field on r0, 1s, Bpr0, 1sq, is the σ-field generated by the intervals of the form
pa, bq, r0, bq, or pa, 1s, where 0 ď a ă b ď 1. Equivalently, Bpr0, 1sq is generated by the
half-open intervals of the form ra, bq or pa, bs.
Example B.22. The Borel σfield Bpr0, 1sq can be generated by either of the following
elementary events:
i) The set of intervals of the form pa, bq, r0, bq, or pa, 1s, where 0 ď a ă b ď 1,
ii) The set of intervals of the form ra, bq or pa, bs, where 0 ď a ă b ď 1, and
iii) The set of intervals of the form ra, bs, where 0 ď a ă b ď 1.
To show this, we need to demonstrate that each elementary event of one set can be generated
by the elementary events from the other sets. In the set of elementary events in (i), the
interval pa, bq can be written as
pa, bq “

8 ´
ď
1ı
a, b ´
.
n
n“1

217

B. PROBABILITY
Therefore, pa, bq can be generated by the events that are described in (ii). r0, bq and pa, 1s
already belong to the set that are described in (ii). Therefore, all elementary events in (i)
can be generated by elementary events in (ii).
In addition, we have
ra, bq “

8 ”
8 ”
ď
ď
1ı
1 ı
a, b ´
and pa, bs “
a ` ,b ,
n
n
n“1
n“1

which implies that all elementary events in (ii) can be generated by elementary events in
(iii).
Finally, we have
ra, bs “

8 ´
8 ´
8 ”
č
č
č
1
1¯
1 ı
1¯
a ´ ,b `
, pa, 1s “
a ´ , 1 , and r0, bq “
0, b `
.
n
n
n
n
n“1
n“1
n“1

Therefore, all elementary events in (iii) can be generated by elementary events in (i).
The Borel σ-field on the half-line r0, 8q, Bpr0, 8qq, is the σ-field generated by the sets of
the form pa, bq or r0, bq, where 0 ď a ă b.
Exercise B.10. Show that Bpr0, 8qq can be generated by either of the following elementary
events:
i) The set of intervals of the form pa, bq or r0, bq, where 0 ď a ă b ă 8, and
ii) The set of intervals of the form ra, bq, where 0 ď a ă b ă 8.
Hint: Show that each elementary event of one set can be generated by the elementary events
from the other set.
The following example is a useful use of elementary events in analyzing an event of interest
and a method of finding the probability of such an event.
Example B.23. In Example B.13, let the event of ruin A be the collection of all outcomes
for which the gambler’s wealth eventually hits zero. For instance, if W0 “ 10, any outcome
with ten loses in a row since the start of the game is in this set. Also, any outcome with the
number of losses at some time larger than the number of wins plus ten is in the ruin event
A. The ruin event is uncountable. We attempt to find the probability of this event later in
Example B.25, namely the ruin probability. Before that, we need to write this event as a
union of disjoint simpler events for which the probability can easily be evaluated.
8
ď
A “ ¨ An ,
n“1

218

B. PROBABILITY
where An is the event that the ruin happens exactly at the nth round. Notice that An is
made of all outcomes such that (1) the nth round is a lost round, (2) in the first n ´ 1st
rounds there are x ´ 1 lost rounds more than the number of wins. Therefore, if m is the
number of won rounds in the n ´ 1st rounds, we must have 2m ` x ´ 1 “ n ´ 1, or m “ n´x
2 .
As a result, An is a nonempty event if and only if n ´ x is an even number. Therefore, one
can write
8
ď
A “ ¨ Ax`2m .
m“1

Exercise B.11. Recall the sample space given by (B.1) for a random walk. Show that in
Example B.23 the event of ruin is uncountable.
Many complicated sets can be found in the Borel σ-field. For more discussion of Borel
sets, see [3, Chapter 7]. However, in most cases, it is enough to work with the elementary
events that build the σ-field.
Probability via measure theory
Given a σ-field of events, we can define a probability measure in the most general form.
Definition B.4. A measure space is a pΩ, Fq such that Ω is a sample space and F is a
σ-field on Ω. A measure on a measure space pΩ, Fq is a function from P : F Ñ R Y t8u
such that for any sequence tAn u8
n“0 Ď F of disjoint events,
˜
¸
8
8
ď
ÿ
P
An “
PpAn q.
n“0

n“0

A probability measure is a measure with the following properties.
a) For any A P F then PpAq ě 0.
b) PpΩq “ 1.
Notice that the above definition leads to many important properties of the probability:
a) PpAA q ` PpAq “ PpAA Y Aq “ PpΩq “ 1. Therefore, PpAA q “ 1 ´ PpAq.
b) PpHq “ 1 ´ PpΩq “ 0.
c) Continuity of probability. For any shrinking sequence of events A1 Ě A2 Ě ¨ ¨ ¨ ,
we have
˜
¸
8
č
lim PpAn q “
An
nÑ8

n“0

Exercise B.12. Show (c) in the above.
219

B. PROBABILITY
Triple pΩ, F, Pq is called a probability space. To define any other measure P on a measurable space pΩ, Fq, it is suﬃcient to define it on the elementary sets that generate the
σ-field F. For example, to define a uniform probability measure on r0, 1s on the Borel
σ-field Bpr0, 1sq, one only needs to define
Pppa, bqq “ b ´ a,

for pa, bq P r0, 1s.

Since probability of singleton is zero, we have
Ppr0, bqq “ Ppt0uq ` Ppp0, bqq “ 0 ` b.
Similarly, Pppa, 1sq “ 1 ´ a.
Here is a more complicated example. The random variable in this example is not discrete
or continuous.
Example B.24. We choose a random number in r0, 1s in the following way. We flip a fair
coin. If the?coin lands heads, we choose a number uniformly in r0, 1s. If the coin lands tails,
we choose 2{2. We define the corresponding probability measure on Bpr0, 1sq by defining
it only on the elementary events:
#
?
1
pb
´
aq
if
2{2 R pa, bq P r0, 1s
?
.
Pppa, bqq “ 21
1
pb
´
aq
`
if
2{2
P
pa,
bq
P
r0,
1s
2
2
Notice that although the above probability is only
? defined on open
?one can find
`?intervals,
˘
probability of other events. For instance, Ppt 2{2uq “ limnÑ8
2{2 ´ n1 , 2{2 ` n1 “
2
1
1
n ` 2 “ 2.
Example B.25. In this example, we follow up on the probability of ruin in Example B.23.
Recall that the event of ruin is represented as the union of disjoint events:
8
ď
A “ ¨ Ax`2m .
m“0

Therefore, by the definition of probability
PpAq “

8
ÿ

PpAx`2m q.

m“0

If the chance of winning any round is p, then
ˆ
˙
x ` 2m ´ 1 m
PpAx`2m q “
p p1 ´ pqx`m .
m
220

B. PROBABILITY
Therefore,
˙
8 ˆ
ÿ
x ` 2m ´ 1 m
PpAq “
p p1 ´ pqx`m .
m
m“0
The above probability is not easy to calculate in this series form, and it is easier to find it
by using a conditioning technique.
Example B.26. In an infinite sequence of coin flips, we consider Ω to be the set of all
sequences pω1 , ω2 , ¨ ¨ ¨ q such that ωi “ H or T for n ě 1. A σ-field can be defined by
specifying some elementary events. For a finite sequence n1 , ...nm of positive integers, an
elementary event En1 ,...nm is defined to be the set of all pω1 , ω2 , ¨ ¨ ¨ q such that ωnj “ H
for j “ 1, ..., m. Then, on the σ-field generated
` ˘mby a fair coin, we have the corresponding
probability measure given by PpEn1 ,...nm q “ 21 . For an unfair coin with the probability
of heads given by p, we have a diﬀerent probability measure QpEn1 ,...nm q “ pm . Based on
the assignment of probability , we can determine the probability of all events in the σ-field
generated by the elementary events. For instance, let Em,´n be the event that the nth flip
is heads and the mth flip is tails. Then,
Em “ Em,n Y Em,´n .
Notice that Em,n and Em,´n are disjoint events. Thus, PpEm,n1 q “ 21 ´ 14 “ 14 . For an
unfair coin, we have QpEm,n1 q “ p ´ p2 “ pp1 ´ pq. Recalling the notion of independence
from (B.3), one can see that for n‰m, En and Em are independent events, under both
measures P and Q. More precisely, since En X Em “ Em,n , we have
PpEm,n q “

1
“ PpEm qPpEn q and QpEm,n q “ p2 “ QpEm qQpEn q.
4

Generally speaking, En1 X ¨ ¨ ¨ X Enm “ En1 ,...,nm , and therefore the σ-field generated by the
sequence tEn : n ě 1u is the same as the σ-field generated by the elementary sets of the
form En1 ,...,nm .
Recall that mapping
8
ÿ
an
ω “ pω1 , ω2 , ¨ ¨ ¨ q ÞÑ
2n
n“1
with an “ 1 when ωn “ H and an “ 0 when ωn “ T maps Ω to r0, 1s. Under this mapping,
the elementary event En is mapped to
n´1
2ď
”

i“0

2i ` 1 2i ` 2 ¯
,
.
2n
2n

Although tedious, one can find the exact intervals that make the image of En1 ,...nm under
this mapping and then use it to verify that the σ-field generated by these events is exactly
221

B. PROBABILITY
the Borel σ-field Bpr0, 1sq. The following theorem is a helpful tool in that regard.
¯
”
Exercise B.13. Show that any interval of the form 2kn1 , 2kn2 with 0 ď k1 ă k2 ď 2n can
be written by a combination of a finite union, intersection and complement of the sets that
are image of the elementary events of the form En under the mapping described in Example
B.26. Use this to show that the σ-field generated by the elementary events of the form En
correspond to the Borel σ-field Bpr0, 1sq.
Given a probability measure P, the events that have a probability of 0 under P are called
null events. For instance, in choosing a point uniformly in r0, 1q, the probability of any
single point is 0; therefore, the singleton
txu is a null event. In Example B.24, the only
␣ ?2 (
singleton that is not a null event is 2 . The set of all rational numbers is a null event in
both cases. In Example B.26, one can show that an event of a particular pattern appearing
periodically along a sequence of coin flips is a null event. For instance, the event of the
pattern THH appearing periodically along a sequence of coin flips is a null event.
Exercise B.14. Show that the event of all outcomes that have the pattern THH (or any
other particular pattern) appearing periodically along a sequence of coin flips is a null event.
Use the same idea to extend the result: the event of all outcomes that have a periodic pattern
is a null event. (Hint: the set of all patterns is a countable set.)
Random variables
In this section, we explain the definition of a random variable. Random variables represent
random quantities that are related to a random experiment. For example, in Example
B.13, the value Wn of a random walk at time n is a random variable.
Definition B.5. A random variable on a measure space pΩ, Fq is a function X : Ω Ñ Rd
such that for any Borel set A P BpRd q, the inverse image of A under X, X ´1 pAq, belongs
to the set of events F.
In the sequel, we denote the inverse image of A under X, X ´1 pAq, by tX P Au. Since
BpRd q is generated by open sets in Rd , the condition “@A P BpRd q, tX P Au P F” in
Definition B.5 needs to hold only for all open sets instead of all Borel sets; A P BpRd q
for all open sets A Ď Rd . If Ω “ Rd and F “ BpRd q, a random variable is called a
Borel-measurable function.
In practice, important random quantities are described by random variables. See the
example below.
Example B.27. In an infinite sequence of coin flips, Example B.26, we define the random
variable X as follows. For ω “ pω1 , ω2 , ¨ ¨ ¨ q P Ω
Xpωq “

8
ÿ
an
3n
n“1

222

B. PROBABILITY
ř
an
such that an “ 0 if ωn “ H, and an “ 2 if ωn “ T. Here, 8
n“1 3n “ 0.a1 a2 ¨ ¨ ¨ is the
ternary representation of a number in r0, 1s. X maps Ω to r0, 1s. To check if X is a random
variable, we need to check that the inverse of an open interval is in the σ-field generated by
the elementary sets An1 ,...nm described in Example B.26. We leave this task to the following
exercise.
Remark B.5. The image of X in Example B.27 is called a Cantor set.
Exercise B.15. Show that the mapping X defined in Example B.27 is a random variable.
Hint: Assume a ternary representation for the endpoints of the interval pa, bq.
Let X be a random variable. The σ-field generated by X is the smallest σ-field that
contains all events tX P Au for all Borel sets A, and is denoted by σpXq. In other words,
it is the σpXq that contains all events related to X. σpXq can equivalently be expressed
as the smallest σ-field that contains all events tX P Au for all open sets A.
Independence
It is possible to define the notion of independence for two random variables X and Y by
using the inverse images tX P Au and tY P Bu.
Definition B.6. A sequence of random variables tXn : n ě 1u are called independent if for
any sequence of Borel sets tAn : n ě 1u Ď BpRq, the sequence of events tXn´1 pAn q : n ě 1u
are independent.
In particular, two random variables X and Y are called independent if for any two Borel
sets A and B, tX P Au and tY P Bu are independent,
PpX P A & Y P Bq “ PpX P AqPpY P Bq.
The following proposition can be used as an alternative definition of independence of two
random variables.
Proposition B.3. Two random variables X and Y are independent if and only if for any
two bounded Borel-measurable functions h1 pxq and h2 pyq we have
Erh1 pXqh2 pY qs “ Erh1 pXqsErh2 pY qs.

(B.7)

As a consequence of the above proposition, if X and Y are independent, then for any two
bounded Borel-measurable functions h1 pxq and h2 pyq, h1 pXq and h2 pY q are also independent.
Example B.28. In Example B.13, consider random variables Wn and Wm ř
´ Wn with
m ą n. Theseřrandom variables are independent. This is because, Wn “ W0 ` ni“1 ξi and
Wm ´ Wn “ m
, ..., ξm q are independent. As
i“n`1 ξi , and the
řnvectors pξ1 , ..., ξn q and pξn`1ř
a result h1 pξ1 , ..., ξn q :“ W0 ` i“1 ξi and h2 pξn`1 , ..., ξm q “ m
i“n`1 ξi are independent.
223

B. PROBABILITY
One can assert the independence of a sequence of random variables in terms of the sequence
of σ-fields generated by them.
Proposition B.4. A sequence of random variables tXn : n ě 1u are independent if any
sequence of events tEn : n ě 1u such that En P σpXn q for all n ą 1 is an independent
sequence.
In particular, two random variables X and Y are independent if for any two events F1 P
σpXq and F2 P σpY q, F1 and F2 are independent,
PpF1 X F2 q “ PpF1 qPpF2 q.
The above proposition gives rise to the notion of independent σ-fields of events.
Definition B.7. A sequence of random variables σ-fields tFn : n ě 1u are called independent if any sequence of events tFn : n ě 1u such that Fn P Fn is an independent
sequence.
In particular, two σ-fields F and G are called independent if for any two events F P F
and G P G, we have
PpF X Gq “ PpF qPpGq.
Example B.29. In Example B.13, consider the σ-field generated by the outcomes of the
even rounds and the σ-field generated by the outcomes of the odd rounds; denote them by
F and G, respectively. Since, the outcomes of each round in independent others, F and G
are independent σ-fields.
Expected value and integration
Before Andrey Kolmogorov used the concept of a measure to define probability, measures
were used to extend the notion of integration. Integration with respect to measures is also
important in probability theory to define the expected value of random variables. Here,
we define the expected value of a random variable by the integral of that random variable
with respect to a probability measure in the most general form, which included uncountable
sample spaces.
If a random variable X is defined on a probability space pΩ, F, Pq, the expected value of
X is defined as an integral of X with respect to measure P, denoted by
ż
ErXs :“ XdP.
The definition of the integral is a little cumbersome. Thus, we only outline the steps.
Step 1) For an indicator random variable X “ 1A where A is an event in F, we have
ż
ErXs :“
dP “ PpAq.
A

224

B. PROBABILITY
Step 2) For step random
ř variable X, a finite linear combination of indicator random
variables X “ N
j“1 aj 1Aj , we have
ErXs :“

N
ÿ

aj PpAj q.

j“1

Step 3) If the random variable X is nonnegative,X ě 0, then X can be approximated
from below by an increasing sequence of step random variables; Xn Ò X. Then,
ErXs :“ sup ErXn s.
n

Notice that one can show that the value ErXs is independent of the choice of
the increasing sequence of step random variables and thus is well defined.
Step 4) For a general random variable X, we decompose X into positive and negative
parts; X “ X` ´ X´ with X` “ max 0, X and X´ “ max 0, ´X. Then,
ErXs :“ ErX` s ´ ErX´ s.
In Step (4) in the above, the expected value ErXs is 8 when ErX` s “ 8 and ErX´ s ă 8,
and it is ´8 when ErX` s ă 8 and ErX´ s “ 8. However, ErXs cannot be defined when
we have both ErX` s “ 8 and ErX´ s “ 8. This motivates the following definition.
Definition B.8. A random variable is called integrable if Er|X|s “ ErX` s ` ErX´ s ă 8.
The following example shows why we need to separate the positive part and the negative
part of a random variable in Step 4 above.
Example B.30. Consider the uniform probability measure on probability space given by
Ω “ r´1, 1s2 , the two dimensional square, and a random variable X given by Xpx, yq “
xy
11 . The positive part of X is r0, 1s2 Y r´1, 0s2 . It is easy (by switching to polar
px2 `y 2 q2
coordinates) to see that
ż1ż1

ż
X` dP “
r0,1s2

0

0

xy
dxdy `
2
px ` y 2 q2

ż0 ż0
´1 ´1

px2

xy
dxdy “ 8,
` y 2 q2

and therefore, X is not integrable. We conclude that ErXs does not exist. However, the
iterated integral below exists and is equal to zero, i.e.
ż1 ż1
Xpx, yqdxdy “ 0.
´1 ´1
11

X is undefined at the single point p0, 0q. But, the probability of a single point is 0. Therefore, we can
define Xp0, 0q by any value of choice; for example, Xp0, 0q “ 0.

225

B. PROBABILITY
Therefore, for random variable X, the iterated integral is not a well defined notion of
expectation.
There are three main convergence theorems for integrals with respect to a measure, which
are very useful in the probability theory. We conclude this section by presenting them.
Theorem B.3 (Monotone convergence theorem). Let tXn uně1 be a sequence of nonnegative and increasing random variables. Then, X :“ limnÑ8 Xn is a random variable and
ErXs “ limnÑ8 ErXn s.
Example B.31. In Example B.27, we assume the coin is a fair coin. We shall find the
expected value of the introduced random variable by introducing the sequence of random
variables tXn u8
n“1 defined by
n
ÿ
aj
Xn pωq :“
,
3j
j“1
such that aj “ 0 if ωj “ H, and aj “ 2 if ωj “ T. Notice that by the monotone convergence
theorem, limnÑ8 ErXn s “ ErXs. Observe that Xn “ Xn´1 ` ξn , where ξn takes two values
0 and 32n with equal probabilities 12 . Therefore, ErXn s “ ErXn´1 s`Erξn s. Since Erξn s “ 31n ,
1
1
we have ErX
řnn s “1 ErXn´1 s ` 3n . By solving ErXn s “ ErXn´1 s ` 3n recursively, we obtain
ErXn s “ j“1 3j . As n Ñ 8, if follows from the monotone convergence theorem that
ř
1
1
ErXs “ 8
j“1 3j “ 2 .
Exercise B.16. Repeat the calculation in Example B.31 for an unfair coin with a probability p of heads.
Theorem B.4 (Fatou’s lemma). Let tXn uně1 be a nonnegative sequence of random variables. Then, X “ lim inf nÑ8 Xn is a random variable, and ErXs ď lim inf nÑ8 ErXn s.
Example B.32. On the sample space Ω “ r0, 1q equipped with uniform probability measure,
define the sequence of random variables tYn u8
n“1 by
#
1 when for j “ 1, ..., n, aj “ 0 or 2
Yn pωq “
,
0 otherwise
where ω “

aj
j“1 3n

ř8

is the ternary expansion of ω P Ω. Define
Y pωq :“ lim Yn pωq.
nÑ8

It is straightforward to see that
#
1
Y pωq “
0

when aj “ 0 or 2 for all j ě 1
.
otherwise
226

B. PROBABILITY
In other words, Y is the indicator random variable of the event that contains all numbers
in r0, 1q whose ternary representation has only digits 0 or 2. This event is the same as the
Cantor set in Remark B.5 and is denoted by C. Therefore, Y “ 1C and ErY s “ PpCq. To
find the PpCq, we use Fatou’s lemma, Theorem B.4, and write
ErY s “ PpCq ď lim inf ErYn s.
nÑ8

Next, we will show that lim inf nÑ8 ErYn s “ 0. To see this, first observe that Yn is also
an indicator random variable. For example for n “ 1, Y1 “ 1r0,1{3qYr2{3,1q and Y2 “
1r0,1{9qYr2{9,1{3qYr2{3,7{9qYr8{9,1q , and so on. Generally speaking,
Yn “ 1An ,
where An is the union of 2n intervals each of size
ErYn s “ PpAn q “

1
3n .

Therefore, under uniform probability,

2n
Ñ 0, as n Ñ 8.
3n

This means that the Cantor set has a probability of 0 under uniform probability.
Theorem B.5 (Lebesgue convergence theorem). Let tXn uně1 be a convergent sequence of
random variables and ξ be an integrable random variable such that |Xn | ď |ξ| for all n ě 1.
Then, X :“ limnÑ8 Xn is a random variable, and ErXs “ limnÑ8 ErXn s.
Remark B.6. In Example B.32, we could use Lebesgue convergence theorem, Therem
B.5, to show that ErY s “ 0. This is because all random variables Yn are indicators, and
therefore, their absolute values are bounded by the constant random variable ξ “ 1.
Equality of random variables
Recall the simple version of the law of large numbers in Theorem B.2. Here, we put the
emphasis on the exception set, where the limit inside the theorem does not converge to 12 .
One possible outcome inside this set is given by Xn “ 0 for n ” 0 pmod 3q, and Xn “ 1
for n ” 1 or 2pmod 3q. Then, the limit on the left-hand side converges to 32 , not 12 . The
law of largeřnumbers in Theorem B.2 asserts that the collection of all outcomes such that
limN Ñ8 N1 N
to 12 is an event with a probability of 1. In other
n“1 Xn exists and is equalř
1
words, the random variable limN Ñ8 N1 N
n“1 Xn is defined to be the constant 2 except on
an event with probability 0.
Definition B.9. Two random variables X and Y are considered equal if the event
tω P Ω : Xpωq‰Y pωqu
has a probability of zero. Then, we write X “ Y P almost surely; X “ Y P-a.s. for short;
or just a.s. whenever the probability measure is assumed.
227

B. PROBABILITY
For instance,
side,
ř Theorem B.2 indicates that the random variable on the left-hand
1
limN Ñ8 N1 8
X
,
is
equal
to
the
random
variable
on
the
right-hand
side,
,
a.s.
In
n“1 n
2
1 ř8
addition, it also implies that the limit limN Ñ8 N n“1 Xn exists a.s., which is not an
obvious fact.
As a result
Lemma, Theorem B.2 shows that the random variable Xpωq “
ř of the following
1
limN Ñ8 N
X
´
is
zero
a.s.: a very fancy representation for zero!
n“1 n
2
Lemma B.1. For a nonnegative random variable X, ErXs “ 0 if and only if X “ 0 a.s.
As a consequence, we can define the convergence of a sequence of random variables.
Definition B.10. A sequence tXn u8
n“1 of random variables is called convergent a.s. if the
event
tω P Ω : lim Xn pωq does not existu
nÑ8

has a probability of 0. Then, the limit random variable X :“ limnÑ8 Xn exists a.s. and is
called the limit of tXn u8
n“1 .
Law of a random variable
In the remainder of this section, we show how to define expectation for general random variables by means of the distribution function, without appealing to the notion of integration
with respect to a measure.
Definition B.11. For a random variable X with real values, the cumulative distribution
function (or cdf or simply “distribution function”) FX pxq is defined by
FX pxq :“ PpX ď xq.
The definition of a distribution function is related to the probability measure P by PpX P
pa, bsq “ FX pbq ´ FX paq. In fact, the distribution function induces a probability measure
on R, denoted by PX , which is defined on open intervals by
PX ppa, bsq “ FX pbq ´ FX paq.
recall that to define a probability measure on BpRq, we only need to define it on the open
intervals, or equivalently on the half-open intervals of the form pa, bs.
Example B.33. Let X “ 1A . Then, FX pxq “ 0 if x ă 1 and FX pxq “ 1 if x ě 1; see
Figure B.4.
Example B.34. In Example B.24, define a random variable that is equal to the value of
the picked random number. Then, the law of X is shown in Figure B.5.
228

B. PROBABILITY

FX (x)

1
P(A)

1 − P(A)

x
1
Figure B.4: The distribution function for an indicator.

FX (x)

1
2

√

+

2
4

√

2
4

x
√

2
2

1

Figure B.5: The distribution function for the random number chosen in Example B.24.

For a discrete random, FX is a step function. For nondiscrete random variables FX pxq is
not a step function. The distribution function of random variable X in Example B.27 is
illustrated in Figure B.612 .
In general, the distribution function of a random variable X satisfies the following properties.
12

To be precise, the distribution function of random variable X in Example B.27 is approximated by the
distribution function of random variable Xn with a large n.

229

B. PROBABILITY

1
0.8
0.6
0.4
0.2
0
0

0.2

0.4

0.6

0.8

1

Figure B.6: Devil’s Staircase: the distribution function of the random variable X in
Example B.27.
a) FX p´8q “ 0 and FX p8q “ 1.
b) FX is an increasing right-continuous function with a left-limit at all points.
Exercise B.17. Show that PpX P ra, bsq “ FX pbq ´ FX pa´q, where FX pa´q is the left
limit of FX at a.
It is also well known that if a function F satisfies the properties (a) and (b) of a distribution
function, then there is always a random variable X in a proper sample space such that
FX “ F .
The probability PX is called the law of X. Notice that knowing FX and knowing the law
of X are equivalent, but they are not equivalent to knowing P. In fact, we shall see that in
many important calculations about random variables, we do not exactly need to know P;
in most applications, the law of a random variable is all we need. Therefore, we will now
introduce expected value in terms of the law of the random variable.
Notice that FX is an increasing function, and therefore one can define the RiemannStieltjes integral with respect to FX as an alternative to the more complicated notion of
integration with respect to measure P. In this case, the integral with respect to measure
PX is also simplified to a Riemann-Stieltjes13 integral.
Proposition B.5. For an integrable random variable X the expectation of X satisfies
ż8
ErXs “
xdFX pxq.
´8
13

Read“Steel-chess”.

230

B. PROBABILITY
In particular, for any function g,
ErgpXqs “

ż8
gpxqFX pdxq,
´8

given Er|gpXq|s ă 8.
Similarly, for a random vector X “ pX1 , ..., Xd q, the distribution function is defined by
FX px1 , ..., xd q :“ PpX1 ď x1 , ..., Xd ď xd q.
The law of X is a probability measure PX on Rd such that
PX pp´8, x1 s ˆ ¨ ¨ ¨ ˆ p´8, xd sq “ FX px1 , ..., xd q.
Then, the expectation of gpX1 , ..., Xd q is given by
ż8
ż8
ErgpX1 , ..., Xd qs “
¨¨¨
gpx1 , ..., xd qFX pdx1 , ..., dxd q,
´8

´8

given Er|gpX1 , ..., Xd q|s ă 8.
Exercise B.18. If tXi u8
independent Bernoulli random variables with
i“1 is a sequence of ř
Xi
equally likely values 0 and 1, show that U “ 8
i“1 2i is uniformly distributed on r0, 1s.
Conditional expectation
Conditional expectation cannot simply be defined in terms of the distribution function;
more advanced methods are needed. Unlike discrete probability setting, (B.6) in Section B,
we need to define ErX | Y s in general form by using a powerful tool in analysis, namely the
Radon-Nikodym theorem. To give you a glimpse of the definition, we recall from Remark
B.3 in the discrete setting that ErX | Y “ ys is a function of the variable y, denoted
by hpyq. Then, we use this function to define ErX | Y s by hpY q. Similarly, we try to
find ErX | Y s among the random variables of the form hpY q for some (Borel measurable)
function h : R Ñ R.
Definition B.12 (Conditional expectation). Let X be an integrable random variable.
ErX | Y s is the unique random variable of the form hpY q, where h : R Ñ R is a Borel
measurable function that satisfies
ErhpY qgpY qs “ ErXgpY qs,
for all bounded real functions g with the domain containing the set of values of Y .
231

(B.8)

B. PROBABILITY
The Radon-Nikodym theorem from measure theory guarantees the existence and the
uniqueness of an integrable random variable ErX | Y s in the a.s. sense. Given Definition B.12 for conditional expectation, all the results of Corollary B.2, Proposition B.1, and
Proposition B.3 hold for general random variables.
Corollary B.4. Let X and Y be random variables and f be a real function, such that
f pY qX is integrable. Then,
Erf pY qX | Y s “ f pY qErX | Y s a.s..
We only provide a proof for the above corollary and leave the rest of the result of this
section to the reader.
Proof. By uniqueness of conditional expectation, it is suﬃcient to show that both Erf pY qX |
Y s and f pY qErX | Y s satisfy the Definition B.12. In other words, for any bounded real
functions g with the domain containing the set of values of Y , we have
ErhpY qgpY qs “ ErXgpY qs,
with hpY q “ Erf pY qX | Y s or hpY q “ f pY qErX | Y s. Without lack of generality, we assume that f is a bounded function. Then, f pY qgpY q is also a bounded function. Therefore,
ErErX | Y sf pY qgpY qs “ ErXf pY qgpY qs.
On the other hand,
ErErf pY qX | Y sgpY qs “ ErXf pY qgpY qs.
Therefore, the uniqueness of conditional expectation implies the desired result.
Proposition B.6. X and Y are independent if and only if for any real function f px, yq
of X and Y , we have
Erf pX, Y q | Y “ ys “ Erf pX, yqs for all y in the set of values of Y,
provided that both f pX, Y q and f pX, yq are integrable for all y in the set of values of Y .
Corollary B.5. Two random variables X and Y are independent if and only if for any a
real function f such that f pXq is integrable, we have
Erf pXq | Y s “ Erf pXqs a.s..
Proposition B.7 (Tower property of conditional expectation). Let X, Y , and Z be integrable random variables. Then,
ErErX | Y, Zs | Y s “ ErX | Y s a.s..
232

B. PROBABILITY
In particular,
ErErX | Y ss “ ErXs.
Remark B.7. The two following comments often help in finding conditional expectation
in general form.
1) One can verify (B.12) over a smaller set of functions to guarantee ErX | Y s “ hpY q.
For instance, if for any bounded function g we have ErhpY qgpY qs “ ErXgpY qs, then
ErX | Y s “ hpY q holds true. Equivalently, if for any Borel set (or open set) A we
have ErhpY q1Y PA s “ ErX1Y PA s, then ErX | Y s “ hpY q.
2) If for a constant a, Aa “ tY “ au is an event with positive probability, then ErX |
Y “ as “ hpaq and is also constant. Then, one can find constant hpaq by using
ErhpY q1Y PAa s “ ErX1Y PAa s in the following.
ErhpY q1tY PAa u s “ hpaqPpY “ aq “ ErX1tY PAa u s ùñ hpaq “

ErX1tY PAa u s
.
PpY “ aq

This means that the conditional expectation ErX | Y s on the event {Y=a} is constant
and is equal to the average of X over the event tY “ au.
Exercise B.19. Use Remark B.7-(1) to show Corollary B.4, Proposition B.6 and Proposition B.5.
Recall that X be a random variable. The σ-field generated by X is the smallest σ-field
that contains all events tX P Au for all Borel sets A, and is denoted by σpXq. In other
words, it is the σpXq that contains all events related to X. σpXq can equivalently be
expressed as the smallest σ-field that contains all events tX P Au for all open sets A. We
say that a random variable Z is σpXq-measurable, or measurable with respect to σpXq, if
for any Borel set A, the event tZ P Au is in σpXq. It is known that if Z is σpXq-measurable,
then there exists a Borel function h : R Ñ R such that Z “ hpXq. In particular, since
ErX | Y s is σpY q-measurable, ErX | Y s “ hpY q.
More generally, for a σ-field G Ď F, we say that a random variable Z is G-measurable,
or measurable with respect to G, if for any Borel set A, the event tZ P Au is in G. One
can define ErX | Gs, the conditional expectation of X given the events in G, in a similar
fashion as Definition B.12, for which existence and uniqueness are guaranteed by the RadonNykodim theorem.
Definition B.13 (Conditional expectation with respect to σ-field). Let X be an integrable
random variable and G be a sub σ-field of F. ErX | Gs is the unique random variable Z
that satisfies
ErZY s “ ErXY s,
(B.9)
for all G-measurable random variables Y such that XY is integrable.
233

B. PROBABILITY
Remark B.7 holds also for (B.13): one only needs to verify ErZ1G s “ ErX1G s, for all
G P G, to show that Z “ ErX | Gs. If G is generated by a set of elementary events E, then
one only needs to verify that ErZ1E s “ ErX1E s for all E P E. In addition, let A is an event
in G such that PpAq ą 0 and for any events B P G such that B Ď A, we have PpBq “ PpAq
or PpBq “ 0. Then, we have
ErX1tY PAu s
on A.
PpAq

ErX | Gs “

Example B.35. Consider the probability space pp0, 1q, Bpp0, 1qqq, Pq where P is uniform
probability measure, and let G be the σ-field generated by the intervals p 4i , i`1
4 q, for i “
0, 1, 2, 3. Define the random variable X : ω P p0, 1q ÞÑ R to be Xpωq “ 1p1{3,2{3q ´ 1p0,1{3q ´
1p2{3,1q . We would like to find ErX|Gs. The key observation here is that the σ-field G
can be generated by a random variable that takes a constant value in interval p 4i , i`1
4 q, for
i “ 0, 1, 2, 3. For instance, one can choose (among all other valid choices)
Y “

3
ÿ

i1p i , i`1 q
4

i“0

4

and ErX|Gs “ ErX|Y s. Therefore, since Y is constant in each interval p 4i , i`1
4 q, so is
ErX|Gs, and we can write
3
ÿ
ErX|Gs “
ai 1p i , i`1 q .
4

i“0

4

In Definition B.13, one can take Y “ 1p i , i`1 q to obtain
4

4

ai Er1p i , i`1 q s “ ErX1p i , i`1 q s “
4

4

4

4

i`1
4

ż

i
4

Xpωqdω “

$
’
´ 14
’
’
’
&1
12

1
’
’
12
’
’
%´ 1
4

i“0
i“1
i“2
i“3

Therefore,

ai “

$
’
´1
’
’
’
&1
3

1
’
’
3
’
’
%´1

and

i“0
i“1
,
i“2
i“3

1
1
ErX|Gs “ ´1p0, 1 q ` 1p 1 , 1 q ` 1p 1 , 3 q ´ 1p 3 ,1q .
4
4
3 4 2
3 2 4
The conditional expectation ErX | Gs can be understood by using the concept of regression.
234

B. PROBABILITY

X

W
E[X|G]
Figure B.7: Geometric interpretation of conditional expectation with respect to a σ-field.
Consider the vector space of square integrable random variables; V “ tξ : Erξ 2 s ă 8u
and a linear subspace W of V including all G-measurable random variables. Then, for a
random variable X P V , the conditional expectation Z :“ ErX|Gs is the closest point in
W to X; ErX|Gs minimizes
Er|X ´ Y |2 s
over all Y P W ( G-measurable square-integrable random variables). See Figure B.7.
Remark B.8. Any σpY q-measurable random variable Ŷ can be written as hpY q such that
h : R Ñ R is a Borel function. Therefore, we have ErX | Y s by ErX | σpY qs.
Having the conditional expectation defined, one can expand the notion of independence
to a general case. One can show, as in Proposition B.9, that two random variables X
and Y are independent if and only if ErgpXq | σpY qs “ ErgpXqs for any Borel function g
(or, equivalently, ErhpY q | σpXqs “ ErhpY qs for any Borel function h), provided that the
expectations exist.
Now, one can define the independence between two σ-fields: two σ-fields G and H are
independent if for any G-measurable random variable Z, ErZ|Hs “ ErZs (or, equivalently,
for any H-measurable random variable Z, ErZ|Gs “ ErZs). Given Definition B.13 for
conditional expectation, all the results of Corollary B.4, Proposition B.5 and Proposition
B.7 hold for general random variables.
Corollary B.6. Let X and Y be random variables. Then, provided that Y is G-measurable,
we have
ErY X | Gs “ Y ErX | Gs a.s.,
given that X and XY are integrable.
Proposition B.8 (Tower property of conditional expectation). Let X be an integrable
random variable and F and G be two σ-fields such that G Ď F. Then,
ErErX | Fs | Gs “ ErX | Gs a.s.
235

B. PROBABILITY
In particular,
ErErX | Fss “ ErXs.
Proposition B.9. X is independent of all G-measurable random variables if and only if
for any bounded real function f such that f pXq is integrable, we have
Erf pXq | Gs “ Erf pXqs a.s.
In particular, X is independent of Y if and only if Erf pXq | σpY qs “ Erf pXqs.
Corollary B.7. Consider a probability space pΩ, F, Pq that hosts an integrable random
variable X, and let G be a σ-field such that G Ď F. Then, for any convex function f , we
have
f pErX | Gsq ď Erf pXq | Gs,
provided that f pXq is integrable.
The proof of this corollary is exactly the same line of argument as in Corollary B.1.
Continuous random variables
In this section, we review the basic concepts of continuous random variables without referring to measurability issues.
Definition B.14. A random variable X is called continuous if there exits a nonnegative
measurable function fX : Rd Ñ R such that
ż x1
ż xd
FX pxq :“
¨¨¨
fX pyqdy.
´8

´8

In this case, the function fX is called the probability density function (pdf) of the continuous
random variable X.
Working with continuous random variables is often computationally convenient; one can
accurately approximate the integrals to estimate relevant quantities such as probability of
certain events and expected value of certain random variables. For example, when X is a
univariate continuous random variable with pdf fX , the expected value of X is given by
ż8
ErXs “
xfX pxqdx.
´8

More generally, for a function h : R Ñ R, we have
ż8
ErhpXqs “
hpxqfX pxqdx.
´8

236

B. PROBABILITY
If I Ď R, then
PpX P Iq “

ż
fX pxqdx.
I

Example B.36 (Normal distribution). A continuous random variable X with density
x2
1
fX pxq “ ? e´ 2 for all x P R
2π

is called a standard Gaussian random variable. By using integration techniques, one can
see that ErXs “ 0 and varpXq :“ ErX 2 s “ 1.
If Y “ σX ` µ for σ ą 0 and µ P R, then Y is also a continuous random variable with
density
px´µq2
1
fY pxq “ ?
e´ 2σ2 for all x P R.
2πσ
Then, Y is called a normal random variable with mean µ and variance σ 2 and is denoted
by Y „ N pµ, σ 2 q.
Exercise B.20. Show that when X „ N p0, 1q, we have ErXs “ 0 and varpXq :“ ErX 2 s “
1.
When X “ pX1 , ..., Xd q is a jointly continuous random vector, we refer to its pdf fX as the
joint probability density function of X1 , ..., Xd to emphasize its multi-dimensionality. For
simplicity, let’s focus on two random variables. Let the joint pdf of pX, Y q be fX,Y px, yq.
Then, it is easy to see that
a) The pdf of X, fX , satisfies
ż8
fX pxq “

fX,Y px, yqdy.
´8

A similar formula holds for the pdf of Y .
b) For a function h : R2 Ñ R, we have
ż8 ż8
ErhpXqs “
hpx, yqfX,Y px, yqdxdy
´8 ´8

c) If K Ď R2 , then
PppX, Y q P Kq “

ĳ
fX,Y px, yqdA.
K

237

B. PROBABILITY
Example B.37 (Bivariate normal distribution). Let C be a symmetric positive-definite
matrix and µ “ pµ1 , ..., µd q P Rd . A jointly continuous random vector X “ pX1 , ..., Xd q
with density
px´µqC ´1 px´µqT
1
´
2
fX pxq “
e
for all x P Rd
p2πdetpCqqd{2
is called a multi-variate normal random vector. For each j “ 1, ..., d, ErXj s “ µj . The matrix C is called the covariance matrix of X, because its entities correspond to the covariance
of components of X, i.e.,
Ci,j “ ErpXi ´ µi qpXj ´ µj qs.
In particular, for d “ 2, for a positive-definite matrix14
ȷ
„ 2
σ1 σ12
C“
σ12 σ22
and µ “ 0, we have
´
1
fX,Y px, yq “ a 2 2
e
2
2π σ1 σ2 ´ σ12

2 x2 ´2σ xy`σ 2 y 2
σ2
12
1
2pσ 2 σ 2 ´σ 2 q
1 2
12

for all x P R.

Here by evaluating double integrals, we can see that σ12 and σ22 are variances of X and Y ,
respectively, and that σ12 is the covariance of X and Y .
Exercise B.21. In Example B.37, show that covpX, Y q :“ ErpXi ´ µi qpXj ´ µj qs “ Ci,j .
Exercise B.22. In Example B.37, show that σ12 and σ22 are variance of X and Y respectively, and σ12 is the covariance of X and Y .
Defining and calculating conditional probability and conditional expectation is also done
through integral definition for continuous random variables. Let pX, Y q be a jointly continuous random variable with density fX,Y px, yq. Then, the conditional density of X given
Y “ y is defined by
fX,Y px, yq
,
fX|Y px | yq :“
fY pyq
provided that y is in the set of values of Y , ty : f pyq ‰ 0u. Using the above definition, the
conditional probability of X P I given Y “ y is given by
ş
fX,Y px, yqdx
(B.10)
PpX P I | Y “ yq :“ I
f pyq
Similarly, if h : R Ñ R is a function, then the conditional expectation of hpXq given Y “ y
14

2
In order for C to be positive-definite, is necessary and suﬃcient to have σ1 , σ2 ‰ 0, and σ12 σ22 ´ σ12
ą 0.

238

B. PROBABILITY
is given by

ş8
ErhpXq | Y “ ys :“

´8 hpxqfX,Y px, yqdx

f pyq

.

In particular, the conditional expectation of X given Y “ y is given by
ş8
xfX,Y px, yqdx
ErX | Y “ ys :“ ´8
.
fY pyq

(B.11)

(B.12)

Notice that conditional expectation and conditional probability in (B.10), (B.11), and(B.12)
are functions of the variable y. The domain of all these is the set of values of Y , i.e., ty :
fY pyq ‰ 0u. This, in particular, can be useful in defining conditional distribution and conditional probability given Y . Let’s first make the definition for conditional probability
of X P I
ş
I fX,Y px,yqdx
given Y . Consider a function Y that maps y onto Ypyq :“ PpX P I | Y “ yq “
.
fY pyq
Then, one can define
ş
fX,Y px, Y qdx
PpX P I | Y q :“ YpY q “ I
.
fY pY q
Notice that, unlike PpX P I | Y “ yq which is a real function, PpX P I | Y q is a random
variable that is completely dependent on random variable Y . Similarly, we have
ş8
ş8
xfX,Y px, Y qdx
´8 hpxqfX,Y px, Y qdx
and ErX | Y s :“ ´8
.
ErhpXq | Y s :“
fY pY q
fY pY q
For continuous random variables independence can be defined in terms of the joint pdf
f px, yq; let X and Y be jointly continuous. Then, X and Y are called independent if f is
a separable function, i.e.
fX,Y px, yq “ gpxqhpyq.
Notice that the choice of h and g is not unique and varies by multiplying or dividing
constants. In this case, one can write the separation in a standard form
fX,Y px, yq “ fX pxqfY pyq,

(B.13)

where fX pxq and fY pyq are, respectively, the pdf of x and the pdf of Y .
Example B.38. From Example B.37 and (B.13), one can see that bivariate normal random variables are independent if and only if they are uncorrelated, i.e., they have zero
correlation or simply σ12 “ 0.
Exercise B.23. Show that (B.7) and (B.13) are equivalent.
239

B. PROBABILITY

B.3

Martingales

The conditional expectation defined in the previous section is required in the definition of
a martingale. Consider a probability space pΩ, F, Pq, i.e., a sample space Ω, a σ-field F,
and a probability measure P and let X :“ tXt uTt“0 (possibly T “ 8) be a discrete-time
stochastic process. Here, a stochastic process is simply a sequence of random variables
indexed by time; for any t “ 0, 1, ..., Xt is a random variable.
Definition B.15. A discrete-time stochastic process tMt uTt“0 on a probability space pΩ, F, Pq
is called a martingale with respect to X if
a) Mt is integrable for all t “ 0, ..., T , Er|Mt |s ă 8.
b) The conditional expectation Mt given Xs , Xs´1 , ..., X0 is equal to Ms ,
ErMt |Xs , Xs´1 , ..., X0 s “ Ms , for s ă t.
Condition (a) in the definition of martingale is technical and guarantees the existence of
the conditional expectation in condition (b). Condition (b) in the definition of martingale
implies that Ms is a σpX0 , ..., Xs q-measurable random variable, for all s ě 0. This is
because the conditional expectation ErMt |Xs , Xs´1 , ..., X0 s is a σpX0 , ..., Xs q-measurable
random variable.
Condition (b) can also be given equivalently by
b1 ) ErMt |Xt´1 , ..., X0 s “ Mt´1 , for t ě 1.
Notice that, as a result of the tower property for conditional expectation, if (b1 ) holds, we
can write
ErErMt |Xt´1 , ..., X0 s|Xs , ..., X0 s “ ErMt´1 |Xs , ..., X0 s.
By applying the tower property inductively, we obtain
ErMt |Xs , ..., X0 s “ ErMt´1 |Xs , ..., X0 s “ ¨ ¨ ¨ “ ErMs`1 |Xs , ..., X0 s “ Ms .
Example B.39. Let Y be an arbitrary integrable random variable. Then, Mt :“ ErY |
Xt , ..., X0 s is a martingale with respect to X.
Example B.40 (Symmetric random walk). The symmetric random walk in Definition B.2
is a martingale. Since Wi ´ Wi´1 “ ξi , we have
ErWt`1 |Wt , ..., W0 s “ ErWt ` ξt`1 |ξt , ..., ξ1 , W0 s
“ ErWt |ξt , ..., ξ1 , W0 s ` Erξt`1 |ξt , ..., ξ1 , W0 s.
ErWt |ξt , ..., ξ1 , W0 s is simply ErWt |Wt , ..., W0 s “ Wt . On the other hand, since tξn u8
n“1 is
an independent sequence of random variables, it follows from Corollary B.3 that
Erξt`1 |ξt , ..., ξ1 , W0 s “ Erξt`1 s “ 0,
240

B. PROBABILITY
and therefore, ErWt`1 |Wt , ..., W0 s “ Wt .
Example B.41 (Multiperiod binomial model). Under the risk-neutral probability, the disSt
counted price of the asset, Ŝt :“ p1`Rq
t is a martingale. Recall from Section II.2.3 that
St “ St´1 Ht ,
where Hi is a sequence of i.i.d. random variables under the risk-neutral probability that is
given by
1`R´ℓ
u´1´R
Pπ pHi “ uq “
and Pπ pHi “ lq “
.
u´ℓ
u´ℓ
Thus, Ht is independent of St´1 “ S0 Ht´1 ¨ ¨ ¨ H1 and
ErSt |St´1 , ..., S0 s “ ErSt´1 Ht |Ht´1 , ..., H1 , S0 s
“ St´1 ErHt |Ht´1 , ..., H1 , S0 s “ St´1 ErHt s “ p1 ` RqSt´1 .
In the second equality above, we used Corollary B.2 and the third equality is the result of
Corollary B.3.
Remark B.9. As a result of tower property of conditional expectation, the expectation of
a martingale remain constant with time, i.e., ErMt s “ ErM0 s.
Example B.42. Let tWt u8
t“0 be a symmetric random walk from Example B.2 and define
Mt :“ Wt2 ´ t. Then, Wt is a martingale with respect to tξt u8
t“1 . To see this, we need to
show
2
ErWt`1
´ pt ` 1q|ξt , ..., ξ1 s “ Wt2 ´ t.
Recall that Wt`1 “ Wt ` ξt`1 . Thus,
2
ErWt`1
|ξt , ..., ξ0 s “ ErpWt ` ξt`1 q2 |ξt , ..., ξ1 s
2
“ ErWt2 |ξt , ..., ξ1 s ` Erξt`1
|ξt , ..., ξ1 s ` 2ErWt ξt`1 |ξt , ..., ξ1 s.

It follows from Corollary B.2 that
ErWt2 |ξt , ..., ξ1 s “ Wt2
ErWt ξt`1 |ξt , ..., ξ1 s “ Wt Erξt`1 |ξt , ..., ξ1 s.
On the other hand, by Corollary B.3, we have
2
2
Erξt`1
|ξt , ..., ξ1 s “ Erξt`1
s“1

Erξt`1 |ξt , ..., ξ1 s “ Erξt`1 s “ 0
2 |ξ , ..., ξ s “ W 2 ` 1, and therefore,
Thus, ErXt`1
t
0
t

ErMt`1 |ξt , ..., ξ1 s “ Wt2 ` 1 ´ pt ` 1q “ Mt .
241

B. PROBABILITY
In the definition of a martingale, Definition B.15, process X models the dynamics of the
information as time passes. At time t, the occurrence or absence of all events related to
Xt , ..., X0 are known. The conditional expectation ErMt |Xs , Xs´1 , ..., X0 s should be read
as expectation of Mt given the information gathered from the realization of process X until
time s. It follows from Remark B.8 that if we denote FsX :“ σpXs , ..., X0 q, then part (b)
in Definition B.15 of martingale can be written as
ErMt |FsX s “ Ms .
This motivates the definition of a filtration.
Definition B.16. A filtration is a sequence of σ-fields F :“ tFs u8
s“0 such that Fs Ď Ft for
t ě s.
For example, if we set FsX :“ σpXs , ..., X0 q, then
FsX “ σpXs , Xs´1 , ..., X0 q Ď FtX “ σpXt , ..., Xs , Xs´1 , ..., X0 q.
In this case, we call FX the filtration generated by X. FX represents the accumulated
information that are revealed by the process X as time passes.
8
We a filtration tFt u8
t“0 is given, a stochastic process tYt ut“0 is called adapted with respect
to the filtration if for all t, Yt is an Ft -measurable random variables. For instance, in
ξ 8
Example B.13, the random walk tWt u8
t“0 is adapted with respect to tFt ut“0 . Here, W0 is
a constant and Ftξ “ σpξ1 , ..., ξt q.
Given Definition B.13 of conditional expectation with respect to a σ-field, one can now
define a martingale with respect to a given filtration without appealing to a process X.
A probability space pΩ, F, Pq equipped with a filtration F :“ tFs u8
s“0 is called a filtered
probability space.
Definition B.17. Consider a filtered probability space, i.e., pΩ, F, F :“ tFs u8
s“0 , Pq. A
discrete-time stochastic process tMt uTt“0 is called a martingale with respect to filtration F if
a) The expected value of |Mt | is finite for all t “ 0, ..., T , i.e., Er|Mt |s ă 8.
b) The conditional expectation Mt given Fs is equal to Ms , ErMt | Fs s “ Ms for s ď t.
We can equivalently present (b) as
ErMt | Ft´1 s “ Mt´1 .
By applying the tower property in Proposition B.8 inductively, we obtain
ErErMt | Ft´1 s | Fs s “ ¨ ¨ ¨ “ ErMs`1 | Fs s “ Ms
242

and

ErMt s “ M0 .

B. PROBABILITY
Super/submartingales
Motivated by American option pricing and many other applications, we define a supermartingale and a submartingales
Definition B.18. A discrete-time stochastic process tMt uTt“0 on a filtered probability space
pΩ, F, Pq is called a supermartingale (or, respectively, a submartingale) with respect to a
filtration F if
a) Mt is integrable for all t “ 0, ..., T , i.e., Er|Mt |s ă 8.
b) ErMt | Fs s ď Ms , for s ă t (or, respectively, ErMt | Fs s ě Ms , for s ă t).
Mt is a supermartingale if and only if ´Mt is a submartingale. So, we can only focus
our study of supermartingales. A martingale is simultaneously a submartingale and a
supermartingale. The supermartingale property can equivalently be given by
ErMt | Ft´1 s ď Mt´1 .
Example B.43 (asymmetric random walk). An asymmetric random walk with Ppξn “
1q “ p ă 21 is a strict supermartingale.
ErWt`1 | ξt , ..., ξ1 s “ ErWt ` ξt`1 | ξt , ..., ξ1 s
“ ErWt | ξt , ..., ξ1 s ` Erξt`1 | ξt , ..., ξ1 s.
ErWt | ξt , ..., ξ1 s is simply Wt . On the other hand, since tξi ui“1 is an independent sequence
of random variables, it follows from Corollary B.3 that
Erξt`1 | ξt , ..., ξ1 s “ Erξt`1 s “ 2p ´ 1 ă 0.
Thus, ErWt`1 | ξt , ..., ξ1 s ă Wt .
The following corollary shows how submartingales naturally show up from convex transformation of martingales.
Lemma B.2. Let tMt utě0 be a martingale with respect to filtration F and f be a convex
function, and define Yt :“ f pMt q. Then, tYt utě0 is a submartingale with respect to filtration
F if Er|f pMt q|s ă 8 for all t ě 0.
Proof. By corollary B.7, we know that
Erf pMt q | Fs s ě f pErMt | Fs sq “ f pMs q.
In the above, the equality comes from the martingale property of tM u8
t“0 .
243

B. PROBABILITY
If tM u8
t“0 is a submartingale, we can still have a slightly weaker version of the above
corollary.
Lemma B.3. Let tMt utě0 be a submartingale with respect to filtration F and f be a convex
nondecreasing function such that Er|f pMt q|s ă 8 for all t ě 0. Define Yt :“ f pMt q. Then,
tYt utě0 is a submartingale with respect to filtration F.
Proof. By corollary B.7, we know that
Erf pMt q | Fs s ě f pErMt | Fs sq ě f pMs q.
In the above, the second inequality comes from the submartingale property of tM u8
t“0 , i.e.,
ErMt | Fs s ě Ms and nondecreasingness property of f .
The following corollaries are the result of Lemmas B.2 and B.3
Corollary B.8. If M “ tMt utě0 is a martingale, then M` “ tmaxt0, Mt uutě0 , |M | :“
t|Mt |utě0 , and |M |p :“ t|Mt |p utě0 for p ą 1 are submartingales; for the last one we need
the assumption that Er|Mt |p s ă 8 for all t ě 0.
Stopping time and optional sampling theorem
Definition B.19. A stopping time with respect to filtration tFt u8
t“0 is a random variables
τ : Ω Ñ t0, 1, ...u such that for any t, the even tτ ď tu belongs to Ft .
A stopping time is a random time that does not anticipate the release of information that
is defined by a filtration. For instance, recall that the filtration generated by the process
X
X is given by tFtX u8
t“0 , where Ft “ σpX0 , ..., Xt q increases as time t passes. Then, the
event that τ happened before or at t should belong to σpX0 , ..., Xt q to make tau a stopping
time. Some examples of a stopping time are presented below.
i) A deterministic time τ ” t0 is a stopping time. Then, the event tt0 ď tu is either Ω
or H, if t0 ď t or t0 ą t, respectively.
ii) Let τa be the first time that a stochastic process tXu8
t“0 such as the price of an asset
is greater than or equal to a. Then, the event tτ ď tu can also be represented by al
the outcomes such that Xu ě a for some u ď t. Therefore, it belongs to σpX0 , ..., Xt q.
iii) Assume that tYt utě0 q be a stochastic process which is measurable with respect to
σpX0 , ..., Xt q. Let τ be the first time that a stochastic process tYt utě0 q enters the
interval pa, bq. Then, τ is a stopping time.
iv) If tYt utě0 q is predictable, i.e., measurable with respect to σpX0 , ..., Xt´1 q, then the
stopping time in (iii) is called a predictable stopping time. In other words, we know
that the event tτ ď tu is going to happen one period ahead of time t.
244

B. PROBABILITY
v) If Yt is not measurable with respect to σpX0 , ..., Xt q; but it is measurable with respect to σpX0 , ..., Xt`1 q, then τ is not a stopping time. Because we know about the
occurrence of tτ ď tu not any time sooner than t ` 1.
Lemma B.4. If τ and ϱ are two stopping times with respect to a filtration tFt u8
t“0 , then
τ _ ϱ :“ maxtτ, ϱu, and τ ^ ϱ :“ mintτ, ϱu are stopping times with respect to filtration
tFt u8
t“0 . In particular, for a deterministic time t0 , τ ^ t0 is a stopping time bounded by t0
with respect to filtration tFt u8
t“0 .
Proof. We only present the proof for τ _ ϱ as the rest of the proof follows through a similar
line of arguments. The event tτ _ ϱ ď tu is equal to tτ ď tu X tϱ ď tu. Since, we have
tτ ď tu P Ft and tϱ ď tu P Ft , tτ _ ϱ ď tu “ tτ ď tu X tϱ ď tu P Ft , and therefore, τ _ ϱ is
a stopping time with respect to a filtration tFt u8
t“0 .
For the simplicity, a stopping time with respect to a known filtration is called a stopping
time, whenever there is no confusion.
Definition B.20 (Stopped process). For a process tXt u8
t“0 that is adapted to a filtration
and a stopping time τ with respect to the same filtration, the random variable Xτ is defined
to be equal Xt on the event τ “ t.
Example B.44. Consider a random walk W , and let the stopping time τa be the first time
the random walk is greater than or equal to a. Since the random walk moves one step at
a time, τa is the first time the random walk hits a. One can see this as the first time the
wealth of a gambler who bets only one dollar at each round becomes equal to a. Therefore,
Wτa “ a.
Let tM u8
t“0 is a martingale and τ be a stopping time with respect to filtration F such that
τ ě t0 for some deterministic time t0 , it is natural to ask whether ErMτ | Ft0 s “ Mt0 . In
particular when t0 “ 0, we want to see whether ErMτ s “ M0 . The answer in general case
is no according to the next example.
Example B.45. Recall the Saint Petersburg paradox in Example 2.2.4. Let τ be the first
time that the gambler wins a round, i.e.,
τ :“ inftt : ξt “ 1u.
Notice that the doubling strategy always generates exactly one dollar more than the initial
wealth, i.e., Wτ “ W0 ` 1. Let t0 “ 0. If the game is fair, i.e., Ppξ “ 1q “ Ppξ “ ´1q “ 21 ,
the random walk, and therefore, the doubling strategy make the wealth process a martingale.
However, ErWτ s “ W0 ` 1 ą W0 .
Under some additional condition, we may hope for ErMτ | Ft0 s and ErMτ s “ M0 to hold
true. The following Theorem is providing a set of suﬃcient conditions.
245

B. PROBABILITY
Theorem B.6 (Optional sampling). Let τ be stopping time bounded by a deterministic
time T , i.e., τ ď T and tM u8
t“0 be a supermartingale. Then for any t ď T ,
ErMτ | Ft s ď Mτ ^t .
In particular, ErMτ s ď M0 .
It is obvious that for a martingale, the inequalities in the assertion of Theorem B.6 turns
to equalities, i.e., ErMτ | Ft s “ Mτ ^t and ErMτ s ď M0 .
To show Theorem B.6, we need the following lemma.
Lemma B.5. Let tM u8
t“0 be a supermartingale. Then, the stopped process
#
Mt τ ą t
Mτ ^t “
Mτ τ ď t
is also a supermartingale.
Proof of Theorem B.6. Notice that because τ ď T , τ ^ T “ τ and by Lemma B.5, one can
write
ErMτ | Ft s “ ErMτ ^T | Ft s “ Mτ ^t .

Proof of Lemma B.5. It suﬃces to show Er|Mτ ^t |s ă 8 and
ErMτ ^t | Ft´1 s “ Mτ ^pt´1q .
Notice that Mτ ^t “ Mτ 1tτ ătu ` Mt 1tτ ětu . Therefore,
ErMτ ^t | Ft´1 s “ ErMτ | 1tτ ătu | Ft´1 s ` ErMt 1tτ ětu | Ft´1 s
Since tτ ă tu “ tτ ď t ´ 1u P Ft´1 and tτ ě tu “ tτ ă tuA P Ft´1 , we have
ErMτ ^t | Ft´1 s “ ErMτ 1tτ ătu | Ft´1 s ` 1tτ ětu ErMt | Ft´1 s.
By supermartingale property of tM u8
t“0 , we have ErMt | Ft´1 s ď Mt´1 and
ErMτ ^t | Ft´1 s ď ErMτ 1tτ ătu | Ft´1 s ` Mt´1 1tτ ětu .
On the other hand,
1tτ ătu ErMτ | Ft´1 s “

t´1
ÿ

ErMτ 1tτ “iu | Ft´1 s “

i“0

t´1
ÿ
i“0

246

ErMi 1tτ “iu | Ft´1 s.

B. PROBABILITY
Since 1tτ “iu Mi isFt´1 -measurable for i ď t ´ 1, we have
ErMi 1tτ “iu | Ft´1 s “ 1tτ “iu Mi ,
and

t´1
ÿ

1tτ ătu ErMτ | Ft´1 s “

Mi 1tτ “iu “ Mτ 1tτ ďt´1u .

i“0

Therefore,
ErMτ ^t | Ft´1 s ď Mτ 1tτ ďt´1u ` Mt´1 1tτ ětu “ Mτ ^pt´1q .

B.4

Characteristic functions and weak convergence

The characteristic function of a (univariate) random variable is a complex function defined
by
χX pθq :“ EreiθX s.
ř
iθxi p , and when X is conWhen X is a discrete random variable,
χX pθq “ 8
1
i“1 e
ş8 then
iθx
tinuous with pdf f , then χX pθq “ ´8 e f pxqdx. In the latter case, the characteristic
function is the Fourier transform of the pdf f .
If F is the distribution function of X, the characteristic function can be equivalently given
by
ż
χX pθq “

R

eiθx dF pxq,

where the above integral should be interpreted as Reimann-Stieltjes integral. Especially
for continuous random variables we have
ż
χX pθq “
eiθx f pxqdx.
R

Therefore, for a continuous random variable, the characteristic function is the Fourier
transform of the pdf. Therefore, if we know the characteristic function of a distribution,
then one can find the distribution function by inverse Fourier transform.
Example B.46. We want to find the characteristic function of Y „ N pµ, σq. First tale
the standard case of X „ N p0, 1q.
1
χX pθq “ ?
2π

ż
e
R

iθx

e

2
´ x2

θ2

e´ 2
dx “ ?
2π
247

ż

e´
R

px´iθq2
2

θ2

dx “ e´ 2 .

B. PROBABILITY
Now, since Y “ µ ` σX, we have
χY pθq “ Ereiθpµ`σXq s “ eiµθ χX pσθq “ eiµθ´

σ2 θ2
2

.

For the inversion theorem, see [10, Theorem 3.3.4], the characteristic function uniquely
determines the distribution of the random variable. Therefore, all the information
For a random vector pX, Y q, the characteristic function is defined as
χpθ1 , θ2 q :“ Ereipθ1 X`θ2 Y q s.
One of the important implications of definition of independent random variable in Remark
B.3 is that if X and Y are independent, then for any pθ1 , θ2 q we have
χpθ1 , θ2 q “ MX pθ1 qMY pθ2 q.

(B.14)

The inverse is also true; see [10, Theorem 3.3.2]. This provides an easy way to formulate
and verify the independence of random variable in theory.
Proposition B.10. X and Y are independent if and only if (B.14) holds true.
Weak convergence
The most well-known place where the weak convergence comes to play is the central limit
theorem (CLT).
Theorem B.7. Let X1 , X2 , ... be a sequence
of i.i.d. random variablesřwith expectation
a
n
pX ´µq
2
µ “ ErX1 s and standard deviation σ :“ ErX1 s ´ µ2 and define Wn :“ i“1σ?ni
. Then,
P pWn ď xq Ñ

żx
´8

y2
1
? e´ 2 dy,
2π

as n Ñ 8.
The appellation “weak” is originated from the fact that this convergence is weaker that the
concept of pointwise or almost sure (shortly a.s.) convergence. The pointwise convergence
indicates that the sequence of random variablestWn pωqun converges for all ω P Ω; while
almost sure convergence means the probability of the event
An :“ tω : Wn pωqun does not convergeu
converges to zero as n Ñ 8. Almost sure convergence, for instance, appears in the law of
large numbers (LLN).

248

B. PROBABILITY
Theorem B.8. Let X1 , X2 , ... be a sequence
of i.i.d. random variables with expectation
a
µ “ ErX1 s and standard deviation σ :“ ErX12 s ´ µ2 . Then,
řn
i“1 Xi ´ nµ
Ñ 0 almost surely,
n
as n Ñ 8. Here almost surely means that the probability that this convergence does not
happen is zero.
řn

X

i
In other words, the statistical average i“1
converges to the expectation (mean), when
n
n Ñ 8, except for a set of outcomes with zero total probability. For example in the
context of flipping a fair coin, the fraction of flips that the coin turns heads converges to 12
exclusively. However, one can simply construct infinite sequences of heads and tails such
as H, T, T, H, T, T, ... with statistical average converging to some value other than 12 .
In the weak sense of convergence in CLT, the sequence of random variablestWn pωqun do
not actually converge to a normal random variable over a significantly large part of the
sample space, as a result of law of iterated logarithms, i.e.

Wn
“ 1 almost surely.
lim sup a
nÑ8
2 logplogpnqq
Instead, the probability distribution function of Wn canřbe approximated by normal disn
X ´nµ
tribution function for large n. In this case, we say that i“1σ?ni
converges weakly or in
distribution to standard Gaussian.
Definition B.21. We say the sequence tYn u8
n“1 of random variables converges weakly (or
in distribution) to random variable Y if for the distribution functions we have
FYn pyq Ñ FY pyq for any y such that FY is continuous at y.
We denote the weak convergence by Yn ñ Y .
The following example reveals a diﬀerent aspect of weak convergence in regard to comparison with a.s. convergence.
Example B.47. On a probability space pΩ, Pq, let the random variable Yn pωq “ yn for all
ω (a.s.), i.e., Yn is a constant random variable equal to yn . If yn Ñ y, then Yn Ñ Y ” y
pointwise (a.s., respectively).
Now, consider a sequence of possibly diﬀerent probability space pΩ “ t0, 1u, Pn q such that
Pn pt0uq “ 1 if n is odd and Pn pt0uq “ 0 if n is even. For each n, let the random variable
Zn : Ω Ñ R be defined by
#
1
pω “ 0 and n is oddq or pω “ 1 and n is evenq
Zn pωq “ n
1
otherwise.
249

B. PROBABILITY
In particular, the distribution of Zn is a Dirac distribution located at
#
1 x ě n1
Fn pxq :“ Pn pZn ď xq “
0 otherwise.

1
n;

Zn does not converge pointwise, since Zn p0q alternates between n1 and 1 as n increases
successively. However, the distribution function Fn pxq of Zn converges to the distribution
function
#
1 xě0
F pxq :“
0 otherwise.
The following proposition is one of the equivalent conditions of weak convergence.
Proposition B.11. Yn ñ Y if and only if for any bounded continuous function f :
R Ñ R we have
lim Erf pYn qs “ Erf pY qs
nÑ8

Notice that the expectation in ErYn s and ErY s are to be interpreted in diﬀerent sample
spaces with diﬀerent probabilities.
One of the ways to establish weak convergence results is to use characteristic functions;
see [10, Theorem 3.3.6]
Theorem B.9. Let tXn u be a sequence of random variables such that for any θ, χXn pθq
converges to a function χpθq which is continuous at θ “ 0. Then, Xn converges weakly to
a random variable X with characteristic function χ.
As a consequence of the this Theorem,
one can easily provide a formal derivation for
řn
X ´nµ
central limit theorem. Let Sn :“ i“1σ?ni
. Thanks to the properties of characteristic
function and (B.14), the characteristic function of Sn is given by
χSn pθq “

n
ź

`
? ˘n
?
χXi ´µ pθ{pσ nqq “ χX1 ´µ pθ{pσ nqq .

i“1

Here we used identical distribution of sequence tXn u to write the last equality. Since
2
eix “ 1 ` ix ´ x2 ` opx2 q, we can write
χXi ´µ pθq “ 1 ´

σ 2 θ2
` opθ2 q.
2

Therefore,
`
? ˘n
χSn pθq “ χpXi ´µq pθ{pσ nqq “

ˆ

250

˙n
θ2
θ2
´1
1´
` opn q
Ñ e´ 2 ,
2n

B. PROBABILITY
as n Ñ 8. This finished the argument since e´
Gaussian.

θ2
2

is the characteristic function of standard

Remark B.10. In the Definition B.21 of weak convergence, only the distribution of random
variables matters, and not the sample space of each random variable. Therefore, in weak
convergence, the random variables in sequence tYn u8
n“1 can live in diﬀerent sample spaces.
However, one can make one universal sample space for all Yn ’s and Y ; more precisely,
ś if
Yn and Y are defined on probability space pΩn , Fn , Pn q and pΩ, F, Pq, then Ω̃ “ Ω ˆ n Ωn
is a universal sample space. The random variables Yn and Y are redefined on Ω̃ by
Ỹ pω, ω1 , ω2 , ...q “ Y pωq,

and Ỹn pω, ω1 , ω2 , ...q “ Yn pωn q.

ś
The distribution of random variables on Ω̃ is determined by the probability P̃ :“ P b n Pn .
Therefore, the weak convergence of random variables can be reduced to weak convergence
of probabilities on a single sample space.
Weak convergence of probabilities
If the sample space is a Polish space (complete metrizable topological space), then one can
define weak convergence of probabilities (or even measures). Sample spaces with a topology
contribute to the richness of the probabilistic structure; the concept of convergence of
probabilities can be defined.
Definition B.22. Consider a sequence of probabilities tPn un on a Polish probability space
pΩ, Fq. We say Pn converges weakly to a probability P on pΩ, Fq, denoted by Pn ñ P, if
for any bounded continuous function f : Ω Ñ R we have
lim En rf s “ Erf s

nÑ8

Notice that in the above definition topology of Ω has been used in the continuity of
function f .
One can always reduce the weak convergence of random variables to weak convergence of
probabilities in the Polish space Rd . Let tYn u8
n“1 be a sequence of random variables and Y
d
be a random variable all with values in R . Then, the distributions of Yn ’s and Y defined
probability measures in Rd as follows.
P̃n pAq “ Pn pY P Aq and P̃pAq “ PpY P Aq.
Notice that, as emphasized in Remark B.10, Yn and Y live in diﬀerent probability spaces
pΩn , Fn , Pn q and pΩ, F, Pq, respectively. However, the probabilities P̃n and P̃ are defined
on the same sample space Rd .
Corollary B.9. Yn ñ Y if and only if P̃n ñ P̃.
251

B. PROBABILITY

W

W

Time

Time

Figure B.8: Left: Sample path of a random walk. Right: Interpolated sample path of a
random walk

B.5

Donsker Invariance Principle and Brownian motion

In this section, we heuristically construct Brownian motion (or Wiener process) as the
weak limit of symmetric discrete-time random walk in Definition B.2. First, we make
the sample paths of random walk continuous by linear interpolation. For t P r0, 8q, we
define the interpolated random walk by Wt :“ Wrts ` pt ´ rtsqWrts`1 ; see Figure B.8. Then,
tWt : t ě 0u becomes a continuous-time stochastic process with continuous sample paths,
i.e., for each t ě 0, Wt is a random variable and for any realization ω of random walk,
Wt pωq is continuous in t.
Motivated by central limit theorem, we defined normalized random walk by
pnq

Xt

1
:“ ? Wnt for all t P r0, 8q.
n

W

√1
n

Time
1
n

A sample path of a normalized random walk X (n)
pnq

Then, we define Brownian motion is the weak limit of Xt
252

as n Ñ 8. Indeed, a rigorous

B. PROBABILITY
definition of the Brownian motion is way more technical and requires advanced techniques
from analysis and measure theory. Here we only need the properties which characterize a
Brownian motion.
Remark B.11. In the above construction, one can take any sequence of i.i.d. random
pnq
1
variables tξn uně0 with finite variance σ 2 and define Xt :“ σ?
W . The rest of the
n nt
arguments in this section can be easily modified for this case.
pnq

pnq

k
ℓ
Because tξi u8
´ Xs has mean zero
i“1 are i.i.d., for any t “ n and s “ n with t ą s, Xt
and variance t ´ s. If t ą s are real numbers, then the mean is still zero but the variance is
pnq
pnq
pnq
1
n prtns´rsnsq which converges to t´s. In addition, Xt ´Xs is independent of Xu when
pnq

pnq

u ď s. By central limit theorem, Xt ´ Xs ñ N p0, t ´ sq, a normal distribution with
mean zero and variance t ´ s. This suggests that Brownian motion inherits the following
pnq
properties in the limit from Xt :
a) B has continuous sample paths,
b) B0 “ 0,
c) when s ă t, the increment Bt ´ Bs is a normally distributed random variables with
mean 0 and variance t ´ s and is independent of Bu ; for all u ď s.
The properties above fully characterize the Brownian motion.
Definition B.23. A stochastic process is a Brownian motion if it satisfies the properties
(a)-(c) above.
Property (c) in the definition of Brownian motion also implies some new properties for
the Brownian motion which will be useful in modeling financial asset prices.
- Time-homogeneity. Brownian motion is time homogeneous, i.e., Bt ´ Bs has the
same distribution as Bt´s .
- Markovian. The distribution of Bt given tBu : u ď su has the same distribution as
Bt given Bs , i.e., the most recent past is the only relevant information. Notice that
Bt “ Bs `Bt ´Bs . Since by property (c) Bt ´Bs is independent of Fs :“ tBu : u ď su,
the distribution of Bt “ Bs ` Bt ´ Bs given Fs “ tBu : u ď su is normal with mean
Bs and variance t ´ s, which only depends on the most recent past Bs . In other word,
by Proposition B.6
Erf pBt q | Fs s “ Erf pBt ´ Bs ` Bs q | Fs s “ Erf pBt ´ Bs ` Bs q | Bs s
253

B. PROBABILITY
- Martingale. Finally, the conditional expectation ErBt | Bu : u ď ss can be shown
to be equal to Bs .
ErBt | Bu : u ď ss “ ErBt | Bs s “ ErBs | Bs s ` ErBt ´ Bs | Bs s “ Bs .
In the above we used property (c) to conclude that ErBt ´ Bs | Bs s “ 0.
A typical sample paths of Brownian motion is shown in Figure B.9.

Figure B.9: A sample paths of Brownian motion

Sample space for Brownian motion
In order to construct a Brownian motion, we need to specify the sample space. In the early
work of Kolmogorov, we choose the sample space to be pRd qr0,8q , i.e., space of all functions
from r0, 8q to Rd . This is motivated by the fact that for any ω P Ω, the sample path of
Brownian motion associated with sample ω is given by the function Bt pωq : r0, 8q Ñ Rd .
See Figure B.9. Kolmogorov made a theory which in particular resulted in the existence
of Brownian motion. While it is not hard to show property (c), in his theory it is not easy
to show property (a) of Brownian motion, i.e., the sample paths are continuous. By using
the weak convergence result of Yuri Prokhorov, Norbert Wiener take the construction of
Brownian motion to a new level by taking the sample space Ω :“ Cpr0, 8q; Rd q, the space
of all continuous functions. This way property (a) becomes trivial, while, property (c) is
more challenging.
Among all the continuous functions in Cpr0, 8q; Rd q only a small set can be a sample
paths of a Brownian motion. In the following, we present some of the characteristics of the
254

B. PROBABILITY
paths of Brownian motion.
i) Sample paths of Brownian motion are nowhere diﬀerentiable. In addition,
lim sup
δÑ0

Bt`δ ´ Bt
“ 8,
δ

and

lim inf
δÑ0

Bt`δ ´ Bt
“ ´8.
δ

ii) Sample paths of Brownian motion are of bounded quadratic variation variations.
More precisely, the quadratic variation of the path of Brownian motion until time t,
equals t, i.e.,
Nÿ
´1
lim
pBti`1 ´ Bti q2 “ t, a.s.,
(B.15)
}Π}Ñ0

i“0

where for the partition Π :“ tt0 “ 0 ă t1 ă ¨ ¨ ¨ ă tN “ tu, }Π} “ maxi“0,...,N ´1 pti`1 ´
ti q
iii) Sample paths of Brownian motion are not of bounded variations almost surely, i.e.,
for
Nÿ
´1
sup
|Bti`1 ´ Bti | “ 8, a.s.,
Π

i“0

where the supremum is over all partitions Π :“ tt0 “ 0 ă t1 ă ¨ ¨ ¨ ă tN “ tu.
In the above, property (iii) is a result of (ii). More precisely, for a a continuous function
g : ra, bs Ñ R, a nonzero quadratic variation implies infinite bounded variation. To show
this, let’s assume that g is continuous and bounded variation B. Then, g is uniformly
continuous on ra, bs, i.e., for any ε ą 0, there exists a δ ą 0 such that if }Π} ď δ, then
max

i“0,...,N ´1

t|gpti`1 q ´ gpti q|u ď ε.

Thus,
Nÿ
´1
i“0

pgpti`1 q ´ gpti qq2 ď

max

i“0,...,N ´1

t|gpti`1 q ´ gpti q|u

Nÿ
´1

|gpti`1 q ´ gpti q| ď εB.

i“0

By sending ε Ñ 0, we obtain that the quadratic variation vanishes.
The following exercise shows the relation between the quadratic variation is martingale
properties of Brownian motion.
Exercise B.24. Show that Bt2 ´ t is a martingale, i.e.
2
ErBt`s
´ pt ` sq | Bs s “ Bs2 ´ s.

255

C. STOCHASTIC ANALYSIS

C

Stochastic analysis

Calculus is the study of derivative (not financial) and integral. Stochastic calculus is
therefore the study of integrals and diﬀerentials of stochastic objects such as Brownian
motion. In this section, we provide a brief overview of the stochastic integral and Itô
formula (stochastic chain rule). The application to finance is provided in Part 3.
şb
In calculus, the Riemann integral a f ptqdt is defined by the limit of Riemann sums:
lim δ

δÑ0

N
ÿ

f pt˚i q,

i“1

˚
where δ “ b´a
N , t0 “ a, ti “ t0 ` iδ, and ti is an arbitrary point in interval rti´1 , ti s. The
Reiman integral can be defined for a limited class of integrands, i.e., the real functions f is
Riemann integrable on ra, bs if and only if it is bounded and continuous almost everywhere.
A natural extension of Riemann integral is Lebesgue integral, which can be defined on a
large class of real functions, i.e., bounded measurable function on ra, bs.

A more general form of Riemann integral, Riemann-Stieltjes integral is defined in a similar
fashion. For two real functions f, g : ra, bs Ñ R, the integral of the integrand f with respect
to integrator g is defined by
żb
f ptqdgptq lim

δÑ0

a

N
ÿ

f pt˚i qpgpti q ´ gpti´1 q.

i“1

For Riemann-Stieltjes integral, and its extension, Lebegue-Stieltjes integral, to be welldefined, we need some conditions on f and g.
The condition on the integrand f is similar to the those in Riemann and Lebesgue integrals.
For example if f is continuous almost everywhere and at the points of discontinuity of g,
then no further condition needs to be imposed on f in the Riemann-Stieltjes integral. For
the Lebesgue-Stieltjes integral, f only needs to be measurable. However, for g a very crucial
condition is needed to make the integral well-defined. g must be of bounded variation, i.e.
lim

δÑ0

N
ÿ

|gpti`1 q ´ gpti q| ă 8.

i“0

No matter how nice the function f is, if g is unbounded variation, Riemann-Stieltjes or
Lebesgue-Stieltjes integral cannot be defined. As seen in Section B.5, the sample paths of
Brownian motion are of unbounded variation,
which makes it impossible to use them as
şb
the integrator. Therefore, the integral a f ptqdBt with respect to Brownian motion cannot
be defined pathwise in the sense of the Riemann-Stitljes or Lebesgue-Stieltjes integrals.
256

C. STOCHASTIC CALCULUS
15
In
şb this section, we define a new notion of integral, Itô integral , which makes sense of
a f ptqdBt in a useful way for some applications, including finance.
One of the major tools in stochastic analysis is the stochastic chain rule. Recall that the
chain rule in the diﬀerential form is written as dhpgptqq “ g 1 ptqh1 pgptqqdt, which can be
used in the change of variable in integral. If vptq “ hpgptqq and h and g are diﬀerentiable
functions, then
żb
żb
f ptqdvptq “
f ptqg 1 ptqh1 pgptqqdt.
a

a

The right-hand side above is a Riemann (Lebesgue) integral. As a matter of fact, change
of variable formula for Reimann (Lebesgue) integral is the integral format of the chain rule.
For bounded variation but not necessarily diﬀerentiable function g, the chain rule in the
change of variable for Riemann-Stieltjes (Lebesgue-Stieltjes) integral can be written in a
slightly diﬀerent way. More precisely, if vptq “ hpgptqq and h is a diﬀerentiable function
and g is of bounded variation, then
żb

żb
f ptqdvptq “

a

f ptqh1 pgptqqdgptq.

a

In the chain rule for Itô stochastic integral, an extra term appears. If vptq “ hpBt q and h
is a twice diﬀerentiable function, then
żb

żb
f ptqdvptq “

f ptqh1 pBt qdBt `

a

a

1
2

żb

f ptqh2 pBt qdt.

a

şb

As expected the term a f ptqh1 pBt qdBt shows up like in chain rule. However, the term
ş
1 b
2
2 a f ptqh pBt qdt, which is a simple Riemann integral, is unprecedented. In the remaining
of this section, we provide a heuristic argument why this term should be in the chain rule
for Itô stochastic integral.

C.1

Stochastic integral with respect to Brownian motion and Itô formula

We first introduce a special case of Itô integral, called Wiener integral16 . In Wiener integral,
we assume that the integrand f is simply a real function and is not stochastic. The the
partial sums
N
ÿ
Sδ :“
f pti´1 qpBti ´ Bti´1 q,
i“1

15
16

Named after Japanese mathematician Kiyosi Itô, 1915-2008.
Named after American mathematician Norbert Wiener, 1894-1964.

257

C. STOCHASTIC CALCULUS
is a Gaussian random variable with mean zero and variance
δ

N
ÿ

f 2 pti´1 q.

i“1

Exercise
C.1. Show that Sδ is a Gaussian random variable with mean zero and variance
ř
2 pt
δ N
f
i´1 q.
i“1
Therefore, it follows form
lim δ

δÑ0

N
ÿ

żb

2

f pti´1 q “

f 2 ptqdt,

a

i“1

şb
that Sδ ñ X where X is a normal random variable with mean zero and variance a f 2 ptqdt.
Notice that in the partial sum for Sδ , we choose ti´1 , i.e., the left endpoint on the interval
rti´1 , ti s. This choice is not crucial to achieve the limit. If we would choose diﬀerent points
on the interval, we still obtain the same limiting distributions. See Exercise C.2.
Exercise C.2. Calculate that the mean and the variance of partial sums below:
ř
a) N
i“1 f pti qpBti ´ Bti´1 q.
řN ´ ti `ti´1 ¯
pBti ´ Bti´1 q.
b) i“1 f
2
c)

řN

i“1 f pti´1 qpBti

´ Bti´1 q.

Then, show that in each case the limit of the calculated quantities as δ Ñ 0 is the same.
Itô integral extends Wiener integral to stochastic integrands. The integrand f is now a
function of time t P ra, bs and ω in sample space Ω. For our analysis in this notes, we only
need to define Itô integral on the integrands of the form f pt, Bt q where f : ra, bs ˆ R Ñ R
is a measurable function. Similar to the Winer integral we start with the partial sum
Nÿ
´1

f pti , Bti qpBti`1 ´ Bti q.

i“0

Exercise C.3. Calculate that the mean and the variance of partial sums below:
ř
a) N
i“1 Bti pBti ´ Bti´1 q.
ř
b) N
i“1 B ti `ti´1 pBti ´ Bti´1 q.
2

258

C. STOCHASTIC CALCULUS
c)

řN

i“1 Bti´1 pBti

´ Bti´1 q.

Then, show that in all cases the limits of the calculated quantities as δ Ñ 0 are diﬀerent.

żT

f pu, Bu qdBu :“ P ´ lim

δÑ0

0

Nÿ
´1

f pti , Bti qpBti`1 ´ Bti q.

(C.1)

i“0

The notation P ´ lim means the limit is in probability, i.e., for any ε ą 0,
¸
˜
żT
´1
ˇ
ˇ Nÿ
ˇ
ˇ
P ˇ
f pti , Bti qpBti`1 ´ Bti q ´
f pu, Bu qdBu ˇ ą ε Ñ 0 as δ Ñ 0.
0

i“0

The choice of starting point ti in the interval rti , ti`1 s in f pti , Bti q is crucial. This is because
choosing other point in the interval rti , ti`1 s leads to diﬀerent limits. Fo instance,
Nÿ
´1

f

i“0

´t ` t
¯
i
i`1 Bti `ti`1
,
pBti`1 ´ Bti q
2
2

converges to
żT

żT
f pu, Bu qdBu `

0

Bx f pu, Bu qdu.
0

Martingale property of stochastic integral
Consider the discrete sum which converges to the stochastic integral, i.e.
MT :“

Nÿ
´1

f pti , Bti qpBti`1 ´ Bti q

i“0

Assume that the values of B0 , ..., Btj are given. We want to evaluate the conditional
expectation of the stochastic sum MT , i.e.
ErMT | B0 , ..., Btj s.
Then, we split the stochastic sum into to parts
MT :“

j´1
ÿ

f pti , Bti qpBti`1 ´ Bti q `

i“0

Nÿ
´1
i“j

259

f pti , Bti qpBti`1 ´ Bti q.

C. STOCHASTIC CALCULUS
The first summation of the right-hand side above is known given B0 , ..., Btj . Thus,
ErMT | B0 , ..., Btj s “

j´1
ÿ

«
f pti , Bti qpBti`1 ´ Bti q ` E

i“0

“

j´1
ÿ

Nÿ
´1

ﬀ
f pti , Bti qpBti`1 ´ Bti q | B0 , ..., Btj

i“j

f pti , Bti qpBti`1 ´ Bti q `

i“0

Nÿ
´1

“
‰
E f pti , Bti qpBti`1 ´ Bti q | B0 , ..., Btj

i“j

Each term in the second summation of right-hand side above can be calculated by tower
property of conditional expectation
“
‰
“
‰
E f pti , Bti qpBti`1 ´ Bti q | B0 , ..., Btj “ E f pti , Bti qErBti`1 ´ Bti | B0 , ..., Bti s | B0 , ..., Btj .
Since Bti`1 ´ Bti is independent of B0 , ..., Bti ,
ErBti`1 ´ Bti | B0 , ..., Bti s “ ErBti`1 ´ Bti s “ 0.
This implies that the second summation vanishes and we have
ErMT | B0 , ..., Btj s “

j´1
ÿ

f pti , Bti qpBti`1 ´ Bti q “: Mtj .

i“0

In other words, given the Brownian motion up to time tj , the expected values of MT is
equal to Mtj . In probability terms, we call this a martingale. By some more technical tools,
one can show that given the path
time t ă T , the expected
şT of a Brownian motion şuntil
t
value of the stochastic integral 0 f ps, Bs qdBs is equal to 0 f ps, Bs qdBs , i.e.
E

„ż T
0

ˇ
ȷ żt
ˇ
f ps, Bs qdBs ˇˇBs for s P r0, ts “
f ps, Bs qdBs .
0

One of the consequence of martingale property is that the expectation of stochastic integral
is zero, i.e.
„ż
ȷ ż
E

T

0

f ps, Bs qdBs “
0

f ps, Bs qdBs “ 0.
0

Remark C.1. The martingale property of the stochastic integral with respect to Brownian
motion
is basically a result of martingale property of Brownian motion. Riemann
integral
şt
şt
f
ps,
B
qds
is
a
martingale
if
and
only
if
f
”
0.
Intuitively,
if
we
assume
f
ps,
B
s
s qds is
0
0
a martingale, we have
ˇ ı
” ż t`δ
ˇ
E
f ps, Bs qdsˇFt “ 0.
t

260

C. STOCHASTIC CALCULUS
By dividing both sides by δ and then sending δ Ñ 0, we obtain
ˇ ı
” 1 ż t`δ
ˇ
lim E
f ps, Bs qdsˇFt “ Erf pt, Bt q | Ft s “ f pt, Bt q.
δÑ0
δ t

C.2

Itô formula

One of the important implications of Itô integral is a very powerful tool called Itô formula.
Itô formula is the stochastic version of Taylor expansion. To understand this better let’s
try to write Taylor expansion for V pt ` δ, Bt`δ q about the point V pt, Bt q.
1
V pt ` δ, Bt`δ q “ V pt, Bt q ` δBt V pt, Bt q ` Bx V pt, Bt qpBt`δ ´ Bt q ` Bxx V pt, Bt qpBt`δ ´ Bt q2 ` opδq.
2
(C.2)
?
The remaining term in of order opδq since Bt`δ ´ Bt „ Op δq. Also, we know that
pBt`δ ´ Bt q2 ´ δ „ opδq, pBt`δ ´ Bt qδ „ opδq,

and trivially δ 2 „ opδq.

(C.3)

If we take conditional expectation with respect to Bt , we obtain
ErV pt ` δ, Bt`δ q | Bt s “V pt, Bt q ` δBt V pt, Bt q ` Bx V pt, Bt qErpBt`δ ´ Bt q | Bt s
1
` Bxx V pt, Bt qδ ` opδq.
2
1
“V pt, Bt q ` pBt V pt, Bt q ` Bxx V pt, Bt qqδ ` opδq
2
Notice that here, by the martingale property of Brownian motion, we have ErpBt`δ ´ Bt q |
Bt s “ 0. Then, we obtain
ﬀ
«
Nÿ
´1
1
ErV pT, BT qs “ V p0, B0 q ` E
pBt V pti , Bti q ` Bxx V pti , Bti qqδ ` op1q,
2
i“0
which in the limit converges to
ErV pT, BT qs “ V p0, B0 q ` E

„ż T
0

ȷ
1
pBt V pti , Bt q ` Bxx V pt, Bt qqdt .
2

The above formula is called Dynkin formula. If we don’t take conditional expectation, we
can write
1
V pt ` δ, Bt`δ q “ V pt, Bt q ` pBt V pt, Bt q ` Bxx V pt, Bt qqδ ` Bx V pt, Bt qpBt`δ ´ Bt q ` opδq.
2
261

C. STOCHASTIC CALCULUS
Then, we obtain
Nÿ
´1

V pT, BT q “ V p0, B0 q`

Nÿ
´1
1
pBt V pti , Bti q` Bxx V pti , Bti qqδ`
Bx V pti , Bti qpBti`1 ´Bti q`op1q.
2
i“0
i“0

which in the limit converges to
żT
V pT, BT q “ V p0, B0 q `
0

1
pBt V pt, Bt q ` Bxx V pt, Bt qqdt `
2

żT
Bx V pt, Bt qdBt .

(C.4)

0

In the above, (C.4) is referred to as Itô formula.
In a less formal way, Utô formula is given by
1
dV pt, Bt q “ pBt V pt, Bt q ` Bxx V pt, Bt qqdt ` Bx V pt, Bt qdBt .
2
However, it has to be interpreted as (C.4).
Exercise C.4. Use Itô formula to calculate dV pt, Bt q in the following cases.
a. V pt, xq “ eax
b. V pt, xq “ e´t eax
c. V pt, xq “ e´t cospxq
d. V pt, xq “ e´t xa
where a is a given constant.

C.3

Martingale property of stochastic integral and partial diﬀerential
equations

Why martingale property of stochastic integral is important? Recall the Itô formula
1
dV pt, Bt q “ pBt V pt, Bt q ` Bxx V pt, Bt qqdt ` Bx V pt, Bt qdBt .
2
Assume that V pt, xq satisfies the PDE
1
Bt V pt, xq ` Bxx V pt, xq “ 0.
2
Then,
dV pt, Bt q “ Bx V pt, Bt qdBt .
262

(C.5)

C. STOCHASTIC CALCULUS
and thus V pt, Bt q is a martingale, i.e.
V pt, Bt q “ ErV pT, BT q | Bs for s P r0, tss.
Conversely, if V pt, Bt q is a martingale, then V pt, xq must satisfy the PDE (C.5).

C.4

Stochastic integral and Stochastic diﬀerential equation

Riemann integral allows us to write a diﬀerential equation
integral equation
ż

dx
dt

“ f pt, xptqq, xp0q “ x0 as an

t

xptq “ x0 `

f ps, xpsqqds.

(C.6)

0

Integral equations are more general because the solution does not necessarily need to be
diﬀerentiable. For instance if
#
1 tě1
f pt, xq “
.
0 tă1
The solution to the integral equation is xptq “ x0 ` pt ´ 1q` , which is not diﬀerentiable at
t “ 1. While dx “ f pt, xptqqdt should be interpreted as (C.6).
Itô integral allows us to define stochastic diﬀerential equations (SDE for short) in integral
form. For example, the Black-Scholes diﬀerential equation is given by
dSt
“ rdt ` σdBt .
St
The true meaning of this term is
żt
St “ S0 ` r

żt
Su du ` σ

0

Su dBu .
0

The solution is a stochastic process St which satisfies the SDE. In the above case, it is easy
to verify, by means of Itô formula, that the geometric Brownian motion
ˆ
˙
1 2
St “ S0 exp pr ´ σ qt ` σBt .
2
`
˘
Take V pt, xq “ S0 exp pr ´ 12 σ 2 qt ` σx . It follows from Itô formula that
żt

1
V pt, Bt q “ V p0, B0 q ` pBt V ps, Bs q ` Bxx V ps, Bs qqdt `
2
0

żt
Bx V ps, Bs qdBs .
0

Since V p0, xq “ S0 , Bt V ps, xq “ pr ´ 21 σ 2 qV ps, xq, Bx V ps, xq “ σV ps, xq, and Bxx V ps, xq “
263

C. STOCHASTIC CALCULUS
σ 2 V ps, xq, we have
żt
V pt, Bt q “ S0 ` r

żt
V ps, Bs qds ` σ

0

V ps, Bs qdBs .
0

In general for a pair of given functions µpt, xq and σpt, xq, an equation of the form
dSt “ µpt, St qdt ` σpt, St qdBt

(C.7)

is called a stochastic diﬀerential equation (SDE). A solution St is a process such that the
Lebesgue integral
żt
µps, Ss qds ă 8 P-a.s.,
0

the Itô integral
żt
σps, Ss qdBs
0

is well-defined, and the following is satisfied:
żt
żt
St “ S0 ` µps, Ss qds ` σps, Ss qdBs .
0

0

For CEV model in Section ??, SDE is written as
dSt
“ rdt ` σStβ dBt
St
or in integral form
żt

żt
Su du ` σ

St “ S0 ` r

Su1`β dBu .

0

0

One of the most important applications of the Itôs formula is the chain rule in the stochastic form. Consider SDE
dSt “ µpt, St qdt ` σpt, St qdBt
(C.8)
and V pt, St q where V pt, xq is a function one time continuously diﬀerentiable in t and twice
continuously diﬀerentiable on x. Then we can write
1
V pt ` δ, St`δ q “ V pt, St q ` Bt V pt, St qδ ` Bx V pt, St qpSt`δ ´ St q ` Bxx V pt, St qpSt`δ ´ St q2 ` opδq.
2
Notice that by (C.8), we have
St`δ ´ St « µpt, St qδ ` σpt, St qpBt`δ ´ Bt q.
264

C. STOCHASTIC CALCULUS
Therefore, we have
pSt`δ ´ St q2 “ σ 2 pt, St qpBt`δ ´ Bt q2 ` opδq.
and
V pt ` δ, St`δ q “ V pt, St q ` Bt V pt, St qδ ` Bx V pt, St qpµpt, St qδ ` σpt, St qpBt`δ ´ Bt qq
1
` Bxx V pt, St qpµpt, St qδ ` σpt, St qpBt`δ ´ Bt qq2 ` opδq
2
“ V pt, St q ` Bt V pt, St qδ ` Bx V pt, St qpµpt, St qδ ` σpt, St qpBt`δ ´ Bt qq
1
` Bxx V pt, St qσ 2 pt, St qδ ` opδq
2
1
“ V pt, St q ` pBt V pt, St q ` Bx V pt, St qµpt, St q ` Bxx V pt, St qσ 2 pt, St qqδ
2
` σpt, St qBx V pt, St qpBt`δ ´ Bt qq ` opδq.
Or in the integral form we have
żt´
¯
1
Bt V pu, Su q ` Bx V pu, Su qµpu, Su q ` Bxx V pu, Su qσ 2 pu, Su q du
V pt, St q “V p0, S0 q `
2
0
żT
`
σpu, Su qBx V pu, Su qdBu .
0

(C.9)
Proposition C.1. If the function V pt, Sq is twice continuously diﬀerentiable and tV pt, St quTt“0
is a martingale, then
1
Bt V pt, Sq ` Bx V pt, Sqµpt, Sq ` Bxx V pt, Sqσ 2 pt, Sq “ 0
2
for all t P r0, T s and S.
Proof. By the Itô formula (C.9), we have
ż t´
¯
1
Bt V pu, Su q ` Bx V pu, Su qµpu, Su q ` Bxx V pu, Su qσ 2 pu, Su q du
2
0
żT
“ V pt, St q ´ V p0, S0 q ´
σpu, Su qBx V pu, Su qdBu .
0

Since the right-hand side is a martingale, so is the left-hand side. However, a Riemann
integral on the left cannot be a martingale unless
1
Bt V pt, St q ` Bx V pt, St qµpt, St q ` Bxx V pt, St qσ 2 pt, St q “ 0.
2
265

C. STOCHASTIC CALCULUS
This is because if the above term is not zero at some time t, e.g. positive, the Riemann
integral becomes increasing for a short interval rt, t ` δs, which contradicts the martingale
property.

C.5

Itô calculus

The calculations in the previous section can be obtained from a formal calculus. First, we
formally write (C.2) as
1
dV pt, Bt q “ Bt V pt, Bt qdt ` Bx V pt, Bt qdBt ` Bxx V pt, Bt qpdBt q2 .
2
Then, we present (C.3) in formal form of
pdBt q2 “ dt, dBt dt “ dtdBt “ 0 ,

and pdtq2 “ 0.

(C.10)

which implies the Itô formula for Brownian motion.
1
dV pt, Bt q “ pBt V pt, Bt q ` Bxx V pt, Bt qqdt ` Bx V pt, Bt qdBt .
2
For the Itô formula for process St in (C.8), we can formally write
1
dV pt, St q “ Bt V pt, St qdt ` Bx V pt, St qdSt ` Bxx V pt, St qpdSt q2 .
2
Then, we use (C.10) to obtain
pdSt q2 “ µ2 pdtq2 ` 2µσdtdBt ` σ 2 pdBt q2 “ σ 2 dt.
Thus,
σ 2 pt, St q
Bxx V pt, St qqdt ` Bx V pt, St qdSt .
2
Theorem C.1 (Itô formula). Consider St given by (C.8) and assume that function V is
once continuously diﬀerentiable in t and twice continuously diﬀerentiable in x. Then, we
have
dV pt, St q “ pBt V pt, St q `

dV pt, St q “ pBt V pt, St q ` µpt, St qBx V pt, St q `

σ 2 pt, St q
Bxx V pt, St qqdt ` σpt, St qBx V pt, St qdBt .
2

Similar to Section C.3, we can use martingale property of stochastic integral to obtain a
PDE. More precisely, V pt, St q is a martingale if and only if V pt, xq satisfies
1
Bt V pt, xq ` µpt, xqBx V pt, xq ` σ 2 pt, xq Bxx V pt, xq “ 0.
2

266

C. STOCHASTIC CALCULUS
Exercise C.5. Let
dSt “ St dt ` 2St dBt .
Calculate dV pt, St q in the following cases.
a. V pt, xq “ eax
b. V pt, xq “ e´t eax
c. V pt, xq “ e´t cospxq
d. V pt, xq “ e´t xa
where a is a constant.
Exercise C.6. In each of the following SDE, find the PDE for the function V pt, xq such
that V pt, St q is a martingale.
a. dSt “ σdBt where σ is constants.
b. dSt “ κpm ´ St qdt ` σdBt where κ, m and σ are constants.
?
c. dSt “ κpm ´ St qdt ` σ St dBt where κ, m and σ are constants.
d. dSt “ rSt dt ` σSt2 dBt where r and σ are constants.
Exercise C.7. Consider the SDE
dSt “ rSt dt ` σSt dBt where r and σ are constants.
a. Find the ODE for the function V pxq such that e´rt V pSt q is a martingale.
b. Find all the solutions to the ODE in (a).

267

C. STOCHASTIC CALCULUS

268

BIBLIOGRAPHY

BIBLIOGRAPHY

Bibliography
[1] M. R. Adams and V. Guillemin, Measure theory and probability, Springer, 1996.
[2] L. Bachelier, Théorie de la spéculation, Gauthier-Villars, 1900.
[3] D. P. Bertsekas and S. E. Shreve, Stochastic optimal control: the discrete time case,
Mathematics in Science and Engineering, Elsevier, Burlington, MA, 1978.
[4] P. Billingsley, Probability and measure, John Wiley & Sons, 2008.
[5] F. Black and M. Scholes, The pricing of options and corporate liabilities, The
journal of political economy, (1973), pp. 637–654.
[6] B. Bouchard, M. Nutz, et al., Arbitrage and duality in nondominated
discrete-time models, The Annals of Applied Probability, 25 (2015), pp. 823–859.
[7] B. Bouchard and X. Warin, Monte-carlo valuation of american options: facts
and new algorithms to improve existing methods, in Numerical methods in finance,
Springer, 2012, pp. 215–255.
[8] S. P. Boyd and L. Vandenberghe, Convex optimization (pdf), Np: Cambridge
UP, (2004).
[9] F. Delbaen and W. Schachermayer, A general version of the fundamental
theorem of asset pricing, Mathematische Annalen, 300 (1994), pp. 463–520.
[10] R. Durrett, Probability. theory and examples. the wadsworth & brooks/cole
statistics/probability series, Wadsworth & Brooks/Cole Advanced Books & Software,
Pacific Grove, CA, (1991).
[11] L. Eisenberg and T. H. Noe, Systemic risk in financial systems, Management
Science, 47 (2001), pp. 236–249.
[12] A. Fahim, N. Touzi, and X. Warin, A probabilistic numerical method for fully
nonlinear parabolic pdes, The Annals of Applied Probability, (2011), pp. 1322–1364.
269

BIBLIOGRAPHY

BIBLIOGRAPHY

[13] H. Föllmer and A. Schied, Stochastic finance: an introduction in discrete time,
Walter de Gruyter, 2011.
[14] J. Franke, W. K. Härdle, and C. M. Hafner, Statistics of financial markets,
vol. 2, Springer, 2004.
[15] P. Glasserman, Monte Carlo methods in financial engineering, vol. 53, Springer
Science & Business Media, 2003.
[16] J. Hull, Options, Futures and Other Derivatives, Options, Futures and Other Derivatives, Pearson/Prentice Hall, 2015.
[17] I. Karatzas and S. Shreve, Brownian motion and stochastic calculus, vol. 113,
Springer Science & Business Media, 2012.
[18] P.-S. Laplace, Essai philosophique sur les probabilités, H. Remy, 1829.
[19] F. A. Longstaff and E. S. Schwartz, Valuing american options by simulation: a
simple least-squares approach, Review of Financial studies, 14 (2001), pp. 113–147.
[20] H. Markowitz, Portfolio selection, The journal of finance, 7 (1952), pp. 77–91.
[21] R. C. Merton, An analytic derivation of the eﬃcient portfolio frontier, Journal of
financial and quantitative analysis, 7 (1972), pp. 1851–1872.
[22]

, Theory of rational option pricing, The Bell Journal of economics and management science, (1973), pp. 141–183.

[23] B. Oksendal, Stochastic diﬀerential equations: an introduction with applications,
Springer Science & Business Media, 2013.
[24] G. Peskir and A. Shiryaev, Optimal stopping and free-boundary problems,
Springer, 2006.
[25] P. Protter, A partial introduction to financial asset pricing theory, Stochastic processes and their applications, 91 (2001), pp. 169–203.
[26] W. Schachermayer and J. Teichmann, How close are the option pricing formulas
of bachelier and black–merton–scholes?, Mathematical Finance, 18 (2008), pp. 155–
170.
[27] S. Shreve, Stochastic calculus for finance I: the binomial asset pricing model, Springer
Science & Business Media, 2012.
[28] S. E. Shreve, Stochastic calculus for finance II: Continuous-time models, vol. 11,
Springer Science & Business Media, 2004.
270

BIBLIOGRAPHY

BIBLIOGRAPHY

[29] M. S. Taqqu, Bachelier and his times: a conversation with bernard bru, Finance and
Stochastics, 5 (2001), pp. 3–32.
[30] N. Touzi and P. Tankov, No-arbitrage theory for derivative pricing, Cours de
l’Ecole polytechnique, (2008).
[31] D. Williams, Probability with martingales, Cambridge university press, 1991.

271

INDEX

INDEX

Index
a.s., see almost surely
ABC, 120
almost surely, 103
arbitrage
arbitrage bounds, 36
model-independent arbitrage, 36
no weak arbitrage condition, 41
strong arbitrage, 41
weak arbitrage, 36, 41
Arrow-Debreu model, 39
artificial boundary conditions, see ABC
asset, 1
liquid, 1
return, 28
realized, 45
risk-free, 1
risky, 1
underlying, 2, 10
Bachelier model, 104
backwardation, 7
binomial model, 75
Black-Scholes equation, 157
Black-Scholes model, 135
bond, 14
convexity, 20
corporate, 16
coupon, 15
coupon-carrying, 15
duration, 19
face value, 14
maturity, 14
present value, 14

principle, 14
sovereign, 16
yield, 15
Brownian motion, 104
calibration, 93
binomial model
physical probability, 94
risk-neutral probability, 98
canonoical mapping, 66
CDO, seecollateralized debt obligation24
collateral portfolio, 24
trenches, 24
equity, 24
junior, 24
mezzanine, 24
senior, 24
central counterparty clearinghouse (CCP), 4
clearing payment, 8
collateralized debt obligation, 24
commodity, 1
computational domain, 120
contango, 7
contingent claim, 56
European, see Markovion82
Markovion, 82
continuously compounded rate, see short rate
credit risk, 2
debt, 1
Delta, 85
derivative, 1
maturity, 2
payoﬀ, 4
272

INDEX

INDEX

dividend yield, 90

complete, 57
incomplete, 57
martingale, 72
maturity, 2
Monte Carlo method, 126

Eisenberg-Noe model, 7
elementary securities, 48
equity, 1

financial risk, 2
no weak arbitrage condition, 41
financial security, 1
no-dominance principle, 33
fixed point, 8
fixed-income, 1
option, 10
maturity, 1
American, 14, 167
fixed-income security, 14
call, 14, 182
forward contract, 2
continuation value, 173
long position, 2
exercise value, 173
short position, 2
put, 14, 182
forward price, 3
straddle, 182
forward rate, 16
asian, 137
instantaneous, 17
at-the-money, 10
forward rate agreement, 17
basket option, 36
free boundary problem, 179
call, 10
FTAP, 104
digital, 107
fundamental theorem of asset pricing, see
call, 107
FTAP
put, 107
futures contract, 2
European, 11
futures prices, 3
in-the-money, 10
long position, 11
GBM, 135
look-back, 137
geometric Brownian motion, see GBM
outof-the-money, 10
Greeks, 140
put, 10
Delta, 142
short position, 11
Gamma, 142
vanilla, 10
Theta, 142
payoﬀ
heat equation
Bear-spread call, 148
backward, 111
Bull-spread call, 148
forward, 111
European, 11
hedging
path-dependent, 87
Delta, 85, 137
straddle, 148
strangle, 148
instantaneous rate, see short rate
payoﬀ function, see payoﬀ
polar collection, 71
marginal account, 4
market
polar sets, 71
273

INDEX
generated, 73
portfolio, 28, 41
of bonds, 15
admissible, 74
collateral portfolio, 24
eﬃcient portfolio, 28
investment portfolio, 28
long position, 41
of defaultable assets, 24
replicating, 52
self-financing, 66
short position, 41
pricing model, 58
prime rating, 21
quadrature method, 126
rate of return, 94
replication
perfect, 58
return
Arithmetic, 93
logarithmic, 93
risk
market, 2
model risk, 58
operational, 2
systemic, 2, 25
risk premium, 96
risk-adjusted probability
risk-neutral probability, 42
risk-neutral probability, 42, 58

INDEX
diﬀusion, 101
Markovian, 78
strike price, 10
subprime rating, 21
superreplication, 58
superreplication price, 58
survival rate, 21
underlying, see asset2
volatility, 94
weak convergence
binomial to GBM, 129
yield
risk-adjusted yield, 22
zero bond, see zero-coupon bond
maturity, 14
principle, 14
zero-coupon bond, 14

sample path, 65
security, 1
short rate, 15
short selling, 34
Snell envelope, 176
spot price, 3
spot rate, see short rate
state-price deflator, 47
stochastic process, 64
274

